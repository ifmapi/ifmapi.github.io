"use strict";function UpdateIceServersSync(){console.warn("UpdateIceServersSync Enter");let n=null;if(!custom.webrtcconfig.turn_disable)try{n=Ifm.TurnCredentialManager.getLastCredential(!0)}catch(i){console.error("UpdateIceServersSync: Error "+i)}let t=[];if(t.push({url:"stun:216.93.246.18:3478"}),!custom.webrtcconfig.turn_disable){const n={url:"turn:"+custom.webrtcconfig.turn_server+":3478?transport=udp",username:"noname",credential:"nocredential"};t.push(n)}!custom.webrtcconfig.turn_disable&&n?(console.warn("GBL: UpdateIceServersSync - Add TURN server to stack"),oSipStack.o_stack.network.ao_ice_servers=t,oSipStack.o_stack.network.ao_ice_servers[1].username=n.username,oSipStack.o_stack.network.ao_ice_servers[1].credential=n.credential):(console.warn("GBL: UpdateIceServersSync - Only STUN server"),oSipStack.o_stack.network.ao_ice_servers=[],oSipStack.o_stack.network.ao_ice_servers.push(t[0]))}function postInit(){if(SIPml.isWebRtc4AllSupported()&&SIPml.isWebRtc4AllPluginOutdated()&&confirm("Your WebRtc4all extension is outdated ("+SIPml.getWebRtc4AllVersion()+"). A new version with critical bug fix is available. Do you want to install it?\nIMPORTANT: You must restart your browser after the installation.")){window.location="http://code.google.com/p/webrtc4all/downloads/list";return}if(!SIPml.isWebRtcSupported()){if(SIPml.getNavigatorFriendlyName()=="chrome"){window.location=confirm("You're using an old Chrome version or WebRTC is not enabled.\nDo you want to see how to enable WebRTC?")?"http://www.webrtc.org/running-the-demos":"index.html";return}if(SIPml.getSystemFriendlyName()=="windows"){if(SIPml.getNavigatorFriendlyName()=="ie"){if(parseFloat(SIPml.getNavigatorVersion())<9&&(window.location=confirm("You are using an old IE version. You need at least version 9. Would you like to update IE?")?"http://windows.microsoft.com/en-us/internet-explorer/products/ie/home":"index.html"),SIPml.isWebRtc4AllSupported()||confirm("webrtc4all extension is not installed. Do you want to install it?\nIMPORTANT: You must restart your browser after the installation.")&&(window.location="http://code.google.com/p/webrtc4all/downloads/list"),!SIPml.isWebRtc4AllSupported())return}else if(SIPml.getNavigatorFriendlyName()=="safari"||SIPml.getNavigatorFriendlyName()=="firefox"||SIPml.getNavigatorFriendlyName()=="opera"){window.location=confirm("Your browser don't support WebRTC.\nDo you want to install WebRTC4all extension to enjoy audio/video calls?\nIMPORTANT: You must restart your browser after the installation.")?"http://code.google.com/p/webrtc4all/downloads/list":"index.html";return}}else{window.location=confirm("WebRTC not supported on your browser.\nDo you want to download a WebRTC-capable browser?")?"https://www.google.com/intl/en/chrome/browser/":"index.html";return}}if(!SIPml.isWebSocketSupported()&&!SIPml.isWebRtc4AllSupported()){window.location=confirm("Your browser don't support WebSockets.\nDo you want to download a WebSocket-capable browser?")?"https://www.google.com/intl/en/chrome/browser/":"index.html";return}SIPml.isWebRtc4AllSupported()?(viewVideoLocal=document.getElementById("divVideoLocal"),viewVideoRemote=document.getElementById("divVideoRemote"),WebRtc4all_SetDisplays(viewVideoLocal,viewVideoRemote)):(viewVideoLocal=videoLocal,viewVideoRemote=videoRemote);SIPml.isWebRtc4AllSupported()||SIPml.isWebRtcSupported()||confirm("Your browser don't support WebRTC.\naudio/video calls will be disabled.\nDo you want to download a WebRTC-capable browser?")&&(window.location="https://www.google.com/intl/en/chrome/browser/");document.body.style.cursor="default";oConfigCall={audio_remote:audioRemote,video_local:viewVideoLocal,video_remote:viewVideoRemote,bandwidth:{audio:undefined,video:64},video_size:{minWidth:undefined,minHeight:undefined,maxWidth:undefined,maxHeight:undefined},events_listener:{events:"*",listener:onSipEventSession},sip_caps:[{name:"+g.oma.sip-im"},{name:"+sip.ice"},{name:"language",value:'"en,fr"'}]}}function sipRegister(){try{if(window.webkitNotifications&&window.webkitNotifications.checkPermission()!=0&&window.webkitNotifications.requestPermission(),SIPml.setDebugLevel("info"),oSipStack=new SIPml.Stack({realm:v_realm,impi:v_impi,impu:v_impu,password:v_passwd,display_name:v_displayname,websocket_proxy_url:v_websocket,outbound_proxy_url:window.localStorage?window.localStorage.getItem("org.doubango.expert.sip_outboundproxy_url"):null,ice_servers:window.localStorage?window.localStorage.getItem("org.doubango.expert.ice_servers"):null,enable_rtcweb_breaker:window.localStorage?window.localStorage.getItem("org.doubango.expert.enable_rtcweb_breaker")=="true":!1,events_listener:{events:"*",listener:onSipEventStack},enable_early_ims:window.localStorage?window.localStorage.getItem("org.doubango.expert.disable_early_ims")!="true":!0,enable_media_stream_cache:window.localStorage?window.localStorage.getItem("org.doubango.expert.enable_media_caching")=="true":!1,bandwidth:window.localStorage?tsk_string_to_object(window.localStorage.getItem("org.doubango.expert.bandwidth")):null,video_size:window.localStorage?tsk_string_to_object(window.localStorage.getItem("org.doubango.expert.video_size")):null,sip_headers:[{name:"User-Agent",value:"IM-client/OMA1.0 sipML5-v1.2013.08.10B"},{name:"Organization",value:"Doubango Telecom"}]}),oSipStack.start()!=0)debug("Failed to start the SIP stack");else return}catch(n){debug(n)}}function sipUnRegister(){oSipStack&&oSipStack.stop()}function sipCall(n,t){if(UpdateIceServersSync(),oSipStack&&!oSipSessionCall){var i=null;if(i=t==!0?"call-audiovideo":"call-audio",window.localStorage&&(oConfigCall.bandwidth=tsk_string_to_object(window.localStorage.getItem("org.doubango.expert.bandwidth")),oConfigCall.video_size=tsk_string_to_object(window.localStorage.getItem("org.doubango.expert.video_size"))),oSipSessionCall=oSipStack.newSession(i,oConfigCall),oSipSessionCall.call(n)!=0){oSipSessionCall=null;debug("Failed to make call");onCallEnded();return}}else oSipSessionCall&&(debug("Connecting..."),oSipSessionCall.accept(oConfigCall))}function sipHangUp(){oSipSessionCall&&(oSipSessionCall.hangup({events_listener:{events:"*",listener:onSipEventSession}}),debug("Terminating the call..."),onCallEnded())}function sipSendDTMF(n){if(oSipSessionCall&&n&&oSipSessionCall.dtmf(n)==0)try{dtmfTone.play()}catch(t){}}function startRingTone(){try{ringtone.play()}catch(n){}}function stopRingTone(){try{ringtone.pause()}catch(n){}}function startRingbackTone(){try{ringbacktone.play()}catch(n){}}function stopRingbackTone(){try{ringbacktone.pause()}catch(n){}}function toggleFullScreen(){videoRemote.webkitSupportsFullscreen?fullScreen(!videoRemote.webkitDisplayingFullscreen):fullScreen(!bFullScreen)}function fullScreen(n){if(bFullScreen=n,tsk_utils_have_webrtc4native()&&bFullScreen&&videoRemote.webkitSupportsFullscreen)bFullScreen?videoRemote.webkitEnterFullScreen():videoRemote.webkitExitFullscreen();else if(tsk_utils_have_webrtc4npapi())try{window.__o_display_remote&&window.__o_display_remote.setFullScreen(n)}catch(t){divVideo.setAttribute("class",n?"full-screen":"normal-screen")}else divVideo.setAttribute("class",n?"full-screen":"normal-screen")}function showNotifICall(n){window.webkitNotifications&&window.webkitNotifications.checkPermission()==0&&(oNotifICall&&oNotifICall.cancel(),oNotifICall=window.webkitNotifications.createNotification("images/sipml-34x39.png","Incaming call","Incoming call from "+n),oNotifICall.onclose=function(){"use strict";oNotifICall=null},oNotifICall.show())}function onKeyUp(n){n=n||window.event;n.keyCode==27?fullScreen(!1):n.ctrlKey&&n.shiftKey&&(n.keyCode==65||n.keyCode==86)&&(bDisableVideo=n.keyCode==65,debug("<i>Video "+(bDisableVideo?"disabled":"enabled")+"<\/i>"),window.localStorage.setItem("org.doubango.expert.disable_video",bDisableVideo))}function uiVideoDisplayEvent(){}function uiVideoDisplayShowHide(){}function uiCallTerminated(n){oSipSessionCall=null;stopRingbackTone();stopRingTone();debug(n);uiVideoDisplayShowHide(!1);oNotifICall&&(oNotifICall.cancel(),oNotifICall=null);uiVideoDisplayEvent(!0,!1);uiVideoDisplayEvent(!1,!1);onCallEnded();setTimeout(function(){},2500)}function onSipEventStack(n){var i,t;tsk_utils_log_info("==stack event = "+n.type);switch(n.type){case"started":try{oSipSessionRegister=this.newSession("register",{expires:200,events_listener:{events:"*",listener:onSipEventSession},sip_caps:[{name:"+g.oma.sip-im",value:null},{name:"+audio",value:null},{name:"language",value:'"en,fr"'}]});oSipSessionRegister.register()}catch(n){debug(n)}break;case"stopping":case"stopped":case"failed_to_start":case"failed_to_stop":i=n.type=="failed_to_start"||n.type=="failed_to_stop";oSipStack=null;oSipSessionRegister=null;oSipSessionCall=null;stopRingbackTone();stopRingTone();uiVideoDisplayShowHide(!1);debug(n.description);break;case"i_new_call":oSipSessionCall?n.newSession.hangup():(oSipSessionCall=n.newSession,oSipSessionCall.setConfiguration(oConfigCall),startRingTone(),t=oSipSessionCall.getRemoteFriendlyName()||"unknown",debug("Incoming call from"+t),showNotifICall(t));break;case"m_permission_accepted":case"m_permission_refused":n.type=="m_permission_refused"&&uiCallTerminated("Media stream permission denied")}}function onSipEventSession(n){var i,u,t,r;tsk_utils_log_info("==session event = "+n.type);switch(n.type){case"connecting":case"connected":i=n.type=="connected";n.session==oSipSessionRegister?debug(n.description):n.session==oSipSessionCall&&(i&&(stopRingbackTone(),stopRingTone(),onCallConnected(),oNotifICall&&(oNotifICall.cancel(),oNotifICall=null)),debug(n.description),SIPml.isWebRtc4AllSupported()&&(uiVideoDisplayEvent(!0,!0),uiVideoDisplayEvent(!1,!0)));break;case"terminating":case"terminated":n.session==oSipSessionRegister?(oSipSessionCall=null,oSipSessionRegister=null,debug(n.description)):n.session==oSipSessionCall&&uiCallTerminated("Call terminated");break;case"m_stream_video_local_added":n.session==oSipSessionCall&&uiVideoDisplayEvent(!0,!0);break;case"m_stream_video_local_removed":n.session==oSipSessionCall&&uiVideoDisplayEvent(!0,!1);break;case"m_stream_video_remote_added":n.session==oSipSessionCall&&uiVideoDisplayEvent(!1,!0);break;case"m_stream_video_remote_removed":n.session==oSipSessionCall&&uiVideoDisplayEvent(!1,!1);break;case"m_stream_audio_remote_added":u=n.session.o_session.o_stream_local;break;case"i_ao_request":n.session==oSipSessionCall&&(t=n.getSipResponseCode(),(t==180||t==183)&&(startRingbackTone(),debug("Remote ringing...")));break;case"m_early_media":n.session==oSipSessionCall&&(stopRingbackTone(),stopRingTone(),debug("Early media started"));break;case"m_remote_hold":n.session==oSipSessionCall&&debug("Placed on hold by remote party");break;case"m_remote_resume":n.session==oSipSessionCall&&debug("Taken off hold by remote party");break;case"o_ect_trying":n.session==oSipSessionCall&&debug("Call transfer in progress...");break;case"o_ect_accepted":n.session==oSipSessionCall&&debug("Call transfer accepted");break;case"o_ect_completed":case"i_ect_completed":n.session==oSipSessionCall&&(debug("Call transfer completed"),oSipSessionTransferCall&&(oSipSessionCall=oSipSessionTransferCall),oSipSessionTransferCall=null);break;case"o_ect_failed":case"i_ect_failed":n.session==oSipSessionCall&&debug("Call transfer failed");break;case"o_ect_notify":case"i_ect_notify":n.session==oSipSessionCall&&(debug(n.getSipResponseCode()+n.description),n.getSipResponseCode()>=300&&oSipSessionCall.bHeld&&oSipSessionCall.resume());break;case"i_ect_requested":if(n.session==oSipSessionCall){if(r="Do you accept call transfer to ["+n.getTransferDestinationFriendlyName()+"]?",confirm(r)){debug("Call transfer in progress...");oSipSessionCall.acceptTransfer();break}oSipSessionCall.rejectTransfer()}}}function UpdateCurrentConfig(){if(typeof custom.webrtcconfig=="undefined"){console.error("Configuration not defined!!!");return}window.v_realm=custom.webrtcconfig.sip_realm;window.v_impi=custom.webrtcconfig.user;window.v_impu="sip:"+custom.webrtcconfig.user+"@"+custom.webrtcconfig.sip_realm;window.v_passwd=custom.webrtcconfig.password;window.v_displayname=custom.webrtcconfig.user+" over C2T";window.v_websocket=custom.webrtcconfig.sip_websocket;window.v_turn_only=custom.webrtcconfig.turn_only;window.v_turn_disable=custom.webrtcconfig.turn_disable;window.v_stunserver={url:"stun:216.93.246.18:3478"};window.v_turnserver={url:"turn:"+custom.webrtcconfig.turn_server+":3478?transport=udp",username:"none",credential:"none"};custom.webrtcconfig.turn_disable||(window.v_turncredserver=custom.webrtcconfig.turn_cred_server,Ifm.TurnCredentialManager.initServerConnection(v_turncredserver))}function CreateTurnCredentialManager(){function f(){console.warn("Try opening WebSocket "+n);t=new WebSocket(n);t.onopen=function(n){s(n)};t.onclose=function(n){h(n)};t.onmessage=function(n){l(n)};t.onerror=function(n){c(n)}}function o(){const n=10;console.warn("Next InitWebSocket() after "+n+" seconds");setTimeout(f,n*1e3)}function s(){console.warn("onOpen: "+n+" CONNECTED");u()}function h(){console.warn("OnClose: "+n+" DISCONNECTED");o()}function c(){console.warn("onError: "+n+" ERROR")}function l(t){const u=t.data;i=JSON.parse(u);const r="TURN "+n+" -> "+i.credential;console.warn(r);window.AppendToLog&&window.AppendToLog(r);i&&i.credential?a(i):e("Invalid server response")}function a(n){r&&r.resolve(n);r=null}function e(n){r&&r.reject(n);r=null}function u(){i=null;t.readyState==WebSocket.OPEN?t.send("GetNewCredential"):(console.error("WebSocket"+n+" not ready, credential not requested!!!"),e("Websocket not ready!!!"))}function v(t){n=t;f()}function y(){const n=new Promise(function(n,t){r={resolve:n,reject:t};u()});return n}function p(n){let t=i;return n&&u(),t}var t,n,i=null,r=null;return{initServerConnection:v,getCredentialAsync:y,getLastCredential:p}}function NotifyMediaSessionCreation(n){console.warn("GBL: NotifyMediaSessionCreation!!!");CurrentMediaSession=n}function checkMediaSession(n,t){n!=CurrentMediaSession&&console.error("GBL: Media session is changed!!! Extra Msg = "+t)}function NotifyNewCandidate(n,t){const i=3e3;if(typeof NotifyNewCandidate.candidateCounter=="undefined"&&(NotifyNewCandidate.candidateCounter=0),checkMediaSession(n,NotifyNewCandidate.name),t==null){NumberOfGatheredCandidates=NotifyNewCandidate.candidateCounter;NotifyNewCandidate.candidateCounter=0;console.warn(JLP+"Candidate is NULL - Total Candidate = "+NumberOfGatheredCandidates);NotifyNewCandidate.TimerId&&(console.warn(JLP+"Cancel candidate timeout"),clearInterval(NotifyNewCandidate.TimerId));return}console.warn(JLP+"Cand["+NotifyNewCandidate.candidateCounter+"] = "+t.candidate);NotifyNewCandidate.candidateCounter==0&&(console.warn(JLP+"Set candidate timeout - setTimeout( "+i+" ms )"),NotifyNewCandidate.TimerId=setTimeout(function(){CandidateTimeout(n)},i));NotifyNewCandidate.candidateCounter++}function CandidateTimeout(n){if(console.warn(JLP+"CandidateTimeout"),n!==CurrentMediaSession&&console.error(JLP+"Wrong media session"),tmedia_session_jsep01)tmedia_session_jsep01.onIceGatheringCompleted(n)}function isSetLocalDescriptionToDefer(n,t){checkMediaSession(n,isSetLocalDescriptionToDefer.name);const i=t&&!n.b_PreventDefer;return n.b_PreventDefer=!0,i}function DeferSetLocalDescription(n){console.warn("GBL: DeferSetLocalDescription");deferredSetLocalDescriptionContext={};deferredSetLocalDescriptionContext.funcToCall=n;deferredSetLocalDescriptionContext.EffectsPromise=new Promise(function(n,t){deferredSetLocalDescriptionContext.resolve=n;deferredSetLocalDescriptionContext.reject=t})}function ExecuteDeferredSetLocalDescription(){if(console.warn("GBL: ExecuteDeferredSetLocalDescription - enter!!!"),!CurrentMediaSession){console.error("GBL: ExecuteDeferredSetLocalDescription: exit (No Media Session)");return}CurrentMediaSession.b_PreventDefer=!0;let n=deferredSetLocalDescriptionContext;if(!n){console.error("GBL: ExecuteDeferredSetLocalDescription exit (no context)");return}if(n.funcWasCalled){console.error("GBL: ExecuteDeferredSetLocalDescription exit (called twice)");return}Promise.resolve().then(n.funcToCall);n.funcWasCalled=!0;try{n.EffectsPromise}catch(t){console.error("GBL: ExecuteDeferredSetLocalDescription - Error = "+t)}console.warn("GBL: ExecuteDeferredSetLocalDescription - exit OK!!!")}function NotifySetLocalDescriptionEffects(n){console.warn("GBL: NotifySetLocalDescriptionEffects("+n+")");let t=deferredSetLocalDescriptionContext;if(deferredSetLocalDescriptionContext=null,!t){console.warn("GBL: deferredSetLocalDescriptionContext not set");return}n?t.resolve():t.reject()}function RemoveCryptoAttribute(n){const t=n.match(/^a=crypto.*/gm);if(!t)return n;for(let i=0;i<t.length;i++){let r=t[i];n=n.replace(r+"\r\n","")}return n}function RemoveReflexiveCandidate(n){const t=n.match(/^a=candidate.*/gm);if(!t)return n;for(let i=0;i<t.length;i++){let r=t[i];r.match(/typ srflx/)&&(console.warn(JLP+"RemoveReflexiveCandidate: Deleted candidate "+r),n=n.replace(r+"\r\n",""))}return n}function PruneCandidate(n){const i=["TCP","tcp","srflx"],t=n.match(/^a=candidate.*/gm);if(!t)return n;for(let r=0;r<t.length;r++){let u=t[r],f=i.some(function(n){return u.includes(n)});f&&(console.warn(JLP+"Removed "+u),n=n.replace(u+"\r\n",""))}return n}function PatchReflexiveCandidate(n){var t,r,u,f;const i=n.match(/^a=candidate.*/gm);if(!i)return n;for(t=0;t<i.length;t++)if(r=i[t],r.match(/typ srflx/)){u=r.split(" ");f=u[5];break}const e="typ srflx raddr 192.168.107.10 rport "+f;return console.warn(JLP+"Modifico candidate srflx aggiungendo = "+e),n.replace(/typ srflx/gm,e)}function PatchTXSDP(n){var t=n;return console.warn(JLP+"PatchTXSDP : enter !!!"),bPruneCandidate&&(t=PruneCandidate(t)),t==n?console.warn(JLP+"TX SDP Not Modified/Patched !!!"):(console.warn(JLP+"TX SDP (Modified/Patched) = "),console.warn("<--\r\n"+t+"-->\r\n")),t}function PatchRXSDP(n){var t;return console.warn(JLP+"PatchRXSDP: enter !!!"),t=n,browserIsEdge&&(t=RemoveReflexiveCandidate(t)),bPruneCandidate&&(t=PruneCandidate(t)),!0&&(t=RemoveCryptoAttribute(t)),t==n?console.warn(JLP+"RX SDP not Modified/Patched"):(console.warn(JLP+"RX SDP (Modified/Patched) = "),console.warn("\r\n"+t+"\r\n")),t}function checkWebRTCSupport(){var n=!1,t;if(typeof webkitRTCPeerConnection!="undefined"||typeof mozRTCPeerConnection!="undefined"&&navigator.appCodeName=="Mozilla"&&bowser.version>=21)if(typeof mozRTCPeerConnection!="undefined")try{t=new mozRTCPeerConnection({iceServers:[]});n=!0}catch(i){return n=!1,!1}else n=!0;return n||typeof RTCPeerConnection!="undefined"&&(n=!0),n}function getFlashObject(n){if(window.document[n])return window.document[n];if(navigator.appName.indexOf("Microsoft Internet")==-1){if(document.embeds&&document.embeds[n])return document.embeds[n]}else return document.getElementById(n)}function onCallConnecting(){raise(Ifm.Phone.onConnecting)}function onCallConnected(){raise(Ifm.Phone.onConnected)}function onCallEnded(){Ifm.Phone.dropped();raise(Ifm.Phone.onDisconnected)}function onRejected(n){Ifm.Phone.dropped();raise(Ifm.Phone.onRejected(n))}function detectWebRTC(){return Ifm.Phone.transport.webRTC}function debug(){}function customLog(){}function guiSetup(){}function raise(n){typeof n=="function"&&n()}var sTransferNumber,oRingTone,oRingbackTone,oSipStack,oSipSessionRegister,oSipSessionCall,oSipSessionTransferCall,videoRemote,videoLocal,audioRemote,bFullScreen,oNotifICall,oReadyStateTimer,bDisableVideo,viewVideoLocal,viewVideoRemote,oConfigCall,CurrentMediaSession,NumberOfGatheredCandidates,deferredSetLocalDescriptionContext,onPhoneConnected,onPhoneDisconnected;(function(n){if(typeof exports=="object"&&typeof module!="undefined")module.exports=n();else if(typeof define=="function"&&define.amd)define([],n);else{var t;t=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:this;t.adapter=n()}})(function(){return function n(t,i,r){function u(f,o){var h,c,s;if(!i[f]){if(!t[f]){if(h=typeof require=="function"&&require,!o&&h)return h(f,!0);if(e)return e(f,!0);c=new Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c;}s=i[f]={exports:{}};t[f][0].call(s.exports,function(n){"use strict";var i=t[f][1][n];return u(i?i:n)},s,s.exports,n,t,i,r)}return i[f].exports}for(var e=typeof require=="function"&&require,f=0;f<r.length;f++)u(r[f]);return u}({1:[function(n,t){var i={};i.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)};i.localCName=i.generateIdentifier();i.splitLines=function(n){return n.trim().split("\n").map(function(n){return n.trim()})};i.splitSections=function(n){var t=n.split("\nm=");return t.map(function(n,t){return(t>0?"m="+n:n).trim()+"\r\n"})};i.matchPrefix=function(n,t){return i.splitLines(n).filter(function(n){return n.indexOf(t)===0})};i.parseCandidate=function(n){var t,r,i;for(t=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" "),r={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case"raddr":r.relatedAddress=t[i+1];break;case"rport":r.relatedPort=parseInt(t[i+1],10);break;case"tcptype":r.tcpType=t[i+1];break;default:r[t[i]]=t[i+1]}return r};i.writeCandidate=function(n){var t=[],i;return t.push(n.foundation),t.push(n.component),t.push(n.protocol.toUpperCase()),t.push(n.priority),t.push(n.ip),t.push(n.port),i=n.type,t.push("typ"),t.push(i),i!=="host"&&n.relatedAddress&&n.relatedPort&&(t.push("raddr"),t.push(n.relatedAddress),t.push("rport"),t.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(t.push("tcptype"),t.push(n.tcpType)),n.ufrag&&(t.push("ufrag"),t.push(n.ufrag)),"candidate:"+t.join(" ")};i.parseIceOptions=function(n){return n.substr(14).split(" ")};i.parseRtpMap=function(n){var t=n.substr(9).split(" "),i={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),i.name=t[0],i.clockRate=parseInt(t[1],10),i.numChannels=t.length===3?parseInt(t[2],10):1,i};i.writeRtpMap=function(n){var t=n.payloadType;return n.preferredPayloadType!==undefined&&(t=n.preferredPayloadType),"a=rtpmap:"+t+" "+n.name+"/"+n.clockRate+(n.numChannels!==1?"/"+n.numChannels:"")+"\r\n"};i.parseExtmap=function(n){var t=n.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}};i.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+"\r\n"};i.parseFmtp=function(n){for(var r={},t,u=n.substr(n.indexOf(" ")+1).split(";"),i=0;i<u.length;i++)t=u[i].trim().split("="),r[t[0].trim()]=t[1];return r};i.writeFmtp=function(n){var i="",r=n.payloadType,t;return n.preferredPayloadType!==undefined&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length&&(t=[],Object.keys(n.parameters).forEach(function(i){t.push(i+"="+n.parameters[i])}),i+="a=fmtp:"+r+" "+t.join(";")+"\r\n"),i};i.parseRtcpFb=function(n){var t=n.substr(n.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}};i.writeRtcpFb=function(n){var t="",i=n.payloadType;return n.preferredPayloadType!==undefined&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(function(n){t+="a=rtcp-fb:"+i+" "+n.type+(n.parameter&&n.parameter.length?" "+n.parameter:"")+"\r\n"}),t};i.parseSsrcMedia=function(n){var t=n.indexOf(" "),i={ssrc:parseInt(n.substr(7,t-7),10)},r=n.indexOf(":",t);return r>-1?(i.attribute=n.substr(t+1,r-t-1),i.value=n.substr(r+1)):i.attribute=n.substr(t+1),i};i.getMid=function(n){var t=i.matchPrefix(n,"a=mid:")[0];if(t)return t.substr(6)};i.parseFingerprint=function(n){var t=n.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}};i.getDtlsParameters=function(n,t){var r=i.matchPrefix(n+t,"a=fingerprint:");return{role:"auto",fingerprints:r.map(i.parseFingerprint)}};i.writeDtlsParameters=function(n,t){var i="a=setup:"+t+"\r\n";return n.fingerprints.forEach(function(n){i+="a=fingerprint:"+n.algorithm+" "+n.value+"\r\n"}),i};i.getIceParameters=function(n,t){var r=i.splitLines(n);return r=r.concat(i.splitLines(t)),{usernameFragment:r.filter(function(n){return n.indexOf("a=ice-ufrag:")===0})[0].substr(12),password:r.filter(function(n){return n.indexOf("a=ice-pwd:")===0})[0].substr(10)}};i.writeIceParameters=function(n){return"a=ice-ufrag:"+n.usernameFragment+"\r\na=ice-pwd:"+n.password+"\r\n"};i.parseRtpParameters=function(n){for(var u,e,t,o,r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},h=i.splitLines(n),s=h[0].split(" "),f=3;f<s.length;f++)if(u=s[f],e=i.matchPrefix(n,"a=rtpmap:"+u+" ")[0],e){t=i.parseRtpMap(e);o=i.matchPrefix(n,"a=fmtp:"+u+" ");t.parameters=o.length?i.parseFmtp(o[0]):{};t.rtcpFeedback=i.matchPrefix(n,"a=rtcp-fb:"+u+" ").map(i.parseRtcpFb);r.codecs.push(t);switch(t.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(t.name.toUpperCase())}}return i.matchPrefix(n,"a=extmap:").forEach(function(n){r.headerExtensions.push(i.parseExtmap(n))}),r};i.writeRtpDescription=function(n,t){var r="",u;return r+="m="+n+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(n){return n.preferredPayloadType!==undefined?n.preferredPayloadType:n.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(n){r+=i.writeRtpMap(n);r+=i.writeFmtp(n);r+=i.writeRtcpFb(n)}),u=0,t.codecs.forEach(function(n){n.maxptime>u&&(u=n.maxptime)}),u>0&&(r+="a=maxptime:"+u+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(n){r+=i.writeExtmap(n)}),r};i.parseRtpEncodingParameters=function(n){var r=[],e=i.parseRtpParameters(n),h=e.fecMechanisms.indexOf("RED")!==-1,c=e.fecMechanisms.indexOf("ULPFEC")!==-1,s=i.matchPrefix(n,"a=ssrc:").map(function(n){return i.parseSsrcMedia(n)}).filter(function(n){return n.attribute==="cname"}),u=s.length>0&&s[0].ssrc,o,f=i.matchPrefix(n,"a=ssrc-group:FID").map(function(n){var t=n.split(" ");return t.shift(),t.map(function(n){return parseInt(n,10)})}),t;return f.length>0&&f[0].length>1&&f[0][0]===u&&(o=f[0][1]),e.codecs.forEach(function(n){if(n.name.toUpperCase()==="RTX"&&n.parameters.apt){var t={ssrc:u,codecPayloadType:parseInt(n.parameters.apt,10),rtx:{ssrc:o}};r.push(t);h&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:o,mechanism:c?"red+ulpfec":"red"},r.push(t))}}),r.length===0&&u&&r.push({ssrc:u}),t=i.matchPrefix(n,"b="),t.length&&(t=t[0].indexOf("b=TIAS:")===0?parseInt(t[0].substr(7),10):t[0].indexOf("b=AS:")===0?parseInt(t[0].substr(5),10)*1e3*.95-16e3:undefined,r.forEach(function(n){n.maxBitrate=t})),r};i.parseRtcpParameters=function(n){var t={},r=i.matchPrefix(n,"a=ssrc:").map(function(n){return i.parseSsrcMedia(n)}).filter(function(n){return n.attribute==="cname"})[0],u,f;return r&&(t.cname=r.value,t.ssrc=r.ssrc),u=i.matchPrefix(n,"a=rtcp-rsize"),t.reducedSize=u.length>0,t.compound=u.length===0,f=i.matchPrefix(n,"a=rtcp-mux"),t.mux=f.length>0,t};i.parseMsid=function(n){var t,u=i.matchPrefix(n,"a=msid:"),r;return u.length===1?(t=u[0].substr(7).split(" "),{stream:t[0],track:t[1]}):(r=i.matchPrefix(n,"a=ssrc:").map(function(n){return i.parseSsrcMedia(n)}).filter(function(n){return n.attribute==="msid"}),r.length>0?(t=r[0].value.split(" "),{stream:t[0],track:t[1]}):void 0)};i.generateSessionId=function(){return Math.random().toString().substr(2,21)};i.writeSessionBoilerplate=function(n,t){var r,u=t!==undefined?t:2;return r=n?n:i.generateSessionId(),"v=0\r\no=thisisadapterortc "+r+" "+u+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"};i.writeMediaSection=function(n,t,r,u){var f=i.writeRtpDescription(n.kind,t),e;return f+=i.writeIceParameters(n.iceGatherer.getLocalParameters()),f+=i.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),r==="offer"?"actpass":"active"),f+="a=mid:"+n.mid+"\r\n",f+=n.direction?"a="+n.direction+"\r\n":n.rtpSender&&n.rtpReceiver?"a=sendrecv\r\n":n.rtpSender?"a=sendonly\r\n":n.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",n.rtpSender&&(e="msid:"+u.id+" "+n.rtpSender.track.id+"\r\n",f+="a="+e,f+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+e,n.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+e,f+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+"\r\n")),f+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n",n.rtpSender&&n.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n"),f};i.getDirection=function(n,t){for(var u=i.splitLines(n),r=0;r<u.length;r++)switch(u[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return u[r].substr(2)}return t?i.getDirection(t):"sendrecv"};i.getKind=function(n){var t=i.splitLines(n),r=t[0].split(" ");return r[0].substr(2)};i.isRejected=function(n){return n.split(" ",2)[1]==="0"};t.exports=i},{}],2:[function(n,t){(function(i){var r=n("./adapter_factory.js");t.exports=r({window:i.window})}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./adapter_factory.js":3}],3:[function(n,t){t.exports=function(t,i){var r=t&&t.window,l={shimChrome:!1,shimFirefox:!1,shimEdge:!0,shimSafari:!0};for(var a in i)hasOwnProperty.call(i,a)&&(l[a]=i[a]);var f=n("./utils"),e=f.log,v=f.detectBrowser(r),o={browserDetails:v,extractVersion:f.extractVersion,disableLog:f.disableLog,disableWarnings:f.disableWarnings},u=n("./chrome/chrome_shim")||null,c=n("./edge/edge_shim")||null,s=n("./firefox/firefox_shim")||null,h=n("./safari/safari_shim")||null;switch(v.browser){case"chrome":if(!u||!u.shimPeerConnection||!l.shimChrome)return e("Chrome shim is not included in this adapter release."),o;e("adapter.js shimming chrome.");o.browserShim=u;u.shimGetUserMedia(r);u.shimMediaStream(r);f.shimCreateObjectURL(r);u.shimSourceObject(r);u.shimPeerConnection(r);u.shimOnTrack(r);u.shimAddTrackRemoveTrack(r);u.shimGetSendersWithDtmf(r);break;case"firefox":if(!s||!s.shimPeerConnection||!l.shimFirefox)return e("Firefox shim is not included in this adapter release."),o;e("adapter.js shimming firefox.");o.browserShim=s;s.shimGetUserMedia(r);f.shimCreateObjectURL(r);s.shimSourceObject(r);s.shimPeerConnection(r);s.shimOnTrack(r);break;case"edge":if(!c||!c.shimPeerConnection||!l.shimEdge)return e("MS edge shim is not included in this adapter release."),o;e("adapter.js shimming edge.");o.browserShim=c;c.shimGetUserMedia(r);f.shimCreateObjectURL(r);c.shimPeerConnection(r);c.shimReplaceTrack(r);break;case"safari":if(!h||!l.shimSafari)return e("Safari shim is not included in this adapter release."),o;e("adapter.js shimming safari.");o.browserShim=h;f.shimCreateObjectURL(r);h.shimRTCIceServerUrls(r);h.shimCallbacksAPI(r);h.shimLocalStreamsAPI(r);h.shimRemoteStreamsAPI(r);h.shimGetUserMedia(r);break;default:e("Unsupported browser!")}return o}},{"./chrome/chrome_shim":4,"./edge/edge_shim":6,"./firefox/firefox_shim":9,"./safari/safari_shim":11,"./utils":12}],4:[function(n,t){var r=n("../utils.js"),u=r.log,i={shimMediaStream:function(n){n.MediaStream=n.MediaStream||n.webkitMediaStream},shimOnTrack:function(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(n){this._ontrack&&this.removeEventListener("track",this._ontrack);this.addEventListener("track",this._ontrack=n)}});var t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){var i=this;return i._ontrackpoly||(i._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(r){var f,u;f=n.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(n){return n.track.id===r.track.id}):{track:r.track};u=new Event("track");u.track=r.track;u.receiver=f;u.streams=[t.stream];i.dispatchEvent(u)});t.stream.getTracks().forEach(function(r){var f,u;f=n.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(n){return n.track.id===r.id}):{track:r};u=new Event("track");u.track=r;u.receiver=f;u.streams=[t.stream];i.dispatchEvent(u)})},i.addEventListener("addstream",i._ontrackpoly)),t.apply(i,arguments)}}},shimGetSendersWithDtmf:function(n){var t,i,r,u,f,e;typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype?(t=function(n,t){return{track:t,get dtmf(){return this._dtmf===undefined&&(this._dtmf=t.kind==="audio"?n.createDTMFSender(t):null),this._dtmf},_pc:n}},n.RTCPeerConnection.prototype.getSenders||(n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()},i=n.RTCPeerConnection.prototype.addTrack,n.RTCPeerConnection.prototype.addTrack=function(n){var u=this,r=i.apply(u,arguments);return r||(r=t(u,n),u._senders.push(r)),r},r=n.RTCPeerConnection.prototype.removeTrack,n.RTCPeerConnection.prototype.removeTrack=function(n){var t=this,i;r.apply(t,arguments);i=t._senders.indexOf(n);i!==-1&&t._senders.splice(i,1)}),u=n.RTCPeerConnection.prototype.addStream,n.RTCPeerConnection.prototype.addStream=function(n){var i=this;i._senders=i._senders||[];u.apply(i,[n]);n.getTracks().forEach(function(n){i._senders.push(t(i,n))})},f=n.RTCPeerConnection.prototype.removeStream,n.RTCPeerConnection.prototype.removeStream=function(n){var t=this;t._senders=t._senders||[];f.apply(t,[t._streams[n.id]||n]);n.getTracks().forEach(function(n){var i=t._senders.find(function(t){return t.track===n});i&&t._senders.splice(t._senders.indexOf(i),1)})}):typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)&&(e=n.RTCPeerConnection.prototype.getSenders,n.RTCPeerConnection.prototype.getSenders=function(){var n=this,t=e.apply(n,[]);return t.forEach(function(t){t._pc=n}),t},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===undefined&&(this._dtmf=this.track.kind==="audio"?this._pc.createDTMFSender(this.track):null),this._dtmf}}))},shimSourceObject:function(n){var t=n&&n.URL;typeof n=="object"&&(!n.HTMLMediaElement||"srcObject"in n.HTMLMediaElement.prototype||Object.defineProperty(n.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(n){var i=this;if(this._srcObject=n,this.src&&t.revokeObjectURL(this.src),!n)return this.src="",undefined;this.src=t.createObjectURL(n);n.addEventListener("addtrack",function(){i.src&&t.revokeObjectURL(i.src);i.src=t.createObjectURL(n)});n.addEventListener("removetrack",function(){i.src&&t.revokeObjectURL(i.src);i.src=t.createObjectURL(n)})}}))},shimAddTrackRemoveTrack:function(n){var t,i,r;n.RTCPeerConnection.prototype.addTrack||(t=n.RTCPeerConnection.prototype.getLocalStreams,n.RTCPeerConnection.prototype.getLocalStreams=function(){var n=this,i=t.apply(this);return n._reverseStreams=n._reverseStreams||{},i.map(function(t){return n._reverseStreams[t.id]})},i=n.RTCPeerConnection.prototype.addStream,n.RTCPeerConnection.prototype.addStream=function(t){var r=this,u;r._streams=r._streams||{};r._reverseStreams=r._reverseStreams||{};t.getTracks().forEach(function(n){var t=r.getSenders().find(function(t){return t.track===n});if(t)throw new DOMException("Track already exists.","InvalidAccessError");});r._reverseStreams[t.id]||(u=new n.MediaStream(t.getTracks()),r._streams[t.id]=u,r._reverseStreams[u.id]=t,t=u);i.apply(r,[t])},r=n.RTCPeerConnection.prototype.removeStream,n.RTCPeerConnection.prototype.removeStream=function(n){var t=this;t._streams=t._streams||{};t._reverseStreams=t._reverseStreams||{};r.apply(t,[t._streams[n.id]||n]);delete t._reverseStreams[t._streams[n.id]?t._streams[n.id].id:n.id];delete t._streams[n.id]},n.RTCPeerConnection.prototype.addTrack=function(t,i){var r=this,f,o,e,u;if(r.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(f=[].slice.call(arguments,1),f.length!==1||!f[0].getTracks().find(function(n){return n===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(o=r.getSenders().find(function(n){return n.track===t}),o)throw new DOMException("Track already exists.","InvalidAccessError");return r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{},e=r._streams[i.id],e?(e.addTrack(t),r.dispatchEvent(new Event("negotiationneeded"))):(u=new n.MediaStream([t]),r._streams[i.id]=u,r._reverseStreams[u.id]=i,r.addStream(u)),r.getSenders().find(function(n){return n.track===t})},n.RTCPeerConnection.prototype.removeTrack=function(n){var t=this,r,i;if(t.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!n._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(r=n._pc===t,!r)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");t._streams=t._streams||{};Object.keys(t._streams).forEach(function(r){var u=t._streams[r].getTracks().find(function(t){return n.track===t});u&&(i=t._streams[r])});i&&(i.getTracks().length===1?t.removeStream(i):i.removeTrack(n.track),t.dispatchEvent(new Event("negotiationneeded")))})},shimPeerConnection:function(n){var f=r.detectBrowser(n),i,t,e;n.RTCPeerConnection?(i=n.RTCPeerConnection,n.RTCPeerConnection=function(n,t){var e,f,u;if(n&&n.iceServers){for(e=[],f=0;f<n.iceServers.length;f++)u=n.iceServers[f],!u.hasOwnProperty("urls")&&u.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),u=JSON.parse(JSON.stringify(u)),u.urls=u.url,e.push(u)):e.push(n.iceServers[f]);n.iceServers=e}return new i(n,t)},n.RTCPeerConnection.prototype=i.prototype,Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:function(){return i.generateCertificate}})):(n.RTCPeerConnection=function(t,i){return u("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new n.webkitRTCPeerConnection(t,i)},n.RTCPeerConnection.prototype=n.webkitRTCPeerConnection.prototype,n.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:function(){return n.webkitRTCPeerConnection.generateCertificate}}));t=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(n,i,r){var o=this,s=arguments,u,f,e;return arguments.length>0&&typeof n=="function"?t.apply(this,arguments):t.length===0&&(arguments.length===0||typeof arguments[0]!="function")?t.apply(this,[]):(u=function(n){var t={},i=n.result();return i.forEach(function(n){var i={id:n.id,timestamp:n.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[n.type]||n.type};n.names().forEach(function(t){i[t]=n.stat(t)});t[i.id]=i}),t},f=function(n){return new Map(Object.keys(n).map(function(t){return[t,n[t]]}))},arguments.length>=2)?(e=function(n){s[1](f(u(n)))},t.apply(this,[e,arguments[0]])):new Promise(function(n,i){t.apply(o,[function(t){n(f(u(t)))},i])}).then(i,r)};f.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var i=n.RTCPeerConnection.prototype[t];n.RTCPeerConnection.prototype[t]=function(){var n=arguments,r=this,t=new Promise(function(t,u){i.apply(r,[n[0],t,u])});return n.length<2?t:t.then(function(){n[1].apply(null,[])},function(t){n.length>=3&&n[2].apply(null,[t])})}});f.version<52&&["createOffer","createAnswer"].forEach(function(t){var i=n.RTCPeerConnection.prototype[t];n.RTCPeerConnection.prototype[t]=function(){var t=this,n;return arguments.length<1||arguments.length===1&&typeof arguments[0]=="object"?(n=arguments.length===1?arguments[0]:undefined,new Promise(function(r,u){i.apply(t,[r,u,n])})):i.apply(this,arguments)}});["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var i=n.RTCPeerConnection.prototype[t];n.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}});e=n.RTCPeerConnection.prototype.addIceCandidate;n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};t.exports={shimMediaStream:i.shimMediaStream,shimOnTrack:i.shimOnTrack,shimAddTrackRemoveTrack:i.shimAddTrackRemoveTrack,shimGetSendersWithDtmf:i.shimGetSendersWithDtmf,shimSourceObject:i.shimSourceObject,shimPeerConnection:i.shimPeerConnection,shimGetUserMedia:n("./getusermedia")}},{"../utils.js":12,"./getusermedia":5}],5:[function(n,t){var r=n("../utils.js"),i=r.log;t.exports=function(n){var h=r.detectBrowser(n),t=n&&n.navigator,u=function(n){if(typeof n!="object"||n.mandatory||n.optional)return n;var t={};return Object.keys(n).forEach(function(i){var r,f,u;i!=="require"&&i!=="advanced"&&i!=="mediaSource"&&(r=typeof n[i]=="object"?n[i]:{ideal:n[i]},r.exact!==undefined&&typeof r.exact=="number"&&(r.min=r.max=r.exact),f=function(n,t){return n?n+t.charAt(0).toUpperCase()+t.slice(1):t==="deviceId"?"sourceId":t},r.ideal!==undefined&&(t.optional=t.optional||[],u={},typeof r.ideal=="number"?(u[f("min",i)]=r.ideal,t.optional.push(u),u={},u[f("max",i)]=r.ideal,t.optional.push(u)):(u[f("",i)]=r.ideal,t.optional.push(u))),r.exact!==undefined&&typeof r.exact!="number"?(t.mandatory=t.mandatory||{},t.mandatory[f("",i)]=r.exact):["min","max"].forEach(function(n){r[n]!==undefined&&(t.mandatory=t.mandatory||{},t.mandatory[f(n,i)]=r[n])}))}),n.advanced&&(t.optional=(t.optional||[]).concat(n.advanced)),t},e=function(n,r){var o,f,s,e;if(n=JSON.parse(JSON.stringify(n)),n&&typeof n.audio=="object"&&(o=function(n,t,i){t in n&&!(i in n)&&(n[i]=n[t],delete n[t])},n=JSON.parse(JSON.stringify(n)),o(n.audio,"autoGainControl","googAutoGainControl"),o(n.audio,"noiseSuppression","googNoiseSuppression"),n.audio=u(n.audio)),n&&typeof n.video=="object"){if(f=n.video.facingMode,f=f&&(typeof f=="object"?f:{ideal:f}),s=h.version<61,f&&(f.exact==="user"||f.exact==="environment"||f.ideal==="user"||f.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!s)&&(delete n.video.facingMode,f.exact==="environment"||f.ideal==="environment"?e=["back","rear"]:(f.exact==="user"||f.ideal==="user")&&(e=["front"]),e))return t.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(n){return n.kind==="videoinput"});var o=t.find(function(n){return e.some(function(t){return n.label.toLowerCase().indexOf(t)!==-1})});return!o&&t.length&&e.indexOf("back")!==-1&&(o=t[t.length-1]),o&&(n.video.deviceId=f.exact?{exact:o.deviceId}:{ideal:o.deviceId}),n.video=u(n.video),i("chrome: "+JSON.stringify(n)),r(n)});n.video=u(n.video)}return i("chrome: "+JSON.stringify(n)),r(n)},o=function(n){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[n.name]||n.name,message:n.message,constraint:n.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},c=function(n,i,r){e(n,function(n){t.webkitGetUserMedia(n,i,function(n){r(o(n))})})},f,s;t.getUserMedia=c;f=function(n){return new Promise(function(i,r){t.getUserMedia(n,i,r)})};t.mediaDevices||(t.mediaDevices={getUserMedia:f,enumerateDevices:function(){return new Promise(function(t){var i={audio:"audioinput",video:"videoinput"};return n.MediaStreamTrack.getSources(function(n){t(n.map(function(n){return{label:n.label,kind:i[n.kind],deviceId:n.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}});t.mediaDevices.getUserMedia?(s=t.mediaDevices.getUserMedia.bind(t.mediaDevices),t.mediaDevices.getUserMedia=function(n){return e(n,function(n){return s(n).then(function(t){if(n.audio&&!t.getAudioTracks().length||n.video&&!t.getVideoTracks().length){t.getTracks().forEach(function(n){n.stop()});throw new DOMException("","NotFoundError");}return t},function(n){return Promise.reject(o(n))})})}):t.mediaDevices.getUserMedia=function(n){return f(n)};typeof t.mediaDevices.addEventListener=="undefined"&&(t.mediaDevices.addEventListener=function(){i("Dummy mediaDevices.addEventListener called.")});typeof t.mediaDevices.removeEventListener=="undefined"&&(t.mediaDevices.removeEventListener=function(){i("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":12}],6:[function(n,t){var i=n("../utils"),r=n("./rtcpeerconnection_shim");t.exports={shimGetUserMedia:n("./getusermedia"),shimPeerConnection:function(n){var t=i.detectBrowser(n),u;n.RTCIceGatherer&&(n.RTCIceCandidate||(n.RTCIceCandidate=function(n){return n}),n.RTCSessionDescription||(n.RTCSessionDescription=function(n){return n}),t.version<15025&&(u=Object.getOwnPropertyDescriptor(n.MediaStreamTrack.prototype,"enabled"),Object.defineProperty(n.MediaStreamTrack.prototype,"enabled",{set:function(n){u.set.call(this,n);var t=new Event("enabled");t.enabled=n;this.dispatchEvent(t)}})));!n.RTCRtpSender||"dtmf"in n.RTCRtpSender.prototype||Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===undefined&&(this.track.kind==="audio"?this._dtmf=new n.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}});n.RTCPeerConnection=r(n,t.version)},shimReplaceTrack:function(n){!n.RTCRtpSender||"replaceTrack"in n.RTCRtpSender.prototype||(n.RTCRtpSender.prototype.replaceTrack=n.RTCRtpSender.prototype.setTrack)}}},{"../utils":12,"./getusermedia":7,"./rtcpeerconnection_shim":8}],7:[function(n,t){t.exports=function(n){var t=n&&n.navigator,i=function(n){return{name:{PermissionDeniedError:"NotAllowedError"}[n.name]||n.name,message:n.message,constraint:n.constraint,toString:function(){return this.name}}},r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(n){return r(n).catch(function(n){return Promise.reject(i(n))})}}},{}],8:[function(n,t){function f(n){var t=n.filter(function(n){return n.kind==="audio"}),i=n.filter(function(n){return n.kind==="video"});for(n=[];t.length||i.length;)t.length&&n.push(t.shift()),i.length&&n.push(i.shift());return n}function e(n,t){var i=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(function(n){var r,u;return n&&(n.urls||n.url)?(r=n.urls||n.url,n.url&&!n.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead."),u=typeof r=="string",u&&(r=[r]),r=r.filter(function(n){var r=n.indexOf("turn:")===0&&n.indexOf("transport=udp")!==-1&&n.indexOf("turn:[")===-1&&!i;return r?(i=!0,!0):n.indexOf("stun:")===0&&t>=14393}),delete n.url,n.urls=u?r[0]:r,!!r.length):!1})}function r(n,t){var i={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(n,t){n=parseInt(n,10);for(var i=0;i<t.length;i++)if(t[i].payloadType===n||t[i].preferredPayloadType===n)return t[i]},u=function(n,t,i,u){var f=r(n.parameters.apt,i),e=r(t.parameters.apt,u);return f&&e&&f.name.toLowerCase()===e.name.toLowerCase()};return n.codecs.forEach(function(r){for(var f,e=0;e<t.codecs.length;e++)if(f=t.codecs[e],r.name.toLowerCase()===f.name.toLowerCase()&&r.clockRate===f.clockRate){if(r.name.toLowerCase()==="rtx"&&r.parameters&&f.parameters.apt&&!u(r,f,n.codecs,t.codecs))continue;f=JSON.parse(JSON.stringify(f));f.numChannels=Math.min(r.numChannels,f.numChannels);i.codecs.push(f);f.rtcpFeedback=f.rtcpFeedback.filter(function(n){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===n.type&&r.rtcpFeedback[t].parameter===n.parameter)return!0;return!1});break}}),n.headerExtensions.forEach(function(n){for(var u,r=0;r<t.headerExtensions.length;r++)if(u=t.headerExtensions[r],n.uri===u.uri){i.headerExtensions.push(u);break}}),i}function u(n,t,i){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][n].indexOf(i)!==-1}var i=n("sdp");t.exports=function(n,t){var o=function(r){var u=this,f=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(n){u[n]=f[n].bind(f)}),this.needNegotiation=!1,this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onicegatheringstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.canTrickleIceCandidates=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return u.localStreams},this.getRemoteStreams=function(){return u.remoteStreams},this.localDescription=new n.RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new n.RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},r&&r.iceTransportPolicy)switch(r.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=r.iceTransportPolicy}this.usingBundle=r&&r.bundlePolicy==="max-bundle";r&&r.iceServers&&(this.iceOptions.iceServers=e(r.iceServers,t));this._config=r||{};this.transceivers=[];this._localIceCandidatesBuffer=[];this._sdpSessionId=i.generateSessionId()};return o.prototype._emitGatheringStateChange=function(){var n=new Event("icegatheringstatechange");if(this.dispatchEvent(n),this.onicegatheringstatechange!==null)this.onicegatheringstatechange(n)},o.prototype._emitBufferedCandidates=function(){var n=this,t=i.splitSections(n.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(i){var f=!i.candidate||Object.keys(i.candidate).length===0,r,u;if(f)for(r=1;r<t.length;r++)t[r].indexOf("\r\na=end-of-candidates\r\n")===-1&&(t[r]+="a=end-of-candidates\r\n");else t[i.candidate.sdpMLineIndex+1]+="a="+i.candidate.candidate+"\r\n";if(n.localDescription.sdp=t.join(""),n.dispatchEvent(i),n.onicecandidate!==null)n.onicecandidate(i);i.candidate||n.iceGatheringState==="complete"||(u=n.transceivers.every(function(n){return n.iceGatherer&&n.iceGatherer.state==="completed"}),u&&n.iceGatheringStateChange!=="complete"&&(n.iceGatheringState="complete",n._emitGatheringStateChange()))});this._localIceCandidatesBuffer=[]},o.prototype.getConfiguration=function(){return this._config},o.prototype._createTransceiver=function(n){var r=this.transceivers.length>0,t={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:n,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,wantReceive:!0},i;return this.usingBundle&&r?(t.iceTransport=this.transceivers[0].iceTransport,t.dtlsTransport=this.transceivers[0].dtlsTransport):(i=this._createIceAndDtlsTransports(),t.iceTransport=i.iceTransport,t.dtlsTransport=i.dtlsTransport),this.transceivers.push(t),t},o.prototype.addTrack=function(t,i){for(var r,u=0;u<this.transceivers.length;u++)this.transceivers[u].track||this.transceivers[u].kind!==t.kind||(r=this.transceivers[u]);return r||(r=this._createTransceiver(t.kind)),r.track=t,r.stream=i,r.rtpSender=new n.RTCRtpSender(t,r.dtlsTransport),this._maybeFireNegotiationNeeded(),r.rtpSender},o.prototype.addStream=function(n){var r=this,i;t>=15025?(this.localStreams.push(n),n.getTracks().forEach(function(t){r.addTrack(t,n)})):(i=n.clone(),n.getTracks().forEach(function(n,t){var r=i.getTracks()[t];n.addEventListener("enabled",function(n){r.enabled=n.enabled})}),i.getTracks().forEach(function(n){r.addTrack(n,i)}),this.localStreams.push(i));this._maybeFireNegotiationNeeded()},o.prototype.removeStream=function(n){var t=this.localStreams.indexOf(n);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},o.prototype.getSenders=function(){return this.transceivers.filter(function(n){return!!n.rtpSender}).map(function(n){return n.rtpSender})},o.prototype.getReceivers=function(){return this.transceivers.filter(function(n){return!!n.rtpReceiver}).map(function(n){return n.rtpReceiver})},o.prototype._createIceGatherer=function(t,r){var u=this,f=new n.RTCIceGatherer(u.iceOptions);return f.onlocalcandidate=function(n){var e=new Event("icecandidate"),s,o,h,l,c;e.candidate={sdpMid:t,sdpMLineIndex:r};s=n.candidate;o=!s||Object.keys(s).length===0;o?f.state===undefined&&(f.state="completed"):(s.component=1,e.candidate.candidate=i.writeCandidate(s));h=i.splitSections(u.localDescription.sdp);h[e.candidate.sdpMLineIndex+1]+=o?"a=end-of-candidates\r\n":"a="+e.candidate.candidate+"\r\n";u.localDescription.sdp=h.join("");l=u._pendingOffer?u._pendingOffer:u.transceivers;c=l.every(function(n){return n.iceGatherer&&n.iceGatherer.state==="completed"});switch(u.iceGatheringState){case"new":o||u._localIceCandidatesBuffer.push(e);o&&c&&u._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":if(u._emitBufferedCandidates(),!o&&(u.dispatchEvent(e),u.onicecandidate!==null))u.onicecandidate(e);if(c){if(u.dispatchEvent(new Event("icecandidate")),u.onicecandidate!==null)u.onicecandidate(new Event("icecandidate"));u.iceGatheringState="complete";u._emitGatheringStateChange()}}},f},o.prototype._createIceAndDtlsTransports=function(){var i=this,r=new n.RTCIceTransport(null),t;return r.onicestatechange=function(){i._updateConnectionState()},t=new n.RTCDtlsTransport(r),t.ondtlsstatechange=function(){i._updateConnectionState()},t.onerror=function(){Object.defineProperty(t,"state",{value:"failed",writable:!0});i._updateConnectionState()},{iceTransport:r,dtlsTransport:t}},o.prototype._disposeIceAndDtlsTransports=function(n){var r=this.transceivers[n].iceGatherer,i,t;r&&(delete r.onlocalcandidate,delete this.transceivers[n].iceGatherer);i=this.transceivers[n].iceTransport;i&&(delete i.onicestatechange,delete this.transceivers[n].iceTransport);t=this.transceivers[n].dtlsTransport;t&&(delete t.ondtlsstatechange,delete t.onerror,delete this.transceivers[n].dtlsTransport)},o.prototype._transceive=function(n,u,f){var e=r(n.localCapabilities,n.remoteCapabilities);u&&n.rtpSender&&(e.encodings=n.sendEncodingParameters,e.rtcp={cname:i.localCName,compound:n.rtcpParameters.compound},n.recvEncodingParameters.length&&(e.rtcp.ssrc=n.recvEncodingParameters[0].ssrc),n.rtpSender.send(e));f&&n.rtpReceiver&&(n.kind==="video"&&n.recvEncodingParameters&&t<15019&&n.recvEncodingParameters.forEach(function(n){delete n.rtx}),e.encodings=n.recvEncodingParameters,e.rtcp={cname:n.rtcpParameters.cname,compound:n.rtcpParameters.compound},n.sendEncodingParameters.length&&(e.rtcp.ssrc=n.sendEncodingParameters[0].ssrc),n.rtpReceiver.receive(e))},o.prototype.setLocalDescription=function(t){var f=this,s,e,o,h,c,a,l;if(!u("setLocalDescription",t.type,this.signalingState))return s=new Error("Can not set local "+t.type+" in state "+this.signalingState),s.name="InvalidStateError",arguments.length>2&&typeof arguments[2]=="function"&&n.setTimeout(arguments[2],0,s),Promise.reject(s);t.type==="offer"?this._pendingOffer&&(e=i.splitSections(t.sdp),o=e.shift(),e.forEach(function(n,t){var r=i.parseRtpParameters(n);f._pendingOffer[t].localCapabilities=r}),this.transceivers=this._pendingOffer,delete this._pendingOffer):t.type==="answer"&&(e=i.splitSections(f.remoteDescription.sdp),o=e.shift(),h=i.matchPrefix(o,"a=ice-lite").length>0,e.forEach(function(n,t){var u=f.transceivers[t],l=u.iceGatherer,a=u.iceTransport,v=u.dtlsTransport,y=u.localCapabilities,p=u.remoteCapabilities,w=i.isRejected(n),s,e,c;w||u.isDatachannel||(s=i.getIceParameters(n,o),e=i.getDtlsParameters(n,o),h&&(e.role="server"),f.usingBundle&&t!==0||(a.start(l,s,h?"controlling":"controlled"),v.start(e)),c=r(y,p),f._transceive(u,c.codecs.length>0,!1))}));this.localDescription={type:t.type,sdp:t.sdp};switch(t.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+t.type+'"');}return c=arguments.length>1&&typeof arguments[1]=="function",c&&(a=arguments[1],n.setTimeout(function(){a();f.iceGatheringState==="new"&&(f.iceGatheringState="gathering",f._emitGatheringStateChange());f._emitBufferedCandidates()},0)),l=Promise.resolve(),l.then(function(){c||(f.iceGatheringState==="new"&&(f.iceGatheringState="gathering",f._emitGatheringStateChange()),n.setTimeout(f._emitBufferedCandidates.bind(f),500))}),l},o.prototype.setRemoteDescription=function(r){var f=this,c,l;if(!u("setRemoteDescription",r.type,this.signalingState))return c=new Error("Can not set remote "+r.type+" in state "+this.signalingState),c.name="InvalidStateError",arguments.length>2&&typeof arguments[2]=="function"&&n.setTimeout(arguments[2],0,c),Promise.reject(c);var e={},s=[],a=i.splitSections(r.sdp),o=a.shift(),v=i.matchPrefix(o,"a=ice-lite").length>0,h=i.matchPrefix(o,"a=group:BUNDLE ").length>0;this.usingBundle=h;l=i.matchPrefix(o,"a=ice-options:")[0];this.canTrickleIceCandidates=l?l.substr(14).split(" ").indexOf("trickle")>=0:!1;a.forEach(function(u,c){var lt=i.splitLines(u),k=i.getKind(u),d=i.isRejected(u),at=lt[0].substr(2).split(" ")[2],p=i.getDirection(u,o),a=i.parseMsid(u),nt=i.getMid(u)||i.generateIdentifier(),l,et,tt,ot,w,it,rt,b,y,ut,st,ft;if(k==="application"&&at==="DTLS/SCTP"){f.transceivers[c]={mid:nt,isDatachannel:!0};return}ut=i.parseRtpParameters(u);d||(st=i.getIceParameters(u,o),ft=i.getDtlsParameters(u,o),ft.role="client");rt=i.parseRtpEncodingParameters(u);var ht=i.parseRtcpParameters(u),ct=i.matchPrefix(u,"a=end-of-candidates",o).length>0,g=i.matchPrefix(u,"a=candidate:").map(function(n){return i.parseCandidate(n)}).filter(function(n){return n.component==="1"||n.component===1});(r.type==="offer"||r.type==="answer")&&!d&&h&&c>0&&f.transceivers[c]&&(f._disposeIceAndDtlsTransports(c),f.transceivers[c].iceGatherer=f.transceivers[0].iceGatherer,f.transceivers[c].iceTransport=f.transceivers[0].iceTransport,f.transceivers[c].dtlsTransport=f.transceivers[0].dtlsTransport,f.transceivers[c].rtpSender&&f.transceivers[c].rtpSender.setTransport(f.transceivers[0].dtlsTransport),f.transceivers[c].rtpReceiver&&f.transceivers[c].rtpReceiver.setTransport(f.transceivers[0].dtlsTransport));r.type!=="offer"||d?r.type!=="answer"||d||(l=f.transceivers[c],et=l.iceGatherer,tt=l.iceTransport,ot=l.dtlsTransport,w=l.rtpReceiver,it=l.sendEncodingParameters,b=l.localCapabilities,f.transceivers[c].recvEncodingParameters=rt,f.transceivers[c].remoteCapabilities=ut,f.transceivers[c].rtcpParameters=ht,h&&c!==0||((v||ct)&&g.length&&tt.setRemoteCandidates(g),tt.start(et,st,"controlling"),ot.start(ft)),f._transceive(l,p==="sendrecv"||p==="recvonly",p==="sendrecv"||p==="sendonly"),w&&(p==="sendrecv"||p==="sendonly")?(y=w.track,a?(e[a.stream]||(e[a.stream]=new n.MediaStream),e[a.stream].addTrack(y),s.push([y,w,e[a.stream]])):(e.default||(e.default=new n.MediaStream),e.default.addTrack(y),s.push([y,w,e.default]))):delete l.rtpReceiver):(l=f.transceivers[c]||f._createTransceiver(k),l.mid=nt,l.iceGatherer||(l.iceGatherer=h&&c>0?f.transceivers[0].iceGatherer:f._createIceGatherer(nt,c)),ct&&g.length&&(!h||c===0)&&l.iceTransport.setRemoteCandidates(g),b=n.RTCRtpReceiver.getCapabilities(k),t<15019&&(b.codecs=b.codecs.filter(function(n){return n.name!=="rtx"})),it=[{ssrc:(2*c+2)*1001}],(p==="sendrecv"||p==="sendonly")&&(w=new n.RTCRtpReceiver(l.dtlsTransport,k),y=w.track,a?(e[a.stream]||(e[a.stream]=new n.MediaStream,Object.defineProperty(e[a.stream],"id",{get:function(){return a.stream}})),Object.defineProperty(y,"id",{get:function(){return a.track}}),e[a.stream].addTrack(y),s.push([y,w,e[a.stream]])):(e.default||(e.default=new n.MediaStream),e.default.addTrack(y),s.push([y,w,e.default]))),l.localCapabilities=b,l.remoteCapabilities=ut,l.rtpReceiver=w,l.rtcpParameters=ht,l.sendEncodingParameters=it,l.recvEncodingParameters=rt,f._transceive(f.transceivers[c],!1,p==="sendrecv"||p==="sendonly"))});this.remoteDescription={type:r.type,sdp:r.sdp};switch(r.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+r.type+'"');}return Object.keys(e).forEach(function(t){var i=e[t],r;i.getTracks().length&&(f.remoteStreams.push(i),r=new Event("addstream"),r.stream=i,f.dispatchEvent(r),f.onaddstream!==null&&n.setTimeout(function(){f.onaddstream(r)},0),s.forEach(function(t){var u=t[0],e=t[1],r;i.id===t[2].id&&(r=new Event("track"),r.track=u,r.receiver=e,r.streams=[i],f.dispatchEvent(r),f.ontrack!==null&&n.setTimeout(function(){f.ontrack(r)},0))}))}),n.setTimeout(function(){f&&f.transceivers&&f.transceivers.forEach(function(n){n.iceTransport&&n.iceTransport.state==="new"&&n.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),n.iceTransport.addRemoteCandidate({}))})},4e3),arguments.length>1&&typeof arguments[1]=="function"&&n.setTimeout(arguments[1],0),Promise.resolve()},o.prototype.close=function(){this.transceivers.forEach(function(n){n.iceTransport&&n.iceTransport.stop();n.dtlsTransport&&n.dtlsTransport.stop();n.rtpSender&&n.rtpSender.stop();n.rtpReceiver&&n.rtpReceiver.stop()});this._updateSignalingState("closed")},o.prototype._updateSignalingState=function(n){this.signalingState=n;var t=new Event("signalingstatechange");if(this.dispatchEvent(t),this.onsignalingstatechange!==null)this.onsignalingstatechange(t)},o.prototype._maybeFireNegotiationNeeded=function(){var t=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,n.setTimeout(function(){if(t.needNegotiation!==!1){t.needNegotiation=!1;var n=new Event("negotiationneeded");if(t.dispatchEvent(n),t.onnegotiationneeded!==null)t.onnegotiationneeded(n)}},0))},o.prototype._updateConnectionState=function(){var r=this,t,n={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0},i;if(this.transceivers.forEach(function(t){n[t.iceTransport.state]++;n[t.dtlsTransport.state]++}),n.connected+=n.completed,t="new",n.failed>0?t="failed":n.connecting>0||n.checking>0?t="connecting":n.disconnected>0?t="disconnected":n.new>0?t="new":(n.connected>0||n.completed>0)&&(t="connected"),t!==r.iceConnectionState&&(r.iceConnectionState=t,i=new Event("iceconnectionstatechange"),this.dispatchEvent(i),this.oniceconnectionstatechange!==null))this.oniceconnectionstatechange(i)},o.prototype.createOffer=function(){var c=this,r,u,e,o,s,h;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");if(arguments.length===1&&typeof arguments[0]!="function"?r=arguments[0]:arguments.length===3&&(r=arguments[2]),u=this.transceivers.filter(function(n){return n.kind==="audio"}).length,e=this.transceivers.filter(function(n){return n.kind==="video"}).length,r){if(r.mandatory||r.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");r.offerToReceiveAudio!==undefined&&(u=r.offerToReceiveAudio===!0?1:r.offerToReceiveAudio===!1?0:r.offerToReceiveAudio);r.offerToReceiveVideo!==undefined&&(e=r.offerToReceiveVideo===!0?1:r.offerToReceiveVideo===!1?0:r.offerToReceiveVideo)}for(this.transceivers.forEach(function(n){n.kind==="audio"?(u--,u<0&&(n.wantReceive=!1)):n.kind==="video"&&(e--,e<0&&(n.wantReceive=!1))});u>0||e>0;)u>0&&(this._createTransceiver("audio"),u--),e>0&&(this._createTransceiver("video"),e--);return o=f(this.transceivers),s=i.writeSessionBoilerplate(this._sdpSessionId),o.forEach(function(r,u){var l=r.track,e=r.kind,h=i.generateIdentifier(),f,s;r.mid=h;r.iceGatherer||(r.iceGatherer=c.usingBundle&&u>0?o[0].iceGatherer:c._createIceGatherer(h,u));f=n.RTCRtpSender.getCapabilities(e);t<15019&&(f.codecs=f.codecs.filter(function(n){return n.name!=="rtx"}));f.codecs.forEach(function(n){n.name==="H264"&&n.parameters["level-asymmetry-allowed"]===undefined&&(n.parameters["level-asymmetry-allowed"]="1")});s=[{ssrc:(2*u+1)*1001}];l&&t>=15019&&e==="video"&&(s[0].rtx={ssrc:(2*u+1)*1001+1});r.wantReceive&&(r.rtpReceiver=new n.RTCRtpReceiver(r.dtlsTransport,e));r.localCapabilities=f;r.sendEncodingParameters=s}),this._config.bundlePolicy!=="max-compat"&&(s+="a=group:BUNDLE "+o.map(function(n){return n.mid}).join(" ")+"\r\n"),s+="a=ice-options:trickle\r\n",o.forEach(function(n){s+=i.writeMediaSection(n,n.localCapabilities,"offer",n.stream);s+="a=rtcp-rsize\r\n"}),this._pendingOffer=o,h=new n.RTCSessionDescription({type:"offer",sdp:s}),arguments.length&&typeof arguments[0]=="function"&&n.setTimeout(arguments[0],0,h),Promise.resolve(h)},o.prototype.createAnswer=function(){var u=i.writeSessionBoilerplate(this._sdpSessionId),f;return this.usingBundle&&(u+="a=group:BUNDLE "+this.transceivers.map(function(n){return n.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(n,f){var e,o,s;if(n.isDatachannel){u+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+n.mid+"\r\n";return}n.stream&&(n.kind==="audio"?e=n.stream.getAudioTracks()[0]:n.kind==="video"&&(e=n.stream.getVideoTracks()[0]),e&&t>=15019&&n.kind==="video"&&(n.sendEncodingParameters[0].rtx={ssrc:(2*f+2)*1001+1}));o=r(n.localCapabilities,n.remoteCapabilities);s=o.codecs.filter(function(n){return n.name.toLowerCase()==="rtx"}).length;!s&&n.sendEncodingParameters[0].rtx&&delete n.sendEncodingParameters[0].rtx;u+=i.writeMediaSection(n,o,"answer",n.stream);n.rtcpParameters&&n.rtcpParameters.reducedSize&&(u+="a=rtcp-rsize\r\n")}),f=new n.RTCSessionDescription({type:"answer",sdp:u}),arguments.length&&typeof arguments[0]=="function"&&n.setTimeout(arguments[0],0,f),Promise.resolve(f)},o.prototype.addIceCandidate=function(t){var f,e,u,o,r,s;if(t){if(e=t.sdpMLineIndex,t.sdpMid)for(u=0;u<this.transceivers.length;u++)if(this.transceivers[u].mid===t.sdpMid){e=u;break}if(o=this.transceivers[e],o){if((r=Object.keys(t.candidate).length>0?i.parseCandidate(t.candidate):{},r.protocol==="tcp"&&(r.port===0||r.port===9))||r.component&&!(r.component==="1"||r.component===1))return Promise.resolve();o.iceTransport.addRemoteCandidate(r);s=i.splitSections(this.remoteDescription.sdp);s[e+1]+=(r.type?t.candidate.trim():"a=end-of-candidates")+"\r\n";this.remoteDescription.sdp=s.join("")}}else for(f=0;f<this.transceivers.length;f++)if(this.transceivers[f].iceTransport.addRemoteCandidate({}),this.usingBundle)return Promise.resolve();return arguments.length>1&&typeof arguments[1]=="function"&&n.setTimeout(arguments[1],0),Promise.resolve()},o.prototype.getStats=function(){var i=[],t,r;return this.transceivers.forEach(function(n){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){n[t]&&i.push(n[t].getStats())})}),t=arguments.length>1&&typeof arguments[1]=="function"&&arguments[1],r=function(n){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[n.type]||n.type},new Promise(function(u){var f=new Map;Promise.all(i).then(function(i){i.forEach(function(n){Object.keys(n).forEach(function(t){n[t].type=r(n[t]);f.set(t,n[t])})});t&&n.setTimeout(t,0,f);u(f)})})},o}},{sdp:1}],9:[function(n,t){var r=n("../utils"),i={shimOnTrack:function(n){typeof n!="object"||!n.RTCPeerConnection||"ontrack"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(n){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly));this.addEventListener("track",this._ontrack=n);this.addEventListener("addstream",this._ontrackpoly=function(n){n.stream.getTracks().forEach(function(t){var i=new Event("track");i.track=t;i.receiver={track:t};i.streams=[n.stream];this.dispatchEvent(i)}.bind(this))}.bind(this))}})},shimSourceObject:function(n){typeof n=="object"&&(!n.HTMLMediaElement||"srcObject"in n.HTMLMediaElement.prototype||Object.defineProperty(n.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(n){this.mozSrcObject=n}}))},shimPeerConnection:function(n){var t=r.detectBrowser(n),i;if(typeof n=="object"&&(n.RTCPeerConnection||n.mozRTCPeerConnection)){n.RTCPeerConnection||(n.RTCPeerConnection=function(i,r){var o,f,u,e,s;if(t.version<38&&i&&i.iceServers){for(o=[],f=0;f<i.iceServers.length;f++)if(u=i.iceServers[f],u.hasOwnProperty("urls"))for(e=0;e<u.urls.length;e++)s={url:u.urls[e]},u.urls[e].indexOf("turn")===0&&(s.username=u.username,s.credential=u.credential),o.push(s);else o.push(i.iceServers[f]);i.iceServers=o}return new n.mozRTCPeerConnection(i,r)},n.RTCPeerConnection.prototype=n.mozRTCPeerConnection.prototype,n.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:function(){return n.mozRTCPeerConnection.generateCertificate}}),n.RTCSessionDescription=n.mozRTCSessionDescription,n.RTCIceCandidate=n.mozRTCIceCandidate);["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var i=n.RTCPeerConnection.prototype[t];n.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}});i=n.RTCPeerConnection.prototype.addIceCandidate;n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var f=function(n){var t=new Map;return Object.keys(n).forEach(function(i){t.set(i,n[i]);t[i]=n[i]}),t},u={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(n,i,r){return e.apply(this,[n||null]).then(function(n){if(t.version<48&&(n=f(n)),t.version<53&&!i)try{n.forEach(function(n){n.type=u[n.type]||n.type})}catch(r){if(r.name!=="TypeError")throw r;n.forEach(function(t,i){n.set(i,Object.assign({},t,{type:u[t.type]||t.type}))})}return n}).then(i,r)}}}};t.exports={shimOnTrack:i.shimOnTrack,shimSourceObject:i.shimSourceObject,shimPeerConnection:i.shimPeerConnection,shimGetUserMedia:n("./getusermedia")}},{"../utils":12,"./getusermedia":10}],10:[function(n,t){var i=n("../utils"),r=i.log;t.exports=function(n){var e=i.detectBrowser(n),t=n&&n.navigator,u=n&&n.MediaStreamTrack,o=function(n){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[n.name]||n.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[n.message]||n.message,constraint:n.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(n,i,u){var f=function(n){if(typeof n!="object"||n.require)return n;var t=[];return Object.keys(n).forEach(function(i){var r,u;i!=="require"&&i!=="advanced"&&i!=="mediaSource"&&(r=n[i]=typeof n[i]=="object"?n[i]:{ideal:n[i]},(r.min!==undefined||r.max!==undefined||r.exact!==undefined)&&t.push(i),r.exact!==undefined&&(typeof r.exact=="number"?r.min=r.max=r.exact:n[i]=r.exact,delete r.exact),r.ideal!==undefined&&(n.advanced=n.advanced||[],u={},u[i]=typeof r.ideal=="number"?{min:r.ideal,max:r.ideal}:r.ideal,n.advanced.push(u),delete r.ideal,Object.keys(r).length||delete n[i]))}),t.length&&(n.require=t),n};return n=JSON.parse(JSON.stringify(n)),e.version<38&&(r("spec: "+JSON.stringify(n)),n.audio&&(n.audio=f(n.audio)),n.video&&(n.video=f(n.video)),r("ff37: "+JSON.stringify(n))),t.mozGetUserMedia(n,i,function(n){u(o(n))})},y=function(n){return new Promise(function(t,i){s(n,t,i)})},h,c,f,l,a,v;t.mediaDevices||(t.mediaDevices={getUserMedia:y,addEventListener:function(){},removeEventListener:function(){}});t.mediaDevices.enumerateDevices=t.mediaDevices.enumerateDevices||function(){return new Promise(function(n){n([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})};e.version<41&&(h=t.mediaDevices.enumerateDevices.bind(t.mediaDevices),t.mediaDevices.enumerateDevices=function(){return h().then(undefined,function(n){if(n.name==="NotFoundError")return[];throw n;})});e.version<49&&(c=t.mediaDevices.getUserMedia.bind(t.mediaDevices),t.mediaDevices.getUserMedia=function(n){return c(n).then(function(t){if(n.audio&&!t.getAudioTracks().length||n.video&&!t.getVideoTracks().length){t.getTracks().forEach(function(n){n.stop()});throw new DOMException("The object can not be found here.","NotFoundError");}return t},function(n){return Promise.reject(o(n))})});e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints()||(f=function(n,t,i){t in n&&!(i in n)&&(n[i]=n[t],delete n[t])},l=t.mediaDevices.getUserMedia.bind(t.mediaDevices),t.mediaDevices.getUserMedia=function(n){return typeof n=="object"&&typeof n.audio=="object"&&(n=JSON.parse(JSON.stringify(n)),f(n.audio,"autoGainControl","mozAutoGainControl"),f(n.audio,"noiseSuppression","mozNoiseSuppression")),l(n)},u&&u.prototype.getSettings&&(a=u.prototype.getSettings,u.prototype.getSettings=function(){var n=a.apply(this,arguments);return f(n,"mozAutoGainControl","autoGainControl"),f(n,"mozNoiseSuppression","noiseSuppression"),n}),u&&u.prototype.applyConstraints&&(v=u.prototype.applyConstraints,u.prototype.applyConstraints=function(n){return this.kind==="audio"&&typeof n=="object"&&(n=JSON.parse(JSON.stringify(n)),f(n,"autoGainControl","mozAutoGainControl"),f(n,"noiseSuppression","mozNoiseSuppression")),v.apply(this,[n])}));t.getUserMedia=function(n,r,u){if(e.version<44)return s(n,r,u);i.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia");t.mediaDevices.getUserMedia(n).then(r,u)}}},{"../utils":12}],11:[function(n,t){var r=n("../utils"),i={shimLocalStreamsAPI:function(n){if(typeof n=="object"&&n.RTCPeerConnection){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getStreamById=function(n){var t=null;return this._localStreams&&this._localStreams.forEach(function(i){i.id===n&&(t=i)}),this._remoteStreams&&this._remoteStreams.forEach(function(i){i.id===n&&(t=i)}),t}),!("addStream"in n.RTCPeerConnection.prototype)){var t=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]);this._localStreams.indexOf(n)===-1&&this._localStreams.push(n);var i=this;n.getTracks().forEach(function(r){t.call(i,r,n)})};n.RTCPeerConnection.prototype.addTrack=function(n,i){i&&(this._localStreams?this._localStreams.indexOf(i)===-1&&this._localStreams.push(i):this._localStreams=[i]);t.call(this,n,i)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(n){var t,i,r;(this._localStreams||(this._localStreams=[]),t=this._localStreams.indexOf(n),t!==-1)&&(this._localStreams.splice(t,1),i=this,r=n.getTracks(),this.getSenders().forEach(function(n){r.indexOf(n.track)!==-1&&i.removeTrack(n)}))})}},shimRemoteStreamsAPI:function(n){typeof n=="object"&&n.RTCPeerConnection&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly));this.addEventListener("addstream",this._onaddstream=n);this.addEventListener("track",this._onaddstreampoly=function(n){var i=n.streams[0],t;(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.indexOf(i)>=0)||(this._remoteStreams.push(i),t=new Event("addstream"),t.stream=n.streams[0],this.dispatchEvent(t))}.bind(this))}}))},shimCallbacksAPI:function(n){var i;if(typeof n=="object"&&n.RTCPeerConnection){var t=n.RTCPeerConnection.prototype,r=t.createOffer,u=t.createAnswer,f=t.setLocalDescription,e=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(n,t){var u=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[u]);return t?(i.then(n,t),Promise.resolve()):i};t.createAnswer=function(n,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=u.apply(this,[r]);return t?(i.then(n,t),Promise.resolve()):i};i=function(n,t,i){var r=f.apply(this,[n]);return i?(r.then(t,i),Promise.resolve()):r};t.setLocalDescription=i;i=function(n,t,i){var r=e.apply(this,[n]);return i?(r.then(t,i),Promise.resolve()):r};t.setRemoteDescription=i;i=function(n,t,i){var r=o.apply(this,[n]);return i?(r.then(t,i),Promise.resolve()):r};t.addIceCandidate=i}},shimGetUserMedia:function(n){var t=n&&n.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(n,i,r){t.mediaDevices.getUserMedia(n).then(i,r)}.bind(t)))},shimRTCIceServerUrls:function(n){var t=n.RTCPeerConnection;n.RTCPeerConnection=function(n,i){var e,f,u;if(n&&n.iceServers){for(e=[],f=0;f<n.iceServers.length;f++)u=n.iceServers[f],!u.hasOwnProperty("urls")&&u.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),u=JSON.parse(JSON.stringify(u)),u.urls=u.url,delete u.url,e.push(u)):e.push(n.iceServers[f]);n.iceServers=e}return new t(n,i)};n.RTCPeerConnection.prototype=t.prototype;Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}};t.exports={shimCallbacksAPI:i.shimCallbacksAPI,shimLocalStreamsAPI:i.shimLocalStreamsAPI,shimRemoteStreamsAPI:i.shimRemoteStreamsAPI,shimGetUserMedia:i.shimGetUserMedia,shimRTCIceServerUrls:i.shimRTCIceServerUrls}},{"../utils":12}],12:[function(n,t){var r=!0,u=!0,i={disableLog:function(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(r=n,n?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(u=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))},log:function(){if(typeof window=="object"){if(r)return;typeof console!="undefined"&&typeof console.log=="function"&&console.log.apply(console,arguments)}},deprecated:function(n,t){u&&console.warn(n+" is deprecated, please use "+t+" instead.")},extractVersion:function(n,t,i){var r=n.match(t);return r&&r.length>=i&&parseInt(r[i],10)},detectBrowser:function(n){var i=n&&n.navigator,t={};if(t.browser=null,t.version=null,typeof n=="undefined"||!n.navigator)return t.browser="Not a browser.",t;if(i.mozGetUserMedia)t.browser="firefox",t.version=this.extractVersion(i.userAgent,/Firefox\/(\d+)\./,1);else if(i.webkitGetUserMedia)if(n.webkitRTCPeerConnection)t.browser="chrome",t.version=this.extractVersion(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(i.userAgent.match(/Version\/(\d+).(\d+)/))t.browser="safari",t.version=this.extractVersion(i.userAgent,/AppleWebKit\/(\d+)\./,1);else return t.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",t;else if(i.mediaDevices&&i.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=this.extractVersion(i.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(i.mediaDevices&&i.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=this.extractVersion(i.userAgent,/AppleWebKit\/(\d+)\./,1);else return t.browser="Not a supported browser.",t;return t},shimCreateObjectURL:function(n){var t=n&&n.URL,u,f;if(!(typeof n=="object"&&n.HTMLMediaElement&&"srcObject"in n.HTMLMediaElement.prototype))return undefined;var e=t.createObjectURL.bind(t),o=t.revokeObjectURL.bind(t),r=new Map,s=0;t.createObjectURL=function(n){if("getTracks"in n){var t="polyblob:"+ ++s;return r.set(t,n),i.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return e(n)};t.revokeObjectURL=function(n){o(n);r.delete(n)};u=Object.getOwnPropertyDescriptor(n.HTMLMediaElement.prototype,"src");Object.defineProperty(n.HTMLMediaElement.prototype,"src",{get:function(){return u.get.apply(this)},set:function(n){return this.srcObject=r.get(n)||null,u.set.apply(this,[n])}});f=n.HTMLMediaElement.prototype.setAttribute;n.HTMLMediaElement.prototype.setAttribute=function(){return arguments.length===2&&(""+arguments[0]).toLowerCase()==="src"&&(this.srcObject=r.get(arguments[1])||null),f.apply(this,arguments)}}};t.exports={log:i.log,deprecated:i.deprecated,disableLog:i.disableLog,disableWarnings:i.disableWarnings,extractVersion:i.extractVersion,shimCreateObjectURL:i.shimCreateObjectURL,detectBrowser:i.detectBrowser.bind(i)}},{}]},{},[2])(2)});bFullScreen=!1;bDisableVideo=!1;window.onload=function(){detectWebRTC()&&(window.console&&window.console.info("location="+window.location),videoLocal=document.getElementById("video_local"),videoRemote=document.getElementById("video_remote"),audioRemote=document.getElementById("audio_remote"),document.onkeyup=onKeyUp,document.body.onkeyup=onKeyUp,guiSetup(),SIPml.setDebugLevel("info"),oReadyStateTimer=setInterval(function(){document.readyState==="complete"&&(clearInterval(oReadyStateTimer),UpdateCurrentConfig(),SIPml.init(postInit),sipRegister())},500))};this.Ifm=this.Ifm||{};this.Ifm.TurnCredentialManager=CreateTurnCredentialManager();const JLP="GBL: ";CurrentMediaSession=null;NumberOfGatheredCandidates=0;deferredSetLocalDescriptionContext=null;const bPruneCandidate=!1;onPhoneConnected=onCallConnected;onPhoneDisconnected=onCallEnded;this.Ifm=this.Ifm||{};this.Ifm.Phone=function(){function f(){return bowser.firefox&&bowser.version<47||bowser.chrome&&bowser.version==42?!0:!1}function e(){try{if(i=checkWebRTCSupport())return}catch(n){}}function o(n,i,u,f){var e="&gatewayURL=rtmp://"+flash_realm+"/sip&sipURL="+flash_impu+"&authName="+flash_impi+"&authPass="+flash_passwd+"&codecs=ulaw alaw dtmf pcmu pcma&bgcolor="+u+"&videoCodecs=h264";try{return AC_FL_RunContent("src",f+"flash/"+t,"width",n,"height",i,"align","middle","id",t,"menu","false","quality","high","bgcolor",u,"name",t,"allowScriptAccess","always","allowFullScreen","true","flashVars",e,"type","application/x-shockwave-flash","pluginspage","http://www.adobe.com/go/getflashplayer"),r=!0}catch(o){console.log("C2T: "+o)}}var n=!1,u=!1,i=!1,r=!1,t="VideoPhone";return f()||e(),{isSupported:function(){return i},transport:{flash:r,webRTC:i},isConnected:function(){return n},setupFlash:function(n){r&&o(n&&n.width||240,n&&n.height||140,n&&n.bgcolor||"#ffffff",n&&n.basepath||"")},canCall:function(){return this.isSupported()&&!n},canDrop:function(){return this.isSupported()&&n},call:function(u,f){if(this.canCall()){n=!0;onCallConnecting();try{if(i)sipCall(u,f,null);else if(r){var s=u+flash_target,e=getFlashObject(t);e&&e.call(s,f)}}catch(o){console.log("Exception during flash call: "+o);debug(o)}}},drop:function(){if(this.canDrop()){try{if(i)sipHangUp();else if(r){var u=getFlashObject(t);u&&u.bye()}}catch(f){debug(f)}n=!1}},dropped:function(){n=!1},setFlashBackground:function(n){var i=getFlashObject(t);i&&i.setBackgroundColor(n)},onConnecting:null,onConnected:null,onDisconnected:null,onRejected:null,about:{name:"Ifm.Phone",stackBehavior:"ClickToTalk"}}}();