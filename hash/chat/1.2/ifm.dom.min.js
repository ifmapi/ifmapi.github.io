
//============================================================================

// Copyright (c) IFM Infomaster. All rights reserved.

//============================================================================

"use strict";function __errhandler(n,t,i,r,u){if(arguments&&arguments.length){var e=u&&u.message?u.message:n||"Script error",f=t||(u?u.filename:"")||"",o=i||(u?u.lineno:"")||"",s=r||(u?u.colno:"")||"",h=u&&u.stack?u.stack:f?[f,o,s].join(" "):"window.onerror";Ifm.Application.onerror(e,h)}}namespace("Ifm"),function(){var u,n,t;for(Ifm.version+="; Ifm.Dom.js/1.0.0",this.Application={frameworkPath:""},u=document.getElementsByTagName("script"),n=0;n<u.length;n++)if(t=u[n].src.match(/(.*)Ifm\.Dom\.js/),t&&t.length===2){Ifm.Application.frameworkPath=t[1];break}var f=!1,i=[],r=function(){if(!f&&(document.addEventListener||event.type==="load"||document.readyState==="complete")){Ifm.Dom.Strings.replaceAll("%");f=!0;for(var n=i.length;n--;)i[n]();i=[]}};document.addEventListener?(document.addEventListener("DOMContentLoaded",r,!1),window.addEventListener("load",r,!1)):(document.attachEvent("onreadystatechange",r),window.attachEvent("onload",r));this.Application.abort=function(n,t){var r=encodeURIComponent(window.location.href),u=encodeURIComponent(n||""),f=encodeURIComponent(t||""),i=sessionStorage,e="";i?(i.setItem("home",r),i.setItem("error",u),i.setItem("stack",f),i.setItem("info",Ifm.version)):e="?home="+r+"&error="+u+"&stack="+f+"&info="+Ifm.version;window.onerror=null;window.onbeforeunload=null;window.location.assign(this.frameworkPath+"blue.htm"+e)};this.Application.parameters=function(){var n={};return n.count=0,(window.location.search+window.location.hash).replace(/([^?&=]+)=([^&]*)?/g,function(t,i,r){i&&(n[i]=r||"",n.count++)}),n};this.Application.showBand=function(n,t){var i="<div style='margin:16px;'><pre style='font-size:xx-large;'>"+(n||"")+"<\/pre><pre style='font-size:medium;'>"+(t||"")+"<\/pre><\/div>";Ifm.Dom.Band.show(i)};this.Application.ready=function(n){if(!Ifm.Type.isFunction(n))throw new Error("Application.ready() -> Invalid ready handler function");if(f){setTimeout(n);return}i.push(n)};this.Application.quit=function(n,t){if(n&&!Ifm.Type.isFunction(n))throw new Error("Application.quit() -> Invalid quit handler function");if(t&&!Ifm.Type.isFunction(t))throw new Error("Application.quit() -> Invalid cancel handler function");window.onbeforeunload=function(){var i=!1;return setTimeout(function(){setTimeout(function(){i&&t&&t()},100)}),i=n()}};this.Application.onerror=function(n,t){Ifm.Diagnostics.Debug.enabled?Ifm.Diagnostics.Debug.fail(n,t):Ifm.Application.abort(n,t)}}.call(Ifm);namespace("Ifm.Dom"),function(){this.Events={addHandler:window.addEventListener?function(n,t,i){n.addEventListener(t,i,!1)}:function(n,t,i){n.attachEvent("on"+t,i)},getEvent:function(n){return n||window.event},getTarget:function(n){var t=n||window.event;return t.target||t.srcElement},preventDefault:function(n){var t=n||window.event;t.preventDefault?t.preventDefault():t.returnValue=!1},removeHandler:window.removeEventListener?function(n,t,i){n.removeEventListener(t,i,!1)}:function(n,t,i){n.detachEvent("on"+t,i)},stopPropagation:function(n){var t=n||window.event;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},stop:function(n){var t=n||window.event;t.preventDefault&&t.preventDefault();t.stopImmediatePropagation&&t.stopImmediatePropagation();t.stopPropagation&&t.stopPropagation();t.stop&&t.stop();t.cancelBubble=!0;t.returnValue=!1}};this.Dialogs={_dialogs:[]};this.Dialogs.create=function(n,t,i){if(!n||!Ifm.Type.isString(n))throw new Error("Dialogs.create() -> Invalid dialog object id: "+n);if(Ifm.Dom.Dialogs._dialogs[n])throw new Error("Dialogs.create() -> Dialog already created:"+n);var r=document.getElementById(n);if(!r)throw new Error("Dialogs.create() -> Dialog definition object not found in DOM: "+n);if(r.parentNode.removeChild(r),t&&!Ifm.Type.isArray(t))throw new Error("Dialogs.create() -> Invalid buttons array:"+t);Ifm.Dom.Dialogs._dialogs[n]={instance:r,buttons:t||null,options:{modal:(i||{}).hasOwnProperty("modal")?i.modal:!0,title:(i||{}).hasOwnProperty("title")?i.title:""},arguments:null,result:undefined}};this.Dialogs.show=function(n,t,i,r){var u,h,e,f,o,s,c;if(!n||!Ifm.Type.isString(n))throw new Error("Dialogs.show() -> Invalid dialog object id: "+n);if(u=Ifm.Dom.Dialogs._dialogs[n],!u)throw new Error("Dialogs.show() -> Dialog not created: "+n);if(i&&!Ifm.Type.isFunction(i))throw new Error("Dialogs.show() -> Invalid handler: beforeShow");if(r&&!Ifm.Type.isFunction(r))throw new Error("Dialogs.show() -> Invalid handler: onHide");if(!u.shown){if(u.shown=!0,u.onhide=r||null,h=u.instance.cloneNode(!0),e=u.buttons,u.options.modal&&Ifm.Dom.Fader.show(),f=document.createElement("div"),f.className="dialog",f.style.zIndex="1100",f.innerHTML='<div class="dialog-title">'+(t||u.options.title||"")+'<\/div><div class="dialog-body"><\/div><div class="dialog-buttons"><\/div>',e&&e.length!==0||(f.innerHTML+='<div class="dialog-close"><button class="dialog-close-button" onclick="Ifm.Dom.Dialogs.hide(&apos;'+n+'&apos;, 0);">r<\/button><\/div>'),document.body.appendChild(f),u.container=f,f.children[1].appendChild(h),e)for(o=0;o<e.length;o++)s=document.createElement("button"),c="Ifm.Dom.Dialogs._dialogs['"+n+"'].result = (function() { "+e[o].click+" })(); Ifm.Dom.Dialogs.hide('"+n+"', "+(o+1)+");",s.onclick=new Function(c),s.innerHTML=e[o].text,f.children[2].appendChild(s);i&&i();Ifm.Dom.Strings.replaceAll("%%")}};this.Dialogs.hide=function(n,t){var i,r;if(!n||!Ifm.Type.isString(n))throw new Error("Dialogs.hide() -> Invalid dialog object id: "+n);if(i=Ifm.Dom.Dialogs._dialogs[n],!i)throw new Error("Dialogs.hide() -> Dialog not created: "+n);if(i.shown){if(i.onhide)i.onhide(t);i.shown=!1;r=i.container;r.style.opacity="0";setTimeout(function(){document.body.removeChild(r)},200);i.options.modal&&Ifm.Dom.Fader.hide()}};this.Cards=function(){var n={};return{show:function(t,i,r,u,f){var e,o,s;return n[i]?e=n[i].element:(e=document.createElement("div"),n[i]={element:e,fade:u?!0:!1},e.close=Ifm.Dom.Cards.close.bind(null,i),e.onclosed=null,u&&Ifm.Dom.Fader.show(),r||(o=document.getElementById("ifmjs_sys_fader")||document,s=o.onclick,o.onclick=function(n){o.onclick=s;Ifm.Dom.Events.stop(n);Ifm.Dom.Cards.close(i)},e.onclick=o.onclick),e.style.zIndex="1100",document.body.appendChild(e),e.className="dialog level-"+(f&&/^[12345]$/.test(f)?f:"1")),t&&(e.innerHTML=t),e},showDialog:function(n,t,i,r){var o='<div class="dialog-title">'+(i||"")+'<\/div><div class="dialog-body">'+(n||"")+'<\/div><div class="dialog-buttons"><\/div>',e=Ifm.Dom.Cards.show(o,t,!0,!0),u,f;if(r&&r.length)for(u=0;u<r.length;u++)f=document.createElement("button"),f.innerHTML=r[u].text||"[Button"+(u+1)+"]",f.onclick=function(n){return function(){Ifm.Type.isFunction(n)&&n()===!1||e.close()}}(r[u].click),e.lastElementChild.appendChild(f)},close:function(t){if(n[t]){var i=n[t].element;if(document.body.removeChild(i),n[t].fade&&Ifm.Dom.Fader.hide(),Ifm.Type.isFunction(i.onclosed))i.onclosed(i);return delete n[t],i}},isShown:function(t){return n[t]?!0:!1}}}();this.Band={_bands:[]};this.Band.show=function(n){var t,i,r;return Ifm.Dom.Fader.show(),t=document.createElement("div"),t.className="band",t.style.position="absolute",t.style.top="50%",t.style.marginTop="-80px",t.style.minHeight="160px",t.style.left="0px",t.style.width="100%",t.style.backgroundColor="#0066CC",t.style.color="white",t.style.overflow="hidden",t.style.zIndex="1200",i=document.getElementById("ifmjs_sys_fader")||document,r=i.onclick,i.onclick=function(n){i.onclick=r;Ifm.Dom.Events.stop(n);Ifm.Dom.Band.hide()},t.onclick=i.onclick,t.innerHTML=n,document.body.appendChild(t),Ifm.Dom.Band._bands.push(t),Ifm.Dom.Band._bands.length>1&&(Ifm.Dom.Band._bands[Ifm.Dom.Band._bands.length-2].style.display="none"),t};this.Band.hide=function(){if(Ifm.Dom.Band._bands.length>0){var n=Ifm.Dom.Band._bands.pop(n);document.body.removeChild(n);Ifm.Dom.Fader.hide()}return Ifm.Dom.Band._bands.length>0&&(Ifm.Dom.Band._bands[Ifm.Dom.Band._bands.length-1].style.display=""),n};this.Fader={_faders:0};this.Fader.show=function(){var n,t;return Ifm.Dom.Fader._faders++,Ifm.Dom.Fader._faders===1&&(n=document.getElementById("ifmjs_sys_fader"),n||(n=document.createElement("div"),n.id="ifmjs_sys_fader",n.style.backgroundColor="#003366",n.style.opacity="0.50",n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.width="100%",n.style.height="100%",n.style.zIndex="1000",t=document.getElementById("page-layout"),t&&(t.className+=" fade-effect")),document.body.appendChild(n)),Ifm.Dom.Fader._faders>0};this.Fader.hide=function(){var t,n;return Ifm.Dom.Fader._faders--,Ifm.Dom.Fader._faders===0&&(t=document.getElementById("ifmjs_sys_fader"),t&&(document.body.removeChild(t),n=document.getElementById("page-layout"),n&&(n.className=n.className.replace(" fade-effect","")))),Ifm.Dom.Fader._faders<=0};this.Menu=function(){if(!(this instanceof Ifm.Dom.Menu))throw Ifm.Diagnostics.Errors.ctor();var n="ifmjs_menu";return{constructor:Ifm.Dom.Menu,choose:function(t,i){var f,r,u;if(!Ifm.Type.isArray(t))throw Ifm.Diagnostics.Errors.arg("items");if(!Ifm.Type.isFunction(i))throw Ifm.Diagnostics.Errors.arg("callback");for(f="",r=0;r<t.length,u=t[r];r++)f+='<option value="{0}" {2}>{1}<\/option>'.format(u.value,u.label,u.disabled?"disabled":"");var o='<div class="menu"><select style="width:100%;" size="{0}">{1}<\/select><\/div>'.format(t.length===1?2:t.length,f),s=Ifm.Dom.Cards.show(o,n),e=s.children[0].children[0];e.onclick=function(){i(this.value)};e.onkeydown=function(t){t=Ifm.Dom.Events.getEvent(t);t.which===13&&(Ifm.Dom.Cards.close(n),i(this.value));t.which===27&&Ifm.Dom.Cards.close(n)};e.focus()}}};this.Strings=function(){function n(n,t){if(Ifm.Type.isString(t.nodeValue)&&t.nodeValue.startsWith(n+"(")&&t.nodeValue.endsWith(")"))try{t.nodeValue=Function("return "+t.nodeValue.slice(n.length+1,-1))()}catch(i){}}return{replaceAll:function(t){t||(t="%");Ifm.Dom.Walker.walk(document.body,function(i){if(i.nodeType==1)for(var r=0;r<i.attributes.length;r++)n(t,i.attributes[r]);else i.nodeType==3&&n(t,i)})}}}();this.Walker={};this.Walker.walk=function n(t,i){for(i(t),t=t.firstChild;t;)n(t,i),t=t.nextSibling}}.call(Ifm.Dom);