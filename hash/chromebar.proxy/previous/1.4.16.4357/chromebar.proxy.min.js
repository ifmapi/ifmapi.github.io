
//============================================================================

// Copyright (c) IFM Infomaster. All rights reserved.

//============================================================================

"use strict";function defineEvents(){for(var t,i={},n=0;n<arguments.length;n++){if(t=arguments[n],!Ifm.Type.isString(t))throw Ifm.Diagnostics.Errors.arg("name");createEventAccessors(i,t)}return i}function createEventAccessors(n,t){var i=new Ifm.Event;Object.defineProperty(n,t,{get:function(){return i},set:function(n){i.addHandler(n)}})}function inherits(n,t){if(!Ifm.Type.isFunction(n))throw Ifm.Diagnostics.Errors.func("ctorClass");if(!Ifm.Type.isFunction(t))throw Ifm.Diagnostics.Errors.func("ctorBase");return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,t.prototype}function namespace(n,t){for(var r,f,i=window,e=n.split("."),u=0;u<e.length;u++)r=e[u],i[r]=i[r]||{},i=i[r];if(typeof t==typeof namespace)t.call(i);else for(f in t)i[f]=t[f];return i}function query(n){var i=n||window.location.search,t={};return i.replace(/[?&#]([^=]+)=([^&]*)?/g,function(n,i,r){return i&&(t[i]=r||""),""}),t}function __errhandler(n,t,i,r,u){if(arguments&&arguments.length){var e=u&&u.message?u.message:n||"Script error",f=t||(u?u.filename:"")||"",o=i||(u?u.lineno:"")||"",s=r||(u?u.colno:"")||"",h=u&&u.stack?u.stack:f?[f,o,s].join(" "):"window.onerror";Ifm.Application.onerror(e,h)}}function namespace(n,t){for(var r,f,i=Ifm,e=n.split("."),u=1;u<e.length;u++)r=e[u],i[r]=i[r]||{},i=i[r];for(f in t)i[f]=t[f];return i}var global=global||window,T0,dT,Occupant,RoomConfig,XmppRoom,__bind,Mustache,dateFormat,Candy,Ifm,helpers;if(Object.defineProperty?Object.defineProperty(global,"T0",{value:+new Date}):T0=+new Date,dT=function(){return new Date-T0},Function.getName=function(n){if(!Ifm.Type.isFunction(n))throw Ifm.Diagnostics.Errors.func("func");var t=/function\s+(\w+)/.exec(n);return t&&t.length===2?t[1]:(t=/(\w+)\s*=\s*function/.exec(n),t&&t.length===2)?t[1]:"anonymous function"},Function.prototype.toShortString=function(){var n=this.toString().replace(/[\r|\n]/g,"").replace(/[\s]+/g," ");return n.substr(0,n.indexOf("{")).trim()},Array.pushArray=function(n,t){if(!Ifm.Type.isArray(n))throw Ifm.Diagnostics.Errors.arg("array1");if(!Ifm.Type.isArray(t))throw Ifm.Diagnostics.Errors.arg("array2");return Array.prototype.push.apply(n,t)},!Array.prototype.find)try{Object.defineProperty(Array.prototype,"find",{enumerable:!1,value:function(n,t){if(!Ifm.Type.isFunction(n))throw Ifm.Diagnostics.Errors.func("func");for(var i=0,r=this.length;i<r;i++)if(i in this&&n.call(t,this[i],i,this))return this[i];return undefined}})}catch(e){}window.ArrayBuffer&&(ArrayBuffer.fromBytes=function(n){for(var i=n.length,r=new ArrayBuffer(i),u=new Uint8Array(r),t=0;t<i;t++)u[t]=n[t];return r},ArrayBuffer.prototype.getBytes=function(){for(var t=new Uint8Array(this),i=[],n=0,r=t.length;n<r;n++)i.push(t[n]);return i});Object.entries||(Object.entries=function(n){var i=[];for(var t in n)n.hasOwnProperty(t)&&i.push([t,n[t]]);return i});Object.keys||(Object.keys=function(n){var t=[];for(var i in n)n.hasOwnProperty(i)&&t.push(i);return t});Object.values||(Object.values=function(n){var t=[];for(var i in n)n.hasOwnProperty(i)&&t.push(n[i]);return t});String.format=function(n){if(!n||!Ifm.Type.isString(n))return n;var t=Array.prototype.slice.call(arguments,1);return n.replace(/{(\d+)}/g,function(n,i){return typeof t[i]!="undefined"?t[i]:""})};String.prototype.format=function(){var n=[this];return Array.prototype.push.apply(n,arguments),String.format.apply(null,n)};String.prototype.startsWith||(String.prototype.startsWith=function(n,t){return t=t||0,this.substr(t,n.length)===n});String.prototype.endsWith||(String.prototype.endsWith=function(n,t){t=t||this.length;var i=Math.max(t-n.length,0);return this.slice(i,t)===n});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")});String.prototype.indexAfter=function(n){var t=this.indexOf(n);return t+(t<0?0:n.length)};String.prototype.lastIndexAfter=function(n){var t=this.lastIndexOf(n);return t+(t<0?0:n.length)};Date.now||(Date.now=function(){return+new Date});Date.prototype.toISOString||function(){function n(n){var t=String(n);return t.length===1&&(t="0"+t),t}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+n(this.getUTCMonth()+1)+"-"+n(this.getUTCDate())+"T"+n(this.getUTCHours())+":"+n(this.getUTCMinutes())+":"+n(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}();Date.prototype.toISOLocaleDateString||(Date.prototype.toISOLocaleDateString=function(){var i=""+this.getFullYear(),n=""+(this.getMonth()+1),t=""+this.getDate();return n.length<2&&(n="0"+n),t.length<2&&(t="0"+t),i+"-"+n+"-"+t});namespace("Ifm",function(){Ifm.version="Ifm.js/1.0.91-3984";this.Objects={deepMerge:function n(t,i,r){for(var u in i)typeof i[u]=="object"?(i[u]===null?r!==!0&&(t[u]=null):(typeof t[u]!="object"||t[u]===null)&&(t[u]={}),n(t[u],i[u],r)):(i[u]!==undefined||r!==!0)&&(t[u]=i[u]);return t}};this.Enum={};this.Enum.getName=function(n,t){for(var r,u=Object.getOwnPropertyNames(n),i=0,f=u.length;i<f;i++)if(r=u[i],n[r]===t)return r;return""};this.Enum.getLength=function(n){return Object.getOwnPropertyNames(n).length};this.Type={};this.Type.getTypeName=function(n){var i=Object.prototype.toString.call(n).slice(8,-1),t;return i==="Object"&&(t=n&&n.constructor&&n.constructor.toString().match(/function\s+([^\s]{1,})\s*\(/),t)?t[1]:i};this.Type.isArray=function(n){return Object.prototype.toString.call(n)==="[object Array]"};this.Type.isLikeArray=function(n){return typeof n=="object"&&!Ifm.Type.isString(n)&&typeof n.length=="number"&&!n.propertyIsEnumerable("length")};this.Type.isFunction=function(n){return typeof n=="function"};this.Type.isNumber=function(n){return typeof n=="number"};this.Type.isString=function(n){return typeof n=="string"||n instanceof String};this.Event=function(){if(!(this instanceof Ifm.Event))throw Ifm.Diagnostics.Errors.ctor();var n=[];return{constructor:Ifm.Event,addHandler:function(t,i){Ifm.Type.isFunction(t)&&n.push({f:t,o:i||null})},hasHandlers:function(){return n.length>0},removeAllHandlers:function(){n.length=0},removeHandler:function(t){for(var i=n.length;i--;)n[i].f===t&&n.splice(i,1)},raise:function(){for(var i=n.length,t;i--;)t=n[i],t.f.apply(t.o,arguments)}}}});namespace("Ifm.Diagnostics",function(){this.Debug={};this.Debug.onprint=new Ifm.Event;this.Debug.enabled=!1;this.Debug.popupAssertions=!1;this.Debug.assert=function(n,t){if(Ifm.Diagnostics.Debug.enabled){if(Ifm.Type.isString(n)){try{var i=new Function("return "+n);Ifm.Diagnostics.Debug.assert(i(),n+" "+t)}catch(r){Ifm.Diagnostics.Debug.fail("Invalid assert condition '"+n+"' : "+r.message)}return}n||Ifm.Diagnostics.Debug.fail(t)}};this.Debug.fail=function n(t){if(Ifm.Diagnostics.Debug.enabled){var i=arguments[1],u=arguments[2]||n;if(!i)try{throw new Error("Assertion failed");}catch(r){i=r.stack||"[Callstack not available]"}window.console&&console.error&&console.error(t,i);Ifm.Diagnostics.Debug.popupAssertions&&alert(t+"\n\n----Stack----\n\n"+i)}};this.Debug.clear=function(){if(Ifm.Diagnostics.Debug.enabled){window.console&&console.clear&&console.clear();var n=document.getElementById("consoleview");n&&(n.innerHTML="")}};this.Debug.print=function(n){var t,i;Ifm.Diagnostics.Debug.enabled&&(t=arguments.length>1?Array.prototype.slice.call(arguments).join(" "):n&&n.toString()||null,t!==null)&&(window.console&&console.log&&console.log(t),Ifm.Diagnostics.Debug.onprint.raise(t),i=document.getElementById("consoleview"),i&&(i.innerHTML+=t+"<br>",i.scrollTop=i.scrollHeight))};this.Debug.printf=function(){Ifm.Diagnostics.Debug.enabled&&Ifm.Diagnostics.Debug.print(String.format.apply(null,arguments))};this.Errors=function(){function t(n,t){return new Error(n+(t?": '"+t+"'":""))}var n={};return n.arg=function(n){return t("Invalid function argument",n)},n.argsno=function(n){return t("Invalid number of function arguments",n)},n.browser=function(){return t("Browser not supported")},n.ctor=function(n){return t("Invalid constructor call",n)},n.func=function(n){return t("Function argument expected",n)},n.miss=function(n){return t("Missing type or module",n)},n.notimpl=function(n){return t("Feature not implemented",n)},n.notsup=function(n){return t("Feature not supported",n)},n.op=function(n){return t("Invalid operation",n)},n}()});namespace("Ifm"),function(){var u,n,t;for(Ifm.version+="; Ifm.Dom.js/1.0.0",this.Application={frameworkPath:""},u=document.getElementsByTagName("script"),n=0;n<u.length;n++)if(t=u[n].src.match(/(.*)Ifm\.Dom\.js/),t&&t.length===2){Ifm.Application.frameworkPath=t[1];break}var f=!1,i=[],r=function(){if(!f&&(document.addEventListener||event.type==="load"||document.readyState==="complete")){Ifm.Dom.Strings.replaceAll("%");f=!0;for(var n=i.length;n--;)i[n]();i=[]}};document.addEventListener?(document.addEventListener("DOMContentLoaded",r,!1),window.addEventListener("load",r,!1)):(document.attachEvent("onreadystatechange",r),window.attachEvent("onload",r));this.Application.abort=function(n,t){var r=encodeURIComponent(window.location.href),u=encodeURIComponent(n||""),f=encodeURIComponent(t||""),i=sessionStorage,e="";i?(i.setItem("home",r),i.setItem("error",u),i.setItem("stack",f),i.setItem("info",Ifm.version)):e="?home="+r+"&error="+u+"&stack="+f+"&info="+Ifm.version;window.onerror=null;window.onbeforeunload=null;window.location.assign(this.frameworkPath+"blue.htm"+e)};this.Application.parameters=function(){var n={};return n.count=0,(window.location.search+window.location.hash).replace(/([^?&=]+)=([^&]*)?/g,function(t,i,r){i&&(n[i]=r||"",n.count++)}),n};this.Application.showBand=function(n,t){var i="<div style='margin:16px;'><pre style='font-size:xx-large;'>"+(n||"")+"<\/pre><pre style='font-size:medium;'>"+(t||"")+"<\/pre><\/div>";Ifm.Dom.Band.show(i)};this.Application.ready=function(n){if(!Ifm.Type.isFunction(n))throw new Error("Application.ready() -> Invalid ready handler function");if(f){setTimeout(n);return}i.push(n)};this.Application.quit=function(n,t){if(n&&!Ifm.Type.isFunction(n))throw new Error("Application.quit() -> Invalid quit handler function");if(t&&!Ifm.Type.isFunction(t))throw new Error("Application.quit() -> Invalid cancel handler function");window.onbeforeunload=function(){var i=!1;return setTimeout(function(){setTimeout(function(){i&&t&&t()},100)}),i=n()}};this.Application.onerror=function(n,t){Ifm.Diagnostics.Debug.enabled?Ifm.Diagnostics.Debug.fail(n,t):Ifm.Application.abort(n,t)}}.call(Ifm);namespace("Ifm.Dom"),function(){this.Events={addHandler:window.addEventListener?function(n,t,i){n.addEventListener(t,i,!1)}:function(n,t,i){n.attachEvent("on"+t,i)},getEvent:function(n){return n||window.event},getTarget:function(n){var t=n||window.event;return t.target||t.srcElement},preventDefault:function(n){var t=n||window.event;t.preventDefault?t.preventDefault():t.returnValue=!1},removeHandler:window.removeEventListener?function(n,t,i){n.removeEventListener(t,i,!1)}:function(n,t,i){n.detachEvent("on"+t,i)},stopPropagation:function(n){var t=n||window.event;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},stop:function(n){var t=n||window.event;t.preventDefault&&t.preventDefault();t.stopImmediatePropagation&&t.stopImmediatePropagation();t.stopPropagation&&t.stopPropagation();t.stop&&t.stop();t.cancelBubble=!0;t.returnValue=!1}};this.Dialogs={_dialogs:[]};this.Dialogs.create=function(n,t,i){if(!n||!Ifm.Type.isString(n))throw new Error("Dialogs.create() -> Invalid dialog object id: "+n);if(Ifm.Dom.Dialogs._dialogs[n])throw new Error("Dialogs.create() -> Dialog already created:"+n);var r=document.getElementById(n);if(!r)throw new Error("Dialogs.create() -> Dialog definition object not found in DOM: "+n);if(r.parentNode.removeChild(r),t&&!Ifm.Type.isArray(t))throw new Error("Dialogs.create() -> Invalid buttons array:"+t);Ifm.Dom.Dialogs._dialogs[n]={instance:r,buttons:t||null,options:{modal:(i||{}).hasOwnProperty("modal")?i.modal:!0,title:(i||{}).hasOwnProperty("title")?i.title:""},arguments:null,result:undefined}};this.Dialogs.show=function(n,t,i,r){var u,h,e,f,o,s,c;if(!n||!Ifm.Type.isString(n))throw new Error("Dialogs.show() -> Invalid dialog object id: "+n);if(u=Ifm.Dom.Dialogs._dialogs[n],!u)throw new Error("Dialogs.show() -> Dialog not created: "+n);if(i&&!Ifm.Type.isFunction(i))throw new Error("Dialogs.show() -> Invalid handler: beforeShow");if(r&&!Ifm.Type.isFunction(r))throw new Error("Dialogs.show() -> Invalid handler: onHide");if(!u.shown){if(u.shown=!0,u.onhide=r||null,h=u.instance.cloneNode(!0),e=u.buttons,u.options.modal&&Ifm.Dom.Fader.show(),f=document.createElement("div"),f.className="dialog",f.style.zIndex="1100",f.innerHTML='<div class="dialog-title">'+(t||u.options.title||"")+'<\/div><div class="dialog-body"><\/div><div class="dialog-buttons"><\/div>',e&&e.length!==0||(f.innerHTML+='<div class="dialog-close"><button class="dialog-close-button" onclick="Ifm.Dom.Dialogs.hide(&apos;'+n+'&apos;, 0);">r<\/button><\/div>'),document.body.appendChild(f),u.container=f,f.children[1].appendChild(h),e)for(o=0;o<e.length;o++)s=document.createElement("button"),c="Ifm.Dom.Dialogs._dialogs['"+n+"'].result = (function() { "+e[o].click+" })(); Ifm.Dom.Dialogs.hide('"+n+"', "+(o+1)+");",s.onclick=new Function(c),s.innerHTML=e[o].text,s.style.cssText=e[o].cssText,f.children[2].appendChild(s);i&&i();Ifm.Dom.Strings.replaceAll("%%")}};this.Dialogs.hide=function(n,t){var i,r;if(!n||!Ifm.Type.isString(n))throw new Error("Dialogs.hide() -> Invalid dialog object id: "+n);if(i=Ifm.Dom.Dialogs._dialogs[n],!i)throw new Error("Dialogs.hide() -> Dialog not created: "+n);if(i.shown){if(i.onhide)i.onhide(t);i.shown=!1;r=i.container;r.style.opacity="0";setTimeout(function(){document.body.removeChild(r)},200);i.options.modal&&Ifm.Dom.Fader.hide()}};this.Cards=function(){var n={};return{show:function(t,i,r,u,f){var e,o,s;return i||(i="card"+(+new Date).toString(16)),n[i]?e=n[i].element:(e=document.createElement("div"),n[i]={element:e,fade:u?!0:!1},e.close=Ifm.Dom.Cards.close.bind(null,i),e.onclosed=null,u&&Ifm.Dom.Fader.show(),r||(o=document.getElementById("ifmjs_sys_fader")||document,s=o.onclick,o.onclick=function(n){o.onclick=s;Ifm.Dom.Events.stop(n);Ifm.Dom.Cards.close(i)},e.onclick=o.onclick),e.style.zIndex="1100",document.body.appendChild(e),e.className="dialog level-"+(f&&/^[12345]$/.test(f)?f:"1")),t&&(e.innerHTML=t),e},showDialog:function(n,t,i,r){var o='<div class="dialog-title">'+(i||"")+'<\/div><div class="dialog-body">'+(n||"")+'<\/div><div class="dialog-buttons"><\/div>',e=Ifm.Dom.Cards.show(o,t,!0,!0),u,f;if(r&&r.length)for(u=0;u<r.length;u++)f=document.createElement("button"),f.innerHTML=r[u].text||"[Button"+(u+1)+"]",f.style.cssText=r[u].cssText,f.onclick=function(n){return function(){Ifm.Type.isFunction(n)&&n()===!1||e.close()}}(r[u].click),e.lastElementChild.appendChild(f)},shake:function(t){if(n[t]){var i=n[t].element,f=i.style.left,e=i.style.right,r=i.offsetLeft,u=function(n){var t=10*(n%3-1);i.style.left=r+t+"px";i.style.right=r-t+"px";--n>0?setTimeout(u,20,n):(i.style.left=f,i.style.right=e)};u(16)}},close:function(t){if(n[t]){var i=n[t].element;if(document.body.removeChild(i),n[t].fade&&Ifm.Dom.Fader.hide(),Ifm.Type.isFunction(i.onclosed))i.onclosed(i);return delete n[t],i}},isShown:function(t){return n[t]?!0:!1}}}();this.Band={_bands:[]};this.Band.show=function(n){var t,i,r;return Ifm.Dom.Fader.show(),t=document.createElement("div"),t.className="band",t.style.position="absolute",t.style.top="50%",t.style.marginTop="-80px",t.style.minHeight="160px",t.style.left="0px",t.style.width="100%",t.style.backgroundColor="#0066CC",t.style.color="white",t.style.overflow="hidden",t.style.zIndex="1200",i=document.getElementById("ifmjs_sys_fader")||document,r=i.onclick,i.onclick=function(n){i.onclick=r;Ifm.Dom.Events.stop(n);Ifm.Dom.Band.hide()},t.onclick=i.onclick,t.innerHTML=n,document.body.appendChild(t),Ifm.Dom.Band._bands.push(t),Ifm.Dom.Band._bands.length>1&&(Ifm.Dom.Band._bands[Ifm.Dom.Band._bands.length-2].style.display="none"),t};this.Band.hide=function(){if(Ifm.Dom.Band._bands.length>0){var n=Ifm.Dom.Band._bands.pop(n);document.body.removeChild(n);Ifm.Dom.Fader.hide()}return Ifm.Dom.Band._bands.length>0&&(Ifm.Dom.Band._bands[Ifm.Dom.Band._bands.length-1].style.display=""),n};this.Fader={_faders:0};this.Fader.show=function(){var n,t;return Ifm.Dom.Fader._faders++,Ifm.Dom.Fader._faders===1&&(n=document.getElementById("ifmjs_sys_fader"),n||(n=document.createElement("div"),n.id="ifmjs_sys_fader",n.style.backgroundColor="#003366",n.style.opacity="0.50",n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.width="100%",n.style.height="100%",n.style.zIndex="1000",t=document.getElementById("page-layout"),t&&(t.className+=" fade-effect")),document.body.appendChild(n)),Ifm.Dom.Fader._faders>0};this.Fader.hide=function(){var t,n;return Ifm.Dom.Fader._faders--,Ifm.Dom.Fader._faders===0&&(t=document.getElementById("ifmjs_sys_fader"),t&&(document.body.removeChild(t),n=document.getElementById("page-layout"),n&&(n.className=n.className.replace(" fade-effect","")))),Ifm.Dom.Fader._faders<=0};this.Menu=function(){if(!(this instanceof Ifm.Dom.Menu))throw Ifm.Diagnostics.Errors.ctor();var n="ifmjs_menu";return{constructor:Ifm.Dom.Menu,choose:function(t,i){var f,r,u;if(!Ifm.Type.isArray(t))throw Ifm.Diagnostics.Errors.arg("items");if(!Ifm.Type.isFunction(i))throw Ifm.Diagnostics.Errors.arg("callback");for(f="",r=0;r<t.length,u=t[r];r++)f+='<option value="{0}" {2}>{1}<\/option>'.format(u.value,u.label,u.disabled?"disabled":"");var o='<div class="menu"><select style="width:100%;" size="{0}">{1}<\/select><\/div>'.format(t.length===1?2:t.length,f),s=Ifm.Dom.Cards.show(o,n),e=s.children[0].children[0];e.onclick=function(){i(this.value)};e.onkeydown=function(t){t=Ifm.Dom.Events.getEvent(t);t.which===13&&(Ifm.Dom.Cards.close(n),i(this.value));t.which===27&&Ifm.Dom.Cards.close(n)};e.focus()}}};this.Strings=function(){function n(n,t){if(Ifm.Type.isString(t.nodeValue)&&t.nodeValue.startsWith(n+"(")&&t.nodeValue.endsWith(")"))try{t.nodeValue=Function("return "+t.nodeValue.slice(n.length+1,-1))()}catch(i){}}return{replaceAll:function(t){t||(t="%");Ifm.Dom.Walker.walk(document.body,function(i){if(i.nodeType===1)for(var r=0;r<i.attributes.length;r++)n(t,i.attributes[r]);else i.nodeType===3&&n(t,i)})}}}();this.Walker={};this.Walker.walk=function n(t,i){for(i(t),t=t.firstChild;t;)n(t,i),t=t.nextSibling}}.call(Ifm.Dom);namespace("Ifm.Messaging").FPropertyList=function(n){if(!(this instanceof Ifm.Messaging.FPropertyList))throw Ifm.Diagnostics.Errors.ctor();if(!n||!Ifm.Type.isString(n))throw Ifm.Diagnostics.Errors.arg("pliststr");n=n.trim();for(var t={},i=[],r,u=/{\s*([^\s{]*)\s*=\s*([^}]*)}/g;r=u.exec(n);)t[r[1]]=r[2],i.push(r[1]);this.events=defineEvents("changed");this.originalString=n;this.get=function(n){if(!n||!Ifm.Type.isString(n))throw Ifm.Diagnostics.Errors.arg("key");return t[n]};this.keys=function(){var n=[];for(var i in t)n.push(i);return n};this.remove=function(n){if(!n||!Ifm.Type.isString(n))throw Ifm.Diagnostics.Errors.arg("key");if(t.hasOwnProperty(n)){delete t[n];for(var r=i.length;r--;)i[r]===n&&(i.splice(r,1),this.events.changed.raise(this,{key:n,value:undefined}))}};this.set=function(n,r){if(!n||!Ifm.Type.isString(n))throw Ifm.Diagnostics.Errors.arg("key");r!==undefined&&(t.hasOwnProperty(n)||i.push(n),t[n]!==r&&(t[n]=r,this.events.changed.raise(this,{key:n,value:r})))};this.toString=function(){for(var r="{",n=0;n<i.length;n++)r+="{"+i[n]+" = "+t[i[n]]+"}";return r+"}"}};namespace("Ifm.Net").WebSocket=function(){function i(n){switch(n){case"403":return": no destination for protocol";case"500":return": client-gateway protocol error";case"502":return": gateway-server protocol error";case"503":return": no destination reachable";default:return""}}var n={},t;return n.ErrorReasons={Failed:"Connection failed",Lost:"Connection lost",Refused:"Connection refused"},n.MessageType={BINARY:"Binary",OBJECT:"Object",TEXT:"Text"},n.isSupported=function(){return global&&global.Ifm&&global.WebSocket?!0:!1},n.create=function(r,u){var f,e,o;if(!n.isSupported())throw Ifm.Diagnostics.Errors.notsup("WebSocket");if(!Ifm.Type.isString(r))throw Ifm.Diagnostics.Errors.arg("url");return f={},f.events=defineEvents("connecting","open","closing","closed","error","receive"),f.id=function(){return t+=1}(),f.connect=function(){function s(){o||(console.debug("[Ifm.Net.WebSocket] %d [%s|%s] %s",t,r,u,"onopen"),o=!0,f.events.open.raise(f,{}))}if(!e||!(e.readyState<WebSocket.CLOSING)){f.events.connecting.raise(f,{});try{e=u?new WebSocket(r,u):new WebSocket(r)}catch(h){f.events.error.raise(f,{error:h});f.events.closed.raise(f,{clean:!1,reason:Ifm.Net.WebSocket.ErrorReasons.Failed});return}e.onmessage=function(e){var o,h;if(Ifm.Type.isString(e.data)){if(o=e.data,o.startsWith("#close")){var c=o.split("|"),l=c.length>1?c[1]:"0",a=l+i(l);console.debug("[Ifm.Net.WebSocket] %d [%s|%s] %s (%s)",t,r,u,"close notification",a);return}if(s(),o.startsWith("{")&&o.endsWith("}")){h=null;try{h=JSON.parse(o)}catch(v){}if(h!==null){f.events.receive.raise(f,{type:n.MessageType.OBJECT,message:h});return}}f.events.receive.raise(f,{type:n.MessageType.TEXT,message:o})}else s(),f.events.receive.raise(f,{type:n.MessageType.BINARY,message:e.data})};e.onclose=function(n){console.debug("[Ifm.Net.WebSocket] %d [%s|%s] %s (code: %d)",t,r,u,"onclose",n.code);f.events.closed.raise(f,{clean:n.wasClean,reason:n.wasClean?"":o?Ifm.Net.WebSocket.ErrorReasons.Lost:Ifm.Net.WebSocket.ErrorReasons.Refused});o=!1;e=null};e.onerror=function(n){f.events.error.raise(f,n)}}},f.close=function(){(console.debug("[Ifm.Net.WebSocket] %d [%s|%s] %s",t,r,u,"close"),e&&e.readyState!==WebSocket.CLOSED)&&(f.events.closing.raise(f,{}),e.close())},f.send=function(n){if(!e||e.readyState!==WebSocket.OPEN)throw Ifm.Diagnostics.Errors.op("WebSocket not open");e.send(n)},Object.defineProperties(f,{isOpen:{get:function(){return f.state===WebSocket.OPEN}},state:{get:function(){return e?e.readyState:WebSocket.CLOSED}}}),e=null,o=!1,f},t=0,n}();namespace("Ifm.Net").Peer=function(){var n={};return n.isSupported=function(){return Ifm&&Ifm.Net&&Ifm.Net.WebSocket&&Ifm.Net.WebSocket.isSupported()?!0:!1},n.query=function(t,i,r,u){n.create(t,i,function(n){n?n.query(r,function(t){u(t);n.close()}):u(null)})},n.create=function(t,i,r){function e(){u.events.closed.removeAllHandlers();u.events.receive.removeAllHandlers()}var f,u;if(!n.isSupported())throw Ifm.Diagnostics.Errors.notsup("Peer");if(!Ifm.Type.isFunction(r))throw Ifm.Diagnostics.Errors.func("callback");return f={},f.query=function(n,t){if(!Ifm.Type.isString(n))throw Ifm.Diagnostics.Errors.arg("query");if(!Ifm.Type.isFunction(t))throw Ifm.Diagnostics.Errors.func("callback");e();u.events.closed=function(){e();t(null)};u.events.receive=function(n,i){e();t(i)};u.isOpen?u.send(n):t(null)},f.receive=function(n){if(!Ifm.Type.isFunction(n))throw Ifm.Diagnostics.Errors.func("callback");e();u.events.closed=function(){n(null)};u.events.receive=function(t,i){n(i)}},f.send=function(n){u.isOpen&&u.send(n)},f.close=function(){e();u.close()},u=Ifm.Net.WebSocket.create(t,i),u.events.closed=function(){e();r(null)},u.events.receive=function(n,t){if(e(),t.type===Ifm.Net.WebSocket.MessageType.TEXT){var i=t.message.split("|");switch(i[0]){case"#ready":r(f);return;case"#close":console.warn(i[1]||"Forcibly closed by server");n.close();r(null);return}}console.warn("[Ifm.Net.Services.Peer] Unexpected message from server",t.message);n.close();r(null)},u.connect(),f},n}();namespace("Ifm.Net.Services").FileTransfer=function(){var n={};n.ErrorReasons={Unavailable:"Service unavailable",RequestRefused:"Request refused",InvalidToken:"Invalid token",FileCorrupted:"File corrupted",FileReadError:"File read error",SecurityError:"Security error: {err}"};n.isSupported=function(){return global&&global.Ifm&&Ifm.Net.Peer&&Ifm.Net.Peer.isSupported()&&global.File&&global.FileList&&global.FileReader&&global.Blob?!0:!1};n.create=function(u){if(!n.isSupported())throw Ifm.Diagnostics.Errors.notsup("FileTransfer");var f={};return f.events=defineEvents("waiting","started","progress","finished","canceled","error"),f.id=function(){return r+=1}(),f.isSender=undefined,f.enabled=function(n){if(!Ifm.Type.isFunction(n))throw Ifm.Diagnostics.Errors.func("callback");Ifm.Net.Peer.query(u,i,"#enabled",function(t){n(t&&t.message||!1)})},f.receive=function(n){if(!Ifm.Type.isString(n))throw Ifm.Diagnostics.Errors.arg("token");if(f.isSender!==undefined)throw Ifm.Diagnostics.Errors.op("FileTransfer instance already in use");f.isSender=!1;var c=Ifm.Net.WebSocket.MessageType.BINARY,a=Ifm.Net.WebSocket.MessageType.OBJECT,l=Ifm.Net.WebSocket.MessageType.TEXT,r=Ifm.Net.Services.FileTransfer.ErrorReasons,e=[],o,s,h;Ifm.Net.Peer.create(u,i,function(i){if(!i){f.events.error.raise(f,{reason:r.Unavailable});return}f.accept=function(){f.accept=function(){};i.send("#start")};f.cancel=function(){f.cancel=function(){};i.send("#cancel");i.close();f.events.canceled.raise(f,{})};i.receive(function(u){var a,v;if(!u){f.events.error.raise(f,{reason:r.RequestRefused});return}if(u.type===l){a=u.message.split("|");switch(a[0]){case"#invalidtoken":i.close();f.events.error.raise(f,{reason:r.InvalidToken});break;case"#cancel":f.cancel();break;case"#paired":f.events.waiting.raise(f,{token:n});break;case"#info":o=a[1];s=Number(a[2]);h=a[3];f.events.started.raise(f,{});break;case"#finished":if(f.cancel=function(){},i.close(),v=new Blob(e,{type:h}),v.size!==s){f.events.error.raise(f,{reason:r.FileCorrupted});return}f.events.finished.raise(f,{fileBlob:v,openOrSaveFunc:function(){if(Ifm.Type.isFunction(window.navigator.msSaveOrOpenBlob))window.navigator.msSaveOrOpenBlob(v,o);else{var n=document.createElement("a");n.href=URL.createObjectURL(v);n.download=o;n.target="_blank";n.style.cssText="display:none!important;";document.body.appendChild(n);n.click();document.body.removeChild(n)}return!1}});break;default:console.warn("[Ifm.Net.Services.FileTransfer] %s Unexpected message: %s","receive()",u.message)}}else u.type===c&&(e.push(u.message),f.events.progress.raise(f,{percentage:Math.ceil(e.length*t*100/s)}))});i.send("#receive|"+n)})},f.transfer=function(n){if(!(n instanceof File))throw Ifm.Diagnostics.Errors.arg("file");if(f.isSender!==undefined)throw Ifm.Diagnostics.Errors.op("FileTransfer instance already in use");f.isSender=!0;var h=Ifm.Net.WebSocket.MessageType.BINARY,c=Ifm.Net.WebSocket.MessageType.OBJECT,s=Ifm.Net.WebSocket.MessageType.TEXT,e=Ifm.Net.Services.FileTransfer.ErrorReasons,r=0,o=!1;Ifm.Net.Peer.create(u,i,function(i){if(!i){f.events.error.raise(f,{reason:e.Unavailable});return}f.cancel=function(){f.cancel=function(){};o=!0;u&&(u.onloadend=function(){},u.onerror=function(){},u.abort(),u=null);i.send("#cancel");i.close();f.events.canceled.raise(f,{})};var u=new FileReader;u.onloadend=function(){var e,s;o||u.readyState===FileReader.DONE&&(i.send(u.result),r+=t,e=r+Math.min(t,n.size-r),r<n.size?(f.events.progress.raise(f,{percentage:Math.ceil(r*100/n.size)}),s=n.slice(r,e),u.readAsArrayBuffer(s)):(f.cancel=function(){},i.send("#finished"),i.close(),f.events.finished.raise(f,{fileBlob:n,openOrSaveFunc:null})))};u.onerror=function(){i.close();f.events.error.raise(f,{reason:e.FileReadError})};i.receive(function(o){var h,c;if(!o){f.events.error.raise(f,{reason:e.RequestRefused});return}if(o.type===s){h=o.message.split("|");switch(h[0]){case"#denied":i.close();f.events.error.raise(f,{reason:e.SecurityError.replace("{err}",h[1])});break;case"#cancel":f.cancel();break;case"#token":f.events.waiting.raise(f,{token:h[1]});break;case"#paired":break;case"#start":i.send("#info|"+n.name+"|"+n.size+"|"+n.type);f.events.started.raise(f,{});c=n.slice(r,Math.min(t,n.size));u.readAsArrayBuffer(c);break;default:console.warn("[Ifm.Net.Services.FileTransfer] %s Unexpected message: %s","transfer()",o.message)}}});i.send("#transfer|"+n.name+"|"+n.size+"|"+n.type)})},f.accept=function(){},f.cancel=function(){},f};var i="ift",t=32768,r=0;return n}();
/*!
 * IFM Strophe bundle 1.3.0-3823
 * Copyright (c) IFM Infomaster. All rights reserved.
 */
(function(n){if(function(n,t){typeof define=="function"&&define.amd?define("strophe-base64",function(){return t()}):n.Base64=t()}(globalThis,function(){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(t){var o="",i,r,u,c,s,h,f,e=0;do i=t.charCodeAt(e++),r=t.charCodeAt(e++),u=t.charCodeAt(e++),c=i>>2,s=(i&3)<<4|r>>4,h=(r&15)<<2|u>>6,f=u&63,isNaN(r)?(s=(i&3)<<4,h=f=64):isNaN(u)&&(f=64),o=o+n.charAt(c)+n.charAt(s)+n.charAt(h)+n.charAt(f);while(e<t.length);return o},decode:function(t){var i="",o,s,h,c,f,u,e,r=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do c=n.indexOf(t.charAt(r++)),f=n.indexOf(t.charAt(r++)),u=n.indexOf(t.charAt(r++)),e=n.indexOf(t.charAt(r++)),o=c<<2|f>>4,s=(f&15)<<4|u>>2,h=(u&3)<<6|e,i=i+String.fromCharCode(o),u!=64&&(i=i+String.fromCharCode(s)),e!=64&&(i=i+String.fromCharCode(h));while(r<t.length);return i}}}),function(n,t){typeof define=="function"&&define.amd?define("strophe-sha1",function(){return t()}):n.SHA1=t()}(globalThis,function(){function t(t,i){t[i>>5]|=128<<24-i%32;t[(i+64>>9<<4)+15]=i;for(var l=new Array(80),f=1732584193,e=-271733879,h=-1732584194,c=271733878,a=-1009589776,r,y,p,w,b,k,d,v=0;v<t.length;v+=16){for(p=f,w=e,b=h,k=c,d=a,r=0;r<80;r++)l[r]=r<16?t[v+r]:u(l[r-3]^l[r-8]^l[r-14]^l[r-16],1),y=n(n(u(f,5),o(r,e,h,c)),n(n(a,l[r]),s(r))),a=c,c=h,h=u(e,30),e=f,f=y;f=n(f,p);e=n(e,w);h=n(h,b);c=n(c,k);a=n(a,d)}return[f,e,h,c,a]}function o(n,t,i,r){return n<20?t&i|~t&r:n<40?t^i^r:n<60?t&i|t&r|i&r:t^i^r}function s(n){return n<20?1518500249:n<40?1859775393:n<60?-1894007588:-899497514}function r(n,r){var f=i(n),e,o,u,s;for(f.length>16&&(f=t(f,n.length*8)),e=new Array(16),o=new Array(16),u=0;u<16;u++)e[u]=f[u]^909522486,o[u]=f[u]^1549556828;return s=t(e.concat(i(r)),512+r.length*8),t(o.concat(s),672)}function n(n,t){var i=(n&65535)+(t&65535),r=(n>>16)+(t>>16)+(i>>16);return r<<16|i&65535}function u(n,t){return n<<t|n>>>32-t}function i(n){for(var i=[],t=0;t<n.length*8;t+=8)i[t>>5]|=(n.charCodeAt(t/8)&255)<<24-t%32;return i}function f(n){for(var i="",t=0;t<n.length*32;t+=8)i+=String.fromCharCode(n[t>>5]>>>24-t%32&255);return i}function e(n){for(var r="",u,i,t=0;t<n.length*4;t+=3)for(u=(n[t>>2]>>8*(3-t%4)&255)<<16|(n[t+1>>2]>>8*(3-(t+1)%4)&255)<<8|n[t+2>>2]>>8*(3-(t+2)%4)&255,i=0;i<4;i++)r+=t*8+i*6>n.length*32?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(u>>6*(3-i)&63);return r}return{b64_hmac_sha1:function(n,t){return e(r(n,t))},b64_sha1:function(n){return e(t(i(n),n.length*8))},binb2str:f,core_hmac_sha1:r,str_hmac_sha1:function(n,t){return f(r(n,t))},str_sha1:function(n){return f(t(i(n),n.length*8))}}}),function(n,t){typeof define=="function"&&define.amd?define("strophe-md5",function(){return t()}):n.MD5=t()}(globalThis,function(){var u=function(n,t){var i=(n&65535)+(t&65535),r=(n>>16)+(t>>16)+(i>>16);return r<<16|i&65535},s=function(n,t){return n<<t|n>>>32-t},e=function(n){for(var i=[],t=0;t<n.length*8;t+=8)i[t>>5]|=(n.charCodeAt(t/8)&255)<<t%32;return i},h=function(n){for(var i="",t=0;t<n.length*32;t+=8)i+=String.fromCharCode(n[t>>5]>>>t%32&255);return i},c=function(n){for(var i="0123456789abcdef",r="",t=0;t<n.length*4;t++)r+=i.charAt(n[t>>2]>>t%4*8+4&15)+i.charAt(n[t>>2]>>t%4*8&15);return r},f=function(n,t,i,r,f,e){return u(s(u(u(t,n),u(r,e)),f),i)},n=function(n,t,i,r,u,e,o){return f(t&i|~t&r,n,t,u,e,o)},t=function(n,t,i,r,u,e,o){return f(t&r|i&~r,n,t,u,e,o)},i=function(n,t,i,r,u,e,o){return f(t^i^r,n,t,u,e,o)},r=function(n,t,i,r,u,e,o){return f(i^(t|~r),n,t,u,e,o)},o=function(f,e){var l;f[e>>5]|=128<<e%32;f[(e+64>>>9<<4)+14]=e;var o=1732584193,s=-271733879,h=-1732584194,c=271733878,a,v,y,p;for(l=0;l<f.length;l+=16)a=o,v=s,y=h,p=c,o=n(o,s,h,c,f[l+0],7,-680876936),c=n(c,o,s,h,f[l+1],12,-389564586),h=n(h,c,o,s,f[l+2],17,606105819),s=n(s,h,c,o,f[l+3],22,-1044525330),o=n(o,s,h,c,f[l+4],7,-176418897),c=n(c,o,s,h,f[l+5],12,1200080426),h=n(h,c,o,s,f[l+6],17,-1473231341),s=n(s,h,c,o,f[l+7],22,-45705983),o=n(o,s,h,c,f[l+8],7,1770035416),c=n(c,o,s,h,f[l+9],12,-1958414417),h=n(h,c,o,s,f[l+10],17,-42063),s=n(s,h,c,o,f[l+11],22,-1990404162),o=n(o,s,h,c,f[l+12],7,1804603682),c=n(c,o,s,h,f[l+13],12,-40341101),h=n(h,c,o,s,f[l+14],17,-1502002290),s=n(s,h,c,o,f[l+15],22,1236535329),o=t(o,s,h,c,f[l+1],5,-165796510),c=t(c,o,s,h,f[l+6],9,-1069501632),h=t(h,c,o,s,f[l+11],14,643717713),s=t(s,h,c,o,f[l+0],20,-373897302),o=t(o,s,h,c,f[l+5],5,-701558691),c=t(c,o,s,h,f[l+10],9,38016083),h=t(h,c,o,s,f[l+15],14,-660478335),s=t(s,h,c,o,f[l+4],20,-405537848),o=t(o,s,h,c,f[l+9],5,568446438),c=t(c,o,s,h,f[l+14],9,-1019803690),h=t(h,c,o,s,f[l+3],14,-187363961),s=t(s,h,c,o,f[l+8],20,1163531501),o=t(o,s,h,c,f[l+13],5,-1444681467),c=t(c,o,s,h,f[l+2],9,-51403784),h=t(h,c,o,s,f[l+7],14,1735328473),s=t(s,h,c,o,f[l+12],20,-1926607734),o=i(o,s,h,c,f[l+5],4,-378558),c=i(c,o,s,h,f[l+8],11,-2022574463),h=i(h,c,o,s,f[l+11],16,1839030562),s=i(s,h,c,o,f[l+14],23,-35309556),o=i(o,s,h,c,f[l+1],4,-1530992060),c=i(c,o,s,h,f[l+4],11,1272893353),h=i(h,c,o,s,f[l+7],16,-155497632),s=i(s,h,c,o,f[l+10],23,-1094730640),o=i(o,s,h,c,f[l+13],4,681279174),c=i(c,o,s,h,f[l+0],11,-358537222),h=i(h,c,o,s,f[l+3],16,-722521979),s=i(s,h,c,o,f[l+6],23,76029189),o=i(o,s,h,c,f[l+9],4,-640364487),c=i(c,o,s,h,f[l+12],11,-421815835),h=i(h,c,o,s,f[l+15],16,530742520),s=i(s,h,c,o,f[l+2],23,-995338651),o=r(o,s,h,c,f[l+0],6,-198630844),c=r(c,o,s,h,f[l+7],10,1126891415),h=r(h,c,o,s,f[l+14],15,-1416354905),s=r(s,h,c,o,f[l+5],21,-57434055),o=r(o,s,h,c,f[l+12],6,1700485571),c=r(c,o,s,h,f[l+3],10,-1894986606),h=r(h,c,o,s,f[l+10],15,-1051523),s=r(s,h,c,o,f[l+1],21,-2054922799),o=r(o,s,h,c,f[l+8],6,1873313359),c=r(c,o,s,h,f[l+15],10,-30611744),h=r(h,c,o,s,f[l+6],15,-1560198380),s=r(s,h,c,o,f[l+13],21,1309151649),o=r(o,s,h,c,f[l+4],6,-145523070),c=r(c,o,s,h,f[l+11],10,-1120210379),h=r(h,c,o,s,f[l+2],15,718787259),s=r(s,h,c,o,f[l+9],21,-343485551),o=u(o,a),s=u(s,v),h=u(h,y),c=u(c,p);return[o,s,h,c]};return{hexdigest:function(n){return c(o(e(n),n.length*8))},hash:function(n){return h(o(e(n),n.length*8))}}}),function(n,t){typeof define=="function"&&define.amd?define("strophe-utils",function(){return t()}):n.stropheUtils=t()}(globalThis,function(){return{utf16to8:function(n){for(var t,i="",u=n.length,r=0;r<u;r++)t=n.charCodeAt(r),t>=0&&t<=127?i+=n.charAt(r):t>2047?(i+=String.fromCharCode(224|t>>12&15),i+=String.fromCharCode(128|t>>6&63),i+=String.fromCharCode(128|t>>0&63)):(i+=String.fromCharCode(192|t>>6&31),i+=String.fromCharCode(128|t>>0&63));return i},addCookies:function(n){var i,t,r,o,u,f,e;for(i in n||{})u="",f="",e="",t=n[i],r=typeof t=="object",o=escape(unescape(r?t.value:t)),r&&(u=t.expires?";expires="+t.expires:"",f=t.domain?";domain="+t.domain:"",e=t.path?";path="+t.path:""),document.cookie=i+"="+o+u+f+e}}}),function(n,t){if(typeof define=="function"&&define.amd)define("strophe-polyfill",[],function(){return t()});else return t()}(globalThis,function(){Function.prototype.bind||(Function.prototype.bind=function(n){var i=this,t=Array.prototype.slice,r=Array.prototype.concat,u=t.call(arguments,1);return function(){return i.apply(n?n:this,r.call(u,t.call(arguments,0)))}});Array.isArray||(Array.isArray=function(n){return Object.prototype.toString.call(n)==="[object Array]"});Array.prototype.indexOf||(Array.prototype.indexOf=function(n){var i=this.length,t=Number(arguments[1])||0;for(t=t<0?Math.ceil(t):Math.floor(t),t<0&&(t+=i);t<i;t++)if(t in this&&this[t]===n)return t;return-1})}),Array.prototype.forEach||(Array.prototype.forEach=function(n,t){var u,i,r,f,e;if(this===null)throw new TypeError(" this is null or not defined");if(r=Object(this),f=r.length>>>0,typeof n!="function")throw new TypeError(n+" is not a function");for(arguments.length>1&&(u=t),i=0;i<f;)i in r&&(e=r[i],n.call(u,e,i,r)),i++}),function(n,t){if(typeof define=="function"&&define.amd)define("strophe-core",["strophe-sha1","strophe-base64","strophe-md5","strophe-utils","strophe-polyfill"],function(){return t.apply(this,arguments)});else{var i=t(n.SHA1,n.Base64,n.MD5,n.stropheUtils);window.Strophe=i.Strophe;window.$build=i.$build;window.$iq=i.$iq;window.$msg=i.$msg;window.$pres=i.$pres;window.SHA1=i.SHA1;window.Base64=i.Base64;window.MD5=i.MD5;window.b64_hmac_sha1=i.SHA1.b64_hmac_sha1;window.b64_sha1=i.SHA1.b64_sha1;window.str_hmac_sha1=i.SHA1.str_hmac_sha1;window.str_sha1=i.SHA1.str_sha1}}(globalThis,function(n,t,i,r){function e(n,t){return new u.Builder(n,t)}function s(n){return new u.Builder("message",n)}function f(n){return new u.Builder("iq",n)}function o(n){return new u.Builder("presence",n)}var u;return u={VERSION:"1.2.9",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(n){for(var t=0;t<u.XHTML.tags.length;t++)if(n==u.XHTML.tags[t])return!0;return!1},validAttribute:function(n,t){if(typeof u.XHTML.attributes[n]!="undefined"&&u.XHTML.attributes[n].length>0)for(var i=0;i<u.XHTML.attributes[n].length;i++)if(t==u.XHTML.attributes[n][i])return!0;return!1},validCSS:function(n){for(var t=0;t<u.XHTML.css.length;t++)if(n==u.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(n,t){u.NS[n]=t},forEachChild:function(n,t,i){for(var f,r=0;r<n.childNodes.length;r++)f=n.childNodes[r],f.nodeType==u.ElementType.NORMAL&&(!t||this.isTagEqual(f,t))&&i(f)},isTagEqual:function(n,t){return n.tagName==t},_xmlGenerator:null,_makeGenerator:function(){var n;return document.implementation.createDocument===undefined||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(n=this._getIEXmlDom(),n.appendChild(n.createElement("strophe"))):n=document.implementation.createDocument("jabber:client","strophe",null),n},xmlGenerator:function(){return u._xmlGenerator||(u._xmlGenerator=u._makeGenerator()),u._xmlGenerator},_getIEXmlDom:function(){for(var n=null,i=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],t=0;t<i.length;t++)if(n===null)try{n=new ActiveXObject(i[t])}catch(r){n=null}else break;return n},xmlElement:function(n){var f,e,o,r,t,i;if(!n)return null;for(f=u.xmlGenerator().createElement(n),e=1;e<arguments.length;e++)if(t=arguments[e],t)if(typeof t=="string"||typeof t=="number")f.appendChild(u.xmlTextNode(t));else if(typeof t=="object"&&typeof t.sort=="function")for(o=0;o<t.length;o++)i=t[o],typeof i=="object"&&typeof i.sort=="function"&&i[1]!==undefined&&i[1]!==null&&f.setAttribute(i[0],i[1]);else if(typeof t=="object")for(r in t)t.hasOwnProperty(r)&&t[r]!==undefined&&t[r]!==null&&f.setAttribute(r,t[r]);return f},xmlescape:function(n){return n=n.replace(/\&/g,"&amp;"),n=n.replace(/</g,"&lt;"),n=n.replace(/>/g,"&gt;"),n=n.replace(/'/g,"&apos;"),n.replace(/"/g,"&quot;")},xmlunescape:function(n){return n=n.replace(/\&amp;/g,"&"),n=n.replace(/&lt;/g,"<"),n=n.replace(/&gt;/g,">"),n=n.replace(/&apos;/g,"'"),n.replace(/&quot;/g,'"')},xmlTextNode:function(n){return u.xmlGenerator().createTextNode(n)},xmlHtmlNode:function(n){var t,i;return window.DOMParser?(i=new DOMParser,t=i.parseFromString(n,"text/xml")):(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(n)),t},getText:function(n){var i,t;if(!n)return null;for(i="",n.childNodes.length===0&&n.nodeType==u.ElementType.TEXT&&(i+=n.nodeValue),t=0;t<n.childNodes.length;t++)n.childNodes[t].nodeType==u.ElementType.TEXT&&(i+=n.childNodes[t].nodeValue);return u.xmlescape(i)},copyElement:function(n){var t,i;if(n.nodeType==u.ElementType.NORMAL){for(i=u.xmlElement(n.tagName),t=0;t<n.attributes.length;t++)i.setAttribute(n.attributes[t].nodeName,n.attributes[t].value);for(t=0;t<n.childNodes.length;t++)i.appendChild(u.copyElement(n.childNodes[t]))}else n.nodeType==u.ElementType.TEXT&&(i=u.xmlGenerator().createTextNode(n.nodeValue));return i},createHtml:function(n){var t,r,o,e,f,i,s,h,c,l,a;if(n.nodeType==u.ElementType.NORMAL)if(e=n.nodeName.toLowerCase(),u.XHTML.validTag(e))try{for(r=u.xmlElement(e),t=0;t<u.XHTML.attributes[e].length;t++)if(f=u.XHTML.attributes[e][t],i=n.getAttribute(f),typeof i!="undefined"&&i!==null&&i!==""&&i!==!1&&i!==0)if(f=="style"&&typeof i=="object"&&typeof i.cssText!="undefined"&&(i=i.cssText),f=="style"){for(s=[],h=i.split(";"),o=0;o<h.length;o++)c=h[o].split(":"),l=c[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),u.XHTML.validCSS(l)&&(a=c[1].replace(/^\s*/,"").replace(/\s*$/,""),s.push(l+": "+a));s.length>0&&(i=s.join("; "),r.setAttribute(f,i))}else r.setAttribute(f,i);for(t=0;t<n.childNodes.length;t++)r.appendChild(u.createHtml(n.childNodes[t]))}catch(v){r=u.xmlTextNode("")}else for(r=u.xmlGenerator().createDocumentFragment(),t=0;t<n.childNodes.length;t++)r.appendChild(u.createHtml(n.childNodes[t]));else if(n.nodeType==u.ElementType.FRAGMENT)for(r=u.xmlGenerator().createDocumentFragment(),t=0;t<n.childNodes.length;t++)r.appendChild(u.createHtml(n.childNodes[t]));else n.nodeType==u.ElementType.TEXT&&(r=u.xmlTextNode(n.nodeValue));return r},escapeNode:function(n){return typeof n!="string"?n:n.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(n){return typeof n!="string"?n:n.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(n){return n.indexOf("@")<0?null:n.split("@")[0]},getDomainFromJid:function(n){var t=u.getBareJidFromJid(n),i;return t.indexOf("@")<0?t:(i=t.split("@"),i.splice(0,1),i.join("@"))},getResourceFromJid:function(n){var t=n.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(n){return n?n.split("/")[0]:null},_handleError:function(n){typeof n.stack!="undefined"&&u.fatal(n.stack);n.sourceURL?u.fatal("error: "+this.handler+" "+n.sourceURL+":"+n.line+" - "+n.name+": "+n.message):n.fileName?u.fatal("error: "+this.handler+" "+n.fileName+":"+n.lineNumber+" - "+n.name+": "+n.message):u.fatal("error: "+n.message)},log:function(){return},debug:function(n){this.log(this.LogLevel.DEBUG,n)},info:function(n){this.log(this.LogLevel.INFO,n)},warn:function(n){this.log(this.LogLevel.WARN,n)},error:function(n){this.log(this.LogLevel.ERROR,n)},fatal:function(n){this.log(this.LogLevel.FATAL,n)},serialize:function(n){var i,f,t,r;if(!n)return null;for(typeof n.tree=="function"&&(n=n.tree()),f=n.nodeName,n.getAttribute("_realname")&&(f=n.getAttribute("_realname")),i="<"+f,t=0;t<n.attributes.length;t++)n.attributes[t].nodeName!="_realname"&&(i+=" "+n.attributes[t].nodeName+"='"+u.xmlescape(n.attributes[t].value)+"'");if(n.childNodes.length>0){for(i+=">",t=0;t<n.childNodes.length;t++){r=n.childNodes[t];switch(r.nodeType){case u.ElementType.NORMAL:i+=u.serialize(r);break;case u.ElementType.TEXT:i+=u.xmlescape(r.nodeValue);break;case u.ElementType.CDATA:i+="<![CDATA["+r.nodeValue+"]\]>"}}i+="<\/"+f+">"}else i+="/>";return i},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(n,t){u._connectionPlugins[n]=t}},u.Builder=function(n,t){(n=="presence"||n=="message"||n=="iq")&&(t&&!t.xmlns?t.xmlns=u.NS.CLIENT:t||(t={xmlns:u.NS.CLIENT}));this.nodeTree=u.xmlElement(n,t);this.node=this.nodeTree},u.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return u.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(n){for(var t in n)n.hasOwnProperty(t)&&(n[t]===undefined?this.node.removeAttribute(t):this.node.setAttribute(t,n[t]));return this},c:function(n,t,i){var r=u.xmlElement(n,t,i);return this.node.appendChild(r),typeof i!="string"&&typeof i!="number"&&(this.node=r),this},cnode:function(n){var t,r=u.xmlGenerator(),i;try{t=r.importNode!==undefined}catch(f){t=!1}return i=t?r.importNode(n,!0):u.copyElement(n),this.node.appendChild(i),this.node=i,this},t:function(n){var t=u.xmlTextNode(n);return this.node.appendChild(t),this},h:function(n){var i=document.createElement("body"),t;for(i.innerHTML=n,t=u.createHtml(i);t.childNodes.length>0;)this.node.appendChild(t.childNodes[0]);return this}},u.Handler=function(n,t,i,r,f,e,o){this.handler=n;this.ns=t;this.name=i;this.type=r;this.id=f;this.options=o||{matchBareFromJid:!1,ignoreNamespaceFragment:!1};this.options.matchBare&&(u.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare);this.from=this.options.matchBareFromJid?e?u.getBareJidFromJid(e):null:e;this.user=!0},u.Handler.prototype={getNamespace:function(n){var t=n.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t},namespaceMatch:function(n){var t=!1,i;if(this.ns)i=this,u.forEachChild(n,null,function(n){i.getNamespace(n)===i.ns&&(t=!0)}),t=t||this.getNamespace(n)===this.ns;else return!0;return t},isMatch:function(n){var t=n.getAttribute("from"),i;return(this.options.matchBareFromJid&&(t=u.getBareJidFromJid(t)),i=n.getAttribute("type"),this.namespaceMatch(n)&&(!this.name||u.isTagEqual(n,this.name))&&(!this.type||(Array.isArray(this.type)?this.type.indexOf(i)!=-1:i==this.type))&&(!this.id||n.getAttribute("id")==this.id)&&(!this.from||t==this.from))?!0:!1},run:function(n){var t=null;try{t=this.handler(n)}catch(i){u._handleError(i);throw i;}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},u.TimedHandler=function(n,t){this.period=n;this.handler=t;this.lastCalled=(new Date).getTime();this.user=!0},u.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},u.Connection=function(n,t){var e,i,o,f;this.service=n;this.options=t||{};e=this.options.protocol||"";this._proto=n.indexOf("ws:")===0||n.indexOf("wss:")===0||e.indexOf("ws")===0?new u.Websocket(this):new u.Bosh(this);this._timeProvider=u.timeProvider||window;this.jid="";this.domain=null;this.features=null;this._sasl_data={};this.do_session=!1;this.do_bind=!1;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this.protocolErrorHandlers={HTTP:{},websocket:{}};this._idleTimeout=null;this._disconnectTimeout=null;this.authenticated=!1;this.connected=!1;this.disconnecting=!1;this.do_authentication=!0;this.paused=!1;this.restored=!1;this._data=[];this._uniqueId=0;this._sasl_success_handler=null;this._sasl_failure_handler=null;this._sasl_challenge_handler=null;this.maxRetries=5;this._idleTimeout=this._timeProvider.setTimeout(function(){this._onIdle()}.bind(this),100);r.addCookies(this.options.cookies);this.registerSASLMechanisms(this.options.mechanisms);for(i in u._connectionPlugins)u._connectionPlugins.hasOwnProperty(i)&&(o=u._connectionPlugins[i],f=function(){},f.prototype=o,this[i]=new f,this[i].init(this))},u.Connection.prototype={reset:function(){this.jid&&(this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0)},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(n){var t=u.getNodeFromJid(this.jid),i=(Math.floor(Math.random()*4026531840)+268435456).toString(16);return typeof n=="string"||typeof n=="number"?++this._uniqueId+":"+t+"-"+i+":"+n:++this._uniqueId+":"+t+"-"+i},addProtocolErrorHandler:function(n,t,i){this.protocolErrorHandlers[n][t]=i},connect:function(n,t,i,r,f,e,o){this.jid=n;this.authzid=u.getBareJidFromJid(this.jid);this.authcid=o||u.getNodeFromJid(this.jid);this.pass=t;this.servtype="xmpp";this.connect_callback=i;this.disconnecting=!1;this.connected=!1;this.authenticated=!1;this.restored=!1;this.domain=u.getDomainFromJid(this.jid);this._changeConnectStatus(u.Status.CONNECTING,null);this._proto._connect(r,f,e)},attach:function(n,t,i,r,f,e,o){if(this._proto instanceof u.Bosh)this._proto._attach(n,t,i,r,f,e,o);else throw{name:"StropheSessionError",message:'The "attach" method can only be used with a BOSH connection.'};},isRestoreSupported:function(){return this._sessionCachingSupported()},isRestorable:function(n,t){if(this._sessionCachingSupported()){var i=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(this._proto._isRestorable(i,n))return typeof t==typeof undefined?!0:typeof i.cts!=typeof undefined&&Date.now()-Number(i.cts)<t*1e3}return!1},restore:function(n,t,i,r,u){if(this._sessionCachingSupported())return this._proto._restore(n,t,i,r,u);throw{name:"StropheSessionError",message:'The "restore" method can only be used with a BOSH connection.'};},_sessionCachingSupported:function(){if(this._proto instanceof u.Bosh){if(!JSON)return!1;try{window.sessionStorage.setItem("_strophe_","_strophe_");window.sessionStorage.removeItem("_strophe_")}catch(n){return!1}return!0}return!1},xmlInput:function(){return},xmlOutput:function(){return},rawInput:function(){return},rawOutput:function(){return},nextValidRid:function(){return},send:function(n){if(n!==null){if(typeof n.sort=="function")for(var t=0;t<n.length;t++)this._queueData(n[t]);else typeof n.tree=="function"?this._queueData(n.tree()):this._queueData(n);this._proto._send()}},flush:function(){this._timeProvider.clearTimeout(this._idleTimeout);this._onIdle()},sendIQ:function(n,t,i,r){var e=null,h=this,f;typeof n.tree=="function"&&(n=n.tree());f=n.getAttribute("id");f||(f=this.getUniqueId("sendIQ"),n.setAttribute("id",f));var o=n.getAttribute("to"),s=this.jid,c=this.addHandler(function(n){var c,r,f;if(e&&h.deleteTimedHandler(e),c=!1,r=n.getAttribute("from"),r!==o&&(o||r!==u.getBareJidFromJid(s)&&r!==u.getDomainFromJid(s)&&r!==s)||(c=!0),!c)throw{name:"StropheError",message:"Got answer to IQ from wrong jid:"+r+"\nExpected jid: "+o};if(f=n.getAttribute("type"),f=="result")t&&t(n);else if(f=="error")i&&i(n);else throw{name:"StropheError",message:"Got bad IQ type of "+f};},null,"iq",["error","result"],f);return r&&(e=this.addTimedHandler(r,function(){return h.deleteHandler(c),i&&i(null),!1})),this.send(n),f},_queueData:function(n){if(n===null||!n.tagName||!n.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(n)},_sendRestart:function(){this._data.push("restart");this._proto._sendRestart();this._idleTimeout=this._timeProvider.setTimeout(function(){this._onIdle()}.bind(this),100)},addTimedHandler:function(n,t){var i=new u.TimedHandler(n,t);return this.addTimeds.push(i),i},deleteTimedHandler:function(n){this.removeTimeds.push(n)},addHandler:function(n,t,i,r,f,e,o){var s=new u.Handler(n,t,i,r,f,e,o);return this.addHandlers.push(s),s},deleteHandler:function(n){this.removeHandlers.push(n);var t=this.addHandlers.indexOf(n);t>=0&&this.addHandlers.splice(t,1)},registerSASLMechanisms:function(n){this.mechanisms={};n=n||[u.SASLAnonymous,u.SASLExternal,u.SASLMD5,u.SASLOAuthBearer,u.SASLPlain,u.SASLSHA1];n.forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(n){this.mechanisms[n.prototype.name]=n},disconnect:function(n){if(this._changeConnectStatus(u.Status.DISCONNECTING,n),u.info("Disconnect was called because: "+n),this.connected){var t=!1;this.disconnecting=!0;this.authenticated&&(t=o({xmlns:u.NS.CLIENT,type:"unavailable"}));this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this));this._proto._disconnect(t)}else u.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests()},_changeConnectStatus:function(n,t){var i,r;for(i in u._connectionPlugins)if(u._connectionPlugins.hasOwnProperty(i)&&(r=this[i],r.statusChanged))try{r.statusChanged(n,t)}catch(e){u.error(""+i+" plugin caused an exception changing status: "+e)}if(this.connect_callback)try{this.connect_callback(n,t)}catch(f){u._handleError(f);u.error("User connection callback caused an exception: "+f)}},_doDisconnect:function(n){typeof this._idleTimeout=="number"&&this._timeProvider.clearTimeout(this._idleTimeout);this._disconnectTimeout!==null&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null);u.debug("_doDisconnect was called");this._proto._doDisconnect();this.authenticated=!1;this.disconnecting=!1;this.restored=!1;this.handlers=[];this.timedHandlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this._changeConnectStatus(u.Status.DISCONNECTED,n);this.connected=!1},_dataRecv:function(n,t){var i=this._proto._reqToData(n),e,s,o,r,h,f;if(i!==null){for(this.xmlInput!==u.Connection.prototype.xmlInput&&(i.nodeName===this._proto.strip&&i.childNodes.length?this.xmlInput(i.childNodes[0]):this.xmlInput(i)),this.rawInput!==u.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(u.serialize(i)));this.removeHandlers.length>0;)s=this.removeHandlers.pop(),e=this.handlers.indexOf(s),e>=0&&this.handlers.splice(e,1);while(this.addHandlers.length>0)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue()){this._doDisconnect();return}if(o=i.getAttribute("type"),o!==null&&o=="terminate"){if(this.disconnecting)return;r=i.getAttribute("condition");h=i.getElementsByTagName("conflict");r!==null?(r=="remote-stream-error"&&h.length>0&&(r="conflict"),this._changeConnectStatus(u.Status.CONNFAIL,r)):this._changeConnectStatus(u.Status.CONNFAIL,"unknown");this._doDisconnect(r);return}f=this;u.forEachChild(i,null,function(n){var i,r,t;for(r=f.handlers,f.handlers=[],i=0;i<r.length;i++){t=r[i];try{t.isMatch(n)&&(f.authenticated||!t.user)?t.run(n)&&f.handlers.push(t):f.handlers.push(t)}catch(e){u.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}}})}},mechanisms:{},_connect_cb:function(n,t,i){var r,c,l,f,e,s,o;u.debug("_connect_cb was called");this.connected=!0;try{r=this._proto._reqToData(n)}catch(h){if(h!="badformat")throw h;this._changeConnectStatus(u.Status.CONNFAIL,"bad-format");this._doDisconnect("bad-format")}if(r&&(this.xmlInput!==u.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==u.Connection.prototype.rawInput&&(i?this.rawInput(i):this.rawInput(u.serialize(r))),c=this._proto._connect_cb(r),c!==u.Status.CONNFAIL)){if(l=r.getElementsByTagNameNS?r.getElementsByTagNameNS(u.NS.STREAM,"features").length>0:r.getElementsByTagName("stream:features").length>0||r.getElementsByTagName("features").length>0,!l){this._proto._no_auth_received(t);return}if(f=[],o=r.getElementsByTagName("mechanism"),o.length>0)for(e=0;e<o.length;e++)s=u.getText(o[e]),this.mechanisms[s]&&f.push(this.mechanisms[s]);if(f.length===0&&r.getElementsByTagName("auth").length===0){this._proto._no_auth_received(t);return}this.do_authentication!==!1&&this.authenticate(f)}},sortMechanismsByPriority:function(n){for(var r,i,u,t=0;t<n.length-1;++t){for(i=t,r=t+1;r<n.length;++r)n[r].prototype.priority>n[i].prototype.priority&&(i=r);i!=t&&(u=n[t],n[t]=n[i],n[i]=u)}return n},_attemptSASLAuth:function(n){var i,r,f,o;for(n=this.sortMechanismsByPriority(n||[]),i=0,r=!1,i=0;i<n.length;++i)if(n[i].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null);this._sasl_mechanism=new n[i];this._sasl_mechanism.onStart(this);f=e("auth",{xmlns:u.NS.SASL,mechanism:this._sasl_mechanism.name});this._sasl_mechanism.isClientFirst&&(o=this._sasl_mechanism.onChallenge(this,null),f.t(t.encode(o)));this.send(f.tree());r=!0;break}return r},_attemptLegacyAuth:function(){u.getNodeFromJid(this.jid)===null?(this._changeConnectStatus(u.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(u.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(f({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:u.NS.AUTH}).c("username",{}).t(u.getNodeFromJid(this.jid)).tree()))},authenticate:function(n){this._attemptSASLAuth(n)||this._attemptLegacyAuth()},_sasl_challenge_cb:function(n){var f=t.decode(u.getText(n)),i=this._sasl_mechanism.onChallenge(this,f),r=e("response",{xmlns:u.NS.SASL});return i!==""&&r.t(t.encode(i)),this.send(r.tree()),!0},_auth1_cb:function(){var n=f({type:"set",id:"_auth_2"}).c("query",{xmlns:u.NS.AUTH}).c("username",{}).t(u.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return u.getResourceFromJid(this.jid)||(this.jid=u.getBareJidFromJid(this.jid)+"/strophe"),n.up().c("resource",{}).t(u.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(n.tree()),!1},_sasl_success_cb:function(n){var i,r;if(this._sasl_data["server-signature"]){var f,o=t.decode(u.getText(n)),e=o.match(/([a-z]+)=([^,]+)(,|$)/);if(e[1]=="v"&&(f=e[2]),f!=this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}return u.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),i=[],r=function(n,t){while(n.length)this.deleteHandler(n.pop());return this._sasl_auth1_cb.bind(this)(t),!1},i.push(this._addSysHandler(function(n){r.bind(this)(i,n)}.bind(this),null,"stream:features",null,null)),i.push(this._addSysHandler(function(n){r.bind(this)(i,n)}.bind(this),u.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(n){var t,i,r;for(this.features=n,t=0;t<n.childNodes.length;t++)i=n.childNodes[t],i.nodeName=="bind"&&(this.do_bind=!0),i.nodeName=="session"&&(this.do_session=!0);if(this.do_bind)this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2"),r=u.getResourceFromJid(this.jid),r?this.send(f({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:u.NS.BIND}).c("resource",{}).t(r).tree()):this.send(f({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:u.NS.BIND}).tree());else return this._changeConnectStatus(u.Status.AUTHFAIL,null),!1;return!1},_sasl_bind_cb:function(n){var r,e,t,i;if(n.getAttribute("type")=="error")return u.info("SASL binding failed."),r=n.getElementsByTagName("conflict"),r.length>0&&(e="conflict"),this._changeConnectStatus(u.Status.AUTHFAIL,e),!1;if(t=n.getElementsByTagName("bind"),t.length>0)i=t[0].getElementsByTagName("jid"),i.length>0&&(this.jid=u.getText(i[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(f({type:"set",id:"_session_auth_2"}).c("session",{xmlns:u.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(u.Status.CONNECTED,null)));else return u.info("SASL binding failed."),this._changeConnectStatus(u.Status.AUTHFAIL,null),!1},_sasl_session_cb:function(n){if(n.getAttribute("type")=="result")this.authenticated=!0,this._changeConnectStatus(u.Status.CONNECTED,null);else if(n.getAttribute("type")=="error")return u.info("Session creation failed."),this._changeConnectStatus(u.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(u.Status.AUTHFAIL,null),!1},_auth2_cb:function(n){return n.getAttribute("type")=="result"?(this.authenticated=!0,this._changeConnectStatus(u.Status.CONNECTED,null)):n.getAttribute("type")=="error"&&(this._changeConnectStatus(u.Status.AUTHFAIL,null),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(n,t){var i=new u.TimedHandler(n,t);return i.user=!1,this.addTimeds.push(i),i},_addSysHandler:function(n,t,i,r,f){var e=new u.Handler(n,t,i,r,f);return e.user=!1,this.addHandlers.push(e),e},_onDisconnectTimeout:function(){return u.info("_onDisconnectTimeout was called"),this._changeConnectStatus(u.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var t,n,r,i,u;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());while(this.removeTimeds.length>0)n=this.removeTimeds.pop(),t=this.timedHandlers.indexOf(n),t>=0&&this.timedHandlers.splice(t,1);for(u=(new Date).getTime(),i=[],t=0;t<this.timedHandlers.length;t++)n=this.timedHandlers[t],(this.authenticated||!n.user)&&(r=n.lastCalled+n.period,r-u<=0?n.run()&&i.push(n):i.push(n));this.timedHandlers=i;this._timeProvider.clearTimeout(this._idleTimeout);this._proto._onIdle();this.connected&&(this._idleTimeout=this._timeProvider.setTimeout(function(){this._onIdle()}.bind(this),100))}},u.SASLMechanism=function(n,t,i){this.name=n;this.isClientFirst=t;this.priority=i},u.SASLMechanism.prototype={test:function(){return!0},onStart:function(n){this._connection=n},onChallenge:function(){throw new Error("You should implement challenge handling!");},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},u.SASLAnonymous=function(){},u.SASLAnonymous.prototype=new u.SASLMechanism("ANONYMOUS",!1,10),u.SASLAnonymous.prototype.test=function(n){return n.authcid===null},u.SASLPlain=function(){},u.SASLPlain.prototype=new u.SASLMechanism("PLAIN",!0,20),u.SASLPlain.prototype.test=function(n){return n.authcid!==null},u.SASLPlain.prototype.onChallenge=function(n){var t=n.authzid;return t=t+"\x00",t=t+n.authcid,t=t+"\x00",t=t+n.pass,r.utf16to8(t)},u.SASLSHA1=function(){},u.SASLSHA1.prototype=new u.SASLMechanism("SCRAM-SHA-1",!0,40),u.SASLSHA1.prototype.test=function(n){return n.authcid!==null},u.SASLSHA1.prototype.onChallenge=function(u,f,e){var s=e||i.hexdigest(Math.random()*1234567890),o="n="+r.utf16to8(u.authcid);return o+=",r=",o+=s,u._sasl_data.cnonce=s,u._sasl_data["client-first-message-bare"]=o,o="n,,"+o,this.onChallenge=function(i,u){for(var c,s,b,e,l,a,v,f,y,h,k,d,p="c=biws,",w=i._sasl_data["client-first-message-bare"]+","+u+",",g=i._sasl_data.cnonce,nt=/([a-z]+)=([^,]+)(,|$)/,o;u.match(nt);){o=u.match(nt);u=u.replace(o[0],"");switch(o[1]){case"r":c=o[2];break;case"s":s=o[2];break;case"i":b=o[2]}}if(c.substr(0,g.length)!==g)return i._sasl_data={},i._sasl_failure_cb();for(p+="r="+c,w+=p,s=t.decode(s),s+="\x00\x00\x00\x01",y=r.utf16to8(i.pass),e=a=n.core_hmac_sha1(y,s),v=1;v<b;v++){for(l=n.core_hmac_sha1(y,n.binb2str(a)),f=0;f<5;f++)e[f]^=l[f];a=l}for(e=n.binb2str(e),h=n.core_hmac_sha1(e,"Client Key"),k=n.str_hmac_sha1(e,"Server Key"),d=n.core_hmac_sha1(n.str_sha1(n.binb2str(h)),w),i._sasl_data["server-signature"]=n.b64_hmac_sha1(k,w),f=0;f<5;f++)h[f]^=d[f];return p+(",p="+t.encode(n.binb2str(h)))}.bind(this),o},u.SASLMD5=function(){},u.SASLMD5.prototype=new u.SASLMechanism("DIGEST-MD5",!1,30),u.SASLMD5.prototype.test=function(n){return n.authcid!==null},u.SASLMD5.prototype._quote=function(n){return'"'+n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},u.SASLMD5.prototype.onChallenge=function(n,t,u){for(var a=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,h=u||i.hexdigest(""+Math.random()*1234567890),c="",l=null,s="",v="",e,o;t.match(a);){e=t.match(a);t=t.replace(e[0],"");e[2]=e[2].replace(/^"(.+)"$/,"$1");switch(e[1]){case"realm":c=e[2];break;case"nonce":s=e[2];break;case"qop":v=e[2];break;case"host":l=e[2]}}o=n.servtype+"/"+n.domain;l!==null&&(o=o+"/"+l);var y=r.utf16to8(n.authcid+":"+c+":"+this._connection.pass),p=i.hash(y)+":"+s+":"+h,w="AUTHENTICATE:"+o,f="";return f+="charset=utf-8,",f+="username="+this._quote(r.utf16to8(n.authcid))+",",f+="realm="+this._quote(c)+",",f+="nonce="+this._quote(s)+",",f+="nc=00000001,",f+="cnonce="+this._quote(h)+",",f+="digest-uri="+this._quote(o)+",",f+="response="+i.hexdigest(i.hexdigest(p)+":"+s+":00000001:"+h+":auth:"+i.hexdigest(w))+",",f+="qop=auth",this.onChallenge=function(){return""},f},u.SASLOAuthBearer=function(){},u.SASLOAuthBearer.prototype=new u.SASLMechanism("OAUTHBEARER",!0,50),u.SASLOAuthBearer.prototype.test=function(n){return n.authcid!==null},u.SASLOAuthBearer.prototype.onChallenge=function(n){var t="n,a=";return t=t+n.authzid,t=t+",",t=t+"\x01",t=t+"auth=Bearer ",t=t+n.pass,t=t+"\x01",t=t+"\x01",r.utf16to8(t)},u.SASLExternal=function(){},u.SASLExternal.prototype=new u.SASLMechanism("EXTERNAL",!0,60),u.SASLExternal.prototype.onChallenge=function(n){return n.authcid===n.authzid?"":n.authzid},{Strophe:u,$build:e,$msg:s,$iq:f,$pres:o,SHA1:n,Base64:t,MD5:i}}),function(n,t){if(typeof define=="function"&&define.amd)define("strophe-bosh",["strophe-core"],function(n){return t(n.Strophe,n.$build)});else return t(Strophe,$build)}(globalThis,function(n,t){return n.Request=function(t,i,r,u){this.id=++n._requestId;this.xmlData=t;this.data=n.serialize(t);this.origFunc=i;this.func=i;this.rid=r;this.date=NaN;this.sends=u||0;this.abort=!1;this.dead=null;this.age=function(){if(!this.date)return 0;var n=new Date;return(n-this.date)/1e3};this.timeDead=function(){if(!this.dead)return 0;var n=new Date;return(n-this.dead)/1e3};this.xhr=this._newXHR()},n.Request.prototype={getResponse:function(){var t=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(t=this.xhr.responseXML.documentElement,t.tagName=="parsererror"){n.error("invalid response received");n.error("responseText: "+this.xhr.responseText);n.error("responseXML: "+n.serialize(this.xhr.responseXML));throw"parsererror";}}else if(this.xhr.responseText){n.error("invalid response received");n.error("responseText: "+this.xhr.responseText);throw"badformat";}return t},_newXHR:function(){var n=null;return window.XMLHttpRequest?(n=new XMLHttpRequest,n.overrideMimeType&&n.overrideMimeType("text/xml; charset=utf-8")):window.ActiveXObject&&(n=new ActiveXObject("Microsoft.XMLHTTP")),n.onreadystatechange=this.func.bind(null,this),n}},n.Bosh=function(n){this._conn=n;this.rid=Math.floor(Math.random()*4294967295);this.sid=null;this.hold=1;this.wait=60;this.window=5;this.errors=0;this._requests=[]},n.Bosh.prototype={strip:null,_buildBody:function(){var i=t("body",{rid:this.rid++,xmlns:n.NS.HTTPBIND});return this.sid!==null&&i.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),i},_reset:function(){this.rid=Math.floor(Math.random()*4294967295);this.sid=null;this.errors=0;this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session");this._conn.nextValidRid(this.rid)},_connect:function(t,i,r){var u,f;this.wait=t||this.wait;this.hold=i||this.hold;this.errors=0;u=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":n.NS.BOSH});r&&u.attrs({route:r});f=this._conn._connect_cb;this._requests.push(new n.Request(u.tree(),this._onRequestStateChange.bind(this,f.bind(this._conn)),u.tree().getAttribute("rid")));this._throttledRequestHandler()},_attach:function(t,i,r,u,f,e,o){this._conn.jid=t;this.sid=i;this.rid=r;this._conn.connect_callback=u;this._conn.domain=n.getDomainFromJid(this._conn.jid);this._conn.authenticated=!0;this._conn.connected=!0;this.wait=f||this.wait;this.hold=e||this.hold;this.window=o||this.window;this._conn._changeConnectStatus(n.Status.ATTACHED,null)},_isRestorable:function(t,i){return typeof t!="undefined"&&t!==null&&t.rid&&t.sid&&t.jid&&(typeof i=="undefined"||i===null||n.getBareJidFromJid(t.jid)===n.getBareJidFromJid(i))},_restore:function(n,t,i,r,u){var f=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(this._isRestorable(f,n))return this._conn.restored=!0,this._attach(f.jid,f.sid,f.rid,t,i,r,u),f;throw{name:"StropheSessionError",message:"_restore: no restorable session."};},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid,cts:Date.now()})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(t){var e=t.getAttribute("type"),i,o,r,u,f;if(e!==null&&e=="terminate")return i=t.getAttribute("condition"),n.error("BOSH-Connection failed: "+i),o=t.getElementsByTagName("conflict"),i!==null?(i=="remote-stream-error"&&o.length>0&&(i="conflict"),this._conn._changeConnectStatus(n.Status.CONNFAIL,i)):this._conn._changeConnectStatus(n.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(i),n.Status.CONNFAIL;this.sid||(this.sid=t.getAttribute("sid"));r=t.getAttribute("requests");r&&(this.window=parseInt(r,10));u=t.getAttribute("hold");u&&(this.hold=parseInt(u,10));f=t.getAttribute("wait");f&&(this.wait=parseInt(f,10))},_disconnect:function(n){this._sendTerminate(n)},_doDisconnect:function(){this.sid=null;this.rid=Math.floor(Math.random()*4294967295);this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session");this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return this._requests.length===0},_callProtocolErrorHandlers:function(n){var i=this._getRequestStatus(n),t;t=this._conn.protocolErrorHandlers.HTTP[i];t&&t.call(this,i)},_hitError:function(t){this.errors++;n.warn("request errored, status: "+t+", number of errors: "+this.errors);this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(t){t=t?t.bind(this._conn):this._conn._connect_cb.bind(this._conn);var i=this._buildBody();this._requests.push(new n.Request(i.tree(),this._onRequestStateChange.bind(this,t.bind(this._conn)),i.tree().getAttribute("rid")));this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(var n;this._requests.length>0;)n=this._requests.pop(),n.abort=!0,n.xhr.abort(),n.xhr.onreadystatechange=function(){}},_onIdle:function(){var t=this._conn._data,r,i,u;if(this._conn.authenticated&&this._requests.length===0&&t.length===0&&!this._conn.disconnecting&&(n.debug("no requests during idle cycle, sending blank request"),t.push(null)),!this._conn.paused){if(this._requests.length<2&&t.length>0){for(r=this._buildBody(),i=0;i<t.length;i++)t[i]!==null&&(t[i]==="restart"?r.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":n.NS.BOSH}):r.cnode(t[i]).up());delete this._conn._data;this._conn._data=[];this._requests.push(new n.Request(r.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),r.tree().getAttribute("rid")));this._throttledRequestHandler()}this._requests.length>0&&(u=this._requests[0].age(),this._requests[0].dead!==null&&this._requests[0].timeDead()>Math.floor(n.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),u>Math.floor(n.TIMEOUT*this.wait)&&(n.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(n.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler()))}},_getRequestStatus:function(t,i){var r;if(t.xhr.readyState==4)try{r=t.xhr.status}catch(u){n.error("Caught an error while retrieving a request's status, reqStatus: "+r)}return typeof r=="undefined"&&(r=typeof i=="number"?i:0),r},_onRequestStateChange:function(t,i){var r,u,f;if(n.debug("request id "+i.id+"."+i.sends+" state changed to "+i.xhr.readyState),i.abort){i.abort=!1;return}if(i.xhr.readyState===4){if(r=this._getRequestStatus(i),this.disconnecting&&r>=400){this._hitError(r);this._callProtocolErrorHandlers(i);return}(r>0&&r<500||i.sends>5)&&(this._removeRequest(i),n.debug("request id "+i.id+" should now be removed"));r==200?(u=this._requests[0]==i,f=this._requests[1]==i,(f||u&&this._requests.length>0&&this._requests[0].age()>Math.floor(n.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(i.rid)+1),n.debug("request id "+i.id+"."+i.sends+" got 200"),t(i),this.errors=0):r===0||r>=400&&r<600||r>=12e3?(n.error("request id "+i.id+"."+i.sends+" error "+r+" happened"),this._hitError(r),this._callProtocolErrorHandlers(i),r>=400&&r<500&&(this._conn._changeConnectStatus(n.Status.DISCONNECTING,null),this._conn._doDisconnect())):n.error("request id "+i.id+"."+i.sends+" error "+r+" happened");(!(r>0&&r<500)||i.sends>5)&&this._throttledRequestHandler()}},_processRequest:function(t){var u=this,i=this._requests[t],f=this._getRequestStatus(i,-1),s,r,h;if(i.sends>this._conn.maxRetries){this._conn._onDisconnectTimeout();return}var e=i.age(),c=!isNaN(e)&&e>Math.floor(n.TIMEOUT*this.wait),o=i.dead!==null&&i.timeDead()>Math.floor(n.SECONDARY_TIMEOUT*this.wait),l=i.xhr.readyState==4&&(f<1||f>=500);if((c||o||l)&&(o&&n.error("Request "+this._requests[t].id+" timed out (secondary), restarting"),i.abort=!0,i.xhr.abort(),i.xhr.onreadystatechange=function(){},this._requests[t]=new n.Request(i.xmlData,i.origFunc,i.rid,i.sends),i=this._requests[t]),i.xhr.readyState===0){n.debug("request id "+i.id+"."+i.sends+" posting");try{s=this._conn.options.contentType||"text/xml; charset=utf-8";i.xhr.open("POST",this._conn.service,this._conn.options.sync?!1:!0);typeof i.xhr.setRequestHeader!="undefined"&&i.xhr.setRequestHeader("Content-Type",s);this._conn.options.withCredentials&&(i.xhr.withCredentials=!0)}catch(a){n.error("XHR open failed.");this._conn.connected||this._conn._changeConnectStatus(n.Status.CONNFAIL,"bad-service");this._conn.disconnect();return}r=function(){var n,t;if(i.date=new Date,u._conn.options.customHeaders){n=u._conn.options.customHeaders;for(t in n)n.hasOwnProperty(t)&&i.xhr.setRequestHeader(t,n[t])}i.xhr.send(i.data)};i.sends>1?(h=Math.min(Math.floor(n.TIMEOUT*this.wait),Math.pow(i.sends,3))*1e3,this._conn._timeProvider.setTimeout(function(){r()},h)):r();i.sends++;this._conn.xmlOutput!==n.Connection.prototype.xmlOutput&&(i.xmlData.nodeName===this.strip&&i.xmlData.childNodes.length?this._conn.xmlOutput(i.xmlData.childNodes[0]):this._conn.xmlOutput(i.xmlData));this._conn.rawOutput!==n.Connection.prototype.rawOutput&&this._conn.rawOutput(i.data)}else n.debug("_processRequest: "+(t===0?"first":"second")+" request has readyState of "+i.xhr.readyState)},_removeRequest:function(t){n.debug("removing request");for(var i=this._requests.length-1;i>=0;i--)t==this._requests[i]&&this._requests.splice(i,1);t.xhr.onreadystatechange=function(){};this._throttledRequestHandler()},_restartRequest:function(n){var t=this._requests[n];t.dead===null&&(t.dead=new Date);this._processRequest(n)},_reqToData:function(n){try{return n.getResponse()}catch(t){if(t!="parsererror")throw t;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(t){var i,r;n.debug("_sendTerminate was called");i=this._buildBody().attrs({type:"terminate"});t&&i.cnode(t.tree());r=new n.Request(i.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),i.tree().getAttribute("rid"));this._requests.push(r);this._throttledRequestHandler()},_send:function(){this._conn._timeProvider.clearTimeout(this._conn._idleTimeout);this._throttledRequestHandler();this._conn._idleTimeout=this._conn._timeProvider.setTimeout(function(){this._onIdle()}.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler();this._conn._timeProvider.clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){(this._requests?n.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):n.debug("_throttledRequestHandler called with undefined requests"),this._requests&&this._requests.length!==0)&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},n}),function(n,t){if(typeof define=="function"&&define.amd)define("strophe-websocket",["strophe-core"],function(n){return t(n.Strophe,n.$build)});else return t(Strophe,$build)}(globalThis,function(n,t){return n.Websocket=function(n){var t,i;this._conn=n;this.strip="wrapper";t=n.service;t.indexOf("ws:")!==0&&t.indexOf("wss:")!==0&&(i="",i+=n.options.protocol==="ws"&&window.location.protocol!=="https:"?"ws":"wss",i+="://"+window.location.host,i+=t.indexOf("/")!==0?window.location.pathname+t:t,n.service=i)},n.Websocket.prototype={_buildStream:function(){return t("open",{xmlns:n.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(t,i){var o,f,u,e;if(o=t.getElementsByTagNameNS?t.getElementsByTagNameNS(n.NS.STREAM,"error"):t.getElementsByTagName("stream:error"),o.length===0)return!1;var s=o[0],r="",h="";for(f=0;f<s.childNodes.length;f++){if(u=s.childNodes[f],u.getAttribute("xmlns")!=="urn:ietf:params:xml:ns:xmpp-streams")break;u.nodeName==="text"?h=u.textContent:r=u.nodeName}return e="WebSocket stream error: ",e+=r?r:"unknown",h&&(e+=" - "+r),n.error(e),this._conn._changeConnectStatus(i,r),this._conn._doDisconnect(),!0},_reset:function(){return},_connect:function(){this._closeSocket();this.socket=new WebSocket(this._conn.service,"xmpp");this.socket.onopen=this._onOpen.bind(this);this.socket.onerror=this._onError.bind(this);this.socket.onclose=this._onClose.bind(this);this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(t){var i=this._check_streamerror(t,n.Status.CONNFAIL);if(i)return n.Status.CONNFAIL},_handleStreamStart:function(t){var i=!1,u=t.getAttribute("xmlns"),r;return(typeof u!="string"?i="Missing xmlns in <open />":u!==n.NS.FRAMING&&(i="Wrong xmlns in <open />: "+u),r=t.getAttribute("version"),typeof r!="string"?i="Missing version in <open />":r!=="1.0"&&(i="Wrong version in <open />: "+r),i)?(this._conn._changeConnectStatus(n.Status.CONNFAIL,i),this._conn._doDisconnect(),!1):!0},_connect_cb_wrapper:function(t){var r,i,u,f,e;if(t.data.indexOf("<open ")===0||t.data.indexOf("<?xml")===0){if(r=t.data.replace(/^(<\?.*?\?>\s*)*/,""),r==="")return;i=(new DOMParser).parseFromString(r,"text/xml").documentElement;this._conn.xmlInput(i);this._conn.rawInput(t.data);this._handleStreamStart(i)&&this._connect_cb(i)}else t.data.indexOf("<close ")===0?(this._conn.rawInput(t.data),this._conn.xmlInput(t),u=t.getAttribute("see-other-uri"),u?(this._conn._changeConnectStatus(n.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=u,this._connect()):(this._conn._changeConnectStatus(n.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect())):(f=this._streamWrap(t.data),e=(new DOMParser).parseFromString(f,"text/xml").documentElement,this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(e,null,t.data))},_disconnect:function(i){var r,u;if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){i&&this._conn.send(i);r=t("close",{xmlns:n.NS.FRAMING});this._conn.xmlOutput(r);u=n.serialize(r);this._conn.rawOutput(u);try{this.socket.send(u)}catch(f){n.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){n.debug("WebSockets _doDisconnect was called");this._closeSocket()},_streamWrap:function(n){return"<wrapper>"+n+"<\/wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(n){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(){this._conn.connected&&!this._conn.disconnecting?(n.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):n.info("Websocket closed")},_no_auth_received:function(t){n.error("Server did not send any auth methods");this._conn._changeConnectStatus(n.Status.CONNFAIL,"Server did not send any auth methods");t&&(t=t.bind(this._conn),t());this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(t){n.error("Websocket error "+t);this._conn._changeConnectStatus(n.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected.");this._disconnect()},_onIdle:function(){var i=this._conn._data,t,r,u;if(i.length>0&&!this._conn.paused){for(t=0;t<i.length;t++)i[t]!==null&&(r=i[t]==="restart"?this._buildStream().tree():i[t],u=n.serialize(r),this._conn.xmlOutput(r),this._conn.rawOutput(u),this.socket.send(u));this._conn._data=[]}},_onMessage:function(t){var i,r,u='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(t.data===u){this._conn.rawInput(u);this._conn.xmlInput(t);this._conn.disconnecting||this._conn._doDisconnect();return}if(t.data.search("<open ")===0){if(i=(new DOMParser).parseFromString(t.data,"text/xml").documentElement,!this._handleStreamStart(i))return}else r=this._streamWrap(t.data),i=(new DOMParser).parseFromString(r,"text/xml").documentElement;if(!this._check_streamerror(i,n.Status.ERROR)){if(this._conn.disconnecting&&i.firstChild.nodeName==="presence"&&i.firstChild.getAttribute("type")==="unavailable"){this._conn.xmlInput(i);this._conn.rawInput(n.serialize(i));return}this._conn._dataRecv(i,t.data)}},_onOpen:function(){var t,i;n.info("Websocket open");t=this._buildStream();this._conn.xmlOutput(t.tree());i=n.serialize(t);this._conn.rawOutput(i);this.socket.send(i)},_reqToData:function(n){return n},_send:function(){this._conn.flush()},_sendRestart:function(){this._conn._timeProvider.clearTimeout(this._conn._idleTimeout);this._conn._onIdle.bind(this._conn)()}},n}),function(){typeof define=="function"&&define.amd&&define("strophe",["strophe-core","strophe-bosh","strophe-websocket"],function(n){return n})}(this),n)if(typeof define=="function"&&define.amd){var t=n;typeof requirejs=="function"?requirejs(["strophe"],function(n){t(n.Strophe,n.$build,n.$msg,n.$iq,n.$pres)}):require(["strophe"],function(n){t(n.Strophe,n.$build,n.$msg,n.$iq,n.$pres)})}else return n(Strophe,$build,$msg,$iq,$pres)})(function(n,t,i,r,u){window.Strophe=n;window.$build=t;window.$msg=i;window.$iq=r;window.$pres=u});__bind=function(n,t){return function(){return n.apply(t,arguments)}};Strophe.addConnectionPlugin("muc",{_connection:null,rooms:{},roomNames:[],init:function(n){return this._connection=n,this._muc_handler=null,Strophe.addNamespace("MUC_OWNER",Strophe.NS.MUC+"#owner"),Strophe.addNamespace("MUC_ADMIN",Strophe.NS.MUC+"#admin"),Strophe.addNamespace("MUC_USER",Strophe.NS.MUC+"#user"),Strophe.addNamespace("MUC_ROOMCONF",Strophe.NS.MUC+"#roomconfig")},join:function(n,t,i,r,u,f,e){var o,s,c,h=this;return s=this.test_append_nick(n,t),o=$pres({from:this._connection.jid,to:s}).c("x",{xmlns:Strophe.NS.MUC}),e!=null&&(o=o.c("history",e)),f!=null&&o.cnode(Strophe.xmlElement("password",[],f)),(c=this._muc_handler)==null&&(this._muc_handler=this._connection.addHandler(function(t){var f,c,i,e,o,l,s,r,u,a;if((f=t.getAttribute("from"),!f)||(o=f.split("/")[0],!h.rooms[o]))return!0;if(n=h.rooms[o],i={},t.nodeName==="message")i=n._message_handlers;else if(t.nodeName==="presence"&&(r=t.getElementsByTagName("x"),r.length>0))for(u=0,a=r.length;u<a;u++)if(l=r[u],s=l.getAttribute("xmlns"),s&&s.match(Strophe.NS.MUC)){i=n._presence_handlers;break}for(e in i)c=i[e],c(t,n)||delete i[e];return!0})),this.rooms.hasOwnProperty(n)||(this.rooms[n]=new XmppRoom(this,n,t,f),this.roomNames.push(n)),r&&this.rooms[n].addHandler("presence",r),i&&this.rooms[n].addHandler("message",i),u&&this.rooms[n].addHandler("roster",u),this._connection.send(o)},leave:function(n,t,i,r){var f,e,u,o;return f=this.roomNames.indexOf(n),delete this.rooms[n],f>=0&&(this.roomNames.splice(f,1),this.roomNames.length===0&&(this._connection.deleteHandler(this._muc_handler),this._muc_handler=null)),o=this.test_append_nick(n,t),u=this._connection.getUniqueId(),e=$pres({type:"unavailable",id:u,from:this._connection.jid,to:o}),r!=null&&e.c("status",r),i!=null&&this._connection.addHandler(i,null,"presence",null,u),this._connection.send(e),u},message:function(n,t,i,r,u){var f,e,o,s;return s=this.test_append_nick(n,t),u=u||(t!=null?"chat":"groupchat"),e=this._connection.getUniqueId(),f=$msg({to:s,from:this._connection.jid,type:u,id:e}).c("body",{xmlns:Strophe.NS.CLIENT}).t(i),f.up(),r!=null&&(f.c("html",{xmlns:Strophe.NS.XHTML_IM}).c("body",{xmlns:Strophe.NS.XHTML}).t(r),f.node.childNodes.length===0?(o=f.node.parentNode,f.up().up(),f.node.removeChild(o)):f.up().up()),f.c("x",{xmlns:"jabber:x:event"}).c("composing"),this._connection.send(f),e},groupchat:function(n,t,i){return this.message(n,null,t,i)},invite:function(n,t,i){var r,u;return u=this._connection.getUniqueId(),r=$msg({from:this._connection.jid,to:n,id:u}).c("x",{xmlns:Strophe.NS.MUC_USER}).c("invite",{to:t}),i!=null&&r.c("reason",i),this._connection.send(r),u},directInvite:function(n,t,i,r){var u,e,f;return f=this._connection.getUniqueId(),u={xmlns:"jabber:x:conference",jid:n},i!=null&&(u.reason=i),r!=null&&(u.password=r),e=$msg({from:this._connection.jid,to:t,id:f}).c("x",u),this._connection.send(e),f},queryOccupants:function(n,t,i){var r,u;return r={xmlns:Strophe.NS.DISCO_ITEMS},u=$iq({from:this._connection.jid,to:n,type:"get"}).c("query",r),this._connection.sendIQ(u,t,i)},configure:function(n,t,i){var r,u;return r=$iq({to:n,type:"get"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}),u=r.tree(),this._connection.sendIQ(u,t,i)},cancelConfigure:function(n){var t,i;return t=$iq({to:n,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"cancel"}),i=t.tree(),this._connection.sendIQ(i)},saveConfiguration:function(n,t,i,r){var e,u,o,f,s;if(u=$iq({to:n,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}),t instanceof Form)t.type="submit",u.cnode(t.toXML());else for(u.c("x",{xmlns:"jabber:x:data",type:"submit"}),f=0,s=t.length;f<s;f++)e=t[f],u.cnode(e).up();return o=u.tree(),this._connection.sendIQ(o,i,r)},createInstantRoom:function(n,t,i){var r;return r=$iq({to:n,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"}),this._connection.sendIQ(r.tree(),t,i)},setTopic:function(n,t){var i;return i=$msg({to:n,from:this._connection.jid,type:"groupchat"}).c("subject",{xmlns:"jabber:client"}).t(t),this._connection.send(i.tree())},_modifyPrivilege:function(n,t,i,r,u){var f;return f=$iq({to:n,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_ADMIN}).cnode(t.node),i!=null&&f.c("reason",i),this._connection.sendIQ(f.tree(),r,u)},modifyRole:function(n,t,i,r,u,f){var e;return e=$build("item",{nick:t,role:i}),this._modifyPrivilege(n,e,r,u,f)},kick:function(n,t,i,r,u){return this.modifyRole(n,t,"none",i,r,u)},voice:function(n,t,i,r,u){return this.modifyRole(n,t,"participant",i,r,u)},mute:function(n,t,i,r,u){return this.modifyRole(n,t,"visitor",i,r,u)},op:function(n,t,i,r,u){return this.modifyRole(n,t,"moderator",i,r,u)},deop:function(n,t,i,r,u){return this.modifyRole(n,t,"participant",i,r,u)},modifyAffiliation:function(n,t,i,r,u,f){var e;return e=$build("item",{jid:t,affiliation:i}),this._modifyPrivilege(n,e,r,u,f)},ban:function(n,t,i,r,u){return this.modifyAffiliation(n,t,"outcast",i,r,u)},member:function(n,t,i,r,u){return this.modifyAffiliation(n,t,"member",i,r,u)},revoke:function(n,t,i,r,u){return this.modifyAffiliation(n,t,"none",i,r,u)},owner:function(n,t,i,r,u){return this.modifyAffiliation(n,t,"owner",i,r,u)},admin:function(n,t,i,r,u){return this.modifyAffiliation(n,t,"admin",i,r,u)},changeNick:function(n,t){var i,r;return r=this.test_append_nick(n,t),i=$pres({from:this._connection.jid,to:r,id:this._connection.getUniqueId()}),this._connection.send(i.tree())},setStatus:function(n,t,i,r){var u,f;return f=this.test_append_nick(n,t),u=$pres({from:this._connection.jid,to:f}),i!=null&&u.c("show",i).up(),r!=null&&u.c("status",r),this._connection.send(u.tree())},listRooms:function(n,t,i){var r;return r=$iq({to:n,from:this._connection.jid,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_ITEMS}),this._connection.sendIQ(r,t,i)},test_append_nick:function(n,t){return n+(t!=null?"/"+Strophe.escapeNode(t):"")}});XmppRoom=function(){function n(n,t,i,r){this.client=n;this.name=t;this.nick=i;this.password=r;this._roomRosterHandler=__bind(this._roomRosterHandler,this);this._addOccupant=__bind(this._addOccupant,this);this.roster={};this._message_handlers={};this._presence_handlers={};this._roster_handlers={};this._handler_ids=0;n.muc&&(this.client=n.muc);this.name=Strophe.getBareJidFromJid(t);this.addHandler("presence",this._roomRosterHandler)}return n.prototype.join=function(n,t,i){return this.client.join(this.name,this.nick,n,t,i,this.password)},n.prototype.leave=function(n,t){return this.client.leave(this.name,this.nick,n,t),delete this.client.rooms[this.name]},n.prototype.message=function(n,t,i,r){return this.client.message(this.name,n,t,i,r)},n.prototype.groupchat=function(n,t){return this.client.groupchat(this.name,n,t)},n.prototype.invite=function(n,t){return this.client.invite(this.name,n,t)},n.prototype.directInvite=function(n,t){return this.client.directInvite(this.name,n,t,this.password)},n.prototype.configure=function(n){return this.client.configure(this.name,n)},n.prototype.cancelConfigure=function(){return this.client.cancelConfigure(this.name)},n.prototype.saveConfiguration=function(n){return this.client.saveConfiguration(this.name,n)},n.prototype.queryOccupants=function(n,t){return this.client.queryOccupants(this.name,n,t)},n.prototype.setTopic=function(n){return this.client.setTopic(this.name,n)},n.prototype.modifyRole=function(n,t,i,r,u){return this.client.modifyRole(this.name,n,t,i,r,u)},n.prototype.kick=function(n,t,i,r){return this.client.kick(this.name,n,t,i,r)},n.prototype.voice=function(n,t,i,r){return this.client.voice(this.name,n,t,i,r)},n.prototype.mute=function(n,t,i,r){return this.client.mute(this.name,n,t,i,r)},n.prototype.op=function(n,t,i,r){return this.client.op(this.name,n,t,i,r)},n.prototype.deop=function(n,t,i,r){return this.client.deop(this.name,n,t,i,r)},n.prototype.modifyAffiliation=function(n,t,i,r,u){return this.client.modifyAffiliation(this.name,n,t,i,r,u)},n.prototype.ban=function(n,t,i,r){return this.client.ban(this.name,n,t,i,r)},n.prototype.member=function(n,t,i,r){return this.client.member(this.name,n,t,i,r)},n.prototype.revoke=function(n,t,i,r){return this.client.revoke(this.name,n,t,i,r)},n.prototype.owner=function(n,t,i,r){return this.client.owner(this.name,n,t,i,r)},n.prototype.admin=function(n,t,i,r){return this.client.admin(this.name,n,t,i,r)},n.prototype.changeNick=function(n){return this.nick=n,this.client.changeNick(this.name,n)},n.prototype.setStatus=function(n,t){return this.client.setStatus(this.name,this.nick,n,t)},n.prototype.addHandler=function(n,t){var i=this._handler_ids++;switch(n){case"presence":this._presence_handlers[i]=t;break;case"message":this._message_handlers[i]=t;break;case"roster":this._roster_handlers[i]=t;break;default:return this._handler_ids--,null}return i},n.prototype.removeHandler=function(n){return delete this._presence_handlers[n],delete this._message_handlers[n],delete this._roster_handlers[n]},n.prototype._addOccupant=function(n){var t;return t=new Occupant(n,this),this.roster[t.nick]=t,t},n.prototype._roomRosterHandler=function(t){var r,o,f,u,i,e;r=n._parsePresence(t);i=r.nick;u=r.newnick||null;switch(r.type){case"error":return;case"unavailable":u&&(r.nick=u,this.roster[i]&&this.roster[u]&&(this.roster[i].update(this.roster[u]),this.roster[u]=this.roster[i]),this.roster[i]&&!this.roster[u]&&(this.roster[u]=this.roster[i].update(r)));delete this.roster[i];break;default:this.roster[i]?this.roster[i].update(r):this._addOccupant(r)}e=this._roster_handlers;for(f in e)o=e[f],o(this.roster,this)||delete this._roster_handlers[f];return!0},n._parsePresence=function(n){var i,r,u,t,f,e,h,c,l,o,a,s,v,y,p,w;for(t={},i=n.attributes,t.nick=Strophe.getResourceFromJid(i.from.textContent),t.type=((l=i.type)!=null?l.textContent:void 0)||null,t.states=[],o=n.childNodes,f=0,h=o.length;f<h;f++){r=o[f];switch(r.nodeName){case"status":t.status=r.textContent||null;break;case"show":t.show=r.textContent||null;break;case"x":if(i=r.attributes,((a=i.xmlns)!=null?a.textContent:void 0)===Strophe.NS.MUC_USER)for(s=r.childNodes,e=0,c=s.length;e<c;e++){u=s[e];switch(u.nodeName){case"item":i=u.attributes;t.affiliation=((v=i.affiliation)!=null?v.textContent:void 0)||null;t.role=((y=i.role)!=null?y.textContent:void 0)||null;t.jid=((p=i.jid)!=null?p.textContent:void 0)||null;t.newnick=((w=i.nick)!=null?w.textContent:void 0)||null;break;case"status":u.attributes.code&&t.states.push(u.attributes.code.textContent)}}}}return t},n}();RoomConfig=function(){function n(n){this.parse=__bind(this.parse,this);n!=null&&this.parse(n)}return n.prototype.parse=function(n){var o,t,i,r,s,h,u,f,e,l,a,v,c;for(h=n.getElementsByTagName("query")[0].childNodes,this.identities=[],this.features=[],this.x=[],u=0,l=h.length;u<l;u++){i=h[u];t=i.attributes;switch(i.nodeName){case"identity":for(s={},f=0,a=t.length;f<a;f++)o=t[f],s[o.name]=o.textContent;this.identities.push(s);break;case"feature":this.features.push(t["var"].textContent);break;case"x":if(t=i.childNodes[0].attributes,!1)break;for(c=i.childNodes,e=0,v=c.length;e<v;e++)(r=c[e],r.attributes.type)||(t=r.attributes,this.x.push({"var":t["var"].textContent,label:t.label.textContent||"",value:r.firstChild.textContent||""}))}}return{identities:this.identities,features:this.features,x:this.x}},n}();Occupant=function(){function n(n,t){this.room=t;this.update=__bind(this.update,this);this.admin=__bind(this.admin,this);this.owner=__bind(this.owner,this);this.revoke=__bind(this.revoke,this);this.member=__bind(this.member,this);this.ban=__bind(this.ban,this);this.modifyAffiliation=__bind(this.modifyAffiliation,this);this.deop=__bind(this.deop,this);this.op=__bind(this.op,this);this.mute=__bind(this.mute,this);this.voice=__bind(this.voice,this);this.kick=__bind(this.kick,this);this.modifyRole=__bind(this.modifyRole,this);this.update(n)}return n.prototype.modifyRole=function(n,t,i,r){return this.room.modifyRole(this.nick,n,t,i,r)},n.prototype.kick=function(n,t,i){return this.room.kick(this.nick,n,t,i)},n.prototype.voice=function(n,t,i){return this.room.voice(this.nick,n,t,i)},n.prototype.mute=function(n,t,i){return this.room.mute(this.nick,n,t,i)},n.prototype.op=function(n,t,i){return this.room.op(this.nick,n,t,i)},n.prototype.deop=function(n,t,i){return this.room.deop(this.nick,n,t,i)},n.prototype.modifyAffiliation=function(n,t,i,r){return this.room.modifyAffiliation(this.jid,n,t,i,r)},n.prototype.ban=function(n,t,i){return this.room.ban(this.jid,n,t,i)},n.prototype.member=function(n,t,i){return this.room.member(this.jid,n,t,i)},n.prototype.revoke=function(n,t,i){return this.room.revoke(this.jid,n,t,i)},n.prototype.owner=function(n,t,i){return this.room.owner(this.jid,n,t,i)},n.prototype.admin=function(n,t,i){return this.room.admin(this.jid,n,t,i)},n.prototype.update=function(n){return this.nick=n.nick||null,this.affiliation=n.affiliation||null,this.role=n.role||null,this.jid=n.jid||null,this.status=n.status||null,this.show=n.show||null,this},n}();Strophe.addConnectionPlugin("disco",{_connection:null,_identities:[],_features:[],_items:[],init:function(n){this._connection=n;this._identities=[];this._features=[];this._items=[];n.addHandler(this._onDiscoInfo.bind(this),Strophe.NS.DISCO_INFO,"iq","get",null,null);n.addHandler(this._onDiscoItems.bind(this),Strophe.NS.DISCO_ITEMS,"iq","get",null,null)},addIdentity:function(n,t,i,r){typeof i=="undefined"&&(i="");typeof r=="undefined"&&(r="");for(var u=0;u<this._identities.length;u++)if(this._identities[u].category==n&&this._identities[u].type==t&&this._identities[u].name==i&&this._identities[u].lang==r)return!1;return this._identities.push({category:n,type:t,name:i,lang:r}),!0},addFeature:function(n){for(var t=0;t<this._features.length;t++)if(this._features[t]==n)return!1;return this._features.push(n),!0},removeFeature:function(n){for(var t=0;t<this._features.length;t++)if(this._features[t]===n)return this._features.splice(t,1),!0;return!1},addItem:function(n,t,i,r){return i&&!r?!1:(this._items.push({jid:n,name:t,node:i,call_back:r}),!0)},info:function(n,t,i,r,u){var f={xmlns:Strophe.NS.DISCO_INFO},e;t&&(f.node=t);e=$iq({from:this._connection.jid,to:n,type:"get"}).c("query",f);this._connection.sendIQ(e,i,r,u)},items:function(n,t,i,r,u){var f={xmlns:Strophe.NS.DISCO_ITEMS},e;t&&(f.node=t);e=$iq({from:this._connection.jid,to:n,type:"get"}).c("query",f);this._connection.sendIQ(e,i,r,u)},_buildIQResult:function(n,t){var u=n.getAttribute("id"),i=n.getAttribute("from"),r=$iq({type:"result",id:u});return i!==null&&r.attrs({to:i}),r.c("query",t)},_onDiscoInfo:function(n){var u=n.getElementsByTagName("query")[0].getAttribute("node"),i={xmlns:Strophe.NS.DISCO_INFO},t,r;for(u&&(i.node=u),r=this._buildIQResult(n,i),t=0;t<this._identities.length;t++)i={category:this._identities[t].category,type:this._identities[t].type},this._identities[t].name&&(i.name=this._identities[t].name),this._identities[t].lang&&(i["xml:lang"]=this._identities[t].lang),r.c("identity",i).up();for(t=0;t<this._features.length;t++)r.c("feature",{"var":this._features[t]}).up();return this._connection.send(r.tree()),!0},_onDiscoItems:function(n){var e={xmlns:Strophe.NS.DISCO_ITEMS},u=n.getElementsByTagName("query")[0].getAttribute("node"),i,t,f,r;if(u){for(e.node=u,i=[],t=0;t<this._items.length;t++)if(this._items[t].node==u){i=this._items[t].call_back(n);break}}else i=this._items;for(f=this._buildIQResult(n,e),t=0;t<i.length;t++)r={jid:i[t].jid},i[t].name&&(r.name=i[t].name),i[t].node&&(r.node=i[t].node),f.c("item",r).up();return this._connection.send(f.tree()),!0}});Strophe.addConnectionPlugin("caps",{HASH:"sha-1",node:"http://strophe.im/strophejs/",_ver:"",_connection:null,_knownCapabilities:{},_jidVerIndex:{},init:function(n){if(this._connection=n,Strophe.addNamespace("CAPS","http://jabber.org/protocol/caps"),!this._connection.disco)throw"Caps plugin requires the disco plugin to be installed.";this._connection.disco.addFeature(Strophe.NS.CAPS);this._connection.addHandler(this._delegateCapabilities.bind(this),Strophe.NS.CAPS)},generateCapsAttrs:function(){return{xmlns:Strophe.NS.CAPS,hash:this.HASH,node:this.node,ver:this.generateVer()}},generateVer:function(){var t,n;if(this._ver!=="")return this._ver;var i="",r=this._connection.disco._identities.sort(this._sortIdentities),f=r.length,u=this._connection.disco._features.sort(),e=u.length;for(n=0;n<f;n++)t=r[n],i+=t.category+"/"+t.type+"/"+t.lang+"/"+t.name+"<";for(n=0;n<e;n++)i+=u[n]+"<";return this._ver=b64_sha1(i),this._ver},getCapabilitiesByJid:function(n){return this._jidVerIndex[n]?this._knownCapabilities[this._jidVerIndex[n]]:null},_delegateCapabilities:function(n){var t=n.getAttribute("from"),r=n.getElementsByTagName("c")[0],i=r.getAttribute("ver"),u=r.getAttribute("node");if(this._knownCapabilities[i])this._jidVerIndex[t]=i;else return this._requestCapabilities(t,u,i);return this._jidVerIndex[t]&&!this._jidVerIndex[t]===i||(this._jidVerIndex[t]=i),!0},_requestCapabilities:function(n,t,i){if(n!==this._connection.jid){var r=this._connection.disco.info(n,t+"#"+i);this._connection.addHandler(this._handleDiscoInfoReply.bind(this),Strophe.NS.DISCO_INFO,"iq","result",r,n)}return!0},_handleDiscoInfoReply:function(n){var e=n.getElementsByTagName("query")[0],i=e.getAttribute("node").split("#"),t=i[1],r=n.getAttribute("from"),f,o,u;if(this._knownCapabilities[t])this._jidVerIndex[r]&&!this._jidVerIndex[r]===t||(this._jidVerIndex[r]=t);else{for(f=e.childNodes,o=f.length,this._knownCapabilities[t]=[],u=0;u<o;u++)i=f[u],this._knownCapabilities[t].push({name:i.nodeName,attributes:i.attributes});this._jidVerIndex[r]=t}return!1},_sortIdentities:function(n,t){return n.category>t.category?1:n.category<t.category?-1:n.type>t.type?1:n.type<t.type?-1:n.lang>t.lang?1:n.lang<t.lang?-1:0}}),function(n,t){typeof define=="function"&&define.amd?define("strophe.rsm",["strophe"],function(n){return t(n.Strophe,n.$build,n.$iq,n.$msg,n.$pres),n}):t(n.Strophe,n.$build,n.$iq,n.$msg,n.$pres)}(this,function(n,t){n.addNamespace("RSM","http://jabber.org/protocol/rsm");n.RSM=function(n){var t,i;if(this.attribs=["max","first","last","after","before","index","count"],typeof n.xml!="undefined")this.fromXMLElement(n.xml);else for(t=0;t<this.attribs.length;t++)i=this.attribs[t],this[i]=n[i]};n.RSM.prototype={toXML:function(){for(var i,r=t("set",{xmlns:n.NS.RSM}),u=0;u<this.attribs.length;u++)i=this.attribs[u],typeof this[i]!="undefined"&&(r=r.c(i).t(this[i].toString()).up());return r.tree()},next:function(t){return new n.RSM({max:t,after:this.last})},previous:function(t){return new n.RSM({max:t,before:this.first})},fromXMLElement:function(t){for(var u,i,r=0;r<this.attribs.length;r++)u=this.attribs[r],i=t.getElementsByTagName(u)[0],typeof i!="undefined"&&i!==null&&(this[u]=n.getText(i),u=="first"&&(this.index=i.getAttribute("index")))}}}),function(){Strophe.addConnectionPlugin("mam",{_c:null,_p:["with","start","end"],init:function(n){this._c=n;Strophe.addNamespace("MAM","urn:xmpp:mam:2")},query:function(n,t){var l=this._p,a={type:"set",to:n},f,i,r,u,e,s,h,o,c;for(t=t||{},f={xmlns:Strophe.NS.MAM},!t.queryid||(f.queryid=t.queryid,delete t.queryid),i=$iq(a).c("query",f).c("x",{xmlns:"jabber:x:data",type:"submit"}),i.c("field",{"var":"FORM_TYPE",type:"hidden"}).c("value").t(Strophe.NS.MAM).up().up(),r=0;r<this._p.length;r++)u=l[r],e=t[u],delete t[u],!e||i.c("field",{"var":u}).c("value").t(e).up().up();return i.up(),s=t.onMessage,delete t.onMessage,h=t.onComplete,delete t.onComplete,i.cnode(new Strophe.RSM(t).toXML()),o=this._c,c=o.addHandler(s,Strophe.NS.MAM,"message",null),this._c.sendIQ(i,function(){o.deleteHandler(c);h.apply(this,arguments)})}})}();Mustache=function(){var n=function(){};return n.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":!0},context:{},render:function(n,t,i,r){if(r||(this.context=t,this.buffer=[]),!this.includes("",n)){if(r)return n;this.send(n);return}n=this.render_pragmas(n);var u=this.render_section(n,t,i);if(r)return this.render_tags(u,t,i,r);this.render_tags(u,t,i,r)},send:function(n){n!=""&&this.buffer.push(n)},render_pragmas:function(n){if(!this.includes("%",n))return n;var t=this,i=new RegExp(this.otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag);return n.replace(i,function(n,i,r){if(!t.pragmas_implemented[i])throw{message:"This implementation of mustache doesn't understand the '"+i+"' pragma"};if(t.pragmas[i]={},r){var u=r.split("=");t.pragmas[i][u[0]]=u[1]}return""})},render_partial:function(n,t,i){if(n=this.trim(n),!i||i[n]===undefined)throw{message:"unknown_partial '"+n+"'"};return typeof t[n]!="object"?this.render(i[n],t,i,!0):this.render(i[n],t[n],i,!0)},render_section:function(n,t,i){if(!this.includes("#",n)&&!this.includes("^",n))return n;var r=this,u=new RegExp(this.otag+"(\\^|\\#)\\s*(.+)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg");return n.replace(u,function(n,u,f,e){var o=r.find(f,t);return u=="^"?!o||r.is_array(o)&&o.length===0?r.render(e,t,i,!0):"":u=="#"?r.is_array(o)?r.map(o,function(n){return r.render(e,r.create_context(n),i,!0)}).join(""):r.is_object(o)?r.render(e,r.create_context(o),i,!0):typeof o=="function"?o.call(t,e,function(n){return r.render(n,t,i,!0)}):o?r.render(e,t,i,!0):"":void 0})},render_tags:function(n,t,i,r){for(var u=this,o=function(){return new RegExp(u.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+u.ctag+"+","g")},s=o(),h=function(n,r,f){switch(r){case"!":return"";case"=":return u.set_delimiters(f),s=o(),"";case">":return u.render_partial(f,t,i);case"{":return u.find(f,t);default:return u.escape(u.find(f,t))}},f=n.split("\n"),e=0;e<f.length;e++)f[e]=f[e].replace(s,h,this),r||this.send(f[e]);if(r)return f.join("\n")},set_delimiters:function(n){var t=n.split(" ");this.otag=this.escape_regex(t[0]);this.ctag=this.escape_regex(t[1])},escape_regex:function(n){if(!arguments.callee.sRE)arguments.callee.sRE=new RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g");return n.replace(arguments.callee.sRE,"\\$1")},find:function(n,t){function r(n){return n===!1||n===0||n}n=this.trim(n);var i;return(r(t[n])?i=t[n]:r(this.context[n])&&(i=this.context[n]),typeof i=="function")?i.apply(t):i!==undefined?i:""},includes:function(n,t){return t.indexOf(this.otag+n)!=-1},escape:function(n){return n=String(n===null?"":n),n.replace(/&(?!\w+;)|["<>\\]/g,function(n){switch(n){case"&":return"&amp;";case"\\":return"\\\\";case'"':return'"';case"<":return"&lt;";case">":return"&gt;";default:return n}})},create_context:function(n){var t,i;return this.is_object(n)?n:(t=".",this.pragmas["IMPLICIT-ITERATOR"]&&(t=this.pragmas["IMPLICIT-ITERATOR"].iterator),i={},i[t]=n,i)},is_object:function(n){return n&&typeof n=="object"},is_array:function(n){return Object.prototype.toString.call(n)==="[object Array]"},trim:function(n){return n.replace(/^\s*|\s*$/g,"")},map:function(n,t){var r,u,i;if(typeof n.map=="function")return n.map(t);for(r=[],u=n.length,i=0;i<u;i++)r.push(t(n[i]));return r}},{name:"mustache.js",version:"0.3.0",to_html:function(t,i,r,u){var f=new n;return u&&(f.send=u),f.render(t,i,r),u?void 0:f.buffer.join("\n")}}}(),function(n){var i=Array.prototype.slice,t={dict:null,missingPattern:null,load:function(t,i){this.dict!==null?n.extend(this.dict,t):this.dict=t;i&&(this.missingPattern=i)},unload:function(){this.dict=null;this.missingPattern=null},_:function(n){var t=this.dict,r;if(t&&t.hasOwnProperty(n))n=t[n];else if(this.missingPattern!==null)return this.printf(this.missingPattern,n);return r=i.call(arguments),r[0]=n,this.printf.apply(this,r)},printf:function(t,r){return arguments.length<2?t:(r=n.isArray(r)?r:i.call(arguments,1),t.replace(/([^%]|^)%(?:(\d+)\$)?s/g,function(n,t,i){return i?t+r[parseInt(i)-1]:t+r.shift()}).replace(/%%s/g,"%s"))}};n.fn._t=function(){return n(this).html(t._.apply(t,arguments))};n.i18n=t}(jQuery);dateFormat=function(){var t=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,i=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,r=/[^-+\dA-Z]/g,n=function(n,t){for(n=String(n),t=t||2;n.length<t;)n="0"+n;return n};return function(u,f,e){var h=dateFormat;if(arguments.length!=1||Object.prototype.toString.call(u)!="[object String]"||/\d/.test(u)||(f=u,u=undefined),u=u?new Date(u):new Date,isNaN(u))throw SyntaxError("invalid date");f=String(h.masks[f]||f||h.masks["default"]);f.slice(0,4)=="UTC:"&&(f=f.slice(4),e=!0);var o=e?"getUTC":"get",c=u[o+"Date"](),y=u[o+"Day"](),l=u[o+"Month"](),p=u[o+"FullYear"](),s=u[o+"Hours"](),w=u[o+"Minutes"](),b=u[o+"Seconds"](),a=u[o+"Milliseconds"](),v=e?0:u.getTimezoneOffset(),k={d:c,dd:n(c),ddd:h.i18n.dayNames[y],dddd:h.i18n.dayNames[y+7],m:l+1,mm:n(l+1),mmm:h.i18n.monthNames[l],mmmm:h.i18n.monthNames[l+12],yy:String(p).slice(2),yyyy:p,h:s%12||12,hh:n(s%12||12),H:s,HH:n(s),M:w,MM:n(w),s:b,ss:n(b),l:n(a,3),L:n(a>99?Math.round(a/10):a),t:s<12?"a":"p",tt:s<12?"am":"pm",T:s<12?"A":"P",TT:s<12?"AM":"PM",Z:e?"UTC":(String(u).match(i)||[""]).pop().replace(r,""),o:(v>0?"-":"+")+n(Math.floor(Math.abs(v)/60)*100+Math.abs(v)%60,4),S:["th","st","nd","rd"][c%10>3?0:(c%100-c%10!=10)*c%10]};return f.replace(t,function(n){return n in k?k[n]:n.slice(1,n.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Date.prototype.format=function(n,t){return dateFormat(this,n,t)};
/*!
 * IFM Candy bundle 1.3.0-3823
 * Copyright (c) IFM Infomaster. All rights reserved.
 */
Candy=function(n,t){return n.about={name:"Candy",version:"1.10.0"},n.init=function(i,r){r.viewClass||(r.viewClass=n.View);r.viewClass.init(t("#candy"),r.view);n.Core.init(i,r.core)},n}(Candy||{},jQuery);Candy.Core=function(n,t,i){var r=null,c=null,u=null,e={},h=!1,l,f={autojoin:undefined,disconnectWithoutTabs:!0,debug:!1,disableWindowUnload:!1,presencePriority:1,resource:Candy.about.name},o=function(n,i){t.addNamespace(n,i)},y=function(){o("PRIVATE","jabber:iq:private");o("BOOKMARKS","storage:bookmarks");o("PRIVACY","jabber:iq:privacy");o("DELAY","jabber:x:delay");o("PUBSUB","http://jabber.org/protocol/pubsub")},a=function(n){var i=t.getNodeFromJid(n),r=t.getDomainFromJid(n);return i?t.escapeNode(i)+"@"+r:r},s=function(){var n=Candy.Core.getConnection().jid;n&&window.sessionStorage.removeItem("candy-cache-"+n)},v=function(){var n=Candy.Core.getConnection().jid;n&&u&&window.sessionStorage.setItem("candy-cache-"+n,JSON.stringify({nick:u.getNick(),rooms:e}))};return n.init=function(u,e){c=u;i.extend(!0,f,e);f.debug&&(n.debug=f.debug.toString().indexOf("verbose")>-1?function(){var n=[];n.push("[Debug]");n.push("[Candy]");Array.prototype.push.apply(n,arguments);console.debug.apply(console,n)}:function(){},n.xml=f.debug.toString().indexOf("xml")>-1?function(n,t){t=i.parseXML(t);n?console.debug(n,t):console.debug(t)}:function(){},n.log=function(){var n=[];n.push("[Info]");n.push("[Candy]");Array.prototype.push.apply(n,arguments);console.log.apply(console,n)},t.log=function(n){var i,r,u;switch(n){case t.LogLevel.DEBUG:if(f.debug.toString().indexOf("http")>=0)i="Debug",r="debug";else return;break;case t.LogLevel.INFO:i="Info";r="log";break;case t.LogLevel.WARN:i="WARN";r="warn";break;case t.LogLevel.ERROR:i="ERROR";r="error";break;case t.LogLevel.FATAL:i="FATAL";r="error"}u=Array.prototype.slice.call(arguments,1);u.unshift("[Strophe]","["+i+"]");try{console[r].apply(console,u)}catch(e){}},n.debug("[Init] Debugging enabled"));y();r=new t.Connection(c,{keepalive:!0,mechanisms:[t.SASLAnonymous]});r.rawInput=n.rawInput.bind(n);r.rawOutput=n.rawOutput.bind(n);r.caps.node="https://candy-chat.github.io/candy/";f.disableWindowUnload||(window.onbeforeunload=n.onWindowUnload)},n.registerEventHandlers=function(){n.addHandler(n.Event.Jabber.Version,t.NS.VERSION,"iq");n.addHandler(n.Event.Jabber.Presence,null,"presence");n.addHandler(n.Event.Jabber.Message,null,"message");n.addHandler(n.Event.Jabber.Bookmarks,t.NS.PRIVATE,"iq");n.addHandler(n.Event.Jabber.Room.Disco,t.NS.DISCO_INFO,"iq","result")},n.connect=function(o,c,l){var p,v,y,w;if(r.reset(),n.registerEventHandlers(),i(Candy).triggerHandler("candy:core.before-connect",{connection:r}),r.isRestoreSupported()){if(r.isRestorable(null,90)){this.debug("Restoring session");p=r.restore(null,Candy.Core.Event.Strophe.Connect);this.debug("Restoring cache");try{if(v=JSON.parse(window.sessionStorage.getItem("candy-cache-"+p.jid)),typeof v!=typeof undefined&&v!==null){u=new n.ChatUser(p.jid,v.nick||l||t.getNodeFromJid(p.jid));for(y in v.rooms)w=new Candy.Core.ChatRoom(y),w.setUser(Candy.Core.getUser()),e[y]=w,Candy.Core.Action.Jabber.Room.Disco(y),Candies.getRoomHistory(y)}else this.log("No restorable cache")}catch(b){this.log("Invalid cache content");this.log(b);s()}return}this.log("No restorable session");s()}else this.debug("Sessions not restorable in this configuration");h=h?!0:o&&o.indexOf("@")<0;o&&c?(r.connect(a(o)+"/"+f.resource,c,Candy.Core.Event.Strophe.Connect),u=l?new n.ChatUser(o,l):new n.ChatUser(o,t.getNodeFromJid(o))):o&&l?(r.connect(a(o)+"/"+f.resource,null,Candy.Core.Event.Strophe.Connect),u=new n.ChatUser(null,l)):o?Candy.Core.Event.Login(o):Candy.Core.Event.Login()},n.attach=function(i,f,e){u=new n.ChatUser(i,t.getNodeFromJid(i));n.registerEventHandlers();r.attach(i,f,e,Candy.Core.Event.Strophe.Connect)},n.disconnect=function(){r.connected&&(s(),i.each(n.getRooms(),function(){Candy.Core.Action.Jabber.Room.Leave(this.getJid())}),r.disconnect())},n.addHandler=function(n,t,i,u,f,e,o){return r.addHandler(n,t,i,u,f,e,o)},n.getUser=function(){return u},n.setUser=function(n){u=n;v()},n.getConnection=function(){return r},n.removeRoom=function(n){delete e[n]},n.getRooms=function(){return e},n.getStropheStatus=function(){return l},n.setStropheStatus=function(n){l=n},n.isAnonymousConnection=function(){return h},n.getOptions=function(){return f},n.getRoom=function(n){return e[n]?e[n]:null},n.onWindowUnload=function(){return;var t},n.rawInput=function(n){this.xml("RECV:",n)},n.rawOutput=function(n){this.xml("SENT:",n)},n.clearCache=function(){s()},n.updateCache=function(){v()},n.debug=function(){},n.log=function(){},n.xml=function(){},n}(Candy.Core||{},Strophe,jQuery);Candy.View=function(n,t){var i={container:null,roomJid:null},r={language:"en",assets:"res/",messages:{limit:2e3,remove:500},crop:{message:{nickname:15,body:1e3},roster:{nickname:15}},enableXHTML:!1},u=function(i){t.i18n.load(n.Translation[i])},f=function(){t(Candy).on("candy:core.chat.connection",n.Observer.Chat.Connection);t(Candy).on("candy:core.chat.message",n.Observer.Chat.Message);t(Candy).on("candy:core.login",n.Observer.Login);t(Candy).on("candy:core.autojoin-missing",n.Observer.AutojoinMissing);t(Candy).on("candy:core.presence",n.Observer.Presence.update);t(Candy).on("candy:core.presence.leave",n.Observer.Presence.update);t(Candy).on("candy:core.presence.room",n.Observer.Presence.update);t(Candy).on("candy:core.presence.error",n.Observer.PresenceError);t(Candy).on("candy:core.message",n.Observer.Message)},e=function(){Candy.Util.getIeVersion()<9?t(document).focusin(Candy.View.Pane.Window.onFocus).focusout(Candy.View.Pane.Window.onBlur):t(window).focus(Candy.View.Pane.Window.onFocus).blur(Candy.View.Pane.Window.onBlur);t(window).resize(Candy.View.Pane.Chat.fitTabs)},o=function(){n.Pane.Chat.Toolbar.init()},s=function(){t("body").delegate("li[data-tooltip]","mouseenter",Candy.View.Pane.Chat.Tooltip.show)};return n.init=function(n,h){h.resources&&(h.assets=h.resources,delete h.resources);t.extend(!0,r,h);u(r.language);Candy.Util.Parser.setEmoticonPath("img/emoticons/");i.container=n;i.container.html(Mustache.to_html(Candy.View.Template.Chat.pane,{tooltipEmoticons:t.i18n._("tooltipEmoticons"),tooltipSound:t.i18n._("tooltipSound"),tooltipAutoscroll:t.i18n._("tooltipAutoscroll"),tooltipStatusmessage:t.i18n._("tooltipStatusmessage"),tooltipAdministration:t.i18n._("tooltipAdministration"),tooltipUsercount:t.i18n._("tooltipUsercount")},{tabs:Candy.View.Template.Chat.tabs,rooms:Candy.View.Template.Chat.rooms,modal:Candy.View.Template.Chat.modal,toolbar:Candy.View.Template.Chat.toolbar}));e();o();f();s()},n.getCurrent=function(){return i},n.getOptions=function(){return r},n}(Candy.View||{},jQuery);Candy.Util=function(n,t){n.jidToId=function(n){return MD5.hexdigest(n)};n.escapeJid=function(n){var i=Strophe.escapeNode(Strophe.getNodeFromJid(n)),r=Strophe.getDomainFromJid(n),t=Strophe.getResourceFromJid(n);return n=i+"@"+r,t&&(n+="/"+t),n};n.unescapeJid=function(n){var i=Strophe.unescapeNode(Strophe.getNodeFromJid(n)),r=Strophe.getDomainFromJid(n),t=Strophe.getResourceFromJid(n);return n=i+"@"+r,t&&(n+="/"+t),n};n.crop=function(n,t){return n.length>t&&(n=n.substr(0,t-3)+"..."),n};n.getDisplayName=function(n){var t=Strophe.unescapeNode(n);return t.lastIndexOf("_")>0?t.substring(0,t.lastIndexOf("_")):t};n.parseAndCropXhtml=function(i,r){return t("<div/>").append(n.createHtml(t(i).get(0),r)).html()};n.setCookie=function(n,t,i){var r=new Date;r.setDate(r.getDate()+i);document.cookie=n+"="+t+";expires="+r.toUTCString()+";path=/"};n.cookieExists=function(n){return document.cookie.indexOf(n)>-1};n.getCookie=function(n){if(document.cookie){var i=new RegExp(escape(n)+"=([^;]*)","gm"),t=i.exec(document.cookie);if(t)return t[1]}};n.deleteCookie=function(n){document.cookie=n+"=;expires=Thu, 01-Jan-70 00:00:01 GMT;path=/"};n.getPosLeftAccordingToWindowBounds=function(n,i){var f=t(document).width(),r=n.outerWidth(),e=r-n.outerWidth(!0),u="left",o=t(document).find("#candy").length>0?t("#candy").offset().left:0;return i+r>=f&&(i-=r-e,u="right"),{px:i-o,backgroundPositionAlignment:u}};n.getPosTopAccordingToWindowBounds=function(n,i){var f=t(document).height(),r=n.outerHeight(),e=r-n.outerHeight(!0),u="top",o=t(document).find("#candy").length>0?t("#candy").offset().top:0;return i+r>=f&&(i-=r-e,u="bottom"),{px:i-o,backgroundPositionAlignment:u}};n.localizedTime=function(i){if(i===undefined)return undefined;var r=n.iso8601toDate(i);return r.toDateString()===(new Date).toDateString()?r.format(t.i18n._("timeFormat")):r.format(t.i18n._("dateFormat"))};n.iso8601toDate=function(n){var r=Date.parse(n),t,i;if(isNaN(r)){if(t=/^(\d{4}|[+\-]\d{6})-(\d{2})-(\d{2})(?:[T ](\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3,}))?)?(?:(Z)|([+\-])(\d{2})(?::?(\d{2}))?))?/.exec(n),t)return i=0,t[8]!=="Z"&&(i=+t[10]*60+ +t[11],t[9]==="+"&&(i=-i)),i-=(new Date).getTimezoneOffset(),new Date(+t[1],+t[2]-1,+t[3],+t[4],+t[5]+i,+t[6],t[7]?+t[7].substr(0,3):0);r=Date.parse(n.replace(/^(\d{4})(\d{2})(\d{2})/,"$1-$2-$3")+"Z")}return new Date(r)};n.isEmptyObject=function(n){for(var t in n)if(n.hasOwnProperty(t))return!1;return!0};n.forceRedraw=function(n){n.css({display:"none"});setTimeout(function(){this.css({display:"block"})}.bind(n),1)};var i=function(){for(var i,n=3,t=document.createElement("div"),r=t.getElementsByTagName("i");t.innerHTML="<!--[if gt IE "+ ++n+"]><i><\/i><![endif]-->",r[0];);return n>4?n:i}();return n.getIeVersion=function(){return i},n.Parser={_emoticonPath:"",setEmoticonPath:function(n){Candy.View.getOptions().assets&&(this._emoticonPath=Candy.View.getOptions().assets+n)},emoticons:[{plain:":)",regex:/((\s):-?\)|:-?\)(\s|$))/gm,image:"Smiling.png"},{plain:";)",regex:/((\s);-?\)|;-?\)(\s|$))/gm,image:"Winking.png"},{plain:":D",regex:/((\s):-?D|:-?D(\s|$))/gm,image:"Grinning.png"},{plain:"XD",regex:/((\s)XD|XD(\s|$))/gm,image:"Laughing.png"},{plain:":(",regex:/((\s):-?\(|:-?\((\s|$))/gm,image:"Unhappy.png"},{plain:"^^",regex:/((\s)\^\^|\^\^(\s|$))/gm,image:"Happy.png"},{plain:":P",regex:/((\s):-?P|:-?P(\s|$))/igm,image:"Tease.png"},{plain:";P",regex:/((\s);-?P|;-?P(\s|$))/igm,image:"Tongue_Out_Winking.png"},{plain:":S",regex:/((\s):-?S|:-?S(\s|$))/igm,image:"Confused.png"},{plain:":/",regex:/((\s):-?\/|:-?\/(\s|$))/gm,image:"Uncertain.png"},{plain:"8)",regex:/((\s)8-?\)|8-?\)(\s|$))/gm,image:"Cool.png"},{plain:":OK:",regex:/((\s):OK:|:OK:(\s|$))/gm,image:"Thumb_Up.png"},{plain:"oO",regex:/((\s)oO|oO(\s|$))/gm,image:"Huh.png"},{plain:":x",regex:/((\s):x|:x(\s|$))/gm,image:"Lips_Sealed.png"},{plain:":666:",regex:/((\s):666:|:666:(\s|$))/gm,image:"Devil.png"},{plain:"<3",regex:/((\s)&lt;3|&lt;3(\s|$))/gm,image:"Heart.png"}],emotify:function(n){if(!Candy.View.getOptions().assets)return n;for(var t=this.emoticons.length-1;t>=0;t--)n=n.replace(this.emoticons[t].regex,'$2<img class="emoticon" alt="$1" src="'+this._emoticonPath+this.emoticons[t].image+'" />$3');return n},linkify:function(n){return n=n.replace(/(^|[^\/])(www\.[^\.]+\.[\S]+(\b|$))/gi,"$1http://$2"),n.replace(/(\b(https?|ftp|file):\/\/[\-A-Z0-9+&@#\/%?=~_|!:,.;]*[\-A-Z0-9+&@#\/%=~_|])/ig,'<a href="$1" target="_blank">$1<\/a>')},escape:function(n){return t("<div/>").text(n).html()},nl2br:function(n){return n.replace(/\r\n|\r|\n/g,"<br />")},all:function(n){return n&&(n=this.escape(n),n=this.linkify(n),n=this.emotify(n),n=this.nl2br(n)),n}},n.createHtml=function(i,r,u){var f,o,l,c,h,e,a,v,y,p,w,s;if(u=u||0,i.nodeType===Strophe.ElementType.NORMAL)if(c=i.nodeName.toLowerCase(),Strophe.XHTML.validTag(c))try{for(o=t("<"+c+"/>"),f=0;f<Strophe.XHTML.attributes[c].length;f++)if(h=Strophe.XHTML.attributes[c][f],e=i.getAttribute(h),typeof e!="undefined"&&e!==null&&e!==""&&e!==!1&&e!==0)if(h==="style"&&typeof e=="object"&&typeof e.cssText!="undefined"&&(e=e.cssText),h==="style"){for(a=[],v=e.split(";"),l=0;l<v.length;l++)y=v[l].split(":"),p=y[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),Strophe.XHTML.validCSS(p)&&(w=y[1].replace(/^\s*/,"").replace(/\s*$/,""),a.push(p+": "+w));a.length>0&&(e=a.join("; "),o.attr(h,e))}else o.attr(h,e);for(f=0;f<i.childNodes.length;f++)o.append(n.createHtml(i.childNodes[f],r,u))}catch(b){Candy.Core.log("[Util:createHtml] Error while parsing XHTML:");Candy.Core.log(b);o=Strophe.xmlTextNode("")}else for(o=Strophe.xmlGenerator().createDocumentFragment(),f=0;f<i.childNodes.length;f++)o.appendChild(n.createHtml(i.childNodes[f],r,u));else if(i.nodeType===Strophe.ElementType.FRAGMENT)for(o=Strophe.xmlGenerator().createDocumentFragment(),f=0;f<i.childNodes.length;f++)o.appendChild(n.createHtml(i.childNodes[f],r,u));else i.nodeType===Strophe.ElementType.TEXT&&(s=i.nodeValue,u+=s.length,r&&u>r&&(s=s.substring(0,r)),s=Candy.Util.Parser.all(s),o=t.parseHTML(s));return o},n}(Candy.Util||{},jQuery);Candy.Core.Action=function(n,t,i){return n.Jabber={Version:function(n){Candy.Core.getConnection().sendIQ($iq({type:"result",to:Candy.Util.escapeJid(n.attr("from")),from:Candy.Util.escapeJid(n.attr("to")),id:n.attr("id")}).c("query",{name:Candy.about.name,version:Candy.about.version,os:navigator.userAgent}))},SetNickname:function(n,t){t=t instanceof Array?t:Candy.Core.getRooms();var r,u,f=Candy.Core.getConnection();i.each(t,function(t){r=Candy.Util.escapeJid(t+"/"+n);u=$pres({to:r,from:f.jid,id:"pres:"+f.getUniqueId()});Candy.Core.getConnection().send(u)})},Roster:function(){Candy.Core.getConnection().sendIQ($iq({type:"get",xmlns:t.NS.CLIENT}).c("query",{xmlns:t.NS.ROSTER}).tree())},Presence:function(n,t){var i=Candy.Core.getConnection(),r;n=n||{};n.id||(n.id="pres:"+i.getUniqueId());r=$pres(n).c("priority").t(Candy.Core.getOptions().presencePriority.toString()).up().c("c",i.caps.generateCapsAttrs()).up();t&&r.node.appendChild(t.node);i.send(r.tree())},Services:function(){Candy.Core.getConnection().sendIQ($iq({type:"get",xmlns:t.NS.CLIENT}).c("query",{xmlns:t.NS.DISCO_ITEMS}).tree())},Autojoin:function(){if(Candy.Core.getOptions().autojoin===!0){Candy.Core.getConnection().sendIQ($iq({type:"get",xmlns:t.NS.CLIENT}).c("query",{xmlns:t.NS.PRIVATE}).c("storage",{xmlns:t.NS.BOOKMARKS}).tree());var r=Candy.Core.getConnection().getUniqueId("pubsub");Candy.Core.addHandler(Candy.Core.Event.Jabber.Bookmarks,t.NS.PUBSUB,"iq","result",r);Candy.Core.getConnection().sendIQ($iq({type:"get",id:r}).c("pubsub",{xmlns:t.NS.PUBSUB}).c("items",{node:t.NS.BOOKMARKS}).tree())}else i.isArray(Candy.Core.getOptions().autojoin)?i.each(Candy.Core.getOptions().autojoin,function(){n.Jabber.Room.Join.apply(null,this.valueOf().split(":",2))}):i(Candy).triggerHandler("candy:core.autojoin-missing")},ResetIgnoreList:function(){Candy.Core.getConnection().sendIQ($iq({type:"set",from:Candy.Core.getUser().getEscapedJid()}).c("query",{xmlns:t.NS.PRIVACY}).c("list",{name:"ignore"}).c("item",{action:"allow",order:"0"}).tree())},RemoveIgnoreList:function(){Candy.Core.getConnection().sendIQ($iq({type:"set",from:Candy.Core.getUser().getEscapedJid()}).c("query",{xmlns:t.NS.PRIVACY}).c("list",{name:"ignore"}).tree())},GetIgnoreList:function(){var n=$iq({type:"get",from:Candy.Core.getUser().getEscapedJid()}).c("query",{xmlns:t.NS.PRIVACY}).c("list",{name:"ignore"}).tree(),i=Candy.Core.getConnection().sendIQ(n);Candy.Core.addHandler(Candy.Core.Event.Jabber.PrivacyList,null,"iq",null,i)},SetIgnoreListActive:function(){Candy.Core.getConnection().sendIQ($iq({type:"set",from:Candy.Core.getUser().getEscapedJid()}).c("query",{xmlns:t.NS.PRIVACY}).c("active",{name:"ignore"}).tree())},GetJidIfAnonymous:function(){Candy.Core.getUser().getJid()||(Candy.Core.debug("[Jabber] Anonymous login"),Candy.Core.getUser().data.jid=Candy.Core.getConnection().jid)},Room:{Join:function(i,r){n.Jabber.Room.Disco(i);i=Candy.Util.escapeJid(i);var u=Candy.Core.getConnection(),e=i+"/"+Candy.Core.getUser().getNick(),f=$pres({to:e,id:"pres:"+u.getUniqueId()}).c("x",{xmlns:t.NS.MUC});r&&f.c("password").t(r);f.up().c("c",u.caps.generateCapsAttrs());u.send(f.tree())},Leave:function(n){var i=Candy.Core.getRoom(n),t;i&&(t=i.getUser(),t&&(n=Candy.Util.escapeJid(n),Candy.Core.getConnection().muc.leave(n,t.getNick(),function(){})))},Disco:function(n){Candy.Core.getConnection().sendIQ($iq({type:"get",from:Candy.Core.getUser().getEscapedJid(),to:Candy.Util.escapeJid(n)}).c("query",{xmlns:t.NS.DISCO_INFO}).tree())},Message:function(n,r,u,f){if(r=i.trim(r),r==="")return!1;var e=null;return u==="chat"&&(e=t.getResourceFromJid(n),n=t.getBareJidFromJid(n)),Candy.Core.getConnection().muc.message(n,e,r,f,u),!0},Invite:function(n,r,u,f){u=i.trim(u);var o=$msg({to:n}),e=o.c("x",{xmlns:t.NS.MUC_USER});i.each(r,function(n,i){i=t.getBareJidFromJid(i);e.c("invite",{to:i});typeof u!="undefined"&&u!==""&&e.c("reason",u)});typeof f!="undefined"&&f!==""&&e.c("password",f);Candy.Core.getConnection().send(o)},IgnoreUnignore:function(n){Candy.Core.getUser().addToOrRemoveFromPrivacyList("ignore",n);Candy.Core.Action.Jabber.Room.UpdatePrivacyList()},UpdatePrivacyList:function(){var t=Candy.Core.getUser(),n=$iq({type:"set",from:t.getEscapedJid()}).c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"ignore"}),r=t.getPrivacyList("ignore");r.length>0?i.each(r,function(t,i){n.c("item",{type:"jid",value:Candy.Util.escapeJid(i),action:"deny",order:t}).c("message").up().up()}):n.c("item",{action:"allow",order:"0"});Candy.Core.getConnection().sendIQ(n.tree())},Admin:{UserAction:function(n,i,r,u){n=Candy.Util.escapeJid(n);i=Candy.Util.escapeJid(i);var f={nick:t.getResourceFromJid(i)};switch(r){case"kick":f.role="none";break;case"ban":f.affiliation="outcast";break;default:return!1}return Candy.Core.getConnection().sendIQ($iq({type:"set",from:Candy.Core.getUser().getEscapedJid(),to:n}).c("query",{xmlns:t.NS.MUC_ADMIN}).c("item",f).c("reason").t(u).tree()),!0},SetSubject:function(n,t){Candy.Core.getConnection().muc.setTopic(Candy.Util.escapeJid(n),t)}}}},n}(Candy.Core.Action||{},Strophe,jQuery);Candy.Core.ChatRoom=function(n){this.room={jid:n,name:Strophe.getNodeFromJid(n)};this.user=null;this.roster=new Candy.Core.ChatRoster;this.setUser=function(n){this.user=n;Candy.Core.updateCache()};this.getUser=function(){return this.user};this.getJid=function(){return this.room.jid};this.setName=function(n){this.room.name=n;Candy.Core.updateCache()};this.getName=function(){return this.room.name};this.setRoster=function(n){this.roster=n;Candy.Core.updateCache()};this.getRoster=function(){return this.roster}};Candy.Core.ChatRoster=function(){this.items={};this.add=function(n){this.items[n.getJid()]=n};this.remove=function(n){delete this.items[n]};this.get=function(n){return this.items[n]};this.getAll=function(){return this.items}};Candy.Core.ChatUser=function(n,t,i,r){this.ROLE_MODERATOR="moderator";this.AFFILIATION_OWNER="owner";this.data={jid:n,nick:Strophe.unescapeNode(t),affiliation:i,role:r,privacyLists:{},customData:{},previousNick:undefined};this.getJid=function(){if(this.data.jid)return Candy.Util.unescapeJid(this.data.jid)};this.getEscapedJid=function(){return Candy.Util.escapeJid(this.data.jid)};this.setJid=function(n){this.data.jid=n};this.getNick=function(n){var t=Strophe.unescapeNode(this.data.nick);return n&&t.lastIndexOf("_")>0?t.substring(0,t.lastIndexOf("_")):t};this.setNick=function(n){this.data.nick=n};this.getRole=function(){return this.data.role};this.setRole=function(n){this.data.role=n};this.setAffiliation=function(n){this.data.affiliation=n};this.getAffiliation=function(){return this.data.affiliation};this.isModerator=function(){return this.getRole()===this.ROLE_MODERATOR||this.getAffiliation()===this.AFFILIATION_OWNER};this.addToOrRemoveFromPrivacyList=function(n,t){this.data.privacyLists[n]||(this.data.privacyLists[n]=[]);var i=-1;return(i=this.data.privacyLists[n].indexOf(t))!==-1?this.data.privacyLists[n].splice(i,1):this.data.privacyLists[n].push(t),this.data.privacyLists[n]};this.getPrivacyList=function(n){return this.data.privacyLists[n]||(this.data.privacyLists[n]=[]),this.data.privacyLists[n]};this.setPrivacyLists=function(n){this.data.privacyLists=n};this.isInPrivacyList=function(n,t){return this.data.privacyLists[n]?this.data.privacyLists[n].indexOf(t)!==-1:!1};this.setCustomData=function(n){this.data.customData=n};this.getCustomData=function(){return this.data.customData};this.setPreviousNick=function(n){this.data.previousNick=n};this.getPreviousNick=function(){return this.data.previousNick}};Candy.Core.Event=function(n,t,i){return n.Login=function(n){i(Candy).triggerHandler("candy:core.login",{presetJid:n})},n.Strophe={Connect:function(n){Candy.Core.setStropheStatus(n);switch(n){case t.Status.CONNECTED:Candy.Core.log("[Connection] Connected");Candy.Core.Action.Jabber.GetJidIfAnonymous();Candy.Core.updateCache();case t.Status.ATTACHED:Candy.Core.log("[Connection] Attached");Candy.Core.Action.Jabber.Presence();break;case t.Status.DISCONNECTED:Candy.Core.log("[Connection] Disconnected");break;case t.Status.AUTHFAIL:Candy.Core.log("[Connection] Authentication failed");Candy.Core.clearCache();break;case t.Status.CONNECTING:Candy.Core.log("[Connection] Connecting");break;case t.Status.DISCONNECTING:Candy.Core.log("[Connection] Disconnecting");Candy.Core.clearCache();break;case t.Status.AUTHENTICATING:Candy.Core.log("[Connection] Authenticating");break;case t.Status.ERROR:case t.Status.CONNFAIL:Candy.Core.log("[Connection] Failed ("+n+")");Candy.Core.clearCache();break;default:Candy.Core.log("[Connection] What?!");Candy.Core.clearCache()}i(Candy).triggerHandler("candy:core.chat.connection",{status:n})}},n.Jabber={Version:function(n){return Candy.Core.debug("[Jabber] Version"),Candy.Core.Action.Jabber.Version(i(n)),!0},Presence:function(r){return Candy.Core.debug("[Jabber] Presence"),r=i(r),r.children('x[xmlns^="'+t.NS.MUC+'"]').length>0?r.attr("type")==="error"?n.Jabber.Room.PresenceError(r):n.Jabber.Room.Presence(r):i(Candy).triggerHandler("candy:core.presence",{from:r.attr("from"),stanza:r}),!0},Bookmarks:function(n){return Candy.Core.debug("[Jabber] Bookmarks"),i("conference",n).each(function(){var n=i(this);n.attr("autojoin")&&Candy.Core.Action.Jabber.Room.Join(n.attr("jid"))}),!0},PrivacyList:function(t){Candy.Core.debug("[Jabber] PrivacyList");var r=Candy.Core.getUser();return(t=i(t),t.attr("type")==="result")?(i('list[name="ignore"] item',t).each(function(){var n=i(this);n.attr("action")==="deny"&&r.addToOrRemoveFromPrivacyList("ignore",n.attr("value"))}),Candy.Core.Action.Jabber.SetIgnoreListActive(),!1):n.Jabber.PrivacyListError(t)},PrivacyListError:function(n){return i('error[code="503"][type="cancel"] service-unavailable',n)?!1:(Candy.Core.log("[Jabber] PrivacyListError"),i('error[code="404"][type="cancel"] item-not-found',n)&&(Candy.Core.Action.Jabber.ResetIgnoreList(),Candy.Core.Action.Jabber.SetIgnoreListActive()),!1)},Message:function(r){var o,e;Candy.Core.debug("[Jabber] Message");r=i(r);var f=r.attr("from"),u=r.attr("type")||"undefined",s=r.attr("to");if(u==="normal"||u==="undefined"){if(o=r.find("invite"),e=r.find('x[xmlns="jabber:x:conference"]'),o.length>0){var h=r.find("password"),c=null,l=o.find("continue"),a=null;h&&(c=h.text());l&&(a=l.attr("thread"));i(Candy).triggerHandler("candy:core:chat:invite",{roomJid:f,from:o.attr("from")||"undefined",reason:o.find("reason")||"",password:c,continuedThread:a,inviteType:"MediatedInvite"})}return e.length>0&&i(Candy).triggerHandler("candy:core:chat:invite",{roomJid:e.attr("jid"),from:f,reason:e.attr("reason")||"",password:e.attr("password"),continuedThread:e.attr("thread"),inviteType:"DirectInvite"}),i(Candy).triggerHandler("candy:core:chat:message:normal",{type:u||"normal",message:r}),!0}return u!=="groupchat"&&u!=="chat"&&u!=="error"&&u!=="headline"?(i(Candy).triggerHandler("candy:core:chat:message:other",{type:u,message:r}),!0):(f!==t.getDomainFromJid(f)&&(u==="groupchat"||u==="chat"||u==="error")?n.Jabber.Room.Message(r):s||f!==t.getDomainFromJid(f)?s&&f===t.getDomainFromJid(f)&&i(Candy).triggerHandler("candy:core.chat.message.server",{type:u||"message",subject:r.children("subject").text(),message:r.children("body").text()}):i(Candy).triggerHandler("candy:core.chat.message.admin",{type:u||"message",message:r.children("body").text()}),!0)},Room:{Leave:function(n){var f,r,o,c;if(Candy.Core.debug("[Jabber:Room] Leave"),n=i(n),f=Candy.Util.unescapeJid(n.attr("from")),r=t.getBareJidFromJid(f),!Candy.Core.getRoom(r))return!0;var l=Candy.Core.getRoom(r).getName(),u=n.find("item"),e="leave",s,h;return delete Candy.Core.getRooms()[r],Candy.Core.updateCache(),u.attr("role")==="none"&&(o=n.find("status").attr("code"),o==="307"?e="kick":o==="301"&&(e="ban"),s=u.find("reason").text(),h=u.find("actor").attr("jid")),c=new Candy.Core.ChatUser(f,t.getResourceFromJid(f),u.attr("affiliation"),u.attr("role")),i(Candy).triggerHandler("candy:core.presence.leave",{roomJid:r,roomName:l,type:e,reason:s,actor:h,user:c}),!0},Disco:function(n){var r,u,e,f;return(Candy.Core.debug("[Jabber:Room] Disco"),n=i(n),!n.find('identity[category="conference"]').length)?!0:(r=t.getBareJidFromJid(Candy.Util.unescapeJid(n.attr("from"))),Candy.Core.getRooms()[r]||(Candy.Core.getRooms()[r]=new Candy.Core.ChatRoom(r)),u=n.find("identity"),u.length&&(e=u.attr("name"),f=Candy.Core.getRoom(r),f.getName()===null&&f.setName(t.unescapeNode(e))),Candy.Core.updateCache(),!0)},Presence:function(r){var a,d,g,w,e,v,o,s,u,c,h,nt,tt;Candy.Core.debug("[Jabber:Room] Presence");var f=Candy.Util.unescapeJid(r.attr("from")),l=t.getBareJidFromJid(f),b=r.attr("type"),y=r.find("status"),k=!1,p=!1;if(y.length)for(a=0,d=y.length;a<d;a++)g=i(y[a]),w=g.attr("code"),w==="303"?p=!0:w==="210"&&(k=!0);return(e=Candy.Core.getRoom(l),e||(Candy.Core.getRooms()[l]=new Candy.Core.ChatRoom(l),e=Candy.Core.getRoom(l)),v=e.getUser()?e.getUser():Candy.Core.getUser(),t.getResourceFromJid(f)===v.getNick()&&b==="unavailable"&&p===!1)?(n.Jabber.Room.Leave(r),!0):(o=e.getRoster(),h=r.find("item"),b!=="unavailable"?o.get(f)?(u=o.get(f),nt=h.attr("role"),tt=h.attr("affiliation"),u.setRole(nt),u.setAffiliation(tt),s="join"):(c=t.getResourceFromJid(f),u=new Candy.Core.ChatUser(f,c,h.attr("affiliation"),h.attr("role")),e.getUser()===null&&(Candy.Core.getUser().getNick()===c||k)&&(e.setUser(u),v=u),o.add(u),s="join"):(u=o.get(f),o.remove(f),p?(c=h.attr("nick"),s="nickchange",u.setPreviousNick(u.getNick()),u.setNick(c),u.setJid(t.getBareJidFromJid(f)+"/"+c),o.add(u)):(s="leave",h.attr("role")==="none"&&(r.find("status").attr("code")==="307"?s="kick":r.find("status").attr("code")==="301"&&(s="ban")))),i(Candy).triggerHandler("candy:core.presence.room",{roomJid:l,roomName:e.getName(),user:u,action:s,currentUser:v}),Candy.Core.updateCache(),!0)},PresenceError:function(n){Candy.Core.log("[Jabber:Room] Presence Error");var f=Candy.Util.unescapeJid(n.attr("from")),r=t.getBareJidFromJid(f),u=Candy.Core.getRooms()[r],e=u&&u.getName()||null;return Candy.Core.removeRoom(r),u=undefined,i(Candy).triggerHandler("candy:core.presence.error",{msg:n,type:n.children("error").children()[0].tagName.toLowerCase(),roomJid:r,roomName:e}),!0},Message:function(n){var r,u,o,c,l,e,p,a,s,h,f,v,w,y,b;if(Candy.Core.debug("[Jabber:Room] Message"),n.children("subject").length>0&&n.children("subject").text().length>0&&n.attr("type")==="groupchat")r=Candy.Util.unescapeJid(t.getBareJidFromJid(n.attr("from"))),u={name:t.getNodeFromJid(r),body:n.children("subject").text(),type:"subject"};else if(n.attr("type")==="error")c=n.children("error"),c.children("text").length>0&&(r=n.attr("from"),u={type:"info",body:c.children("text").text()});else{if(n.children("composing").length>0||n.children("inactive").length>0||n.children("paused").length>0||n.children("gone").length>0)return l=Candy.Util.unescapeJid(n.attr("from")),r=t.getBareJidFromJid(l),o=t.getResourceFromJid(l),n.children("active").length>0?e="active":n.children("composing").length>0?e="composing":n.children("paused").length>0?e="paused":n.children("inactive").length>0?e="inactive":n.children("gone").length>0&&(e="gone"),i(Candy).triggerHandler("candy:core.message.chatstate",{name:o,displayName:Candy.Util.getDisplayName(o),roomJid:r,chatstate:e}),!0;if(n.children("body").length>=0){if(n.attr("type")==="chat"||n.attr("type")==="normal")r=Candy.Util.unescapeJid(n.attr("from")),p=t.getBareJidFromJid(r),a=!Candy.Core.getRoom(p),o=a?t.getNodeFromJid(r):t.getResourceFromJid(r),u={name:o,body:n.children("body").text(),type:n.attr("type"),isNoConferenceRoomJid:a};else if(r=Candy.Util.unescapeJid(t.getBareJidFromJid(n.attr("from"))),s=t.getResourceFromJid(n.attr("from")),s)s=t.unescapeNode(s),u={name:s,body:n.children("body").text(),type:n.attr("type")};else{if(!Candy.View.Pane.Chat.rooms[n.attr("from")])return!0;u={name:"",body:n.children("body").text(),type:"info"}}for(h=[],f=0;f<n[0].attributes.length;f++)h.push(n[0].attributes[f]);for(u.attributes={},f=0;f<h.length;f++)u.attributes[h[f].name]=h[f].value;v=n.children('html[xmlns="'+t.NS.XHTML_IM+'"]');Candy.View.getOptions().enableXHTML===!0&&v.length>0&&(w=v.children('body[xmlns="'+t.NS.XHTML+'"]').first().html(),u.xhtmlMessage=w)}else return!0}return y=n.children("delay")?n.children("delay"):n.children('x[xmlns="'+t.NS.DELAY+'"]'),b=y!==undefined?y.attr("stamp"):null,i(Candy).triggerHandler("candy:core.message",{roomJid:r,message:u,timestamp:b}),!0}}},n}(Candy.Core.Event||{},Strophe,jQuery);Candy.View.Observer=function(n,t){var i=!0;return n.Chat={Connection:function(n,r){var f="candy:view.connection.status-"+r.status,u;if(t(Candy).triggerHandler(f)===!1)return!1;switch(r.status){case Strophe.Status.CONNECTING:case Strophe.Status.AUTHENTICATING:Candy.View.Pane.Chat.Modal.show(t.i18n._("statusConnecting"),!1,!0);break;case Strophe.Status.ATTACHED:case Strophe.Status.CONNECTED:i===!0&&(Candy.View.Pane.Chat.Modal.show(t.i18n._("statusConnected")),Candy.View.Pane.Chat.Modal.hide());break;case Strophe.Status.DISCONNECTING:Candy.View.Pane.Chat.Modal.show(t.i18n._("statusDisconnecting"),!1,!0);break;case Strophe.Status.DISCONNECTED:u=Candy.Core.isAnonymousConnection()?Strophe.getDomainFromJid(Candy.Core.getUser().getJid()):null;Candy.View.Pane.Chat.Modal.showLoginForm(t.i18n._("statusDisconnected"),u);break;case Strophe.Status.AUTHFAIL:Candy.View.Pane.Chat.Modal.showLoginForm(t.i18n._("statusAuthfail"));break;default:Candy.View.Pane.Chat.Modal.show(t.i18n._("status",r.status))}},Message:function(n,t){if(t.type==="message")Candy.View.Pane.Chat.adminMessage(t.subject||"",t.message);else if(t.type==="chat"||t.type==="groupchat")Candy.View.Pane.Chat.onInfoMessage(Candy.View.getCurrent().roomJid,t.subject||"",t.message)}},n.Presence={update:function(n,i){if(i.type==="leave"||i.type==="kick"||i.type==="ban"){var r={type:i.type,reason:i.reason,roomJid:i.roomJid,user:i.user};t(Candy).triggerHandler("candy:view.presence",[r])}else if(i.roomJid){if(!i.user)return!1;if(i.roomJid=Candy.Util.unescapeJid(i.roomJid),!Candy.View.Pane.Chat.rooms[i.roomJid]){if(Candy.View.Pane.Room.init(i.roomJid,i.roomName)===!1)return!1;t("#chat-rooms").children().length===1&&Candy.View.Pane.Room.show(i.roomJid)}Candy.View.Pane.Roster.update(i.roomJid,i.user,i.action,i.currentUser);Candy.View.Pane.Chat.rooms[i.user.getJid()]&&i.action!=="nickchange"&&(Candy.View.Pane.Roster.update(i.user.getJid(),i.user,i.action,i.currentUser),Candy.View.Pane.PrivateRoom.setStatus(i.user.getJid(),i.action))}},notifyPrivateChats:function(n,t){Candy.Core.log("[View:Observer] notify Private Chats");for(var i in Candy.View.Pane.Chat.rooms)Candy.View.Pane.Chat.rooms.hasOwnProperty(i)&&Candy.View.Pane.Room.getUser(i)&&n.getJid()===Candy.View.Pane.Room.getUser(i).getJid()&&(Candy.View.Pane.Roster.update(i,n,t,n),Candy.View.Pane.PrivateRoom.setStatus(i,t))}},n.PresenceError=function(n,i){switch(i.type){case"not-authorized":var r;i.msg.children("x").children("password").length>0&&(r=t.i18n._("passwordEnteredInvalid",[i.roomName]));Candy.View.Pane.Chat.Modal.showEnterPasswordForm(i.roomJid,i.roomName,r);break;case"conflict":Candy.View.Pane.Chat.Modal.showNicknameConflictForm(i.roomJid);break;case"registration-required":Candy.View.Pane.Chat.Modal.showError("errorMembersOnly",[i.roomName]);break;case"service-unavailable":Candy.View.Pane.Chat.Modal.showError("errorMaxOccupantsReached",[i.roomName])}},n.Message=function(n,t){Candy.View.Pane.Chat.rooms[t.roomJid]||(Candy.View.Pane.Room.init(t.roomJid,t.message.name),Candy.View.Pane.Room.setUser(t.roomJid,Candy.Core.getUser()),Candy.View.Pane.Room.show(t.roomJid));t.message.type==="subject"?Candy.View.Pane.Room.setSubject(t.roomJid,t.message.body):t.message.type==="info"?Candy.View.Pane.Chat.infoMessage(t.roomJid,t.message.body):(t.message.type!=="chat"||Candy.View.Pane.Chat.rooms[t.roomJid]||Candy.View.Pane.PrivateRoom.open(t.roomJid,t.message.name,!1,t.message.isNoConferenceRoomJid),Candy.View.Pane.Message.show(t.roomJid,t.message.name,t.message.body,t.message.xhtmlMessage,t.timestamp,t.message.attributes))},n.Login=function(n,t){Candy.View.Pane.Chat.Modal.showLoginForm(null,t.presetJid)},n.AutojoinMissing=function(){i=!1;Candy.View.Pane.Chat.Modal.showError("errorAutojoinMissing")},n}(Candy.View.Observer||{},jQuery);Candy.View.Pane=function(n,t){return n.Window={_hasFocus:!0,_plainTitle:document.title,_unreadMessagesCount:0,autoscroll:!0,hasFocus:function(){return n.Window._hasFocus},increaseUnreadMessages:function(){n.Window.renderUnreadMessages(++n.Window._unreadMessagesCount)},reduceUnreadMessages:function(t){n.Window._unreadMessagesCount-=t;n.Window._unreadMessagesCount<=0?n.Window.clearUnreadMessages():n.Window.renderUnreadMessages(n.Window._unreadMessagesCount)},clearUnreadMessages:function(){n.Window._unreadMessagesCount=0;document.title=n.Window._plainTitle},renderUnreadMessages:function(t){document.title=Candy.View.Template.Window.unreadmessages.replace("{{count}}",t).replace("{{title}}",n.Window._plainTitle)},onFocus:function(){n.Window._hasFocus=!0;Candy.View.getCurrent().roomJid&&(n.Room.setFocusToForm(Candy.View.getCurrent().roomJid),n.Chat.clearUnreadMessages(Candy.View.getCurrent().roomJid))},onBlur:function(){n.Window._hasFocus=!1}},n.Chat={rooms:[],addTab:function(i,r,u){var e=Candy.Util.jidToId(i),o=Mustache.to_html(Candy.View.Template.Chat.tab,{roomJid:i,roomId:e,name:r||Strophe.getNodeFromJid(i),privateUserChat:function(){return u==="chat"},roomType:u}),f=t(o).appendTo("#chat-tabs");f.click(n.Chat.tabClick);t("a.close",f).click(n.Chat.tabClose);n.Chat.clearUnreadMessages(i);n.Chat.fitTabs()},getTab:function(n){return t("#chat-tabs").children('li[data-roomjid="'+n+'"]')},removeTab:function(t){n.Chat.getTab(t).remove();n.Chat.fitTabs()},setActiveTab:function(n){t("#chat-tabs").children().each(function(){var i=t(this);i.attr("data-roomjid")===n?i.addClass("active"):i.removeClass("active")})},increaseUnreadMessages:function(t){var i=this.getTab(t).find(".unread");i.show().text(i.text()!==""?parseInt(i.text(),10)+1:1);n.Chat.rooms[t].type==="chat"&&n.Window.increaseUnreadMessages()},clearUnreadMessages:function(t){var i=n.Chat.getTab(t).find(".unread");n.Window.reduceUnreadMessages(i.text());i.hide().text("")},tabClick:function(i){var r=Candy.View.getCurrent().roomJid;n.Chat.rooms[r].scrollPosition=n.Room.getPane(r,".message-pane-wrapper").scrollTop();n.Room.show(t(this).attr("data-roomjid"));i.preventDefault()},tabClose:function(){var i=t(this).parent().attr("data-roomjid");return n.Chat.rooms[i].type==="chat"?n.Room.close(i):Candy.Core.Action.Jabber.Room.Leave(i),!1},allTabsClosed:function(){n.Chat.Toolbar.hide();Candy.Core.getOptions().disconnectWithoutTabs&&Candy.Core.disconnect()},fitTabs:function(){var i=t("#chat-tabs").innerWidth(),r=0,n=t("#chat-tabs").children(),u,f;n.each(function(){r+=t(this).css({width:"auto",overflow:"visible"}).outerWidth(!0)});r>i&&(u=n.outerWidth(!0)-n.width(),f=Math.floor(i/n.length)-u,n.css({width:f,overflow:"hidden"}))},adminMessage:function(i,r){if(Candy.View.getCurrent().roomJid){var u=Mustache.to_html(Candy.View.Template.Chat.adminMessage,{subject:i,message:r,sender:t.i18n._("administratorMessageSubject"),time:Candy.Util.localizedTime((new Date).toGMTString())});t("#chat-rooms").children().each(function(){n.Room.appendToMessagePane(t(this).attr("data-roomjid"),u)});t(Candy).triggerHandler("candy:view.chat.admin-message",{subject:i,message:r})}},infoMessage:function(t,i,r){n.Chat.onInfoMessage(t,i,r)},onInfoMessage:function(i,r,u){if(Candy.View.Pane.Room.getPane(i)){var f=Mustache.to_html(Candy.View.Template.Chat.infoMessage,{subject:r,message:t.i18n._(u),time:Candy.Util.localizedTime((new Date).toGMTString())});n.Room.appendToMessagePane(i,f)}},Toolbar:{_supportsNativeAudio:null,init:function(){t("#emoticons-icon").click(function(t){n.Chat.Context.showEmoticonsMenu(t.currentTarget);t.stopPropagation()});t("#chat-autoscroll-control").click(n.Chat.Toolbar.onAutoscrollControlClick);try{if(!!document.createElement("audio").canPlayType){var i=document.createElement("audio");i.canPlayType("audio/mpeg;").replace(/no/,"")?n.Chat.Toolbar._supportsNativeAudio="mp3":i.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,"")?n.Chat.Toolbar._supportsNativeAudio="ogg":!i.canPlayType('audio/mp4; codecs="mp4a.40.2"').replace(/no/,"")||(n.Chat.Toolbar._supportsNativeAudio="m4a")}}catch(r){Candy.Core.log("[View:Pane:Toolbar] init error:");Candy.Core.log(r)}t("#chat-sound-control").click(n.Chat.Toolbar.onSoundControlClick);Candy.Util.cookieExists("candy-nosound")&&t("#chat-sound-control").click();t("#chat-statusmessage-control").click(n.Chat.Toolbar.onStatusMessageControlClick);Candy.Util.cookieExists("candy-nostatusmessages")&&t("#chat-statusmessage-control").click()},show:function(){t("#chat-toolbar").show()},hide:function(){t("#chat-toolbar").hide()},update:function(i){var r=t("#chat-toolbar").find(".context"),u=n.Room.getUser(i);u&&u.isModerator()?r.show().click(function(t){n.Chat.Context.show(t.currentTarget,i);t.stopPropagation()}):r.hide();n.Chat.Toolbar.updateUsercount(n.Chat.rooms[i].usercount)},playSound:function(t){n.Chat.Toolbar.onPlaySound(t)},onPlaySound:function(i){if(Candy.View.getOptions().assets){var r=i||"new_message";try{n.Chat.Toolbar._supportsNativeAudio!==null?new Audio(Candy.View.getOptions().assets+"sfx/"+r+"."+n.Chat.Toolbar._supportsNativeAudio).play():(t("#chat-sound-control bgsound").remove(),t("<bgsound/>").attr({src:Candy.View.getOptions().assets+"sfx/"+r+".mp3",loop:1,autostart:!0}).appendTo("#chat-sound-control"))}catch(u){Candy.Core.log("[View:Pane:Toolbar] onPlaySound error:");Candy.Core.log(u)}}},onSoundControlClick:function(){var i=t("#chat-sound-control");i.hasClass("checked")?(n.Chat.Toolbar.playSound=function(){},Candy.Util.setCookie("candy-nosound","1",365)):(n.Chat.Toolbar.playSound=function(t){n.Chat.Toolbar.onPlaySound(t)},Candy.Util.deleteCookie("candy-nosound"),n.Chat.Toolbar.playSound("toggle_on"));i.toggleClass("checked")},onAutoscrollControlClick:function(){var i=t("#chat-autoscroll-control");i.hasClass("checked")?(n.Room.scrollToBottom=function(t){n.Room.onScrollToStoredPosition(t)},n.Window.autoscroll=!1):(n.Room.scrollToBottom=function(t){n.Room.onScrollToBottom(t)},n.Room.scrollToBottom(Candy.View.getCurrent().roomJid),n.Window.autoscroll=!0);i.toggleClass("checked")},onStatusMessageControlClick:function(){var i=t("#chat-statusmessage-control");i.hasClass("checked")?(n.Chat.infoMessage=function(){},Candy.Util.setCookie("candy-nostatusmessages","1",365)):(n.Chat.infoMessage=function(t,i,r){n.Chat.onInfoMessage(t,i,r)},Candy.Util.deleteCookie("candy-nostatusmessages"));i.toggleClass("checked")},updateUsercount:function(n){t("#chat-usercount").text(n)}},Modal:{show:function(i,r,u){r?n.Chat.Modal.showCloseControl():n.Chat.Modal.hideCloseControl();u?n.Chat.Modal.showSpinner():n.Chat.Modal.hideSpinner();t("#chat-modal").stop(!1,!0);t("#chat-modal-body").html(i);t("#chat-modal").fadeIn("fast");t("#chat-modal-overlay").show()},hide:function(n){t("#chat-modal").fadeOut("fast",function(){t("#chat-modal-body").text("");t("#chat-modal-overlay").hide()});t(document).keydown(function(n){n.which===27&&n.preventDefault()});n&&n()},showSpinner:function(){t("#chat-modal-spinner").show()},hideSpinner:function(){t("#chat-modal-spinner").hide()},showCloseControl:function(){t("#admin-message-cancel").show().click(function(t){n.Chat.Modal.hide();t.preventDefault()});t(document).keydown(function(t){t.which===27&&(n.Chat.Modal.hide(),t.preventDefault())})},hideCloseControl:function(){t("#admin-message-cancel").hide().click(function(){})},showLoginForm:function(i,r){n.Chat.Modal.show((i?i:"")+Mustache.to_html(Candy.View.Template.Login.form,{_labelNickname:t.i18n._("labelNickname"),_labelUsername:t.i18n._("labelUsername"),_labelPassword:t.i18n._("labelPassword"),_loginSubmit:t.i18n._("loginSubmit"),displayPassword:!Candy.Core.isAnonymousConnection(),displayUsername:!r,displayNickname:Candy.Core.isAnonymousConnection(),presetJid:r?r:!1}));t("#login-form").children(":input:first").focus();t("#login-form").submit(function(){var n=t("#username").val(),u=t("#password").val(),i;return Candy.Core.isAnonymousConnection()?Candy.Core.connect(r,null,n):(i=Candy.Core.getUser()&&n.indexOf("@")<0?n+"@"+Strophe.getDomainFromJid(Candy.Core.getUser().getJid()):n,i.indexOf("@")<0&&!Candy.Core.getUser()?Candy.View.Pane.Chat.Modal.showLoginForm(t.i18n._("loginInvalid")):Candy.Core.connect(i,u)),!1})},showEnterPasswordForm:function(i,r,u){n.Chat.Modal.show(Mustache.to_html(Candy.View.Template.PresenceError.enterPasswordForm,{roomName:r,_labelPassword:t.i18n._("labelPassword"),_label:u?u:t.i18n._("enterRoomPassword",[r]),_joinSubmit:t.i18n._("enterRoomPasswordSubmit")}),!0);t("#password").focus();t("#enter-password-form").submit(function(){var r=t("#password").val();return n.Chat.Modal.hide(function(){Candy.Core.Action.Jabber.Room.Join(i,r)}),!1})},showNicknameConflictForm:function(i){n.Chat.Modal.show(Mustache.to_html(Candy.View.Template.PresenceError.nicknameConflictForm,{_labelNickname:t.i18n._("labelNickname"),_label:t.i18n._("nicknameConflict"),_loginSubmit:t.i18n._("loginSubmit")}));t("#nickname").focus();t("#nickname-conflict-form").submit(function(){var r=t("#nickname").val();return n.Chat.Modal.hide(function(){Candy.Core.getUser().data.nick=r;Candy.Core.Action.Jabber.Room.Join(i)}),!1})},showError:function(i,r){n.Chat.Modal.show(Mustache.to_html(Candy.View.Template.PresenceError.displayError,{_error:t.i18n._(i,r)}),!0)}},Tooltip:{show:function(n,i){var r=t("#tooltip"),u=t(n.currentTarget),f;i||(i=u.attr("data-tooltip"));r.length===0&&(f=Mustache.to_html(Candy.View.Template.Chat.tooltip),t("#chat-pane").append(f),r=t("#tooltip"));t("#context-menu").hide();r.stop(!1,!0);r.children("div").html(i);var e=u.offset(),o=Candy.Util.getPosLeftAccordingToWindowBounds(r,e.left),s=Candy.Util.getPosTopAccordingToWindowBounds(r,e.top);r.css({left:o.px,top:s.px}).removeClass("left-top left-bottom right-top right-bottom").addClass(o.backgroundPositionAlignment+"-"+s.backgroundPositionAlignment).fadeIn("fast");u.mouseleave(function(n){n.stopPropagation();t("#tooltip").stop(!1,!0).fadeOut("fast",function(){t(this).css({top:0,left:0})})})}},Context:{init:function(){if(t("#context-menu").length===0){var n=Mustache.to_html(Candy.View.Template.Chat.Context.menu);t("#chat-pane").append(n);t("#context-menu").mouseleave(function(){t(this).fadeOut("fast")})}},show:function(i,r,u){var o,e,h,s,c;i=t(i);var y=n.Chat.rooms[r].id,f=t("#context-menu"),p=t("ul li",f);t("#tooltip").hide();u||(u=Candy.Core.getUser());p.remove();o=this.getMenuLinks(r,u,i);h=function(n,i){return function(r){r.data.callback(r,n,i);t("#context-menu").hide()}};for(e in o)o.hasOwnProperty(e)&&(s=o[e],c=Mustache.to_html(Candy.View.Template.Chat.Context.menulinks,{roomId:y,"class":s["class"],id:e,label:s.label}),t("ul",f).append(c),t("#context-menu-"+e).bind("click",s,h(r,u)));if(e){var l=i.offset(),a=Candy.Util.getPosLeftAccordingToWindowBounds(f,l.left),v=Candy.Util.getPosTopAccordingToWindowBounds(f,l.top);return f.css({left:a.px,top:v.px}).removeClass("left-top left-bottom right-top right-bottom").addClass(a.backgroundPositionAlignment+"-"+v.backgroundPositionAlignment).fadeIn("fast"),t(Candy).triggerHandler("candy:view.roster.after-context-menu",{roomJid:r,user:u,element:f}),!0}},getMenuLinks:function(i,r,u){var f,e,o={roomJid:i,user:r,elem:u,menulinks:this.initialMenuLinks(u)};t(Candy).triggerHandler("candy:view.roster.context-menu",o);f=o.menulinks;for(e in f)f.hasOwnProperty(e)&&f[e].requiredPermission!==undefined&&!f[e].requiredPermission(r,n.Room.getUser(i),u)&&delete f[e];return f},initialMenuLinks:function(){return{"private":{requiredPermission:function(n,t){return t.getNick()!==n.getNick()&&Candy.Core.getRoom(Candy.View.getCurrent().roomJid)&&!Candy.Core.getUser().isInPrivacyList("ignore",n.getJid())},"class":"private",label:t.i18n._("privateActionLabel"),callback:function(n,i,r){t("#user-"+Candy.Util.jidToId(i)+"-"+Candy.Util.jidToId(r.getJid())).click()}},ignore:{requiredPermission:function(n,t){return t.getNick()!==n.getNick()&&!Candy.Core.getUser().isInPrivacyList("ignore",n.getJid())},"class":"ignore",label:t.i18n._("ignoreActionLabel"),callback:function(n,t,i){Candy.View.Pane.Room.ignoreUser(t,i.getJid())}},unignore:{requiredPermission:function(n,t){return t.getNick()!==n.getNick()&&Candy.Core.getUser().isInPrivacyList("ignore",n.getJid())},"class":"unignore",label:t.i18n._("unignoreActionLabel"),callback:function(n,t,i){Candy.View.Pane.Room.unignoreUser(t,i.getJid())}},kick:{requiredPermission:function(n,t){return t.getNick()!==n.getNick()&&t.isModerator()&&!n.isModerator()},"class":"kick",label:t.i18n._("kickActionLabel"),callback:function(i,r,u){n.Chat.Modal.show(Mustache.to_html(Candy.View.Template.Chat.Context.contextModalForm,{_label:t.i18n._("reason"),_submit:t.i18n._("kickActionLabel")}),!0);t("#context-modal-field").focus();t("#context-modal-form").submit(function(){return Candy.Core.Action.Jabber.Room.Admin.UserAction(r,u.getJid(),"kick",t("#context-modal-field").val()),n.Chat.Modal.hide(),!1})}},ban:{requiredPermission:function(n,t){return t.getNick()!==n.getNick()&&t.isModerator()&&!n.isModerator()},"class":"ban",label:t.i18n._("banActionLabel"),callback:function(i,r,u){n.Chat.Modal.show(Mustache.to_html(Candy.View.Template.Chat.Context.contextModalForm,{_label:t.i18n._("reason"),_submit:t.i18n._("banActionLabel")}),!0);t("#context-modal-field").focus();t("#context-modal-form").submit(function(){return Candy.Core.Action.Jabber.Room.Admin.UserAction(r,u.getJid(),"ban",t("#context-modal-field").val()),n.Chat.Modal.hide(),!1})}},subject:{requiredPermission:function(n,t){return t.getNick()===n.getNick()&&t.isModerator()},"class":"subject",label:t.i18n._("setSubjectActionLabel"),callback:function(i,r){n.Chat.Modal.show(Mustache.to_html(Candy.View.Template.Chat.Context.contextModalForm,{_label:t.i18n._("subject"),_submit:t.i18n._("setSubjectActionLabel")}),!0);t("#context-modal-field").focus();t("#context-modal-form").submit(function(i){Candy.Core.Action.Jabber.Room.Admin.SetSubject(r,t("#context-modal-field").val());n.Chat.Modal.hide();i.preventDefault()})}}}},showEmoticonsMenu:function(n){var f,e;n=t(n);var o=n.offset(),r=t("#context-menu"),s=t("ul",r),u="",i;for(t("#tooltip").hide(),i=Candy.Util.Parser.emoticons.length-1;i>=0;i--)u='<img src="'+Candy.Util.Parser._emoticonPath+Candy.Util.Parser.emoticons[i].image+'" alt="'+Candy.Util.Parser.emoticons[i].plain+'" />'+u;return s.html('<li class="emoticons">'+u+"<\/li>"),s.find("img").click(function(){var n=Candy.View.Pane.Room.getPane(Candy.View.getCurrent().roomJid,".message-form").children(".field"),i=n.val(),r=t(this).attr("alt")+" ";n.val(i?i+" "+r:r).focus()}),f=Candy.Util.getPosLeftAccordingToWindowBounds(r,o.left),e=Candy.Util.getPosTopAccordingToWindowBounds(r,o.top),r.css({left:f.px,top:e.px}).removeClass("left-top left-bottom right-top right-bottom").addClass(f.backgroundPositionAlignment+"-"+e.backgroundPositionAlignment).fadeIn("fast"),!0}}},n.Room={init:function(i,r,u){var f,e;return(u=u||"groupchat",i=Candy.Util.unescapeJid(i),f={roomJid:i,type:u},t(Candy).triggerHandler("candy:view.room.before-add",f)===!1)?!1:(Candy.Util.isEmptyObject(n.Chat.rooms)&&n.Chat.Toolbar.show(),e=Candy.Util.jidToId(i),n.Chat.rooms[i]={id:e,usercount:0,name:r,type:u,messageCount:0,scrollPosition:-1},t("#chat-rooms").append(Mustache.to_html(Candy.View.Template.Room.pane,{roomId:e,roomJid:i,roomType:u,form:{_messageSubmit:t.i18n._("messageSubmit")},roster:{_userOnline:t.i18n._("userOnline")}},{roster:Candy.View.Template.Roster.pane,messages:Mustache.to_html(Candy.View.Template.Message.pane,{},{header:Candy.View.Template.Message.header}),form:Candy.View.Template.Room.form})),n.Chat.addTab(i,r,u),n.Room.getPane(i,".message-form").submit(n.Message.submit),f.element=n.Room.getPane(i),t(Candy).triggerHandler("candy:view.room.after-add",f),n.Chat.Toolbar.playSound("new_chat"),e)},show:function(i){var u=n.Chat.rooms[i].id,r;t(".room-pane").each(function(){var f=t(this);r={roomJid:f.attr("data-roomjid"),element:f};f.attr("id")==="chat-room-"+u?(f.show(),Candy.View.getCurrent().roomJid=i,n.Chat.setActiveTab(i),n.Chat.Toolbar.update(i),n.Chat.clearUnreadMessages(i),n.Room.setFocusToForm(i),n.Room.scrollToBottom(i),t(Candy).triggerHandler("candy:view.room.after-show",r)):f.is(":visible")&&(f.hide(),t(Candy).triggerHandler("candy:view.room.after-hide",r))})},setSubject:function(i,r){r=Candy.Util.Parser.linkify(Candy.Util.Parser.escape(r));var u=Mustache.to_html(Candy.View.Template.Room.subject,{subject:r,roomName:n.Chat.rooms[i].name,_roomSubject:t.i18n._("roomSubject"),time:Candy.Util.localizedTime((new Date).toGMTString())});n.Room.appendToMessagePane(i,u);t(Candy).triggerHandler("candy:view.room.after-subject-change",{roomJid:i,element:n.Room.getPane(i),subject:r})},close:function(i){n.Chat.removeTab(i);n.Window.clearUnreadMessages();n.Room.getPane(i).remove();var r=t("#chat-rooms").children();Candy.View.getCurrent().roomJid===i&&(Candy.View.getCurrent().roomJid=null,r.length===0?n.Chat.allTabsClosed():n.Room.show(r.last().attr("data-roomjid")));delete n.Chat.rooms[i];t(Candy).triggerHandler("candy:view.room.after-close",{roomJid:i})},insertInMessagePane:function(i,r,u,f){var e=!1,o=n.Room.getPane(i,".message-pane");o.children('li[data-id="'+u+'"]').length>0||(o.children().each(function(){var n=t(this);if(Number(f)<Number(n.attr("data-seqid")))return n.before(r),e=!0,!1}),e||n.Room.getPane(i,".message-pane").append(r))},appendToMessagePane:function(t,i){n.Room.getPane(t,".message-pane").append(i);n.Chat.rooms[t].messageCount++;n.Room.sliceMessagePane(t);Candy.View.getCurrent().roomJid===t&&n.Room.scrollToBottom(t)},sliceMessagePane:function(t){if(n.Window.autoscroll){var i=Candy.View.getOptions().messages;n.Chat.rooms[t].messageCount>i.limit&&(n.Room.getPane(t,".message-pane").children().slice(0,i.remove).remove(),n.Chat.rooms[t].messageCount-=i.remove)}},scrollToBottom:function(t){n.Room.onScrollToBottom(t)},onScrollToBottom:function(t){var i=n.Room.getPane(t,".message-pane-wrapper");i.scrollTop(i.prop("scrollHeight"))},onScrollToStoredPosition:function(t){if(n.Chat.rooms[t].scrollPosition>-1){var i=n.Room.getPane(t,".message-pane-wrapper");i.scrollTop(n.Chat.rooms[t].scrollPosition);n.Chat.rooms[t].scrollPosition=-1}},setFocusToForm:function(t){var i=n.Room.getPane(t,".message-form");if(i)try{i.children(".field")[0].focus()}catch(r){}},setUser:function(i,r){n.Chat.rooms[i].user=r;var f=n.Room.getPane(i),u=t("#chat-pane");f.attr("data-userjid",r.getJid());r.isModerator()?(r.getRole()===r.ROLE_MODERATOR&&u.addClass("role-moderator"),r.getAffiliation()===r.AFFILIATION_OWNER&&u.addClass("affiliation-owner")):u.removeClass("role-moderator affiliation-owner");n.Chat.Context.init()},getUser:function(t){return n.Chat.rooms[t].user},ignoreUser:function(n,t){Candy.Core.Action.Jabber.Room.IgnoreUnignore(t);Candy.View.Pane.Room.addIgnoreIcon(n,t)},unignoreUser:function(n,t){Candy.Core.Action.Jabber.Room.IgnoreUnignore(t);Candy.View.Pane.Room.removeIgnoreIcon(n,t)},addIgnoreIcon:function(n,i){Candy.View.Pane.Chat.rooms[i]&&t("#user-"+Candy.View.Pane.Chat.rooms[i].id+"-"+Candy.Util.jidToId(i)).addClass("status-ignored");Candy.View.Pane.Chat.rooms[Strophe.getBareJidFromJid(n)]&&t("#user-"+Candy.View.Pane.Chat.rooms[Strophe.getBareJidFromJid(n)].id+"-"+Candy.Util.jidToId(i)).addClass("status-ignored")},removeIgnoreIcon:function(n,i){Candy.View.Pane.Chat.rooms[i]&&t("#user-"+Candy.View.Pane.Chat.rooms[i].id+"-"+Candy.Util.jidToId(i)).removeClass("status-ignored");Candy.View.Pane.Chat.rooms[Strophe.getBareJidFromJid(n)]&&t("#user-"+Candy.View.Pane.Chat.rooms[Strophe.getBareJidFromJid(n)].id+"-"+Candy.Util.jidToId(i)).removeClass("status-ignored")},getPane:function(i,r){if(n.Chat.rooms[i])return r?n.Chat.rooms[i]["pane-"+r]?n.Chat.rooms[i]["pane-"+r]:(n.Chat.rooms[i]["pane-"+r]=t("#chat-room-"+n.Chat.rooms[i].id).find(r),n.Chat.rooms[i]["pane-"+r]):t("#chat-room-"+n.Chat.rooms[i].id)},changeDataUserJidIfUserIsMe:function(n,i){if(i.getNick()===Candy.Core.getUser().getNick()){var r=t("#chat-room-"+n);r.attr("data-userjid",Strophe.getBareJidFromJid(r.attr("data-userjid"))+"/"+i.getNick())}}},n.PrivateRoom={open:function(i,r,u,f){var e=f?Candy.Core.getUser():n.Room.getUser(Strophe.getBareJidFromJid(i)),o={roomJid:i,roomName:r,type:"chat"};if(t(Candy).triggerHandler("candy:view.private-room.before-open",o)===!1||Candy.Core.getUser().isInPrivacyList("ignore",i)||!n.Chat.rooms[i]&&n.Room.init(i,r,"chat")===!1)return!1;u&&n.Room.show(i);n.Roster.update(i,new Candy.Core.ChatUser(i,r),"join",e);n.Roster.update(i,e,"join",e);n.PrivateRoom.setStatus(i,"join");f&&n.Chat.infoMessage(i,t.i18n._("presenceUnknownWarningSubject"),t.i18n._("presenceUnknownWarning"));o.element=n.Room.getPane(i);t(Candy).triggerHandler("candy:view.private-room.after-open",o)},setStatus:function(t,i){var r=n.Room.getPane(t,".message-form");i==="join"?(n.Chat.getTab(t).addClass("online").removeClass("offline"),r.children(".field").removeAttr("disabled"),r.children(".submit").removeAttr("disabled"),n.Chat.getTab(t)):i==="leave"&&(n.Chat.getTab(t).addClass("offline").removeClass("online"),r.children(".field").attr("disabled",!0),r.children(".submit").attr("disabled",!0))},changeNick:function(i,r){Candy.Core.log("[View:Pane:PrivateRoom] changeNick");var e=i+"/"+r.getPreviousNick(),f=i+"/"+r.getNick(),s=Candy.Util.jidToId(e),c=Candy.Util.jidToId(f),o=n.Chat.rooms[e],u,h;n.Chat.rooms[f]&&n.Room.close(f);o?(o.name=r.getNick(!0),o.id=c,n.Chat.rooms[f]=o,delete n.Chat.rooms[e],u=t("#chat-room-"+s),u&&(u.attr("data-roomjid",f),u.attr("id","chat-room-"+c),h=t('#chat-tabs li[data-roomjid="'+e+'"]'),h.attr("data-roomjid",f),h.children("a.label").text("@"+r.getNick(!0)),Candy.View.getCurrent().roomJid===e&&(Candy.View.getCurrent().roomJid=f))):(u=t('.room-pane.roomtype-chat[data-userjid="'+e+'"]'),u.length&&(s=Candy.Util.jidToId(u.attr("data-roomjid")),u.attr("data-userjid",f)));u&&u.length&&n.Roster.changeNick(s,r)}},n.Roster={update:function(i,r,u,f){var h,v,c,y,p;Candy.Core.log("[View:Pane:Roster] "+u);var e=n.Chat.rooms[i].id,o=Candy.Util.jidToId(r.getJid()),s=-1,l=t("#user-"+e+"-"+o),a={roomJid:i,user:r,action:u,element:l};if(t(Candy).triggerHandler("candy:view.roster.before-update",a),u==="join")s=1,h=Mustache.to_html(Candy.View.Template.Roster.user,{roomId:e,userId:o,userJid:r.getJid(),nick:r.getNick(),displayNick:Candy.Util.crop(r.getNick(!0),Candy.View.getOptions().crop.roster.nickname),role:r.getRole(),affiliation:r.getAffiliation(),me:f!==undefined&&r.getNick()===f.getNick(),tooltipRole:t.i18n._("tooltipRole"),tooltipIgnored:t.i18n._("tooltipIgnored")}),l.length<1?(v=!1,c=n.Room.getPane(i,".roster-pane"),c.children().length>0&&(y=r.getNick().toUpperCase(),c.children().each(function(){var n=t(this);return n.attr("data-nick").toUpperCase()>y?(n.before(h),v=!0,!1):!0})),v||c.append(h),n.Roster.showJoinAnimation(r,o,e,i,f),n.Roster.showJoinMessage(r,o,e,i,f)):(s=0,l.replaceWith(h),t("#user-"+e+"-"+o).css({opacity:1}).show(),f!==undefined&&r.getNick()===f.getNick()&&n.Room.getUser(i)&&n.Chat.Toolbar.update(i)),f!==undefined&&f.getNick()===r.getNick()?n.Room.setUser(i,r):t("#user-"+e+"-"+o).click(n.Roster.userClick),t("#user-"+e+"-"+o+" .context").click(function(t){n.Chat.Context.show(t.currentTarget,i,r);t.stopPropagation()}),f!==undefined&&f.isInPrivacyList("ignore",r.getJid())&&Candy.View.Pane.Room.addIgnoreIcon(i,r.getJid());else if(u==="leave"||u==="kick"||u==="ban")if(n.Roster.leaveAnimation("user-"+e+"-"+o),n.Chat.rooms[i].type==="chat")n.Chat.onInfoMessage(i,t.i18n._("userLeftRoom",[r.getNick(!0)]));else n.Chat.infoMessage(i,t.i18n._("userLeftRoom",[r.getNick(!0)]));else if(u==="nickchange"){s=0;n.Roster.changeNick(e,r);n.Room.changeDataUserJidIfUserIsMe(e,r);n.PrivateRoom.changeNick(i,r);p=t.i18n._("userChangedNick",[r.getPreviousNick(),r.getNick(!0)]);n.Chat.onInfoMessage(i,p)}Candy.View.Pane.Chat.rooms[i].usercount+=s;i===Candy.View.getCurrent().roomJid&&Candy.View.Pane.Chat.Toolbar.updateUsercount(Candy.View.Pane.Chat.rooms[i].usercount);a.element=t("#user-"+e+"-"+o);t(Candy).triggerHandler("candy:view.roster.after-update",a)},userClick:function(){var i=t(this);n.PrivateRoom.open(i.attr("data-jid"),i.attr("data-nick"),!0)},showJoinAnimation:function(i,r,u){var f="user-"+u+"-"+r,e=t("#"+f);i.getPreviousNick()&&e&&e.is(":visible")!==!1||n.Roster.joinAnimation(f)},showJoinMessage:function(i,r,u,f,e){if(!i.getPreviousNick()&&e!==undefined&&i.getNick()!==e.getNick()&&!i.isModerator())n.Chat.onInfoMessage(f,t.i18n._("userJoinedRoom",[i.getNick(!0)]))},joinAnimation:function(n){t("#"+n).stop(!0).slideDown("normal",function(){t(this).animate({opacity:1})})},leaveAnimation:function(n){t("#"+n).stop(!0).attr("id","#"+n+"-leaving").animate({opacity:0},{complete:function(){t(this).slideUp("normal",function(){t(this).remove()})}})},changeNick:function(n,i){Candy.Core.log("[View:Pane:Roster] changeNick");var u=Strophe.getBareJidFromJid(i.getJid())+"/"+i.getPreviousNick(),f="user-"+n+"-"+Candy.Util.jidToId(u),r=t("#"+f);r.attr("data-nick",i.getNick());r.attr("data-jid",i.getJid());r.children("div.label").text(i.getNick());r.attr("id","user-"+n+"-"+Candy.Util.jidToId(i.getJid()))}},n.Message={submit:function(i){var r=Candy.View.getCurrent().roomJid,o=Candy.View.Pane.Chat.rooms[r].type,u=t(this).children(".field").val().substring(0,Candy.View.getOptions().crop.message.body),f,e={roomJid:r,message:u,xhtmlMessage:f};if(t(Candy).triggerHandler("candy:view.message.before-send",e)===!1){i.preventDefault();return}u=e.message;f=e.xhtmlMessage;Candy.Core.Action.Jabber.Room.Message(r,u,o,f);o==="chat"&&u&&n.Message.show(r,n.Room.getUser(r).getNick(!0),u);t(this).children(".field").val("").trigger("change").focus();i.preventDefault()},show:function(i,r,u,f,e,o){var v=u,h,s,a,p;if(u=Candy.Util.Parser.all(u.substring(0,Candy.View.getOptions().crop.message.body)),f&&(f=Candy.Util.parseAndCropXhtml(f,Candy.View.getOptions().crop.message.body)),h=!!e,s={roomJid:i,name:r,rawMessage:v,attributes:o,message:u,xhtmlMessage:f,history:h},t(Candy).triggerHandler("candy:view.message.before-show",s)!==!1){u=s.message;f=s.xhtmlMessage;f!==undefined&&f.length>0&&(u=f);var c=new Date,y=n.Room.getUser(i),w=y&&y.getNick(),l={rawMessage:v,attributes:o,template:Candy.View.Template.Message.item,templateData:{name:r,displayName:Candy.Util.getDisplayName(r),croppedDisplayName:Candy.Util.crop(Candy.Util.getDisplayName(r),Candy.View.getOptions().crop.message.nickname),message:u,time:Candy.Util.localizedTime(e||c.toGMTString()),timestamp:e||c.toISOString(),stamp:(e&&new Date(e)||c).valueOf(),id:o.id||"",seqId:o.seqId||0x8000000000000,roomJid:i,sender:r===w?"sender-is-me":"sender-is-other"},history:h};t(Candy).triggerHandler("candy:view.message.before-render",l)!==!1&&(a=Mustache.to_html(l.template,l.templateData),h?n.Room.insertInMessagePane(i,a,o.id,o.seqId):(n.Room.appendToMessagePane(i,a),Candy.View.getCurrent().roomJid===i&&n.Window.hasFocus()||(n.Chat.increaseUnreadMessages(i),n.Chat.Toolbar.playSound("new_message"))),p=n.Room.getPane(i,".message-pane").children().last(),s.element=p,t(Candy).triggerHandler("candy:view.message.after-show",s))}}},n}(Candy.View.Pane||{},jQuery);Candy.View.Template=function(n){return n.Window={unreadmessages:"({{count}}) {{title}}"},n.Chat={pane:'<div id="chat-pane">{{> tabs}}{{> toolbar}}{{> rooms}}<\/div>{{> modal}}',rooms:'<div id="chat-rooms" class="rooms"><\/div>',tabs:'<ul id="chat-tabs"><\/ul>',tab:'<li class="roomtype-{{roomType}}" data-roomjid="{{roomJid}}" data-roomtype="{{roomType}}"><a href="#" class="label">{{#privateUserChat}}@{{/privateUserChat}}{{name}}<\/a><small class="transfer"><\/small><small class="unread"><\/small><\/li>',modal:'<div id="chat-modal"><a id="admin-message-cancel" class="close" href="#">×<\/a><span id="chat-modal-body"><\/span><span id="chat-modal-spinner-wrapper"><div id="chat-modal-spinner" /><\/span><\/div><div id="chat-modal-overlay"><\/div>',adminMessage:'<li><small data-stamp="{{stamp}}">{{time}}<\/small><div class="adminmessage"><span class="label">{{sender}}<\/span><span class="spacer">▸<\/span><span class="message">{{subject}} {{message}}<\/span><\/div><\/li>',infoMessage:'<li><small data-stamp="{{stamp}}">{{time}}<\/small><div class="infomessage"><span class="spacer">•<\/span><span class="message">{{subject}} {{message}}<\/span><\/div><\/li>',stateMessage:'<li name="chat-state-message"><div class="statemessage">{{subject}} {{message}}<\/div><\/li>',toolbar:'<ul id="chat-toolbar"><li id="emoticons-icon" data-tooltip="{{tooltipEmoticons}}"><\/li><li id="chat-sound-control" class="checked" data-tooltip="{{tooltipSound}}"><\/li><li id="chat-autoscroll-control" class="checked" data-tooltip="{{tooltipAutoscroll}}"><\/li><li class="checked" id="chat-statusmessage-control" data-tooltip="{{tooltipStatusmessage}}"><\/li><li class="context" data-tooltip="{{tooltipAdministration}}"><\/li><li class="usercount" data-tooltip="{{tooltipUsercount}}"><span id="chat-usercount"><\/span><\/li><\/ul>',Context:{menu:'<div id="context-menu"><i class="arrow arrow-top"><\/i><ul><\/ul><i class="arrow arrow-bottom"><\/i><\/div>',menulinks:'<li class="{{class}}" id="context-menu-{{id}}">{{label}}<\/li>',contextModalForm:'<form action="#" id="context-modal-form"><label for="context-modal-label">{{_label}}<\/label><input type="text" name="contextModalField" id="context-modal-field" /><input type="submit" class="button" name="send" value="{{_submit}}" /><\/form>',adminMessageReason:'<a id="admin-message-cancel" class="close" href="#">×<\/a><p>{{_action}}<\/p>{{#reason}}<p>{{_reason}}<\/p>{{/reason}}'},tooltip:'<div id="tooltip"><i class="arrow arrow-top"><\/i><div><\/div><i class="arrow arrow-bottom"><\/i><\/div>'},n.Room={pane:'<div class="room-pane roomtype-{{roomType}}" id="chat-room-{{roomId}}" data-roomjid="{{roomJid}}" data-roomtype="{{roomType}}">{{> roster}}{{> messages}}{{> form}}<\/div>',subject:'<li><small data-stamp="{{stamp}}">{{time}}<\/small><div class="subject"><span class="label">{{roomName}}<\/span><span class="spacer">▸<\/span>{{_roomSubject}} {{{subject}}}<\/div><\/li>',form:'<div class="message-form-wrapper"><form method="post" class="message-form"><input name="message" class="field" type="text" aria-label="Message Form Text Field" autocomplete="off" maxlength="1000" /><input type="submit" class="submit" name="submit" value="{{_messageSubmit}}" /><\/form><\/div>'},n.Roster={pane:'<div class="roster-pane"><\/div>',user:'<div class="user role-{{role}} affiliation-{{affiliation}}{{#me}} me{{/me}}" id="user-{{roomId}}-{{userId}}" data-jid="{{userJid}}" data-nick="{{nick}}" data-role="{{role}}" data-affiliation="{{affiliation}}"><div class="label">{{displayNick}}<\/div><ul><li class="context" id="context-{{roomId}}-{{userId}}">&#x25BE;<\/li><li class="role role-{{role}} affiliation-{{affiliation}}" data-tooltip="{{tooltipRole}}"><\/li><li class="ignore" data-tooltip="{{tooltipIgnored}}"><\/li><\/ul><\/div>'},n.Message={pane:'{{> header}}<div class="message-pane-wrapper"><ul class="message-pane"><\/ul><\/div>',item:'<li class="{{sender}}" data-id="{{id}}" data-seqid="{{seqId}}"><small data-stamp="{{stamp}}">{{time}}<\/small><div><a class="label name" href="#">{{croppedDisplayName}}<\/a><span class="spacer">▸<\/span><span class="message">{{{message}}}<\/span><\/div><\/li>',header:'<div id="header"><\/div>'},n.Login={form:'<form method="post" id="login-form" class="login-form">{{#displayNickname}}<label for="username">{{_labelNickname}}<\/label><input type="text" id="username" name="username"/>{{/displayNickname}}{{#displayUsername}}<label for="username">{{_labelUsername}}<\/label><input type="text" id="username" name="username"/>{{/displayUsername}}{{#presetJid}}<input type="hidden" id="username" name="username" value="{{presetJid}}"/>{{/presetJid}}{{#displayPassword}}<label for="password">{{_labelPassword}}<\/label><input type="password" id="password" name="password" />{{/displayPassword}}<input type="submit" class="button" value="{{_loginSubmit}}" /><\/form>'},n.PresenceError={enterPasswordForm:'<strong>{{_label}}<\/strong><form method="post" id="enter-password-form" class="enter-password-form"><label for="password">{{_labelPassword}}<\/label><input type="password" id="password" name="password" /><input type="submit" class="button" value="{{_joinSubmit}}" /><\/form>',nicknameConflictForm:'<strong>{{_label}}<\/strong><form method="post" id="nickname-conflict-form" class="nickname-conflict-form"><label for="nickname">{{_labelNickname}}<\/label><input type="text" id="nickname" name="nickname" /><input type="submit" class="button" value="{{_loginSubmit}}" /><\/form>',displayError:"<strong>{{_error}}<\/strong>"},n}(Candy.View.Template||{});Candy.View.Translation={en:{status:"Status: %s",statusConnecting:"Connecting...",statusConnected:"Connected",statusDisconnecting:"Disconnecting...",statusDisconnected:"Disconnected",statusAuthfail:"Authentication failed",sessionRestored:"Session restored",roomSubject:"Subject:",messageSubmit:"Send",labelUsername:"Username:",labelNickname:"Nickname:",labelPassword:"Password:",loginSubmit:"Login",loginInvalid:"Invalid JID",reason:"Reason:",subject:"Subject:",reasonWas:"Reason was: %s.",kickActionLabel:"Kick",youHaveBeenKickedBy:"You have been kicked from %2$s by %1$s",youHaveBeenKicked:"You have been kicked from %s",banActionLabel:"Ban",youHaveBeenBannedBy:"You have been banned from %1$s by %2$s",youHaveBeenBanned:"You have been banned from %s",privateActionLabel:"Private chat",ignoreActionLabel:"Ignore",unignoreActionLabel:"Unignore",setSubjectActionLabel:"Change Subject",administratorMessageSubject:"Administrator",userJoinedRoom:"%s joined the room.",userLeftRoom:"%s left the room.",userHasBeenKickedFromRoom:"%s has been kicked from the room.",userHasBeenBannedFromRoom:"%s has been banned from the room.",userChangedNick:"%1$s has changed his nickname to %2$s.",presenceUnknownWarningSubject:"Notice:",presenceUnknownWarning:"This user might be offline. We can't track his presence.",dateFormat:"dd.mm.yyyy",timeFormat:"HH:MM:ss",tooltipRole:"Moderator",tooltipIgnored:"You ignore this user",tooltipEmoticons:"Emoticons",tooltipSound:"Play sound for new messages",tooltipAutoscroll:"Autoscroll",tooltipStatusmessage:"Display status messages",tooltipAdministration:"Room Administration",tooltipUsercount:"Room Occupants",enterRoomPassword:'Room "%s" is password protected.',enterRoomPasswordSubmit:"Join room",passwordEnteredInvalid:'Invalid password for room "%s".',nicknameConflict:"Username already in use. Please choose another one.",errorMembersOnly:'You can\'t join room "%s": Insufficient rights.',errorMaxOccupantsReached:'You can\'t join room "%s": Too many occupants.',errorAutojoinMissing:"No autojoin parameter set in configuration. Please set one to continue.",antiSpamMessage:"Please do not spam. You have been blocked for a short-time."},de:{status:"Status: %s",statusConnecting:"Verbinden...",statusConnected:"Verbunden",statusDisconnecting:"Verbindung trennen...",statusDisconnected:"Verbindung getrennt",statusAuthfail:"Authentifizierung fehlgeschlagen",sessionRestored:"Session restored",roomSubject:"Thema:",messageSubmit:"Senden",labelUsername:"Benutzername:",labelNickname:"Spitzname:",labelPassword:"Passwort:",loginSubmit:"Anmelden",loginInvalid:"Ungültige JID",reason:"Begründung:",subject:"Titel:",reasonWas:"Begründung: %s.",kickActionLabel:"Kick",youHaveBeenKickedBy:"Du wurdest soeben aus dem Raum %1$s gekickt (%2$s)",youHaveBeenKicked:"Du wurdest soeben aus dem Raum %s gekickt",banActionLabel:"Ban",youHaveBeenBannedBy:"Du wurdest soeben aus dem Raum %1$s verbannt (%2$s)",youHaveBeenBanned:"Du wurdest soeben aus dem Raum %s verbannt",privateActionLabel:"Privater Chat",ignoreActionLabel:"Ignorieren",unignoreActionLabel:"Nicht mehr ignorieren",setSubjectActionLabel:"Thema ändern",administratorMessageSubject:"Administrator",userJoinedRoom:"%s hat soeben den Raum betreten.",userLeftRoom:"%s hat soeben den Raum verlassen.",userHasBeenKickedFromRoom:"%s ist aus dem Raum gekickt worden.",userHasBeenBannedFromRoom:"%s ist aus dem Raum verbannt worden.",userChangedNick:"%1$s hat den Nicknamen zu %2$s geändert.",presenceUnknownWarningSubject:"Hinweis:",presenceUnknownWarning:"Dieser Benutzer könnte bereits abgemeldet sein. Wir können seine Anwesenheit nicht verfolgen.",dateFormat:"dd.mm.yyyy",timeFormat:"HH:MM:ss",tooltipRole:"Moderator",tooltipIgnored:"Du ignorierst diesen Benutzer",tooltipEmoticons:"Smileys",tooltipSound:"Ton abspielen bei neuen Nachrichten",tooltipAutoscroll:"Autoscroll",tooltipStatusmessage:"Statusnachrichten anzeigen",tooltipAdministration:"Raum Administration",tooltipUsercount:"Anzahl Benutzer im Raum",enterRoomPassword:'Raum "%s" ist durch ein Passwort geschützt.',enterRoomPasswordSubmit:"Raum betreten",passwordEnteredInvalid:'Inkorrektes Passwort für Raum "%s".',nicknameConflict:"Der Benutzername wird bereits verwendet. Bitte wähle einen anderen.",errorMembersOnly:'Du kannst den Raum "%s" nicht betreten: Ungenügende Rechte.',errorMaxOccupantsReached:'Du kannst den Raum "%s" nicht betreten: Benutzerlimit erreicht.',errorAutojoinMissing:'Keine "autojoin" Konfiguration gefunden. Bitte setze eine konfiguration um fortzufahren.',antiSpamMessage:"Bitte nicht spammen. Du wurdest für eine kurze Zeit blockiert."},fr:{status:"Status: %s",statusConnecting:"Connexion…",statusConnected:"Connecté.",statusDisconnecting:"Déconnexion…",statusDisconnected:"Déconnecté.",statusAuthfail:"L'authentification a échoué",sessionRestored:"Session restored",roomSubject:"Sujet:",messageSubmit:"Envoyer",labelUsername:"Nom d'utilisateur:",labelPassword:"Mot de passe:",loginSubmit:"Connexion",loginInvalid:"JID invalide",reason:"Motif:",subject:"Titre:",reasonWas:"Motif: %s.",kickActionLabel:"Kick",youHaveBeenKickedBy:"Vous avez été expulsé du salon %1$s (%2$s)",youHaveBeenKicked:"Vous avez été expulsé du salon %s",banActionLabel:"Ban",youHaveBeenBannedBy:"Vous avez été banni du salon %1$s (%2$s)",youHaveBeenBanned:"Vous avez été banni du salon %s",privateActionLabel:"Chat privé",ignoreActionLabel:"Ignorer",unignoreActionLabel:"Ne plus ignorer",setSubjectActionLabel:"Changer le sujet",administratorMessageSubject:"Administrateur",userJoinedRoom:"%s vient d'entrer dans le salon.",userLeftRoom:"%s vient de quitter le salon.",userHasBeenKickedFromRoom:"%s a été expulsé du salon.",userHasBeenBannedFromRoom:"%s a été banni du salon.",presenceUnknownWarningSubject:"Note:",presenceUnknownWarning:"Cet utilisateur n'est malheureusement plus connecté, le message ne sera pas envoyé.",dateFormat:"dd/mm/yyyy",timeFormat:"HH:MM:ss",tooltipRole:"Modérateur",tooltipIgnored:"Vous ignorez cette personne",tooltipEmoticons:"Smileys",tooltipSound:"Jouer un son lors de la réception de nouveaux messages",tooltipAutoscroll:"Défilement automatique",tooltipStatusmessage:"Messages d'état",tooltipAdministration:"Administration du salon",tooltipUsercount:"Nombre d'utilisateurs dans le salon",enterRoomPassword:'Le salon "%s" est protégé par un mot de passe.',enterRoomPasswordSubmit:"Entrer dans le salon",passwordEnteredInvalid:'Le mot de passe pour le salon "%s" est invalide.',nicknameConflict:"Le nom d'utilisateur est déjà utilisé. Veuillez en choisir un autre.",errorMembersOnly:'Vous ne pouvez pas entrer dans le salon "%s": droits insuffisants.',errorMaxOccupantsReached:'Vous ne pouvez pas entrer dans le salon "%s": Limite d\'utilisateur atteint.',antiSpamMessage:"Merci de ne pas envoyer de spam. Vous avez été bloqué pendant une courte période.."},nl:{status:"Status: %s",statusConnecting:"Verbinding maken...",statusConnected:"Verbinding is gereed",statusDisconnecting:"Verbinding verbreken...",statusDisconnected:"Verbinding is verbroken",statusAuthfail:"Authenticatie is mislukt",sessionRestored:"Session restored",roomSubject:"Onderwerp:",messageSubmit:"Verstuur",labelUsername:"Gebruikersnaam:",labelPassword:"Wachtwoord:",loginSubmit:"Inloggen",loginInvalid:"JID is onjuist",reason:"Reden:",subject:"Onderwerp:",reasonWas:"De reden was: %s.",kickActionLabel:"Verwijderen",youHaveBeenKickedBy:"Je bent verwijderd van %1$s door %2$s",youHaveBeenKicked:"Je bent verwijderd van %s",banActionLabel:"Blokkeren",youHaveBeenBannedBy:"Je bent geblokkeerd van %1$s door %2$s",youHaveBeenBanned:"Je bent geblokkeerd van %s",privateActionLabel:"Prive gesprek",ignoreActionLabel:"Negeren",unignoreActionLabel:"Niet negeren",setSubjectActionLabel:"Onderwerp wijzigen",administratorMessageSubject:"Beheerder",userJoinedRoom:"%s komt de chat binnen.",userLeftRoom:"%s heeft de chat verlaten.",userHasBeenKickedFromRoom:"%s is verwijderd.",userHasBeenBannedFromRoom:"%s is geblokkeerd.",presenceUnknownWarningSubject:"Mededeling:",presenceUnknownWarning:"Deze gebruiker is waarschijnlijk offline, we kunnen zijn/haar aanwezigheid niet vaststellen.",dateFormat:"dd.mm.yyyy",timeFormat:"HH:MM:ss",tooltipRole:"Moderator",tooltipIgnored:"Je negeert deze gebruiker",tooltipEmoticons:"Emotie-iconen",tooltipSound:"Speel een geluid af bij nieuwe berichten.",tooltipAutoscroll:"Automatisch scrollen",tooltipStatusmessage:"Statusberichten weergeven",tooltipAdministration:"Instellingen",tooltipUsercount:"Gebruikers",enterRoomPassword:'De Chatroom "%s" is met een wachtwoord beveiligd.',enterRoomPasswordSubmit:"Ga naar Chatroom",passwordEnteredInvalid:'Het wachtwoord voor de Chatroom "%s" is onjuist.',nicknameConflict:"De gebruikersnaam is reeds in gebruik. Probeer a.u.b. een andere gebruikersnaam.",errorMembersOnly:'Je kunt niet deelnemen aan de Chatroom "%s": Je hebt onvoldoende rechten.',errorMaxOccupantsReached:'Je kunt niet deelnemen aan de Chatroom "%s": Het maximum aantal gebruikers is bereikt.',antiSpamMessage:"Het is niet toegestaan om veel berichten naar de server te versturen. Je bent voor een korte periode geblokkeerd."},es:{status:"Estado: %s",statusConnecting:"Conectando...",statusConnected:"Conectado",statusDisconnecting:"Desconectando...",statusDisconnected:"Desconectado",statusAuthfail:"Falló la autenticación",sessionRestored:"Session restored",roomSubject:"Asunto:",messageSubmit:"Enviar",labelUsername:"Usuario:",labelPassword:"Clave:",loginSubmit:"Entrar",loginInvalid:"JID no válido",reason:"Razón:",subject:"Asunto:",reasonWas:"La razón fue: %s.",kickActionLabel:"Expulsar",youHaveBeenKickedBy:"Has sido expulsado de %1$s por %2$s",youHaveBeenKicked:"Has sido expulsado de %s",banActionLabel:"Prohibir",youHaveBeenBannedBy:"Has sido expulsado permanentemente de %1$s por %2$s",youHaveBeenBanned:"Has sido expulsado permanentemente de %s",privateActionLabel:"Chat privado",ignoreActionLabel:"Ignorar",unignoreActionLabel:"No ignorar",setSubjectActionLabel:"Cambiar asunto",administratorMessageSubject:"Administrador",userJoinedRoom:"%s se ha unido a la sala.",userLeftRoom:"%s ha dejado la sala.",userHasBeenKickedFromRoom:"%s ha sido expulsado de la sala.",userHasBeenBannedFromRoom:"%s ha sido expulsado permanentemente de la sala.",presenceUnknownWarningSubject:"Atención:",presenceUnknownWarning:"Éste usuario podría estar desconectado..",dateFormat:"dd.mm.yyyy",timeFormat:"HH:MM:ss",tooltipRole:"Moderador",tooltipIgnored:"Ignoras a éste usuario",tooltipEmoticons:"Emoticonos",tooltipSound:"Reproducir un sonido para nuevos mensajes",tooltipAutoscroll:"Desplazamiento automático",tooltipStatusmessage:"Mostrar mensajes de estado",tooltipAdministration:"Administración de la sala",tooltipUsercount:"Usuarios en la sala",enterRoomPassword:'La sala "%s" está protegida mediante contraseña.',enterRoomPasswordSubmit:"Unirse a la sala",passwordEnteredInvalid:'Contraseña incorrecta para la sala "%s".',nicknameConflict:"El nombre de usuario ya está siendo utilizado. Por favor elija otro.",errorMembersOnly:'No se puede unir a la sala "%s": no tiene privilegios suficientes.',errorMaxOccupantsReached:'No se puede unir a la sala "%s": demasiados participantes.',antiSpamMessage:"Por favor, no hagas spam. Has sido bloqueado temporalmente."},cn:{status:"状态: %s",statusConnecting:"连接中...",statusConnected:"已连接",statusDisconnecting:"断开连接中...",statusDisconnected:"已断开连接",statusAuthfail:"认证失败",sessionRestored:"Session restored",roomSubject:"主题:",messageSubmit:"发送",labelUsername:"用户名:",labelPassword:"密码:",loginSubmit:"登录",loginInvalid:"用户名不合法",reason:"原因:",subject:"主题:",reasonWas:"原因是: %s.",kickActionLabel:"踢除",youHaveBeenKickedBy:"你在 %1$s 被管理者 %2$s 请出房间",banActionLabel:"禁言",youHaveBeenBannedBy:"你在 %1$s 被管理者 %2$s 禁言",privateActionLabel:"单独对话",ignoreActionLabel:"忽略",unignoreActionLabel:"不忽略",setSubjectActionLabel:"变更主题",administratorMessageSubject:"管理员",userJoinedRoom:"%s 加入房间",userLeftRoom:"%s 离开房间",userHasBeenKickedFromRoom:"%s 被请出这个房间",userHasBeenBannedFromRoom:"%s 被管理者禁言",presenceUnknownWarningSubject:"注意:",presenceUnknownWarning:"这个会员可能已经下线，不能追踪到他的连接信息",dateFormat:"dd.mm.yyyy",timeFormat:"HH:MM:ss",tooltipRole:"管理",tooltipIgnored:"你忽略了这个会员",tooltipEmoticons:"表情",tooltipSound:"新消息发音",tooltipAutoscroll:"滚动条",tooltipStatusmessage:"禁用状态消息",tooltipAdministration:"房间管理",tooltipUsercount:"房间占有者",enterRoomPassword:'登录房间 "%s" 需要密码.',enterRoomPasswordSubmit:"加入房间",passwordEnteredInvalid:'登录房间 "%s" 的密码不正确',nicknameConflict:"用户名已经存在，请另选一个",errorMembersOnly:'您的权限不够，不能登录房间 "%s" ',errorMaxOccupantsReached:'房间 "%s" 的人数已达上限，您不能登录',antiSpamMessage:"因为您在短时间内发送过多的消息 服务器要阻止您一小段时间。"},ja:{status:"ステータス: %s",statusConnecting:"接続中…",statusConnected:"接続されました",statusDisconnecting:"ディスコネクト中…",statusDisconnected:"ディスコネクトされました",statusAuthfail:"認証に失敗しました",sessionRestored:"Session restored",roomSubject:"トピック：",messageSubmit:"送信",labelUsername:"ユーザーネーム：",labelPassword:"パスワード：",loginSubmit:"ログイン",loginInvalid:"ユーザーネームが正しくありません",reason:"理由：",subject:"トピック：",reasonWas:"理由: %s。",kickActionLabel:"キック",youHaveBeenKickedBy:"あなたは%2$sにより%1$sからキックされました。",youHaveBeenKicked:"あなたは%sからキックされました。",banActionLabel:"アカウントバン",youHaveBeenBannedBy:"あなたは%2$sにより%1$sからアカウントバンされました。",youHaveBeenBanned:"あなたは%sからアカウントバンされました。",privateActionLabel:"プライベートメッセージ",ignoreActionLabel:"無視する",unignoreActionLabel:"無視をやめる",setSubjectActionLabel:"トピックを変える",administratorMessageSubject:"管理者",userJoinedRoom:"%sは入室しました。",userLeftRoom:"%sは退室しました。",userHasBeenKickedFromRoom:"%sは部屋からキックされました。",userHasBeenBannedFromRoom:"%sは部屋からアカウントバンされました。",presenceUnknownWarningSubject:"忠告：",presenceUnknownWarning:"このユーザーのステータスは不明です。",dateFormat:"dd.mm.yyyy",timeFormat:"HH:MM:ss",tooltipRole:"モデレーター",tooltipIgnored:"このユーザーを無視設定にしている",tooltipEmoticons:"絵文字",tooltipSound:"新しいメッセージが届くたびに音を鳴らす",tooltipAutoscroll:"オートスクロール",tooltipStatusmessage:"ステータスメッセージを表示",tooltipAdministration:"部屋の管理",tooltipUsercount:"この部屋の参加者の数",enterRoomPassword:'"%s"の部屋に入るにはパスワードが必要です。',enterRoomPasswordSubmit:"部屋に入る",passwordEnteredInvalid:'"%s"のパスワードと異なるパスワードを入力しました。',nicknameConflict:"このユーザーネームはすでに利用されているため、別のユーザーネームを選んでください。",errorMembersOnly:'"%s"の部屋に入ることができません: 利用権限を満たしていません。',errorMaxOccupantsReached:'"%s"の部屋に入ることができません: 参加者の数はすでに上限に達しました。',antiSpamMessage:"スパムなどの行為はやめてください。あなたは一時的にブロックされました。"},sv:{status:"Status: %s",statusConnecting:"Ansluter...",statusConnected:"Ansluten",statusDisconnecting:"Kopplar från...",statusDisconnected:"Frånkopplad",statusAuthfail:"Autentisering misslyckades",sessionRestored:"Session restored",roomSubject:"Ämne:",messageSubmit:"Skicka",labelUsername:"Användarnamn:",labelPassword:"Lösenord:",loginSubmit:"Logga in",loginInvalid:"Ogiltigt JID",reason:"Anledning:",subject:"Ämne:",reasonWas:"Anledningen var: %s.",kickActionLabel:"Sparka ut",youHaveBeenKickedBy:"Du har blivit utsparkad från %2$s av %1$s",youHaveBeenKicked:"Du har blivit utsparkad från %s",banActionLabel:"Bannlys",youHaveBeenBannedBy:"Du har blivit bannlyst från %1$s av %2$s",youHaveBeenBanned:"Du har blivit bannlyst från %s",privateActionLabel:"Privat chatt",ignoreActionLabel:"Blockera",unignoreActionLabel:"Avblockera",setSubjectActionLabel:"Ändra ämne",administratorMessageSubject:"Administratör",userJoinedRoom:"%s kom in i rummet.",userLeftRoom:"%s har lämnat rummet.",userHasBeenKickedFromRoom:"%s har blivit utsparkad ur rummet.",userHasBeenBannedFromRoom:"%s har blivit bannlyst från rummet.",presenceUnknownWarningSubject:"Notera:",presenceUnknownWarning:"Denna användare kan vara offline. Vi kan inte följa dennes närvaro.",dateFormat:"yyyy-mm-dd",timeFormat:"HH:MM:ss",tooltipRole:"Moderator",tooltipIgnored:"Du blockerar denna användare",tooltipEmoticons:"Smilies",tooltipSound:"Spela upp ett ljud vid nytt meddelande",tooltipAutoscroll:"Autoskrolla",tooltipStatusmessage:"Visa statusmeddelanden",tooltipAdministration:"Rumadministrering",tooltipUsercount:"Antal användare i rummet",enterRoomPassword:'Rummet "%s" är lösenordsskyddat.',enterRoomPasswordSubmit:"Anslut till rum",passwordEnteredInvalid:'Ogiltigt lösenord för rummet "%s".',nicknameConflict:"Upptaget användarnamn. Var god välj ett annat.",errorMembersOnly:'Du kan inte ansluta till rummet "%s": Otillräckliga rättigheter.',errorMaxOccupantsReached:'Du kan inte ansluta till rummet "%s": Rummet är fullt.',antiSpamMessage:"Var god avstå från att spamma. Du har blivit blockerad för en kort stund."},it:{status:"Stato: %s",statusConnecting:"Connessione...",statusConnected:"Connessione",statusDisconnecting:"Disconnessione...",statusDisconnected:"Disconnesso",statusAuthfail:"Autenticazione fallita",sessionRestored:"Sessione ristabilita",roomSubject:"Oggetto:",messageSubmit:"Invia",labelUsername:"Nome utente:",labelPassword:"Password:",loginSubmit:"Login",loginInvalid:"JID non valido",reason:"Ragione:",subject:"Oggetto:",reasonWas:"Ragione precedente: %s.",kickActionLabel:"Espelli",youHaveBeenKickedBy:"Sei stato espulso da %2$s da %1$s",youHaveBeenKicked:"Sei stato espulso da %s",banActionLabel:"Escluso",youHaveBeenBannedBy:"Sei stato escluso da %1$s da %2$s",youHaveBeenBanned:"Sei stato escluso da %s",privateActionLabel:"Stanza privata",ignoreActionLabel:"Ignora",unignoreActionLabel:"Non ignorare",setSubjectActionLabel:"Cambia oggetto",administratorMessageSubject:"Amministratore",userJoinedRoom:"%s si è unito alla stanza.",userLeftRoom:"%s ha lasciato la stanza.",userHasBeenKickedFromRoom:"%s è stato espulso dalla stanza.",userHasBeenBannedFromRoom:"%s è stato escluso dalla stanza.",presenceUnknownWarningSubject:"Nota:",presenceUnknownWarning:"Questo utente potrebbe essere offline. Non possiamo tracciare la sua presenza.",dateFormat:"dd/mm/yyyy",timeFormat:"HH:MM:ss",tooltipRole:"Moderatore",tooltipIgnored:"Stai ignorando questo utente",tooltipEmoticons:"Emoticons",tooltipSound:"Riproduci un suono quando arrivano messaggi",tooltipAutoscroll:"Autoscroll",tooltipStatusmessage:"Mostra messaggi di stato",tooltipAdministration:"Amministrazione stanza",tooltipUsercount:"Partecipanti alla stanza",enterRoomPassword:'La stanza "%s" è protetta da password.',enterRoomPasswordSubmit:"Unisciti alla stanza",passwordEnteredInvalid:'Password non valida per la stanza "%s".',nicknameConflict:"Nome utente già in uso. Scegline un altro.",errorMembersOnly:'Non puoi unirti alla stanza "%s": Permessi insufficienti.',errorMaxOccupantsReached:'Non puoi unirti alla stanza "%s": Troppi partecipanti.',antiSpamMessage:"Per favore non scrivere messaggi pubblicitari. Sei stato bloccato per un po' di tempo."},pt:{status:"Status: %s",statusConnecting:"Conectando...",statusConnected:"Conectado",statusDisconnecting:"Desligando...",statusDisconnected:"Desligado",statusAuthfail:"Falha na autenticação",sessionRestored:"Session restored",roomSubject:"Assunto:",messageSubmit:"Enviar",labelUsername:"Usuário:",labelPassword:"Senha:",loginSubmit:"Entrar",loginInvalid:"JID inválido",reason:"Motivo:",subject:"Assunto:",reasonWas:"O motivo foi: %s.",kickActionLabel:"Excluir",youHaveBeenKickedBy:"Você foi excluido de %1$s por %2$s",youHaveBeenKicked:"Você foi excluido de %s",banActionLabel:"Bloquear",youHaveBeenBannedBy:"Você foi excluido permanentemente de %1$s por %2$s",youHaveBeenBanned:"Você foi excluido permanentemente de %s",privateActionLabel:"Bate-papo privado",ignoreActionLabel:"Ignorar",unignoreActionLabel:"Não ignorar",setSubjectActionLabel:"Trocar Assunto",administratorMessageSubject:"Administrador",userJoinedRoom:"%s entrou na sala.",userLeftRoom:"%s saiu da sala.",userHasBeenKickedFromRoom:"%s foi excluido da sala.",userHasBeenBannedFromRoom:"%s foi excluido permanentemente da sala.",presenceUnknownWarning:"Este usuário pode estar desconectado. Não é possível determinar o status.",dateFormat:"dd.mm.yyyy",timeFormat:"HH:MM:ss",tooltipRole:"Moderador",tooltipIgnored:"Você ignora este usuário",tooltipEmoticons:"Emoticons",tooltipSound:"Reproduzir o som para novas mensagens",tooltipAutoscroll:"Deslocamento automático",tooltipStatusmessage:"Mostrar mensagens de status",tooltipAdministration:"Administração da sala",tooltipUsercount:"Usuários na sala",enterRoomPassword:'A sala "%s" é protegida por senha.',enterRoomPasswordSubmit:"Junte-se à sala",passwordEnteredInvalid:'Senha incorreta para a sala "%s".',nicknameConflict:"O nome de usuário já está em uso. Por favor, escolha outro.",errorMembersOnly:'Você não pode participar da sala "%s":  privilégios insuficientes.',errorMaxOccupantsReached:'Você não pode participar da sala "%s": muitos participantes.',antiSpamMessage:"Por favor, não envie spam. Você foi bloqueado temporariamente."},pt_br:{status:"Estado: %s",statusConnecting:"Conectando...",statusConnected:"Conectado",statusDisconnecting:"Desconectando...",statusDisconnected:"Desconectado",statusAuthfail:"Autenticação falhou",sessionRestored:"Session restored",roomSubject:"Assunto:",messageSubmit:"Enviar",labelUsername:"Usuário:",labelPassword:"Senha:",loginSubmit:"Entrar",loginInvalid:"JID inválido",reason:"Motivo:",subject:"Assunto:",reasonWas:"Motivo foi: %s.",kickActionLabel:"Derrubar",youHaveBeenKickedBy:"Você foi derrubado de %2$s por %1$s",youHaveBeenKicked:"Você foi derrubado de %s",banActionLabel:"Banir",youHaveBeenBannedBy:"Você foi banido de %1$s por %2$s",youHaveBeenBanned:"Você foi banido de %s",privateActionLabel:"Conversa privada",ignoreActionLabel:"Ignorar",unignoreActionLabel:"Não ignorar",setSubjectActionLabel:"Mudar Assunto",administratorMessageSubject:"Administrador",userJoinedRoom:"%s entrou na sala.",userLeftRoom:"%s saiu da sala.",userHasBeenKickedFromRoom:"%s foi derrubado da sala.",userHasBeenBannedFromRoom:"%s foi banido da sala.",presenceUnknownWarningSubject:"Aviso:",presenceUnknownWarning:"Este usuário pode estar desconectado.. Não conseguimos rastrear sua presença..",dateFormat:"dd.mm.yyyy",timeFormat:"HH:MM:ss",tooltipRole:"Moderador",tooltipIgnored:"Você ignora este usuário",tooltipEmoticons:"Emoticons",tooltipSound:"Tocar som para novas mensagens",tooltipAutoscroll:"Auto-rolagem",tooltipStatusmessage:"Exibir mensagens de estados",tooltipAdministration:"Administração de Sala",tooltipUsercount:"Participantes da Sala",enterRoomPassword:'Sala "%s" é protegida por senha.',enterRoomPasswordSubmit:"Entrar na sala",passwordEnteredInvalid:'Senha inváida para sala "%s".',nicknameConflict:"Nome de usuário já em uso. Por favor escolha outro.",errorMembersOnly:'Você não pode entrar na sala "%s": privilégios insuficientes.',errorMaxOccupantsReached:'Você não pode entrar na sala "%s": máximo de participantes atingido.',antiSpamMessage:"Por favor, não faça spam. Você foi bloqueado temporariamente."},ru:{status:"Статус: %s",statusConnecting:"Подключение...",statusConnected:"Подключено",statusDisconnecting:"Отключение...",statusDisconnected:"Отключено",statusAuthfail:"Неверный логин",sessionRestored:"Session restored",roomSubject:"Топик:",messageSubmit:"Послать",labelUsername:"Имя:",labelPassword:"Пароль:",loginSubmit:"Логин",loginInvalid:"Неверный JID",reason:"Причина:",subject:"Топик:",reasonWas:"Причина была: %s.",kickActionLabel:"Выбросить",youHaveBeenKickedBy:"Пользователь %1$s выбросил вас из чата %2$s",youHaveBeenKicked:"Вас выбросили из чата %s",banActionLabel:"Запретить доступ",youHaveBeenBannedBy:"Пользователь %1$s запретил вам доступ в чат %2$s",youHaveBeenBanned:"Вам запретили доступ в чат %s",privateActionLabel:"Один-на-один чат",ignoreActionLabel:"Игнорировать",unignoreActionLabel:"Отменить игнорирование",setSubjectActionLabel:"Изменить топик",administratorMessageSubject:"Администратор",userJoinedRoom:"%s вошёл в чат.",userLeftRoom:"%s вышел из чата.",userHasBeenKickedFromRoom:"%s выброшен из чата.",userHasBeenBannedFromRoom:"%s запрещён доступ в чат.",presenceUnknownWarningSubject:"Уведомление:",presenceUnknownWarning:"Этот пользователь вероятнее всего оффлайн.",dateFormat:"mm.dd.yyyy",timeFormat:"HH:MM:ss",tooltipRole:"Модератор",tooltipIgnored:"Вы игнорируете этого пользователя.",tooltipEmoticons:"Смайлики",tooltipSound:"Озвучивать новое сообщение",tooltipAutoscroll:"Авто-прокручивание",tooltipStatusmessage:"Показывать статус сообщения",tooltipAdministration:"Администрирование чат комнаты",tooltipUsercount:"Участники чата",enterRoomPassword:'Чат комната "%s" защищена паролем.',enterRoomPasswordSubmit:"Войти в чат",passwordEnteredInvalid:'Неверный пароль для комнаты "%s".',nicknameConflict:"Это имя уже используется. Пожалуйста выберите другое имя.",errorMembersOnly:'Вы не можете войти в чат "%s": Недостаточно прав доступа.',errorMaxOccupantsReached:'Вы не можете войти в чат "%s": Слишком много участников.',antiSpamMessage:"Пожалуйста не рассылайте спам. Вас заблокировали на короткое время."},ca:{status:"Estat: %s",statusConnecting:"Connectant...",statusConnected:"Connectat",statusDisconnecting:"Desconnectant...",statusDisconnected:"Desconnectat",statusAuthfail:"Ha fallat la autenticació",sessionRestored:"Session restored",roomSubject:"Assumpte:",messageSubmit:"Enviar",labelUsername:"Usuari:",labelPassword:"Clau:",loginSubmit:"Entrar",loginInvalid:"JID no vàlid",reason:"Raó:",subject:"Assumpte:",reasonWas:"La raó ha estat: %s.",kickActionLabel:"Expulsar",youHaveBeenKickedBy:"Has estat expulsat de %1$s per %2$s",youHaveBeenKicked:"Has estat expulsat de %s",banActionLabel:"Prohibir",youHaveBeenBannedBy:"Has estat expulsat permanentment de %1$s per %2$s",youHaveBeenBanned:"Has estat expulsat permanentment de %s",privateActionLabel:"Xat privat",ignoreActionLabel:"Ignorar",unignoreActionLabel:"No ignorar",setSubjectActionLabel:"Canviar assumpte",administratorMessageSubject:"Administrador",userJoinedRoom:"%s ha entrat a la sala.",userLeftRoom:"%s ha deixat la sala.",userHasBeenKickedFromRoom:"%s ha estat expulsat de la sala.",userHasBeenBannedFromRoom:"%s ha estat expulsat permanentment de la sala.",presenceUnknownWarningSubject:"Atenció:",presenceUnknownWarning:"Aquest usuari podria estar desconnectat ...",dateFormat:"dd.mm.yyyy",timeFormat:"HH:MM:ss",tooltipRole:"Moderador",tooltipIgnored:"Estàs ignorant aquest usuari",tooltipEmoticons:"Emoticones",tooltipSound:"Reproduir un so per a nous missatges",tooltipAutoscroll:"Desplaçament automàtic",tooltipStatusmessage:"Mostrar missatges d'estat",tooltipAdministration:"Administració de la sala",tooltipUsercount:"Usuaris dins la sala",enterRoomPassword:'La sala "%s" està protegida amb contrasenya.',enterRoomPasswordSubmit:"Entrar a la sala",passwordEnteredInvalid:'Contrasenya incorrecta per a la sala "%s".',nicknameConflict:"El nom d'usuari ja s'està utilitzant. Si us plau, escolleix-ne un altre.",errorMembersOnly:'No pots unir-te a la sala "%s": no tens prous privilegis.',errorMaxOccupantsReached:'No pots unir-te a la sala "%s": hi ha masses participants.',antiSpamMessage:"Si us plau, no facis spam. Has estat bloquejat temporalment."}},function(){if(!window.Candy)throw Ifm.Diagnostics.Errors.miss("Candy");Candy.View.Translation.en.labelNickname="Your name:";Candy.View.Translation.en.loginSubmit="Enter chat";Candy.View.Translation.en.userJoinedRoom="%s has entered the conversation.";Candy.View.Translation.en.userLeftRoom="%s has left the conversation.";Candy.View.Translation.it.labelNickname="Il tuo nome:";Candy.View.Translation.it.loginSubmit="Entra in chat";Candy.View.Translation.it.userJoinedRoom="%s è entrato nella conversazione.";Candy.View.Translation.it.userLeftRoom="%s ha lasciato la conversazione.";var n=Candy.View.Pane.Chat.onInfoMessage;Candy.View.Pane.Chat.onInfoMessage=function(t,i,r){if(Candy.View.Pane.Room.getPane(t)){var u=Candy.View.Pane.Room.getPane(t,".message-pane").children().last().text();u.indexOf(i)<0&&u.indexOf(r)<0&&n(t,i,r)}};Candy.Core.isConnected=function(){return Candy.Core.getConnection().connected};Candy.Core.getUsername=function(){return Candy.Core.getUser().getNick()};Candy.Core.getRoomUserByName=function(n,t){var u=Candy.Core.getRoom(n),i,r;if(u){i=u.roster.getAll();for(r in i)if(Strophe.getResourceFromJid(i[r].getJid())===t)return i[r]}return null};Candy.Core.available=function(n){var t=$pres({from:Candy.Core.getConnection().jid,to:n});Ifm.Diagnostics.Debug.print("[Candy] [Extensions] sending availability to",n);Candy.Core.getConnection().send(t)};Candy.Core.subscribe=function(n,t,i){var u="pres:"+Candy.Core.getConnection().getUniqueId(),r=$pres({from:Candy.Core.getConnection().jid,to:n,id:u,type:"subscribe"});t&&r.c("nick",{xmlns:"http://jabber.org/protocol/nick"},t);i&&r.c("status",{},i);Ifm.Diagnostics.Debug.print("[Candy] [Extensions] requesting subscription to",n,"(id",u,")",t?"as "+t:"");Candy.Core.getConnection().send(r)};Candy.Core.subscribed=function(n,t){var i=t||"pres:"+Candy.Core.getConnection().getUniqueId(),r=$pres({from:Candy.Core.getConnection().jid,to:n,id:i,type:"subscribed"});Ifm.Diagnostics.Debug.print("[Candy] [Extensions] replying subscription to",n,"(id",i,")");Candy.Core.getConnection().send(r)};Candy.Core.notifystate=function(n,t){var i=$msg({from:Candy.Core.getConnection().jid,to:n,type:"groupchat"}).c(t,{xmlns:"http://jabber.org/protocol/chatstates"});Ifm.Diagnostics.Debug.print("[Candy] [Extensions] sending",t,"notification");Candy.Core.getConnection().send(i)};Candy.View.deletenotification=function(n){var i=Candy.View.Pane.Room.getPane(n),r,t;i&&(r=Candy.View.Pane.Room.getPane(n,".message-pane"),t=i.data(),t.resetnotificationtmr&&(clearTimeout(t.resetnotificationtmr),t.resetnotificationtmr=0),r.find("[name=chat-state-message]").remove())};Candy.View.movenotification=function(n){if(Candy.View.Pane.Room.getPane(n)){var t=Candy.View.Pane.Room.getPane(n,".message-pane"),i=t.find("[name=chat-state-message]");i.length&&t.append(i)}};Candy.View.updatenotification=function(n,t,i,r){var u,f;Candy.View.deletenotification(n);u=Candy.View.Pane.Room.getPane(n);u&&(f=Mustache.to_html(Candy.View.Template.Chat.stateMessage,{subject:t,message:r}),Candy.View.Pane.Room.appendToMessagePane(n,f),u.data({resetnotificationtmr:setTimeout(function(){Candy.View.deletenotification(n)},1e4)}))};window.Candies=window.Candies||{};Candies.appendToMessagePane=function(n,t,i,r){r=r||"";var u=new Date,f=Candy.View.Template.Message.item,e={name:r,displayName:Candy.Util.getDisplayName(r),croppedDisplayName:Candy.Util.crop(Candy.Util.getDisplayName(r),Candy.View.getOptions().crop.message.nickname),message:t,time:Candy.Util.localizedTime(u.toGMTString()),timestamp:u.toISOString(),stamp:u.valueOf(),id:"",seqId:0x8000000000000,roomJid:n,sender:i?"sender-is-me":"sender-is-other"},o=Mustache.to_html(f,e);Candy.View.Pane.Room.appendToMessagePane(n,o)};Candies.send=function(n,t){Candy.Core.Action.Jabber.Room.Message(n,t.toString())};Candies.sysMessage=function(n,t){for(var r=new Ifm.Messaging.FStringMessageWriter(t),i=2;i<arguments.length;i++)r.add(arguments[i]);Candies.send(n,r.end())};Candies.getRoomHistory=function(n){Candy.Core.debug("Getting messages of room "+n);var t=0;Candy.Core.getConnection().mam.query(n,{onMessage:function(i){t+=1;var u=$(i),r=u.find("forwarded message"),f=Candy.Util.unescapeJid(r.attr("from")),e=Strophe.getResourceFromJid(f),o={roomJid:n,message:{name:e,body:r.children("body").text(),type:r.attr("type"),attributes:{xmlns:r.attr("xmlns"),to:u.attr("to"),type:r.attr("type"),id:r.attr("id"),from:f,seqId:t}},timestamp:u.find("forwarded delay").attr("stamp")};return Candy.View.Observer.Message(null,o),!0},onComplete:function(i){Candy.Core.debug("[MAM] Response "+i);Candy.Core.debug("Got all messages of room "+n);t===0&&Candies.sysMessage(n,"CONTINUITY");Candy.View.Pane.Chat.onInfoMessage(n,$.i18n._("sessionRestored"));Candy.View.Pane.Room.scrollToBottom(n)}})}}();namespace("Ifm.Chat.Extras.FileTransfer",function(){this.transferFile=function(n,t,i,r){if(!i||!i.name||i.size===undefined||!i.type===undefined){Ifm.Diagnostics.Debug.print("Invalid argument file");return}var u=i.token?!1:!0,f;f=i.size>=1073741824?Math.round(i.size/1073741824)+" GB":i.size>=1048576?Math.round(i.size/1048576)+" MB":i.size>=1024?Math.round(i.size/1024)+" KB":i.size>1?i.size+" bytes":i.size===1?"1 byte":"0 bytes";t.events.waiting=function(t,e){var h=Candy.View.Pane.Room.getPane(n),c=h&&h.data(),s,a,o;if(!c){t.cancel();return}u&&(s=new Ifm.Messaging.FStringMessageWriter("FTTOKEN"),s.add(e.token).add(i.name).add(i.size).add(i.type).end(),Candies.send(n,s));var l="ft-item-"+t.id,v="<span id='"+l+"'> <span class='filetransfer-title'> "+r.FileTransfer.TransferTitle+" <\/span> <span class='filetransfer-file'> <b>"+i.name+"<\/b> <\/span> <span class='filetransfer-status'> "+r.FileTransfer.Waiting+" <\/span> <a class='filetransfer-accept' href='#'> "+r.FileTransfer.Accept+" <\/a> <a class='filetransfer-cancel' href='#'> "+r.FileTransfer.Cancel+" <\/a> <\/span>",y=Candy.View.Template.FileTransfer.item,p={view:v,time:Candy.Util.localizedTime((new Date).toGMTString())},w=Mustache.to_html(y,p);Candy.View.Pane.Room.appendToMessagePane(n,w);a=Candy.View.Pane.Chat.getTab(n);a.find(".transfer").show();o=$("#"+l);c.filetransfers[t.id]={filetransfer:t,viewelement:o};o.find(".filetransfer-cancel").click(function(){return t.cancel(),!1});u?o.find(".filetransfer-accept").remove():(o.find(".filetransfer-status").text(f),o.find(".filetransfer-accept").click(function(){return t.accept(),o.find(".filetransfer-accept").remove(),!1}))};t.events.started=function(t){var f=Candy.View.Pane.Room.getPane(n),e=f&&f.data(),i,o;e&&(i=e.filetransfers[t.id].viewelement,u?i.find(".filetransfer-status").text(r.FileTransfer.Sending):i.find(".filetransfer-status").text(r.FileTransfer.Receiving),o=Candy.View.Pane.Chat.getTab(n),o.find(".transfer").hide())};t.events.progress=function(t,i){var r=Candy.View.Pane.Room.getPane(n),u=r&&r.data(),f;u&&(f=u.filetransfers[t.id].viewelement,f.find(".filetransfer-status").text(i.percentage+"%"))};t.events.finished=function(t,e){var s=Candy.View.Pane.Room.getPane(n),h=s&&s.data(),o;h&&(o=h.filetransfers[t.id].viewelement,o.find(".filetransfer-cancel").remove(),u?(o.find(".filetransfer-status").text(r.FileTransfer.Sent),Candies.send(n,r.FileTransfer.TransferTitle+" "+i.name+" "+f+" "+r.FileTransfer.Complete)):(o.find(".filetransfer-status").text(r.FileTransfer.Received),o.append($("<a>",{"class":"filetransfer-open",click:e.openOrSaveFunc,href:"#",text:r.FileTransfer.Open}))),Ifm.Chat.Extras.MediaPreview.generateThumbnail(n,i.name,e.fileBlob,u))};t.events.canceled=function(t){var f=Candy.View.Pane.Room.getPane(n),e=f&&f.data(),i,o;e&&(i=e.filetransfers[t.id].viewelement,i.find(".filetransfer-status").text(r.FileTransfer.Canceled),i.find(".filetransfer-cancel").remove(),u||i.find(".filetransfer-accept").remove(),o=Candy.View.Pane.Chat.getTab(n),o.find(".transfer").hide())};t.events.error=function(t,i){var o=Candy.View.Pane.Room.getPane(n),e=o&&o.data(),f,s;e&&(Candy.View.Pane.Chat.Modal.showError("File Transfer: "+i.reason),e.filetransfers[t.id]&&(f=e.filetransfers[t.id].viewelement,f.find(".filetransfer-status").text(r.FileTransfer.Error),f.find(".filetransfer-cancel").remove(),u||f.find(".filetransfer-accept").remove(),s=Candy.View.Pane.Chat.getTab(n),s.find(".transfer").hide()))};u?t.transfer(i):t.receive(i.token)}});namespace("Ifm.Chat.Extras.MediaPreview",function(){function n(n,t,i){Candies.appendToMessagePane(n,t,i)}function r(n){var t=document.getElementById(n),i;t&&(i=u(),i.src=t.src,i.alt=t.alt)}function u(){var n=document.getElementById(t),r,u;if(n)r=document.getElementById(i);else{n=document.createElement("div");n.id=t;r=document.createElement("img");r.id=i;n.appendChild(r);document.body.appendChild(n);u=function(){n.style.display="none";r.src="";r.alt=""};n.onclick=function(){u()};$("body").on("keydown",function(t){t.which!==27||n.style.display||u()})}return n.style.display="",r}this.generateThumbnail=function(t,i,u,f){var e,o,s;this.isTypeSupported(u)&&(e=URL.createObjectURL(u),o=u.type,o.startsWith("image/")?(s="media-preview-thumbnail-"+(+new Date).toString(36),n(t,'<img id="'+s+'" class="media-preview-thumbnail" src="'+e+'" alt="'+i+'">',f),document.getElementById(s).onclick=function(){r(s)}):o.startsWith("audio/")?n(t,'<audio class="media-preview-player" controls><source src="'+e+'" type="'+u.type+'"><\/audio>',f):o.startsWith("video/")&&n(t,'<video class="media-preview-player" controls><source src="'+e+'" type="'+u.type+'"><\/video>',f))};this.isTypeSupported=function(n){var t=n.type;return t.startsWith("image/")||t.startsWith("audio/")||t.startsWith("video/")};var t="media-preview-modal-div",i="media-preview-modal-img"});namespace("Ifm.Chat.Extras.UrlPreview",function(){function n(n,t){return new Promise(function(i){$.ajax({url:"https://api.linkpreview.net?key="+n+"&q="+t,success:function(n){if(!n.title&&!n.description||!n.image){Ifm.Diagnostics.Debug.print("[Candy] [UrlPreview] preview not available for",t);return}var r='<div class="message-url-preview-container"><h1 class="message-url-preview-title">'+n.title+'<\/h1><h2 class="message-url-preview-subtitle">'+n.description+'<\/h2><img class="message-url-preview-img" src="'+n.image+'" alt="'+n.title+'"><\/div>';i({url:t,html:r})},error:function(n){Ifm.Diagnostics.Debug.print("[Candy] [UrlPreview] review service returned an error:",n.statusText)}})})}function t(n,t,i){var r=document.getElementById(n);if(r){var f='<a class="message-url" href="'+t+'" target="_blank">'+i+"<\/a>",e=t.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1").replace(/&(?!amp;)/g,"&amp;"),u=new RegExp("<a[^>]*href\\s*=\\s*['\"`]"+e+"['\"`].*?>.*?<\\/a\\s*>","gi");r.innerHTML.match(u)&&(r.innerHTML=r.innerHTML.replace(u,f))}}this.findAndGenerate=function(i,r){var o=this.settings&&this.settings.authKey,u,f,e,s;if(o&&(u=/<a[^>]*href\s*=\s*['"`]((?!javascript)[^\s#'"`]+?)['"`].*?>.*?<\/a\s*>/gi,u.test(r))){for(u.lastIndex=0,f=r,e="message-url-preview-"+(+new Date).toString(36),r='<span id="'+e+'">'+f+"<\/span>";(s=u.exec(f))!==null;)n(o,s[1]).then(function(n){t(e,n.url,n.html)});Candy.View.Pane.Room.scrollToBottom(i)}return r}}),function(){var t=namespace("Ifm.PhoneBar.Media"),n;t.Xmpp={events:defineEvents("initialized","reachable","unreachable","newcall","newmessage","callclosed","filetransfer","showtransferform")};t.Xmpp.instance=function(){function y(){var h,l;Ifm.Net.TimeProvider.settings&&!Ifm.Net.TimeProvider.settings.service&&(Ifm.Net.TimeProvider.settings.service=i.config.service);Strophe.timeProvider=Ifm.Net.TimeProvider.getDefault();document.getElementById("candy")||(h=document.createElement("div"),h.id="candy",h.style.display="none",document.body.appendChild(h));t.theme?(t.theme.endsWith("/")||(t.theme+="/"),$("head").append('<link rel="stylesheet" href="'+t.theme+'default.css" />')):document.getElementById("candy").style.display="none";Candy.init(t.service,{core:{debug:t.debug,autojoin:[],disconnectWithoutTabs:!1},view:{assets:t.theme,language:t.language}});Candy.View.getOptions().crop.message.body=1e6;e=Ifm.Chat.Strings[t.language]||Ifm.Chat.Strings.it;l=window.onbeforeunload;window.addEventListener?(window.addEventListener("pagehide",l),window.addEventListener("unload",l)):window.attachEvent("onunload",l);window.onbeforeunload=null;Candy.View.Template.FileTransfer={item:'<li><small>{{time}}<\/small><div class="filetransfer"><span class="spacer">•<\/span><span class="message">{{{view}}}<\/span><\/div><\/li>'};Candy.View.Template.Message.header='<div class="header-wrapper"><span class="chatstatus-text header-text"><\/span><span timerid="" class="chatduration-text header-text"><\/span><button class="header-button hangup-button"><\/button><button class="header-button chattransfer-button"><\/button><button class="header-button chatclosetab-button" style="display:none;"><\/button><\/div>';$(Candy).on("candy:core.chat.connection",function(n,r){switch(r.status){case Strophe.Status.CONNECTING:i.log("PhoneBar.Media.Xmpp","Debug","Connecting to XMPP server");break;case Strophe.Status.ATTACHED:i.log("PhoneBar.Media.Xmpp","Debug","Connection restored with XMPP server");p();break;case Strophe.Status.CONNECTED:i.log("PhoneBar.Media.Xmpp","Debug","Connected to XMPP server");setTimeout(function(){t.mediatypes&Ifm.PhoneBar.Mediatypes.NearRealTime&&(Candy.Core.subscribe(t.getPresence_nrt(),t.getAgentPre(),t.presence),Candy.Core.subscribe(t.getDomain_nrt()),Candy.Core.subscribe(t.getAdmin_nrt()));t.mediatypes&Ifm.PhoneBar.Mediatypes.StoreAndForward&&(Candy.Core.subscribe(t.getPresence_saf(),t.getAgentPre(),t.presence),Candy.Core.subscribe(t.getDomain_saf()),Candy.Core.subscribe(t.getAdmin_saf()))},100);break;case Strophe.Status.DISCONNECTING:i.log("PhoneBar.Media.Xmpp","Debug","Disconnecting from XMPP server");break;case Strophe.Status.DISCONNECTED:i.log("PhoneBar.Media.Xmpp","Debug","Disconnected from XMPP server");Candy.Core.keepconnected?setTimeout(function(){Candy.Core.connect(t.server,null,t.getUsername())},200):f.unreachable.raise(i,{reason:null});break;case Strophe.Status.CONNFAIL:case Strophe.Status.AUTHFAIL:i.log("PhoneBar.Media.Xmpp","Debug","Connection with XMPP server failed",r.status);f.unreachable.raise(i,{reason:"Connection with XMPP server failed"});break;default:i.log("PhoneBar.Media.Xmpp","Debug","Connection with XMPP server in status",r.status)}});$(Candy).on("candy:view.connection.status-6",function(){Candy.View.Pane.Chat.Modal.hide();for(var n in u)s(n),Candy.View.Pane.Room.close(n);return r={},u={},o(),!1});$(Candy).on("candy:view.connection.status-7",function(){return Candy.View.Pane.Chat.Modal.hide(),!1});$(Candy).on("candy:core.presence",function(n,r){var e=r.stanza,u=e.attr("from"),o=e.attr("id"),s=e.attr("type")||"available";i.log("PhoneBar.Media.Xmpp","Debug","Got",s,"message from",u,"(id",o||"none",")");switch(s){case"subscribe":Candy.Core.subscribed(u,o);break;case"subscribed":Candy.Core.available(u);u.startsWith(t.presence)&&f.reachable.raise(i,{})}});$(Candy).on("candy:core:chat:invite",function(n,t){var r,u;(t.inviteType===undefined||t.inviteType==="DirectInvite")&&(r=t.inviteType||"Invite",i.log("PhoneBar.Media.Xmpp","Debug","Got",r,"message from",t.roomJid),u=Candy.Util.unescapeJid(t.roomJid),Candy.Core.Action.Jabber.Room.Join(u,null))});$(Candy).on("candy:core.message.chatstate",function(n,t){t.chatstate&&t.name!==Candy.Core.getUsername()&&(t.chatstate==="composing"?Candy.View.updatenotification(t.roomJid,t.displayName,t.chatstate,e.ChatStateComposing):Candy.View.deletenotification(t.roomJid))});$(Candy).on("candy:view.room.before-add",function(n,t){var f=t.roomJid,e,h=f.substr(1,36).toUpperCase(),s;if(!u[f]||!r[u[f]]){i.log("PhoneBar.Media.Xmpp","Debug","Matching conversation");s=!1;for(e in r)if(h===r[e].callGuid){r[e].roomJid=f;u[f]=Number(e);o();s=!0;break}if(!s)return i.log("PhoneBar.Media.Xmpp","Debug","Unable to match, no active call for this conversation"),!1}});$(Candy).on("candy:view.room.after-add",function(i,f){var a=f.roomJid,v=u[a],o,h,w,b,y,s;Candy.View.Pane.Chat.getTab(a).find(".label").html(r[v].campaignName);o=Candy.View.Pane.Room.getPane(a);h=o.find(".hangup-button");h.click(function(){n.close(v)});h=o.find(".chatclosetab-button");h.click(function(){n.ready(v)});h=o.find(".chattransfer-button");t.showtransfer?h.click(function(){n.showTransferDialog(v)}):h.hide();w=o.find(".chatstatus-text");w.text(e.ChatStateTalking);var k=setInterval(function(){var u=new Date,t=Math.abs(b-u),i=Math.floor(t/36e5),n,r;i<10&&(i="0"+i);t-=i*36e5;n=Math.floor(t/6e4);n<10&&(n="0"+n);t-=n*6e4;r=Math.floor(t/1e3);r<10&&(r="0"+r);p.text(i+":"+n+":"+r)},1e3),p=o.find(".chatduration-text"),l=p.data();l.timerid=k;b=new Date;p.text("00:00:00");y=o.find(".message-pane-wrapper")[0];s=o.find("[name=message]")[0];l=o.data();l.filetransfers={};Candy.View.Pane.Chat.fitTabs();s.onchange=s.oninput=function(){s.value===""?(Candy.Core.notifystate(a,"paused"),l.lastnotificationsent=0):(!l.lastnotificationsent||dT()-l.lastnotificationsent>5e3)&&(Candy.Core.notifystate(a,"composing"),l.lastnotificationsent=dT())};y.ondragover=s.ondragover=function(n){n||(n=window.event);n&&n.preventDefault()};y.ondrop=s.ondrop=function(n){var i,t;if((n||(n=window.event),n&&n.preventDefault(),Candy.Core.isConnected())&&r[v]!==undefined&&!r[v].terminated&&n.source!==y&&n.source!==s){if(i=n.dataTransfer.getData("text"),i){s.value=i;s.select();return}if(t=n.dataTransfer.files,t&&t.length>0){c(a,t[0]);return}}}});$(Candy).on("candy:view.pane.roster.after-update",function(n,t){var c=t.roomJid,e=u[c],s,h;if(t.action==="join"){if(e===undefined){i.log("PhoneBar.Media.Xmpp","Debug","Discarding unmatched conversation notification");return}r[e].externalPartyUserName||(s=t.user,h=s.getNick(),s.getRole()!==s.ROLE_MODERATOR&&h!==Candy.Core.getUsername()&&(r[e].externalPartyUserName=h,r[e].externalPartyDisplayName=s.getNick(!0),o(),f.newcall.raise(i,{callId:e})))}else Candy.View.deletenotification(c)});$(Candy).on("candy:view.message.before-show",function(n,t){var i,r;if(t.message.startsWith("*begin*"))return t.history||t.name===Candy.Core.getUsername()||(i=new Ifm.Messaging.FStringMessageReader(t.message),i.type==="FTTOKEN"?(r={token:i.data[0],name:i.data[1],size:Number(i.data[2]),type:i.data[3]},c(t.roomJid,r)):i.type==="FTUNSUP"&&(s(t.roomJid),Candy.View.Pane.Chat.Modal.showError(e.FileTransfer.NotAvailOther))),!1});$(Candy).on("candy:view.message.before-render",function(n,t){var o=t.templateData,c=u[o.roomJid],l=o.displayName,h=l.startsWith("Synthetic"),a=o.name!==r[c].externalPartyUserName,s;return h&&e.BotNickname&&(o.displayName=e.BotNickname,o.croppedDisplayName=Candy.Util.crop(o.displayName,Candy.View.getOptions().crop.message.nickname)),s={callId:c,displayName:o.displayName,sender:l,senderIsBot:h,sentFromHere:a,rawMessage:t.rawMessage,message:o.message,time:o.time,timestamp:o.timestamp,history:t.history,attributes:t.attributes},o.sender=s.sentFromHere?"sender-is-me":"sender-is-other",h&&(o.sender+=" sender-is-bot"),f.newmessage.raise(i,s),s.displayName&&s.displayName!==o.displayName&&(o.displayName=s.displayName,o.croppedDisplayName=Candy.Util.crop(o.displayName,Candy.View.getOptions().crop.message.nickname)),o.message=Ifm.Chat.Extras.UrlPreview.findAndGenerate(t.templateData.roomJid,s.message),o.message?void 0:!1});$(Candy).on("candy:view.message.after-show",function(n,t){if(t.name!==Candy.Core.getUsername()){var i=t.element;i.addClass("new-message-highlight");setTimeout(function(){i.removeClass("new-message-highlight")},4e3);Candy.View.movenotification(t.roomJid)}});$(Candy).on("candy:view.presence",function(n,t){var c=t.roomJid,l=u[c],p=r[l]&&r[l].transferred,h=Candy.View.Pane.Room.getPane(c),a,v,y;Candy.View.deletenotification(c);s(c);p?Candy.View.Pane.Room.close(c):h&&(Candy.View.Pane.Chat.getTab(c).addClass("closed"),h.find(".message-form-wrapper").css({visibility:"hidden"}),h.find(".message-pane-wrapper").css({opacity:".80"}),h.find(".hangup-button").hide(),h.find(".chattransfer-button").hide(),h.find(".chatclosetab-button").show(),a=h.find(".chatduration-text"),v=a.data(),clearInterval(v.timerid),y=h.find(".chatstatus-text"),y.text(e.ChatStateClosed));r[l]&&r[l].callClosed!==!0&&(f.callclosed.raise(i,{callId:l}),r[l].callClosed=!0,o())});$(Candy).on("candy:view.room.after-close",function(n,t){var s=t.roomJid,e=u[s];r[e]&&r[e].callClosed!==!0&&(f.callclosed.raise(i,{callId:e}),r[e].callClosed=!0);delete r[e];delete u[s];o()})}function p(){var n=window.sessionStorage.getItem("chat-session-calls");n&&(r=JSON.parse(n));n=window.sessionStorage.getItem("chat-session-rooms");n&&(u=JSON.parse(n))}function o(){window.sessionStorage.setItem("chat-session-calls",JSON.stringify(r));window.sessionStorage.setItem("chat-session-rooms",JSON.stringify(u))}function c(n,o){var s,c,h;if(n===undefined||u[n]===undefined){i.log("PhoneBar.Media.Xmpp","Debug","Invalid conversation");return}if(s=u[n],r[s].mediatype!==Ifm.PhoneBar.Mediatypes.NearRealTime){Ifm.Diagnostics.Debug.print("Unsupported mediatype of call",s);return}if(!Ifm.Net.Services.FileTransfer.isSupported()||!t.ftservice){isSender?Candy.View.Pane.Chat.Modal.showError(e.FileTransfer.NotAvailable):(c=new Ifm.Messaging.FStringMessageWriter("FTUNSUP").end(),Candies.send(n,c));return}h=Ifm.Net.Services.FileTransfer.create(t.ftservice);Ifm.Chat.Extras.FileTransfer.transferFile(n,h,o,e);f.filetransfer.raise(i,{callId:u[n],file:o,filetransfer:h})}function s(n){var r=Candy.View.Pane.Room.getPane(n),t=r&&r.data(),i;if(t&&t.filetransfers)for(i in t.filetransfers)t.filetransfers[i].filetransfer.cancel(),delete t.filetransfers[i]}function w(n,t){if(n&&r[n]){var i=r[n].roomJid;i&&u[i]&&(Candy.Core.Action.Jabber.Room.Leave(i),t&&Candy.View.Pane.Room.getPane(i)&&(s(i),Candy.View.Pane.Room.close(i)))}}function a(n,t){(t.mediatype===Ifm.PhoneBar.Mediatypes.NearRealTime||t.mediatype===Ifm.PhoneBar.Mediatypes.StoreAndForward)&&(n.log("PhoneBar.Media.Xmpp","Debug","Assignment event"),r[t.callId]=t,o())}function v(n,t){r[t.callId]&&(n.log("PhoneBar.Media.Xmpp","Debug","CallFailure event"),w(t.callId,!0))}if(!window.jQuery)throw Ifm.Diagnostics.Errors.miss("jQuery");if(!window.Strophe)throw Ifm.Diagnostics.Errors.miss("Candy/Libs");if(!window.Candy)throw Ifm.Diagnostics.Errors.miss("Candy");var i=null,h=null,r={},u={},l=!1,e,f=Ifm.PhoneBar.Media.Xmpp.events,t={mediatypes:0,service:"",server:"",ftservice:"",nickname:"",theme:"assets/xmpp/",language:"it",domain_nrt:"xmpp-nrt",domain_saf:"xmpp-saf",admin_nrt:"lxadmin-nrt",admin_saf:"lxadmin-saf",presence:"login",debug:!1,showtransfer:!0,areValidMediatypes:function(){var n=Ifm.Type.isNumber(this.mediatypes)?this.mediatypes:parseInt(this.mediatypes);return isFinite(n)&&n==Ifm.PhoneBar.Mediatypes.NearRealTime||n==Ifm.PhoneBar.Mediatypes.StoreAndForward||n==Ifm.PhoneBar.Mediatypes.NearRealTime+Ifm.PhoneBar.Mediatypes.StoreAndForward?!0:!1},getAdmin_nrt:function(){return this.admin_nrt+"@"+this.server},getAdmin_saf:function(){return this.admin_saf+"@"+this.server},getDomain_nrt:function(){return this.domain_nrt+"."+this.server},getDomain_saf:function(){return this.domain_saf+"."+this.server},getPresence_nrt:function(){return this.presence+"@"+this.domain_nrt+"."+this.server},getPresence_saf:function(){return this.presence+"@"+this.domain_saf+"."+this.server},getAgentPre:function(){return"Agent_"+this.extension},getUsername:function(){return(this.displayname||"Agent")+"_"+this.extension}};return{isConnected:function(){return Candy.Core.isConnected()},activeCalls:function(){throw new Error("Obsolete. Use Ifm.PhoneBar.instance.calls() instead.");},getCall:function(){throw new Error("Obsolete. Use Ifm.PhoneBar.instance.calls() instead.");},initialize:function(n,r,u){function e(n){return r.hasOwnProperty(n)?r[n]:t[n]}function o(n){if(!r[n])throw Error("Invalid configuration, argument '"+n+"' is missing.");return r[n]}if(!n)throw Ifm.Diagnostics.Errors.arg("pb");if(i=n,h=u||Ifm.PhoneBar,!r)throw Error("Invalid configuration.");if(t.service=o("service"),t.server=o("server"),t.mediatypes=o("mediatypes"),t.ftservice=e("ftservice"),t.nickname=e("nickname"),t.theme=e("theme"),t.language=e("language"),t.domain_nrt=e("domain_nrt"),t.domain_saf=e("domain_saf"),t.admin_nrt=e("admin_nrt"),t.admin_saf=e("admin_saf"),t.presence=e("presence"),t.debug=e("debug"),t.showtransfer=e("showtransfer"),!t.areValidMediatypes())throw Error("Invalid mediatype(s).");t.mediatypes=+t.mediatypes;h.events.assignment.addHandler(a);h.events.callfailure.addHandler(v);l||(y(),l=!0);f.initialized.raise(i,{})},terminate:function(){if(this.isConnected())throw Ifm.Diagnostics.Errors.op("must be disconnected");h.events.assignment.removeHandler(a);h.events.callfailure.removeHandler(v)},connect:function(){var n=i.agent.extension,e=i.agent.firstName,s=i.agent.lastName,u,o,f,r;if(!n){i.log("PhoneBar.Media.Xmpp","Warn","Can't connect without an extension specified");Candy.Core.keepconnected=!1;Candy.Core.disconnect();return}u=t.extension||null;t.extension=n;o=t.firstname||null;t.firstname=e;f=t.displayname||null;t.displayname=t.nickname||t.firstname;r=Candy.Core.isConnected();(n!==u||t.displayname!==f)&&r&&(Candy.Core.keepconnected=!0,Candy.Core.disconnect());r||(i.log("PhoneBar.Media.Xmpp","Debug","Connecting as",t.displayname),Candy.Core.keepconnected=!0,Candy.Core.connect(t.server,null,t.getUsername()))},disconnect:function(){if(this.isConnected()){for(var n in u)Candy.Core.Action.Jabber.Room.Leave(n);setTimeout(function(){var n=0,t=setInterval(function(){var f=Ifm.Enum.getLength(u),r;if(f>0&&++n<10){i.log("PhoneBar.Media.Xmpp","Debug","Waiting for calls to close:",f,"remaining");return}clearInterval(t);for(r in u)s(r),Candy.View.Pane.Room.getPane(r)&&Candy.View.Pane.Room.close(r);Candy.Core.keepconnected=!1;Candy.Core.disconnect()},100)},100)}},handled:function(n){return this.sendSysMessage(n,"HANDLED")?(r[n].handled=!0,o(),!0):!1},send:function(n,t){if(!this.isConnected())return i.log("PhoneBar.Media.Xmpp","Warn","Cannot send messages while disconnected from XMPP server"),!1;if(r[n]===undefined||r[n].terminated)return i.log("PhoneBar.Media.Xmpp","Warn","Invalid callId",n),!1;var u=r[n].roomJid;return u===undefined?(i.log("PhoneBar.Media.Xmpp","Warn","Session not yet created for call",n),!1):(Candies.send(u,t),!0)},sendCallInfo:function(n,t){var i=new Ifm.Messaging.FStringMessageWriter("CALLINFO");for(var r in t)i.add(r+":"+t[r]);return this.send(n,i.end().toString())},sendSysMessage:function(n,t){for(var r=new Ifm.Messaging.FStringMessageWriter(t),i=2;i<arguments.length;i++)r.add(arguments[i]);return this.send(n,r.end().toString())},showTransferDialog:function(n){try{Ifm.PhoneBar.UI.Commands.showTransferForm(n)}catch(t){}f.showtransferform.raise(i,{callId:n})},close:function(n){if(this.isConnected()){if(r[n]===undefined||r[n].terminated){i.log("PhoneBar.Media.Xmpp","Warn","Invalid callId",n);return}var t=r[n].roomJid;if(t===undefined){i.log("PhoneBar.Media.Xmpp","Warn","Session not yet created for call",n);return}Candy.Core.Action.Jabber.Room.Leave(t)}},ready:function(n){if(i.calls(n)&&i.calls(n).postcall&&i.ready(n),Candy.Core.isConnected()){if(r[n]===undefined){i.log("PhoneBar.Media.Xmpp","Warn","Invalid callId",n);return}if(!r[n].terminated){i.log("PhoneBar.Media.Xmpp","Warn","Call not yet terminated",n);return}var t=r[n].roomJid;if(t===undefined){i.log("PhoneBar.Media.Xmpp","Warn","Session not yet created for call",n);return}Candy.View.Pane.Room.getPane(t)&&(s(t),Candy.View.Pane.Room.close(t))}},append:function(t,i){console.warn("Obsolete. Use xmpp.conversation.append() instead");n.conversation.append(t,i)},conversation:{append:function(n,t){var u;if(r[n]===undefined){i.log("PhoneBar.Media.Xmpp","Warn","Invalid callId",n);return}if(u=r[n].roomJid,u===undefined){i.log("PhoneBar.Media.Xmpp","Warn","Session not yet created for call",n);return}Candy.View.Pane.Chat.onInfoMessage(u,"{{message}}");var e=Candy.View.Pane.Room.getPane(u),f=e.find(".message-pane").children().last(),o=f.html();f.html(o.replace("{{message}}",t))},html:function(n){var t,u;if(r[n]===undefined){i.log("PhoneBar.Media.Xmpp","Warn","Invalid callId",n);return}if(t=r[n].roomJid,t===undefined){i.log("PhoneBar.Media.Xmpp","Warn","Session not yet created for call",n);return}return u=Candy.View.Pane.Room.getPane(t),u.find(".message-pane").html()},prepend:function(n,t){var u,f;if(r[n]===undefined){i.log("PhoneBar.Media.Xmpp","Warn","Invalid callId",n);return}if(u=r[n].roomJid,u===undefined){i.log("PhoneBar.Media.Xmpp","Warn","Session not yet created for call",n);return}t&&(f=Candy.View.Pane.Room.getPane(u),f.find(".message-pane").prepend(t))},select:function(n){if(r[n]===undefined){i.log("PhoneBar.Media.Xmpp","Warn","Invalid callId",n);return}var t=r[n].roomJid;if(t===undefined){i.log("PhoneBar.Media.Xmpp","Warn","Session not yet created for call",n);return}Candy.View.Pane.Room.show(t)}},queryFileTransfer:function(n){if(!Ifm.Type.isFunction(n))throw Ifm.Diagnostics.Errors.func("callback");if(!Ifm.Net.Services.FileTransfer.isSupported()||!t.ftservice){n(!1);return}var i=Ifm.Net.Services.FileTransfer.create(t.ftservice);i.enabled(n)},requestFileTransfer:function(n,t){var f,u;if(r[n]===undefined||r[n].terminated){i.log("PhoneBar.Media.Xmpp","Warn","Invalid callId",n);return}if(r[n].mediatype!==Ifm.PhoneBar.Mediatypes.NearRealTime){Ifm.Diagnostics.Debug.print("Unsupported mediatype of call",n);return}if(f=r[n].roomJid,f===undefined){i.log("PhoneBar.Media.Xmpp","Warn","Session not yet created for call",n);return}if(!t||!t.name||t.size===undefined||!t.type){u=document.createElement("input");u.type="file";u.style.cssText="display:none!important;";document.body.appendChild(u);u.click();document.body.removeChild(u);u.onchange=function(){u.files&&u.files.length>0&&c(f,u.files[0])};return}}}}();n=t.Xmpp.instance}();namespace("Ifm.Chat.Strings"),function(n){n.en={ChatStateComposing:"is writing...",ChatStateTalking:"Chatting",ChatStateClosed:"Chat terminated",BotNickname:"Synthetic",FileTransfer:{NotAvailable:"File transfer not available",NotAvailOther:"File transfer not available with this user",TransferTitle:"File",Complete:"transferred",Accept:"Accept",Cancel:"Cancel",Open:"Open",Waiting:"waiting",Canceled:"canceled",Error:"error",Receiving:"receiving",Sending:"sending",Received:"received",Sent:"sent"}};n.it={ChatStateComposing:"sta scrivendo...",ChatStateTalking:"In conversazione",ChatStateClosed:"Conversazione chiusa",BotNickname:"Synthetic",FileTransfer:{NotAvailable:"Trasferimento file non disponibile",NotAvailOther:"Trasferimento file non disponibile con questo utente",TransferTitle:"File",Complete:"trasferito",Accept:"Accetta",Cancel:"Annulla",Open:"Apri",Waiting:"in attesa",Canceled:"annullato",Error:"errore",Receiving:"ricezione",Sending:"invio",Received:"ricevuto",Sent:"inviato"}}}(Ifm.Chat.Strings);namespace("Ifm.ChromeBar.Strings",{en:{InfoNotificationPopupTitle:"ChromeBar",WarningNotificationPopupTitle:"ChromeBar - Warning",ErrorNotificationPopupTitle:"ChromeBar - Error",RequestRefused:"Request refused",NoBrowserSupport:"This browser does not have the features needed to run the ChromeBar",InvalidConfig_MissingPhonesServer:"Configuration error: at least one #phones server must be defined",InvalidConfig_InvalidServerFormat:"Configuration error: the #phones server name does not respect the expected format (ws://server:port/)",InvalidConfig_MissingExtension:"Configuration error: invalid extension",InvalidConfig_MissingSPCService:"Configuration error: SPC service is missing or invalid",InvalidConfig_MissingSPCDomain:"Configuration error: SPC domain is missing or invalid",ConfigNotSaved:"Configuration not saved: new configuration is invalid or ChromeBar is active",ConfigNotSaved_Locked:"Configuration not saved: operation not allowed",ConfigurationSaved:"Configuration succesfully saved",PanicSent:"Panic request sent",BusyInOtherMediaCallMessage:"Engaged in non-telephonic calls",MicrophoneWarningMessage1:"Warning",MicrophoneWarningMessage2:"Audio Capture permission not granted!",VirtualPhoneTabLabel:"Virtual Phone",QueueInfoTabLabel:"Queue Info",AssignedCampaignsTabLabel:"Assigned Campaigns",ActiveCallsTabLabel:"Active Calls",HandledCallsTabLabel:"Handled Calls",FailedCallsTabLabel:"Failed Calls",SoftPhoneNotConnectedStateLabel:"{0}: not connected",SoftPhoneNotRegisteredStateLabel:"{0}: not registered",SoftPhoneRegisteredStateLabel:"{0}: registered",SoftPhoneRegisteredNoMediaStateLabel:"{0}: registered, media device access not granted",XmppNotConnectedStateLabel:"XMPP server: not connected",XmppConnectedStateLabel:"XMPP Server: connected",TooltipShowRecordingPanelButton:"Show/Hide recording commands",TooltipAddCueSheetButton:"Add CueSheet in the recording file",TooltipCueSheetText:"CueSheet text",TooltipPickup:"Click to answer",PageTitle:"ChromeBar",MainMenuEntry:"General",Oauth2Entry:"Single sign-on",OptionsMenuEntry:"Options",ScriptsMenuEntry:"Scripts",SPCConfigMenuEntry:"SoftPhone",WebRTCConfigMenuEntry:"WebRTC",XMPPConfigMenuEntry:"XMPP",MainTabTitle:"General",AgentTabTitle:"Agent",Oauth2TabTitle:"Single sign-on",OptionsTabTitle:"Options",ScriptsTabTitle:"Scripts",PluginsTabTitle:"Plugins",SoftPhoneConfigTabTitle:"SPC Connection Parameters",WebRTCConfigTabTitle:"WebRTC Server Connection Parameters",XmppConfigTabTitle:"XMPP Server Connection Parameters",CommonTabSubtitle:"Parameters marked with '*' are optional: leave unset to use default values",ProvisionLoginInstructionLabel:"Log in with your account credentials to continue",ProvisionedConfigurationLabel:"Enable configuration provisioning",IsRemoteOperatorLabel:"Agent is remote:",WebSocketGatewayServiceLabel:"WebSocketGateway services:",ExtensionLabel:"Extension:",PhoneDeviceTypeLabel:"Telephone device:",RecordingPathLabel:"Recording folder:",LanguageLabel:"Language:",SkinLabel:"Skin:",EnableOauth2LoginLabel:"Enable OAuth2 login:",IsAdfsLabel:"Authority is ADFS:",AuthorityUrlLabel:"Authority URL:",ClientIdLabel:"Client Id:",ScopesLabel:"Scopes:",HideClockWhenPausedLabel:"Hide the time spent in the pause state:",HidePausedAgentsLabel:"Hide the paused agents in the transfer call dialog:",ShowPopupForManualCallsLabel:"Display information popup for icoming manual calls:",ShowCampaignNameForVoiceCallsLabel:"Display campaign name for voice calls:",EnableAbortCallLabel:"Enalbe 'Abort' button for outbound calls:",DisableManualCallLabel:"Disable manual call:",AutoAnswerPhoneLabel:"Automatically answer these calls:",AutoAnswerPhone0Label:"none (do not answer automatically)",AutoAnswerPhone1Label:"#phones outbound calls",AutoAnswerPhone2Label:"#phones inbound and outbound calls",AutoAnswerPhone3Label:"all calls (#phones and manual)",AutoAnswerRingsLabel:"Number of rings before automatic answer:",CallingNumberLabel:"Calling number for outbound calls:",RemeberCredentialLabel:"Enable saving of credentials in a cookie:",RemeberCredential0Label:"don't save anything (delete previous saves)",RemeberCredential1Label:"save credentials without password",RemeberCredential2Label:"save credentials with password",ShowPopoupIncomingCallLabel:"Display information popup for incoming calls of the specified media types:",NoPopupLabel:"none",VoiceCallsLabel:"voice calls",NrtCallsLabel:"near real-time calls (chat)",SafCallsLabel:"store and forward calls (mail/social)",VoiceAndNrtCallsLabel:"voice and near real-time (chat) calls",VoiceAndSafCallsLabel:"voice and store and forward (mail/social) calls",NrtAndSafCallsLabel:"near real-time (chat) and store and forward (mail/social) calls",AllCallsLabel:"all calls",PopupTypeForIncomingCallLabel:"Type of information popup for incoming calls (for selected media only):",WindowsNotificationLabel:"show Windows notifications (if enabled)",ChromeBarPopupLabel:"shows ChromeBar popup as topmost window",BothPopupTypeLabel:"show both",EnableCallHistoryLogLabel:"Enable call history log for specified outcomes:",SaveNoneLabel:"none",SaveConnectedCallsOnlyLabel:"saves only connected calls",SaveFailedCallsOnlyLabel:"saves only failed calls",SaveBothCallsTypeLabel:"saves both types of calls",CallHistoryLogLenLabel:"Maximum number of calls to be stored in the log (for each type)",ClearCallHistoryOnLogout:"Clear call history log on logout:",AutoConnectToXMPP:"Automatically connect to the XMPP server:",HideCallerNumberLabel:"Hide the caller number:",EnabledColumnHeaderLabel:"Enabled",UrlColumnHeaderLabel:"URL",PopupColumnHeaderLabel:"Popup",WinHeightColumnHeaderLabel:"Window Height",WinWidthColumnHeaderLabel:"Window Width",IconNameColumnHeaderLabel:"Icon Name",SoftPhoneControllerUrl:"SPC URL:",SoftPhoneRegistrarDomain:"Registrar domain:",WebRtcDomain:"Domain:",WebRtcWebRtcAddresses:"Addresses:",WebRtcIceServers:"ICE Servers:",WebRtcUseDomainOfLoggedUser:"Use domain of logged user:",UseBuiltinChatAgentWindow:"Use built-in chat window:",ChatServiceUrl:"Chat serice URL:",XmppServerName:"XMPP server name:",FileTransferServiceUrl:"File transfer service URL:",MediaType:"Media type:",AgentNickNameOverride:"Agent nickname: *",NrtDomainName:"Near real-time domain name: *",NrtAdminName:"Near real-time domain administrator: *",SafDomainName:"Store and forward domain name: *",SafAdminName:"Store and forward domain administrator: *",YesLabel:"Yes",NoLabel:"No",TrueLabel:"True",FalseLabel:"False",SaveButton:"Save configuration",VersionLabel:"Version: {0} - Copyright © Base Digitale Platform",InvalidConfig:"Invalid configuration",TooltipOptions:"Configuration",TootltipAbortCall:"Abort Call",QueuedNumberText:"Calls currently queued",QueuedMaxTimeText:"Max queue time",QueuedAvgTimeText:"Avg queue time",CampaignName:"Campaign name",CampaignDirection:"Direction",CampaignState:"Active",CampaignStateActive:"Yes",CampaignStateInactive:"No",LoginUserName:"User Name:",LoginSiteSelection:"Site: ",CallId:"Id",CallMediaType:"Type",CallCampaignName:"Campaign Name",IsRecording:"Rec",InPostCall:"PCW",DateTime:"Date/Time",PhoneNumber:"Number",DisplayName:"Name",Audio_MediaType:"Voice",NRT_MediaType:"NRT",SAF_MediaType:"SAF"}});namespace("Ifm.ChromeBar.Strings",{it:{InfoNotificationPopupTitle:"ChromeBar",WarningNotificationPopupTitle:"ChromeBar - Avviso",ErrorNotificationPopupTitle:"ChromeBar - Errore",RequestRefused:"Richiesta rifiutata",NoBrowserSupport:"Questo browser non ha le funzionalità necessarie a eseguire la ChromeBar",InvalidConfig_MissingPhonesServer:"Errore di configurazione: deve essere definito almeno un server #phones",InvalidConfig_InvalidServerFormat:"Errore di configurazione: il nome del server #phones non rispetta il formato atteso (ws://server:port/)",InvalidConfig_MissingExtension:"Errore di configurazione: interno telefonico non valido",InvalidConfig_MissingSPCService:"Errore di configurazione: servzio SPC mancante o non valido",InvalidConfig_MissingSPCDomain:"Errore di configurazione: dominio SPC mancante o non valido",ConfigNotSaved:"Configurazione non salvata: nuova configurazione non valida o ChromeBar attiva",ConfigNotSaved_Locked:"Configurazione non salvata: operazione non consentita",ConfigurationSaved:"La configurazione è stata salvata con successo",PanicSent:"Richiesta di assistenza inviata",BusyInOtherMediaCallMessage:"Impegnato in chiamate non telefoniche",MicrophoneWarningMessage1:"Attenzione!",MicrophoneWarningMessage2:"Non è stato possibile ottenere i diritti a usare il microfono!",VirtualPhoneTabLabel:"Telefono Virtuale",QueueInfoTabLabel:"Code",AssignedCampaignsTabLabel:"Campagne assegnate",ActiveCallsTabLabel:"Chiamate attive",HandledCallsTabLabel:"Chiamate gestite",FailedCallsTabLabel:"Chiamate fallite",SoftPhoneNotConnectedStateLabel:"{0}: non connesso",SoftPhoneNotRegisteredStateLabel:"{0}: non registrato",SoftPhoneRegisteredStateLabel:"{0}: registrato",SoftPhoneRegisteredNoMediaStateLabel:"{0}: registrato, senza accesso al microfono",XmppNotConnectedStateLabel:"Server XMPP: non connesso",XmppConnectedStateLabel:"Server XMPP: connesso",TooltipShowRecordingPanelButton:"Mostra/Nascondi comandi registrazione",TooltipAddCueSheetButton:"Inserisci label nel file registrato",TooltipCueSheetText:"Testo della label da inserire nel file registrato",TooltipPickup:"Clicca sulla notifica per rispondere",PageTitle:"ChromeBar",MainMenuEntry:"Generale",Oauth2Entry:"Single sign-on",OptionsMenuEntry:"Opzioni",ScriptsMenuEntry:"Script",SPCConfigMenuEntry:"SoftPhone",WebRTCConfigMenuEntry:"WebRTC",XMPPConfigMenuEntry:"XMPP",MainTabTitle:"Generale",AgentTabTitle:"Agente",Oauth2TabTitle:"Single sign-on",OptionsTabTitle:"Opzioni",ScriptsTabTitle:"Script",PluginsTabTitle:"Plugin",SoftPhoneConfigTabTitle:"SoftPhone controller",WebRTCConfigTabTitle:"Server WebRTC",XmppConfigTabTitle:"Server XMPP",CommonTabSubtitle:"I parametri con '*' sono opzionali: possono essere lasciati vuoti per usare i valori predefiniti",ProvisionLoginInstructionLabel:"Accedi con le credenziali del tuo account per proseguire",ProvisionedConfigurationLabel:"La configurazione è fornita dal server?",IsRemoteOperatorLabel:"L'agente è remoto:",WebSocketGatewayServiceLabel:"WebSocketGateway services:",ExtensionLabel:"Interno telefonico:",PhoneDeviceTypeLabel:"Dispositivo telefonico:",RecordingPathLabel:"Folder in cui salvare le registrazioni:",LanguageLabel:"Lingua:",SkinLabel:"Skin:",EnableOauth2LoginLabel:"Abilita login tramite Oauth2:",IsAdfsLabel:"L'authority è di tipo ADFS:",AuthorityUrlLabel:"Authority URL:",ClientIdLabel:"Client Id:",ScopesLabel:"Scope (lista di valori separati da virgola):",HideClockWhenPausedLabel:"Nascondi il tempo di permanenza nello stato di pausa:",HidePausedAgentsLabel:"Nascondi gli agenti in stato 'Pausa' nel pannello di trasferimento:",ShowPopupForManualCallsLabel:"Visualizza popup informativo per le chiamate manuali in ingresso:",ShowCampaignNameForVoiceCallsLabel:"Visualizza il nome della campagna per le chiamate telefoniche:",EnableAbortCallLabel:"Abilita bottone 'abort' per le chiamate outbound:",DisableManualCallLabel:"Disabilita le chiamate manuali:",AutoAnswerPhoneLabel:"Rispondi automaticamente a queste chiamate:",AutoAnswerPhone0Label:"nessuna",AutoAnswerPhone1Label:"chiamate #phones di outbound",AutoAnswerPhone2Label:"chiamate #phones di inbound e outbound",AutoAnswerPhone3Label:"tutte (#phones e manuali)",AutoAnswerRingsLabel:"Numero di squilli prima di eseguire la risposta automatica:",CallingNumberLabel:"Numero chiamante per le chiamate outbound:",RemeberCredentialLabel:"Abilita il salvataggio delle credenziali in un cookie:",RemeberCredential0Label:"non salvare nulla (cancella precedenti salvataggi)",RemeberCredential1Label:"salva le credenziali senza password",RemeberCredential2Label:"salva le credenziali compresa password",ShowPopoupIncomingCallLabel:"Visualizza popup informativo per le chiamate in arrivo dei media type specificati:",NoPopupLabel:"nessuna",VoiceCallsLabel:"solo chiamate vocali",NrtCallsLabel:"solo chiamate near real-time (chat)",SafCallsLabel:"solo chiamate store and forward (mail/social)",VoiceAndNrtCallsLabel:"chiamate vocali e near real-time (chat)",VoiceAndSafCallsLabel:"chiamate vocali e store and forward (mail/social)",NrtAndSafCallsLabel:"chiamate near real-time (chat) e store and forward (mail/social)",AllCallsLabel:"tutte le chiamate",PopupTypeForIncomingCallLabel:"Tipo di popup informativo per le chiamate in arrivo (solo per i media selezionati):",WindowsNotificationLabel:"mostra notifiche Windows (se abilitate nelle impostazioni)",ChromeBarPopupLabel:"mostra ChromeBar in primo piano",BothPopupTypeLabel:"mostra entrambe",EnableCallHistoryLogLabel:"Abilita il registro delle chiamate per i seguenti esiti:",SaveNoneLabel:"nessuno",SaveConnectedCallsOnlyLabel:"solo chiamate connesse",SaveFailedCallsOnlyLabel:"solo chiamate fallite",SaveBothCallsTypeLabel:"tutte indipendentemente dall'esito",CallHistoryLogLenLabel:"Numero massimo di chiamate nello storico (per ogni tipo):",ClearCallHistoryOnLogout:"Svuota lo storico delle chiamate sul logout:",AutoConnectToXMPP:"Connetti automaticamente al server XMPP:",HideCallerNumberLabel:"Non visualizzare numero chiamante:",EnabledColumnHeaderLabel:"Abilitato",UrlColumnHeaderLabel:"URL",PopupColumnHeaderLabel:"Popup",WinHeightColumnHeaderLabel:"Altezza finestra",WinWidthColumnHeaderLabel:"Larghezza finestra",IconNameColumnHeaderLabel:"Nome icona",SoftPhoneControllerUrl:"URL del SPC:",SoftPhoneRegistrarDomain:"Dominio di registrazione:",WebRtcDomain:"Dominio:",WebRtcWebRtcAddresses:"Indirizzi:",WebRtcIceServers:"Lista server ICE:",WebRtcUseDomainOfLoggedUser:"Usa dominio dell'utente loggato:",UseBuiltinChatAgentWindow:"Usa la finestra di chat integrata:",ChatServiceUrl:"URL del servizio chat:",XmppServerName:"Nome del server XMPP:",FileTransferServiceUrl:"URL del servizio di file transfer:",MediaType:"Media type:",AgentNickNameOverride:"Nickname dell'agente: *",NrtDomainName:"Nome del dominio near real-time: *",NrtAdminName:"Amministratore del dominio near real-time: *",SafDomainName:"Nome del dominio store and forward: *",SafAdminName:"Amministratore del dominio store and forward: *",YesLabel:"Si",NoLabel:"No",TrueLabel:"Vero",FalseLabel:"Falso",SaveButton:"Salva configurazione",VersionLabel:"Versione: {0} - Copyright © Base Digitale Platform",InvalidConfig:"Configurazione non valida",TooltipOptions:"Configurazione",TootltipAbortCall:"Interrompi chiamata",QueuedNumberText:"Attualmente accodate",QueuedMaxTimeText:"Tempo massimo",QueuedAvgTimeText:"Tempo medio",CampaignName:"Nome Campagna",CampaignDirection:"Direzione",CampaignState:"Attiva",CampaignStateActive:"Si",CampaignStateInactive:"No",LoginUserName:"Nome utente:",LoginSiteSelection:"Sede:",CallId:"Id",CallMediaType:"Tipo",CallCampaignName:"Campagna",IsRecording:"Rec",InPostCall:"PCW",DateTime:"Data/Ora",PhoneNumber:"Numero",DisplayName:"Nome",Audio_MediaType:"Voce",NRT_MediaType:"NRT",SAF_MediaType:"SAF"}});jQuery.fn.extend({enable:function(){return this.each(function(){jQuery(this).prop("disabled",!1);jQuery(this).removeAttr("disabled")})},disable:function(){return this.each(function(){jQuery(this).prop("disabled",!0);jQuery(this).attr("disabled","")})},enabled:function(n){return this.each(function(){n?jQuery(this).enable():jQuery(this).disable()})}});Ifm=Ifm||{};namespace("Ifm.ChromeBar.Constants").CallFailureCauseResources={1:"CallFailureNoDialTone",2:"CallFailureNoRingback",3:"CallFailureLineBusy",4:"CallFailureNoAnswer",5:"CallFailureFaxTone",6:"CallFailureRemoteHangUp",7:"CallFailureAgentNoDialTone",8:"CallFailureAgentNoRingback",9:"CallFailureAgentBusy",10:"CallFailureAgentNoAnswer",255:"CallFailureUnknown"};namespace("Ifm.ChromeBar.Constants").LogLevels={Debug:"DEBUG",Warn:"WARN",Error:"ERROR",Fatal:"FATAL"};namespace("Ifm.ChromeBar.Constants").Skins={beach:"Beach",dark:"Dark",flowers:"Flowers",forest:"Forest",nexgen:"NexGen",pastel:"Pastel",portofino:"Portofino",purple:"Purple",red:"Red",sand:"Sand",sky:"Sky",wood:"Wood"};namespace("Ifm.ChromeBar.Constants").Languages={en:"English",it:"Italiano"};namespace("Ifm.ChromeBar.Constants").PhoneDevices={SPC:"SoftPhone",WebRTC:"WebRTC",Teams:"Teams"};namespace("Ifm.ChromeBar.Constants").MessageCodes={ChromeBarStatusChangedEvent:"chromeBarStatusChangedEvent",ChromeBarStatusTimerChangedEvent:"chromeBarStatusTimerChangedEvent",ChromeBarUpdateVuMetersEvent:"updateVuMetersEvent",ChromeBarDialTextBoxUpdateEvent:"dialTextBoxUpdateEvent",GetConfigurationRequest:"getConfigurationRequest",GetConfigurationReply:"getConfigurationReply",SetConfigurationRequest:"setConfigurationRequest",SetConfigurationReply:"setConfigurationReply",ConfigurationChangedEvent:"configurationChangedEvent",DumpRequest:"dump",ShowNotificationRequest:"showNotification",DialPadStateChangedEvent:"dialpadStateChangedEvent",QueueInfoUpdateEvent:"queueInfoUpdateEvent",ToggleQueueInfoRequest:"toggleQueueInfoRequest",ToggleQueueInfoReply:"toggleQueueInfoReply",SetCampaigPanelVisibilityEvent:"setCampaignPanelVisibilityEvent",InitializeRequest:"initializeRequest",DeregisterRequest:"deregisterRequest",GetCallsRequest:"getCallsRequest",GetCallsReply:"getCallsReply",ConnectionLostEvent:"connectionLostEvent",ProxyCommandExecutionResult:"proxyCommandExecutionResult",ChatClientConnectedEvent:"chatClientConnectedEvent",ChatClientDisconnectedEvent:"chatClientDisconnectedEvent",PopupChatWindowRequest:"popupChatWindowRequest",OpenChatWindowRequest:"openChatWindowRequest",DetachPopupWindowRequest:"detachPopupWindowRequest",CommunicationPortClosedEvent:"communicationPortClosed",GetProductVersionRequest:"getProductVersionRequest",GetProductVersionReply:"getProductVersionReply",CallDataChangedEvent:"callDataChangedEvent",EnableChromeBarButtonRequest:"enableChromeBarButtonRequest",EnableChromeBarButtonReply:"enableChromeBarButtonReply",ToggleRecordingPanelRequest:"toggleRecordingPanelRequest",ToggleRecordingPanelReply:"toggleRecordingPanelReply",MediaAccessGrantedEvent:"mediaAccessGrantedEvent",GetCallHistoryLogRequest:"getCallHistoryLogRequest",GetCallHistoryLogReply:"getCallHistoryLogReply",ClearCallHistoryLogRequest:"clearCallHistoryLogRequest",ToggleExternalPluginPopupRequest:"toggleExternalPluginPopupRequest",ToggleExternalPluginPopupReply:"toggleExternalPluginPopupRequest",OpenLoginDialogRequest:"openLoginDialogRequest",CloseLoginDialogRequest:"closeLoginDialogRequest",InitializeOffScreenPageRequest:"initializeOffScreenPageRequest",NoMoreChromePageAliveEvent:"noMoreChromePageAliveEvent",OnNotificationClickedEvent:"onNotificationClickedEvent",OnTabRemovedEvent:"onTabRemovedEvent",OnWindowRemovedEvent:"onWindowRemovedEvent",OpenOptionsPageRequest:"openOptionPageRequest",KeepAliveRequest:"keepAliveRequest",KeepAliveReply:"keepAliveReply",SetBadgeTextRequest:"setBadgeTextRequest",SetCallHistoryLogRequest:"setCallHistoryLogRequest",SetIconRequest:"setIconRequest",NotificationsClearRequest:"clearNotification",CreateWindowRequest:"createWindowRequest",CreateWindowReply:"createWindowReply",CloseWindowRequest:"closeWindowRequest",UpdateWindowRequest:"updateWindowRequest",GetOauth2TokenRequest:"getOauth2TokenRequest",GetOauth2TokenReply:"getOauth2TokenReply",Oauth2LogoutRequest:"oauth2LogoutRequest",LoginRequest:"loginRequest",LoginExRequest:"loginExRequest",LoginWithTokenRequest:"loginWithToken",Oauth2LoginRequest:"oath2LoginRequest",ProvisioningAndLoginRequest:"provisioningAndLoginRequest",ProvisioningAndLoginReply:"provisioningAndLoginReply",RefreshTokenRequest:"refreshTokenRequest",LoginReply:"loginReply",LogoutRequest:"logoutRequest",LogoutReply:"logoutReply",PauseRequest:"pauseRequest",PauseReply:"pauseReply",ReadyRequest:"readyRequest",ReadyReply:"readyReply",MakePhonesCallRequest:"makeCallRequest",MakePhonesCallReply:"makeCallReply",AbortCallRequest:"abortCallRequest",AbortCallReply:"abortCallReply",GetAgentListRequest:"agentListRequest",GetAgentListReply:"agentListReply",GetTransferAgentListRequest:"transferAgentListRequest",GetTransferAgentListReply:"transferAgentListReply",GetCampaignListRequest:"campaignListRequest",GetCampaignListReply:"campaignListReply",GetAssignedCampaignListRequest:"assignedCampaignListRequest",GetAssignedCampaignListReply:"assignedCampaignListReply",GetOutboundCampaignListRequest:"outboundCampaignListRequest",GetOutboundCampaignListReply:"outboundCampaignListReply",GetTransferCampaignListRequest:"getTransferCampaignListRequest",GetTransferCampaignListReply:"getTransferCampaignListReply",GetPauseReasonsRequest:"pauseReasonsRequest",GetPauseReasonsReply:"pauseReasonsReply",GetQueueInfoRequest:"queueInfoRequest",GetQueueInfoReply:"queueInfoReply",PanicEvent:"panicEvent",LogEvent:"logEvent",StartRecordingRequest:"startRecordingRequest",StopRecordingRequest:"stopRecordingRequest",MuteRecordingRequest:"muteRecordingRequest",TagRecordingRequest:"tagCallRecordingRequest",TransferCallRequest:"transferCallRequest",TransferCallReply:"transferCallReply",AddCallDataRequest:"addCallDataRequest",SetCallDataRequest:"setCallDataRequest",SaveCallDataRequest:"saveCallDataRequest",SwapCallRequest:"swapCallRequest",StartDTMFMaskingRequest:"startDTMFMasking",StopDTMFMaskingRequest:"stopDTMFMasking",MaskedDigitReceivedEvent:"maskedDigitReceivedEvent",MaskedPayloadReceivedEvent:"maskedPayloadReceivedEvent",GetAuthorityInfoRequest:"getAuthorityInfoRequest",GetAuthorityInfoReply:"getAuthorityInfoReply",GetProvisioningSiteListRequest:"getProvisioningSiteListRequest",GetProvisioningSiteListReply:"getProvisioningSiteListReply",GetModuleConfigurationRequest:"getModuleConfigurationRequest",GetModuleConfigurationReply:"getModuleConfigurationReply",InitializedEvent:"initializedEvent",BookedEvent:"bookedEvent",AssignmentEvent:"assignmentEvent",AlertingEvent:"alertingEvent",AnsweredEvent:"answeredEvent",CallFailureEvent:"callFailureEvent",OtherCallEvent:"othercallEvent",PauseBookedEvent:"pauseBookedEvent",PauseEvent:"pauseEvent",ReadyEvent:"readyEvent",ReadyForDetachEvent:"readyForDetachEvent",ReadyForTransferEvent:"readyForTransferEvent",TerminatedEvent:"terminatedEvent",RecordingStartedEvent:"recordingStartedEvent",RecordingMuteChangedEvent:"recordingMuteChangedEvent",RecordingStoppedEvent:"recordingStoppedEvent",StateChangedEvent:"stateChangedEvent",StateTimeChangedEvent:"stateTimeChangedEvent",SupervisorMessageEvent:"supervisorMessageEvent",CallTransferInitiatedEvent:"callTransferInitiatedEvent",DialNumberRequest:"dialNumberRequest",DialNumberReply:"dialNumberReply",EnterConferenceRequest:"enterConferenceRequest",EnterConferenceReply:"enterConferenceReply",LeaveConferenceRequest:"leaveConferenceRequest",LeaveConferenceReply:"leaveConferenceReply",HangupRequest:"hangupRequest",HangupReply:"hangupReply",MakeManualCallRequest:"makeManualCallRequest",MakeManualCallReply:"makeManualCallReply",MicrophoneOffRequest:"microphoneOffRequest",MicrophoneOffReply:"microphoneOffReply",MicrophoneOnRequest:"microphoneOnRequest",MicrophoneOnReply:"microphoneOnReply",PickupRequest:"pickupRequest",PickupReply:"pickupReply",SelectLineRequest:"selectLineRequest",SelectLineReply:"selectLineReply",SwitchLineRequest:"switchLineRequest",SwitchLineReply:"switchLineReply",SendDtmfRequest:"sendDigitRequest",SendDtmfReply:"sendDigitReply",RegisterRequest:"registerRequest",RegisterReply:"registerReply",UnregisterRequest:"unregisterRequest",UnregisterReply:"unregisterReply",PhoneLineStateChangedEvent:"phoneLineStateChangedEvent",PhoneLineSelectedEvent:"phoneLineSelectedEvent",PhoneInitializedEvent:"phoneInitializedEvent",PhoneConnectedEvent:"phoneConnectedEvent",PhoneDisconnectedEvent:"phoneDisconnectedEvent",PhoneRegisteredStateChangedEvent:"phoneRegisteredStateChangedEvent",PhoneConferenceStateChangedEvent:"phoneConferenceStateChangedEvent",PhoneCallingEvent:"phoneCallingEvent",PhoneCallConnectedEvent:"phoneCallConnectedEvent",PhoneCallDisconnectedEvent:"phoneCallDisconnectedEvent",PhoneDisplayNameEvent:"phoneDispayNameEvent",PhoneIncomingCallEvent:"phoneIncomingCallEvent",PhoneRingingEvent:"phoneRingingEvent",PhoneMuteChangedEvent:"phoneMuteChangedEvent",PhoneVUMeterEvent:"phoneVUMeterEvent",ConnectedEvent:"connectedEvent",DisconnectedEvent:"disconnectedEvent",RegisterClientPageRequest:"registerClientPageRequest",RegisterClientPageReply:"registerClientPageReply",OnPhonesbarEvent:"onPhonebarEvent",CheckExtensionRequest:"checkExtensionRequest",CheckExtensionReply:"checkExtensionReply",ExtensionConnectionFailedEvent:"extensionConnectionFailedEvent"};namespace("Ifm.ChromeBar.Constants").UIElementClasses={PopupBody:".chromebar-popup-body",PopupBodyExpanded:".chromebar-popup-body-expanded",PopupBodyLeftPanel:".chromebar-left-popup-body",PopupBodyRightPanel:".chromebar-right-popup-body",PopupBodyMenuPanel:".chromebar-menu-popup-body",ChromeBarPanelContainer:".chromebar-panels-container",ChromeBarMainPanel:".chromebar-main-panel",ChromeBarSecondaryPanel:".chromebar-secondary-panel",ChromeBarMenuPanel:".chromebar-menu-panel",QueueInfoPanel:".chromebar-queue-info-panel",CampaignInfoPanel:".chromebar-campaign-info-panel",CampaignInfoPanelCard:".chromebar-campaign-info-panel-card",RecordingCmdsPanel:".chromebar-recording-commands-panel",MainToolbar:".phonebar-toolbar",PhoneToolbar:".phonebar-phone-toolbar",PhoneDialPad:".phonebar-phone-dialpad",LogText:".phonebar-log-text",MarqueeLabel:".phonebar-state-text",TimerLabel:".phonebar-state-time-text",PhoneStateText:".phonebar-phone-state-text",RecordingStateText:".phonebar-recording-state-text",DialedDigitsLabel:".phonebar-dialed-digits",NumberLabel:".phonebar-number-label",NumberInput:".phonebar-number-input",QueueInfoLabel:".chromebar-queue-info-label",CueSheetInput:".phonebar-cuesheet-text-input",LoginButton:".phonebar-login-button",LoginOrReadyButton:".phonebar-login-ready-button",ReadyButton:".phonebar-ready-button",PauseButton:".phonebar-pause-button",LogoutButton:".phonebar-logout-button",CallButton:".phonebar-call-button",AbortCallButton:".phonebar-abort-call-button",TransferButton:".phonebar-transfer-button",CampaignListButton:".phonebar-campaignlist-button",QueueInfoButton:".phonebar-queueinfo-button",PanicButton:".phonebar-panic-button",StartRecordingButton:".phonebar-start-recording-button",StopRecordingButton:".phonebar-stop-recording-button",MuteRecordingButton:".phonebar-mute-recording-button",UnmuteRecordingButton:".phonebar-unmute-recording-button",AddCueSheetButton:".phonebar-add-cuesheet-button",ShowRecordingPanelButton:".phonebar-recording-button",ExternalPlugin1Button:".phonebar-plugin1-button",ExternalPlugin2Button:".phonebar-plugin2-button",ExternalPlugin3Button:".phonebar-plugin3-button",ConfigurationButton:".phonebar-configuration-button",HangupButton:".phonebar-phone-hangup-button",PickupButton:".phonebar-phone-pickup-button",FlashButton:".phonebar-phone-flash-button",ManualTransferButton:".phonebar-phone-manual-transfer-button",Line1Button:".phonebar-phone-line1-button",Line2Button:".phonebar-phone-line2-button",EnterConferenceButton:".phonebar-phone-enter-conference-button",LeaveConferenceButton:".phonebar-phone-leave-conference-button",MicrophoneVULabel:".phonebar-phone-microphone-label",MicrophoneVUMeter:".phonebar-phone-microphone-meter",SpeakersVULabel:".phonebar-phone-speakers-label",SpeakersVUMeter:".phonebar-phone-speakers-meter",MicrophoneOffButton:".phonebar-phone-microphone-off-button",MicrophoneOnButton:".phonebar-phone-microphone-on-button",HideDialPadButton:".phonebar-phone-dialpad-hide-button",ShowDialPadButton:".phonebar-phone-dialpad-show-button",SoftPhoneStateLabel:".phonebar-phone-softphone-state-label",XmppStateLabel:".phonebar-phone-xmpp-state-label",DialpadDigit0Button:".phonebar-phone-key-digit0",DialpadDigit1Button:".phonebar-phone-key-digit1",DialpadDigit2Button:".phonebar-phone-key-digit2",DialpadDigit3Button:".phonebar-phone-key-digit3",DialpadDigit4Button:".phonebar-phone-key-digit4",DialpadDigit5Button:".phonebar-phone-key-digit5",DialpadDigit6Button:".phonebar-phone-key-digit6",DialpadDigit7Button:".phonebar-phone-key-digit7",DialpadDigit8Button:".phonebar-phone-key-digit8",DialpadDigit9Button:".phonebar-phone-key-digit9",DialpadHashButton:".phonebar-phone-key-hash",DialpadStarButton:".phonebar-phone-key-star",TransferCampaignList:".phonebar-transfer-campaign-list",TransferAgentList:".phonebar-transfer-agent-list",TransferMandatoryCheck:".phonebar-transfer-mandatory-check"};namespace("Ifm.ChromeBar.Constants").Templates={QueueInfoLabel:"{number}\t{queuedNumberText} | {maxTime}\t{queuedMaxTimeText} | {avgTime}\t{queuedAvgTimeText}",QueueInfoCard:'<div class="phonebar-queueinfo-card-content"><div><b>{number}<\/b> {queuedNumberText}<\/div><div><b>{maxTime}<\/b> {queuedMaxTimeText}<\/div><div><b>{avgTime}<\/b> {queuedAvgTimeText}<\/div><\/div>',QueueInfoCardEx:'<div class="phonebar-queueinfo-card-content"><table id="options" style="width: 100%;"><colgroup><col span="1" style="width: 60%;"><col span="1" style="width: 40%;"><\/colgroup><tbody><tr class="spaceUnder"><td><label class="queued-call-count-label" id="queuedcallscountlbl">{queuedNumberText}:<\/label><\/td><td><label class="queued-call-count-value" id="queuedcallscountvalue">{number}<\/label><\/td><\/tr><tr class="spaceUnder"><td><label class="queued-call-maxtime-label" id="queuedcallsmaxtimelbl">{queuedMaxTimeText}:<\/label><\/td><td><label class="queued-call-maxtime-value" id="queuedcallsmaxtimevalue">{maxTime}<\/label><\/td><\/tr><tr class="spaceUnder"><td><label class="queued-call-avgtime-label" id="queuedcallsavgtimelbl">{queuedAvgTimeText}:<\/label><\/td><td><label class="queued-call-avgtime-value" id="queuedcallsavgtimevalue">{avgTime}<\/label><\/td><\/tr><\/tbody><\/table><\/div>',CallListCard:'<div class="phonebar-campaignlist-card-content"><table class="phonebar-campaignlist-card-table"><thead><tr><th>{callidth}<\/th><th style="width: 15%;">{mediatypeth}<\/th><th style="width: 70%;">{campaignth}<\/th><th>{isrecordingth}<\/th><th>{inpostcallth}<\/th><\/tr><\/thead><tbody>{body}<\/tbody><\/table><\/div>',CallHistoryListRow:'<tr><td class="phonebar-campaignlist-card-table-element">{callid}<\/td><td class="phonebar-campaignlist-card-table-element">{datetime}<\/td><td class="phonebar-campaignlist-card-table-element">{campaign}<\/td><td class="phonebar-campaignlist-card-table-element">{phonenumber}<\/td><td class="phonebar-campaignlist-card-table-element">{displayname}<\/td><\/tr>',CallHistoryListCard:'<div class="phonebar-campaignlist-card-content"><table class="phonebar-campaignlist-card-table"><thead><tr><th style="width: 10%;">{callidth}<\/th><th style="width: 20%;">{datetimeth}<\/th><th style="width: 30%;">{campaignth}<\/th><th style="width: 15%;">{phonenumberth}<\/th><th style="width: 25%;">{displaynameth}<\/th><\/tr><\/thead><tbody>{body}<\/tbody><\/table><\/div>',CallListRow:'<tr><td class="phonebar-campaignlist-card-table-element">{callid}<\/td><td class="phonebar-campaignlist-card-table-element">{mediatype}<\/td><td class="phonebar-campaignlist-card-table-element">{campaign}<\/td><td class="phonebar-campaignlist-card-table-element">{isrecording}<\/td><td class="phonebar-campaignlist-card-table-element">{inpostcall}<\/td><\/tr>',CampaignListCard:'<div class="phonebar-campaignlist-card-content"><table class="phonebar-campaignlist-card-table"><thead><tr><th style="width: 70%;">{nameth}<\/th><th>{boundnessth}<\/th><th>{stateth}<\/th><\/tr><\/thead><tbody>{body}<\/tbody><\/table><\/div>',CampaignListCardEx:'<div class="phonebar-campaignlist-card-content" style="overflow-y: scroll;"><table class="phonebar-campaignlist-card-table"><thead><tr><th>{nameth}<\/th><th>{boundnessth}<\/th><th>{stateth}<\/th><\/tr><\/thead><tbody>{body}<\/tbody><\/table><\/div>',CampaignListRow:'<tr><td class="phonebar-campaignlist-card-table-element">{name}<\/td><td class="phonebar-campaignlist-card-table-element">{boundness}<\/td><td class="phonebar-campaignlist-card-table-element">{state}<\/td><\/tr>',IncomingCallCard:'<div class="phonebar-incoming-call-card-content"><div class="phonebar-incoming-call-text">{incomingCallText}<\/div><div class="phonebar-incoming-call-number">{incomingCallNumber}<\/div><div class="phonebar-incoming-call-campaign">{campaignName}<\/div><\/div>',LoginDialog:'<fieldset><div><label class="phonebar-form-label" for="firstnametxt">{firstNameLabel}<\/label><input class="phonebar-form-input" type="text" id="firstnametxt" value="{firstName}"><\/div><div><label class="phonebar-form-label" for="lastnametxt">{lastNameLabel}<\/label><input class="phonebar-form-input" type="text" id="lastnametxt" value="{lastName}"><\/div><div><label class="phonebar-form-label" for="passwordtxt">{passwordLabel}<\/label><input class="phonebar-form-input" type="password" id="passwordtxt" value="{password}"><\/div><\/fieldset>',LoginDialogBtnTable:'<div><hr /><table id="table2" style="width: 100%" ><colgroup><col span="1" style="width: 70%;"><col span="1" style="width: 20%;"><col span="1" style="width: 10%;"><\/colgroup><tbody style="border: none"><tr><td align="left"><button id="changepasswordbtn" class="dialog-button" value="ChangePassword">{changePasswordBtn}<\/button><\/td><td><button id="cancelloginbtn" class="dialog-button" value="Cancel">{cancelBtn}<\/button><\/td><td><button id="submitloginbtn" type="submit" class="dialog-button">{okBtn}<\/button><\/td><\/tr><\/tbody><\/table><\/div>',Login2Dialog:'<fieldset><div><label class="phonebar-form-label" for="firstnametxt">{firstNameLabel}<\/label><input class="phonebar-form-input" type="text" id="firstnametxt" value="{firstName}"><\/div><div><label class="phonebar-form-label" for="lastnametxt">{lastNameLabel}<\/label><input class="phonebar-form-input" type="text" id="lastnametxt" value="{lastName}"><\/div><div><label class="phonebar-form-label" for="oldPasswordtxt">{oldPasswordLabel}<\/label><input class="phonebar-form-input" type="password" id="oldPasswordtxt" value="{oldPassword}"><\/div><div><label class="phonebar-form-label" for="newPasswordtxt">{newPasswordLabel}<\/label><input class="phonebar-form-input" type="password" id="newPasswordtxt" value="{newPassword}"><\/div><div><label class="phonebar-form-label" for="confirmPasswordtxt">{confirmPasswordLabel}<\/label><input class="phonebar-form-input" type="password" id="confirmPasswordtxt" value="{confirmPassword}"><\/div><\/fieldset>',Login2DialogBtnTable:'<div><hr /><table id="table2" style="width: 100%" ><colgroup><col span="1" style="width: 70%;"><col span="1" style="width: 20%;"><col span="1" style="width: 10%;"><\/colgroup><tbody><tr><td><\/td><td><button id="cancelloginbtn" class="dialog-button" value="Cancel">{cancelBtn}<\/button><\/td><td><button id="submitloginbtn" type="submit" class="dialog-button">{okBtn}<\/button><\/td><\/tr><\/tbody><\/table><\/div>',Login3Dialog:'<fieldset><div><label class="phonebar-form-label" for="usernametxt">{userNameLabel}<\/label><input class="phonebar-form-input" type="text" id="usernametxt" value="{userName}"><\/div><\/fieldset>',Login4Dialog:'<fieldset><div><label class="phonebar-form-label" for="sitenametxt">{siteNameLabel}<\/label><select class="cfginputtextshort" id="sitenametxt">{sitesList}<\/select><\/div><\/fieldset>',MessageCard:'<div class="phonebar-message-{severity}"><i class="material-icons">{icon}<\/i> <span class="phonebar-message-title">{title}<\/span><\/div><div class="phonebar-message-text">{message}<\/div>',SupervisorMessageCard:'<div class="phonebar-supervisor-message-{severity}"><i class="material-icons">{icon}<\/i> <span class="phonebar-supervisor-message-title">{title}<\/span><\/div><div class="phonebar-supervisor-message-text">{message}<\/div>',TransferCallCard:'<div class="phonebar-transfercall-card-content" style="height:{height}px"><select class="phonebar-transfer-campaign-list"><\/select><br><select class="phonebar-transfer-agent-list" size="10" style="height: {selectHeight}px"><\/select><label><input type="checkbox" class="phonebar-transfer-mandatory-check" checked>{mandatoryLabel}<\/label><\/div>',TransferCallAgentListItem:'<option class="phonebar-transfer-agent-list-item" firstName="{0}" lastName="{1}" agentState="{2}">{0} {1} {2}<\/option>',TransferCallCampaignListItem:'<option class="phonebar-transfer-campaign-list-item" campaignName="{0}">{1}<\/option>',TransferDialogBtnTable:'<div class="phonebar-transfercall-botton-div"><hr /><table id="table2" style="width: 100%" ><colgroup><col span="1" style="width: 35%;"><col span="1" style="width: 35%;"><col span="1" style="width: 30%;"><\/colgroup><tbody style="border: none"><tr><td align="left"><button id="refreshbtn" class="dialog-button" value="Refresh">{refreshBtn}<\/button><\/td><td><button id="cancelbtn" class="dialog-button" value="Cancel">{cancelBtn}<\/button><\/td><td><button id="submitbtn" type="submit" class="dialog-button">{transferBtn}<\/button><\/td><\/tr><\/tbody><\/table><\/div>'};helpers={areArrayEquals:function(n,t){return n.length===t.length&&n.every((n,i)=>n===t[i])},arrayToString:function(n){var t="";if(n&&helpers.isArray(n))try{n.forEach(n=>{t.length>0&&(t+=", "),t+=n})}catch(i){}return t},friendlyTime:function(n,t){var r,u;t&&(n=n/1e3);r=Math.floor(n%60);n=n/60;u=Math.floor(n%60);n=n/60;var f=Math.floor(n%24),e=Math.floor(n/24),i="";return e>0&&(i+=e+" d "),f>0&&(i+=f+" h "),u>0&&(i+=u+" m "),r>0&&(i+=r+" s "),i},getChromeVersion:function(){var n=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return n?parseInt(n[2],10):!1},isArray:function(n){return Object.prototype.toString.call(n)==="[object Array]"},isBoolean:function(n){return typeof n=="boolean"},isFunction:function(n){return typeof n=="function"},isNull:function(n){return n===null?!0:n===undefined?!0:!1},isNullOrEmpty:function(n){return n===null?!0:n===undefined?!0:n===""?!0:!1},isValidLanguage:function(n){return Ifm.ChromeBar.Constants.Languages[n]!==undefined},isValidPhoneDevice:function(n){return Ifm.ChromeBar.Constants.PhoneDevices[n]!==undefined||n===""},isValidSkin:function(n){return Ifm.ChromeBar.Constants.Skins[n]!==undefined},isValidServicesList:function(n){var i=n,t=!0;return helpers.isArray(n)||(i=n.split(",")),i.forEach(n=>{t=t&helpers.isValidServiceUrl(n)}),t},isValidServiceUrl:function(n){var t=/^((ws{1,2}:\/\/)|(\*\.))[a-zA-Z0-9-.]+/ig.exec(n);return t&&t.length>0},log:function(n){var t=n;arguments.length>1&&(t=Array.prototype.splice.call(arguments,0).join(" "));console.log(t)},parseInt:function(n,t){var i=parseInt(n);return i==NaN?t:i},postMessage:function(n,t){try{if(n!==null)return n.postMessage(t),!0}catch(i){try{return n.postMessage(JSON.parse(JSON.stringify(t))),!0}catch(i){return!1}}return!1},showNotification:function(n,t,i,r,u,f,e,o){var s={type:"basic",title:n,message:t,contextMessage:i||"ChromeBar",requireInteraction:u||!1,iconUrl:r||"./assets/icons/96.png",buttons:e,priority:o||2};f?chrome.notifications.create(String(f),s,undefined):chrome.notifications.create(s,undefined)},stringify:function(n){let t=[],i=JSON.stringify(n,function(n,i){if(typeof i=="object"&&i!==null){if(t.indexOf(i)!==-1)return;t.push(i)}return i});return t=null,i}};namespace("Ifm.ChromeBar").Proxy={about:{product:"#phones",title:"ChromeBarProxy",version:"1.4.16.4357"},events:defineEvents("initialized","disconnected","connected","connectionFailure","saveConfigReply","configChangedEvent","buttonStateChangedEvent","booked","assignment","alerting","answered","callfailure","othercall","pausebooked","pause","ready","readyfordetach","readyfortransfer","terminated","recordingstarted","recordingmutechanged","recordingstopped","maskeddigitreceived","maskedpayloadreceived","statechanged","statetimechanged","supervisormessage","onconnected","ondisconnected","onabortcallreply","onalertingevent","onansweredevent","onassignmentrequest","onrecordingcompletedevent","onrecordingmutedevent","onrecordingstartedevent","onbookedevent","oncallfailureevent","oncalltransferinitiatedevent","onconnectionremovedevent","ondeviceinfochangedevent","ondisplaynamechangedevent","onphonebarclosedevent","onloginreply","onlogoutreply","onnewcallreply","onothercallevent","onpauseevent","onpausereply","onphonebarconnectionlostevent","onpostcallworkevent","onreadyevent","onreadyfordetachevent","onreadyreply","onreadyfortransferevent","onretrievecallreply","onrejectableassignmentrequest","onterminatedevent","ontransferreply","onsupervisormessageevent","onmaskeddigitreceivedevent","onmaskedpayloadreceivedevent","onqueueinforeply","onagentslistreply","oncampaignslistreply","onpausereasonslistreply","onagentdetailsreply","ongetcallhistorylogreply","oncommandexecutedevent"),AgentInfoMask:{NotAvailable:1,Available:2,Assigned:4,Booked:8,Talking:16,Paused:32,PostCallWork:64,OtherCall:128,AnyAvailable:254,AnyCampaign:0,SpecificCampaign:256,OmitSynthetics:512,OmitHumans:1024},CampaignInfoMask:{Inactive:1,Active:2,Suspended:4,StatusMask:7,Inbound:8,Outbound:16,BoundnessMask:24,NotAssigned:32,Assigned:64,AssignmentMask:96,PostCallWork:128,HideTransferNotAllowed:256,ExcludeSyntheticCampaigns:512,ExcludeHumanCampaigns:1024},RecordingStates:{Inactive:0,Active:1,TxChannelMuted:2,RxChannelMuted:4},States:{Initialization:"[Initialization]",NotLoggedIn:"[Not Logged In]",Connecting:"[Connecting]",LoggedIn:"[Logged In]",Paused:"[Paused]",Ready:"[Ready]",Alerting:"[Alerting]",Talking:"[Talking]",PostCall:"[Post Call]",OtherCall:"[Other Call]",Assigned:"[Assigned]",WaitingOutbound:"[Waiting Outbound]",WaitingTransfer:"[Waiting Transfer]"},MediaTypes:{Voice:1,AtPhones:2,Video:4,VoiceAndVideo:5,NearRealTime:8,StoreAndForward:16},LoginReplyFailureCauses:{Unspecified:0,AccountLockout:1,ExpiredPassword:2,WrongUsernameOrPassword:3,InvalidNewPassword:4,PasswordChangeNotAllowed:5,WrongState:6,InvalidExtension:7,ExtensionAlreadyInUse:8,TokenBasedLoginNotAvailable:9,InvalidToken:10,ExtensionTranslationError:128},AgentStates:{1:"[Not Available]",2:"[Available]",4:"[Assigned]",8:"[Booked]",16:"[Talking]",32:"[Paused]",64:"[Post-Call]",128:"[Manual Call]"},CallFailureCauses:{1:"[No Dial Tone]",2:"[No Ringback]",3:"[Line Busy]",4:"[No Answer]",5:"[Fax Tone]",6:"[Remote Hangup]",7:"[Agent: No Dial Tone]",8:"[Agent: No Ringback]",9:"[Agent: Line Busy]",10:"[Agent: No Answer]",255:"[Unknown]"},CallFailureCauseResources:{1:"CallFailureNoDialTone",2:"CallFailureNoRingback",3:"CallFailureLineBusy",4:"CallFailureNoAnswer",5:"CallFailureFaxTone",6:"CallFailureRemoteHangUp",7:"CallFailureAgentNoDialTone",8:"CallFailureAgentNoRingback",9:"CallFailureAgentBusy",10:"CallFailureAgentNoAnswer",255:"CallFailureUnknown"},UpdateConfigurationFailureCauses:{1:"[Invalid Configuration]",2:"[Wrong ChromeBar State]"},ChromeBarButtonIndexes:{btnLogin:1,btnPause:2,btnLogout:3,btnCall:4,btnTransfer:5,btnAssignment:6,btnFlashDial:7,btnHookstate:8,btnFlash:9,btnRetake:10,btnMute:11,btnLine1:12,btnLine2:13,btnConference:14,btnStartRecording:15,btnStopRecording:16,brnMuteRecording:17,btnMuteRecording:17,btnDialPad:18,btnQueueInfo:19,btnPanic:20},canRun:function(){return!0},run:function(){this.run=function(){self.log("PhoneBar","Debug","Already running")};this.instance.initialize()},instance:function(){function it(l){var a=l.data.details,v,w,ii,fi,it,st,ui,ri;if(a&&(a.command===i.CheckExtensionReply&&b&&(b(!0),clearTimeout(k),k=null,b=null),t))switch(a.command){case i.DumpRequest:console.log(a.message);break;case i.ExtensionConnectionFailed:t.events.connectionFailure.raise(t);break;case i.RegisterClientPageReply:for(d&&(console.log("[Proxy] RegisterClientPageReply received: Stopping connection timeout"),clearTimeout(d)),y=a.state.CurrentState,u=a.configuration,nt=a.currentStateReason,g=a.state.CurrentStateTime,p=a.state,e=a.stringPh,c=a.language,tt=a.numberOfLines,ft=a.supportsConference,f={},ii=0;ii<a.calls.length;ii++)it=new Ifm.Messaging.FPropertyList(a.calls[ii].callData.originalString),it.save=function(){t.savecalldata(st)},it.events.changed=function(n,t){window.postMessage({type:"chromebarProxy",params:i.SetCallDataRequest,callId:st,key:t.key,value:t.value},"*")},a.calls[ii].callData=it,f[a.calls[ii].callId]=a.calls[ii];a.phone&&(t.media.phone=new Ifm.ChromeBar.Proxy.Media.Phone(t),t.media.phone.numberOfLines=a.numberOfLines,t.media.phone.supportsConference=a.supportsConference);t.agent.firstName=a.agentInfo.firstName;t.agent.lastName=a.agentInfo.lastName;t.agent.username=a.agentInfo.username;t.agent.extension=a.agentInfo.extension;t.agent.password=a.agentInfo.password;t.agent.id=a.agentInfo.agentId;t.config.service=a.configuration.config.service;et=a.chromebarVersion;ot=a.phonebarVersion;t.media.xmpp=Ifm.PhoneBar.Media.Xmpp.instance;try{t.isLoggedIn()&&u.options.autoConnectToXmppServer&&t.media.xmpp.initialize(t,u.xmppconfig,Ifm.ChromeBar.Proxy)}catch(ei){}t.scriptControlMode?t.events.onconnected.raise():(ni(),t.events.initialized.raise(t,{accepted:a.accepted,reasonCode:a.reasonCode}));t.scriptControlMode||(ht(a.state,!0),t.events.statechanged.raise(t,{previousState:"[Initialization]",currentState:y}),t.events.statetimechanged.raise(t,{stateTime:a.state.CurrentStateTime,startTimer:a.state.StartTimer}));t.media.phone&&(t.media.phone._onLineSelected(a.lineSelected),t.media.phone._onLineStateChanged(0,a.lineState0),tt>1&&t.media.phone._onLineStateChanged(1,a.lineState1));break;case i.DisconnectedEvent:case i.ConnectionLostEvent:rt();t.scriptControlMode?t.events.onphonebarclosedevent.raise({}):(a.command===i.ConnectionLostEvent?t.events.disconnected.raise(t,{clean:!1,failed:!1,lost:!0}):t.events.disconnected.raise(t,a.message),ti());break;case i.ProxyCommandExecutionResult:t.scriptControlMode&&t.events.oncommandexecutedevent.raise({commandcode:a.message.commandCode,result:a.message.result});break;case i.ChromeBarStatusChangedEvent:y=a.message.CurrentState;p=a.message;a.message.stateOnly&&(fi=a.message.stateOnly);t.scriptControlMode||ht(p,!1,fi);break;case i.ChromeBarUpdateVuMetersEvent:t.scriptControlMode||(jQuery(n.SpeakersVUMeter).val(a.message.speakers),jQuery(n.MicrophoneVUMeter).val(a.message.microphone));break;case i.ChromeBarStatusTimerChangedEvent:t.scriptControlMode||jQuery(n.TimerLabel).html(a.message).change();break;case i.ChromeBarDialTextBoxUpdateEvent:t.scriptControlMode||jQuery(n.NumberInput).val(a.text).change();break;case i.SetConfigurationReply:t.events.saveConfigReply.raise(t,{accepted:a.updated,cause:a.reason});v=r.setConfiguration.shift();v&&v(a.updated,a.reason);break;case i.ConfigurationChangedEvent:u=a.message;t.events.configChangedEvent.raise(t,{configuration:u});break;case i.LoginReply:t.agent.extension=a.extension;t.agent.id=a.agentId;t.agent.firstName=a.firstName||"";t.agent.lastName=a.lastName||"";t.agent.username=a.username||"";u.options.autoConnectToXmppServer&&a.message.accepted&&t.media.xmpp.initialize(t,u.xmppconfig,Ifm.ChromeBar.Proxy);v=r.login.shift();v&&v(a.message);t.scriptControlMode&&o(!0,!1,"")&&t.events.onloginreply.raise({accepted:a.message.accepted,failureCause:a.message.failureCause});break;case i.LogoutReply:v=r.logout.shift();v&&v(a.message);t.scriptControlMode&&o(!0,!1,"")&&t.events.onlogoutreply.raise({accepted:a.message.accepted});break;case i.PauseReply:v=r.pause.shift();v&&v(a.message);a.accepted!==3&&t.scriptControlMode&&o(!0,!1,"")&&t.events.onpausereply.raise({accepted:a.message.accepted,reasonid:a.message.reasonId,description:a.message.reasonText});break;case i.ReadyReply:v=r.ready.shift();v&&v(a.message);t.scriptControlMode&&o(!0,!0,"*")&&t.events.onreadyreply.raise({accepted:a.message.accepted});break;case i.MakePhonesCallReply:v=r.make.shift();v&&v(a.message);t.scriptControlMode&&o(!0,!0,a.message.campaign)&&t.events.onnewcallreply.raise({campaign:a.message.campaign,callid:a.message.callId,accepted:a.message.accepted});break;case i.AbortCallReply:t.scriptControlMode&&o(!0,!0,a.message.campaign)&&t.events.onabortcallreply.raise({campaign:a.message.campaign,callid:a.message.callId,accepted:a.message.accepted});break;case i.TransferCallReply:v=r.transfer.shift();v&&v(a.message);t.scriptControlMode&&o(!0,!0,a.message.campaign,h(a.message.callId))&&t.events.ontransferreply.raise({campaign:a.message.campaign,callid:a.message.callId,mediatype:h(a.message.callId),accepted:a.message.accepted});break;case i.CallTransferInitiated:t.scriptControlMode&&o(!0,!0,a.message.campaign,h(a.message.callId))&&t.events.oncalltransferinitiatedevent.raise({campaign:a.message.campaign,callid:a.message.callId,mediatype:h(a.message.callId)});break;case i.GetAgentListReply:v=r.getAgents.shift().callback;ct();v&&v(a.message);break;case i.GetPauseReasonsReply:v=r.getPauseReasons.shift();lt();v&&v(a.message);break;case i.GetTransferAgentListReply:v=r.getTransferAgents.shift().callback;at();v&&v(a.message);break;case i.GetCampaignListReply:v=r.getCampaigns.shift().callback;vt();v&&v(a.message);break;case i.GetAssignedCampaignListReply:v=r.getAssignedCampaigns.shift();yt();v&&v(a.message);break;case i.GetOutboundCampaignListReply:v=r.getOutboundCampaigns.shift();pt();v&&v(a.message);break;case i.GetTransferCampaignListReply:v=r.getTransferCampaigns.shift().callback;wt();v&&v(a.message);break;case i.GetCallHistoryLogReply:v=r.getCallHistoryLog.shift();bt();v&&v(a.callHistoryLog);break;case i.GetQueueInfoReply:v=r.getQueueInfo.shift().callback;kt();v&&v(a.message);break;case i.GetAuthorityInfoReply:v=r.getAuthorityInfo.shift().callback;dt();v&&v(a.accepted,a.authInfo);break;case i.GetProvisioningSiteListReply:v=r.getSiteListFromProvisioning.shift().callback;ut();v&&v(a.sites);break;case i.GetModuleConfigurationReply:v=r.getModuleConfiguration.shift().callback;gt();v&&v(a.moduleName,a.parameters);break;case i.BookedEvent:t.scriptControlMode?o(!0,!1,"",a.message.mediatype)&&t.events.onbookedevent.raise({campaign:a.message.campaignName,mediatype:a.message.mediatype}):(s(!0)||s(!1,a.message.campaignName))&&t.events.booked.raise(t,a.message);break;case i.AssignmentEvent:it=new Ifm.Messaging.FPropertyList(a.message.callData.originalString);st=a.message.callId;it.save=function(){t.savecalldata(st)};it.events.changed=function(n,t){window.postMessage({type:"chromebarProxy",params:i.SetCallDataRequest,callId:st,key:t.key,value:t.value},"*")};ui=f[st]={callId:st,callGuid:it.get("GUID").toUpperCase(),mediatype:a.message.mediatype,hideNumber:a.message.hideNumber,displayNumber:a.message.displayNumber,campaignName:a.message.campaignName,callData:it,otherData:{serviceId:a.message.otherData.serviceId,campaignId:a.message.otherData.campaignId,scriptName:a.message.otherData.scriptName,scriptParameters:a.message.otherData.scriptParameters},isRecording:a.message.isRecording,recordingData:{fileName:a.message.recordingData.fileName,settings:a.message.recordingData.settings,rxChannelMuted:a.message.recordingData.rxChannelMuted,txChannelMuted:a.message.recordingData.txChannelMuted}};t.scriptControlMode?o(!0,!0,a.message.campaignName,h(a.message.callId))&&(ri=a.message.isRecording?1:0,a.message.recordingData.txChannelMuted&&(ri+=2),a.message.recordingData.rxChannelMuted&&(ri+=4),t.events.onassignmentrequest.raise({campaign:a.message.campaignName,callid:st,mediatype:ui.mediatype,calldata:a.message.callData.originalString,recordingstate:ri})):s(!1,a.message.campaignName)&&t.events.assignment.raise(t,ui);break;case i.AlertingEvent:t.scriptControlMode?o(!0,!0,a.message.campaignName,h(a.message.callId))&&t.events.onalertingevent.raise({campaign:a.message.campaignName,callid:a.message.callId,mediatype:h(a.message.callId)}):s(!1,a.message.campaignName)&&t.events.alerting.raise(t,a.message);break;case i.AnsweredEvent:t.scriptControlMode?o(!0,!0,a.message.campaignName,h(a.message.callId))&&t.events.onansweredevent.raise({campaign:a.message.campaignName,callid:a.message.callId,mediatype:h(a.message.callId)}):s(!1,a.message.campaignName)&&t.events.answered.raise(t,a.message);break;case i.CallFailureEvent:f[a.message.callId]&&(f[a.message.callId].terminated=!0);t.scriptControlMode?o(!0,!0,a.message.campaignName,h(a.message.callId))&&t.events.oncallfailureevent.raise({campaign:a.message.campaignName,callid:a.message.callId,mediatype:h(a.message.callId),reasoncode:a.message.cause,protocolterminationcause:a.message.protocolTerminationCause,protocolterminationdescription:a.message.protocolTerminationDescription,detectedcontentcode:a.message.detectedContentCode,detectedcontentdescription:a.message.detectedContentDescription}):s(!1,a.message.campaignName)&&t.events.callfailure.raise(t,a.message);f[a.message.callId]&&delete f[a.message.callId];break;case i.OtherCallEvent:t.scriptControlMode?o(!0,!1,"")&&t.events.onothercallevent.raise({}):s(!0)&&t.events.othercall.raise(t,a.message);break;case i.PauseBookedEvent:t.scriptControlMode||s(!0)&&t.events.pausebooked.raise(t,a.message);break;case i.PauseEvent:nt=a.message.reasonText;t.scriptControlMode?o(!0,!1,"")&&t.events.onpauseevent.raise({reasonid:a.message.reasonId,description:a.message.reasonText}):s(!0)&&t.events.pause.raise(t,a.message);break;case i.ReadyEvent:a.message.callId&&f[a.message.callId]&&(f[a.message.callId].postcall=!1,f[a.message.callId].terminated=!0);t.scriptControlMode?o(!0,!1,"",h(a.message.callId))&&t.events.onreadyevent.raise({callid:a.message.callId,mediatype:h(a.message.callId)}):s(!0)&&t.events.ready.raise(t,a.message);a.message.callId&&f[a.message.callId]&&delete f[a.message.callId];Object.values(f).forEach(function(n){n.transferred&&delete f[n.callId]});break;case i.ReadyForDetachEvent:t.scriptControlMode?o(!0,!0,a.message.campaignName,h(a.message.callId))&&t.events.onreadyfordetachevent.raise({campaign:a.message.campaignName,callid:a.message.callId,mediatype:h(a.message.callId),callterminated:a.message.callTerminated,protocolterminationcause:a.message.protocolTerminationCause,protocolterminationdescription:a.message.protocolTerminationDescription,detectedcontentcode:a.message.detectedContentCode,detectedcontentdescription:a.message.detectedContentDescription}):s(!1,a.message.campaignName)&&t.events.readyfordetach.raise(t,a.message);f[a.message.callId]&&f[a.message.callId].transferred&&f[a.message.callId].mediatype>Ifm.ChromeBar.Proxy.MediaTypes.Voice&&delete f[a.message.callId];break;case i.ReadyForTransferEvent:f[a.message.callId].transferred=!0;t.scriptControlMode?o(!1,!0,a.message.campaignName,h(a.message.callId))&&t.events.onreadyfortransferevent.raise({campaign:a.message.campaignName,callid:a.message.callId,mediatype:h(a.message.callId)}):s(!1,a.message.campaignName)&&t.events.readyfortransfer.raise(t,a.message);break;case i.TerminatedEvent:f[a.message.callId].terminated=!0;a.message.postCallWork===1&&(f[a.message.callId].postcall=!0);t.scriptControlMode?o(!0,!0,a.message.campaignName,h(a.message.callId))&&(t.events.onterminatedevent.raise({campaign:a.message.campaignName,callid:a.message.callId,mediatype:h(a.message.callId)}),a.message.postCallWork&&t.events.onpostcallworkevent.raise({campaign:a.message.campaignName,callid:a.message.callId,mediatype:h(a.message.callId)})):s(!1,a.message.campaignName)&&t.events.terminated.raise(t,a.message);f[a.message.callId].postcall||delete f[a.message.callId];break;case i.CallDataChangedEvent:f[a.message.callId]&&(a.message.value!==undefined?f[a.message.callId].callData.set(a.message.key,a.message.value):f[a.message.callId].callData.remove(a.message.key));break;case i.RecordingStartedEvent:w="undefined";f[a.message.callId]&&(f[a.message.callId].isRecording=!0,f[a.message.callId].recordingData.fileName=a.message.fileName,w=f[a.message.callId].campaignName);t.scriptControlMode?o(!0,!1,"")&&t.events.onrecordingstartedevent.raise({callid:a.message.callId,recfilename:a.message.fileName}):s(!1,w)&&t.events.recordingstarted.raise(t,a.message);break;case i.RecordingMuteChangedEvent:w="undefined";f[a.message.callId]&&(f[a.message.callId].recordingData.rxChannelMuted=a.message.rxChannelMuted,f[a.message.callId].recordingData.txChannelMuted=a.message.txChannelMuted,w=f[a.message.callId].campaignName);t.scriptControlMode?o(!0,!1,"")&&t.events.onrecordingmutedevent.raise({callid:a.message.callId,txchannelmuted:a.message.txChannelMuted,rxchannelmuted:a.message.rxChannelMuted}):s(!1,w)&&t.events.recordingmutechanged.raise(t,a.message);break;case i.RecordingStoppedEvent:w="undefined";f[a.message.callId]&&(f[a.message.callId].isRecording=!1,w=f[a.message.callId].campaignName);t.scriptControlMode?o(!0,!1,"")&&t.events.onrecordingcompletedevent.raise({callid:a.message.callId,result:a.message.result}):s(!1,w)&&t.events.recordingstopped.raise(t,a.message);break;case i.MaskedDigitReceivedEvent:w="undefined";f[a.message.callId]&&(w=f[a.message.callId].campaignName);t.scriptControlMode?o(!0,!1,"")&&t.events.onmaskeddigitreceivedevent.raise({callid:a.message.callId}):s(!1,w)&&t.events.maskeddigitreceived.raise(t,a.message);break;case i.MaskedPayloadReceivedEvent:w="undefined";f[a.message.callId]&&(w=f[a.message.callId].campaignName);t.scriptControlMode?o(!0,!1,"")&&t.events.onmaskedpayloadreceivedevent.raise({callid:a.message.callId,payload:a.message.payload,result:a.message.result}):s(!1,w)&&t.events.maskedpayloadreceived.raise(t,a.message);break;case i.StateChangedEvent:y=a.message.currentState;t.scriptControlMode?o(!0,!1,"")&&t.events.statechanged.raise({previousState:a.message.previousState,state:a.message.currentState}):s(!0)&&t.events.statechanged.raise(t,a.message);break;case i.StateTimeChangedEvent:g=a.message.stateTime;t.scriptControlMode||s(!0)&&t.events.statetimechanged.raise(t,a.message);break;case i.SupervisorMessageEvent:t.scriptControlMode?o(!0,!1,"")&&t.events.onsupervisormessageevent.raise({severity:a.message.severity,message:a.message.message}):s(!0)&&t.events.supervisormessage.raise(t,a.message);break;case i.PhoneLineStateChangedEvent:t.media.phone&&t.media.phone._onLineStateChanged(a.message.lineId,a.message.state);break;case i.PhoneLineSelectedEvent:t.media.phone&&t.media.phone._onLineSelected(a.message.lineId);break;case i.PhoneInitilizedEvent:t.media.phone&&t.media.phone._onInitialized();break;case i.PhoneConnectedEvent:t.media.phone&&t.media.phone._onConnected();break;case i.PhoneDisconnectedEvent:t.media.phone&&t.media.phone._onDisconnected(a.message.clean);break;case i.PhoneRegisteredStateChangedEvent:t.media.phone&&t.media.phone._onRegisteredStateChanged(a.message.isRegistered);break;case i.PhoneConferenceStateChangedEvent:t.media.phone&&t.media.phone._onConferenceStateChanged(a.message.inConference);break;case i.PhoneCallingEvent:t.media.phone&&t.media.phone._onCalling(a.message.lineId);break;case i.PhoneCallConnectedEvent:t.media.phone&&t.media.phone._onCallConnected(a.message.lineId);break;case i.PhoneCallDisconnectedEvent:t.media.phone&&t.media.phone._onCallDisconnected(a.message.lineId,a.message.sipCode,a.message.sipCause);break;case i.PhoneDisplayNameEvent:t.media.phone&&t.media.phone._onDisplayName(a.message.lineId,a.message.displayName);break;case i.PhoneIncomingCallEvent:t.media.phone&&t.media.phone._onIncomingCall(a.message.lineId);break;case i.PhoneRingingEvent:t.media.phone&&t.media.phone._onRinging(a.message.lineId,a.message.rings);break;case i.PhoneMuteChangedEvent:t.media.phone&&t.media.phone._onMuteChanged(a.message.isMuted);break;case i.PhoneVUMeterEvent:t.media.phone&&t.media.phone._onVUMeter(a.message.microphone,a.message.speakers);break;case i.ConnectedEvent:t.events.connected.raise(t);break;case i.EnableChromeBarButtonReply:t.events.buttonStateChangedEvent.raise(t,{buttonIdx:a.buttonIdx,accepted:a.accepted,buttonState:a.buttonState})}}function o(n,i,r,u){return u!==undefined&&u>5&&t.filterNonPhoneCallEvents===!0?!1:n===!0?t.isSCPRegisteredForCLEvents:i===!0&&r?r==="*"?t.registeredCampaignList.length>0:t.registeredCampaignList.indexOf(r)>-1:!1}function s(n,i){return n===!0?t.isPBPRegisteredForCLEvents:t.registeredCampaignList.length>0?i==="*"?!0:t.registeredCampaignList.indexOf(i)>-1:!0}function h(n){return n&&f[n]?f[n].mediatype:undefined}function ni(){jQuery(n.NumberInput).on("change input",function(){var i=jQuery(n.NumberInput).val().replace(/([^0-9#*])/g,"");jQuery(n.NumberInput).val(i);t.currentState()===a.LoggedIn||t.currentState()===a.Ready||t.currentState()===a.Paused?(jQuery(n.CallButton).enabled(i.length>0),jQuery(n.ManualTransferButton).disable()):t.currentState()===a.Talking||t.currentState()===a.OtherCall?(jQuery(n.CallButton).enabled(i.length>0),jQuery(n.ManualTransferButton).enabled(i.length>0)):jQuery(n.CallButton+", "+n.ManualTransferButton).disable()}).on("keydown",function(i){return i.which===13?((t.currentState()===a.LoggedIn||t.currentState()===a.Ready||t.currentState()===a.Paused)&&t.showMakeCallPopup(jQuery(n.NumberInput).val()),!1):i.which===27?(jQuery(n.NumberInput).val("").change(),!1):void 0})}function ti(){jQuery(n.PhoneToolbar).show();jQuery(n.PhoneDialPad).hide();jQuery(n.LoginButton).disable();jQuery(n.LoginOrReadyButton).disable();jQuery(n.ReadyButton).disable();jQuery(n.PauseButton).disable();jQuery(n.LogoutButton).disable();jQuery(n.CallButton).disable();jQuery(n.TransferButton).disable();jQuery(n.CampaignListButton).disable();jQuery(n.StartRecordingButton).disable();jQuery(n.QueueInfoButton).disable();jQuery(n.StopRecordingButton).disable();jQuery(n.MuteRecordingButton).disable();jQuery(n.UnmuteRecordingButton).disable();jQuery(n.PanicButton).disable();jQuery(n.HideDialPadButton).disable();jQuery(n.ShowDialPadButton).disable();jQuery(n.PickupButton).disable();jQuery(n.HangupButton).disable();jQuery(n.FlashButton).disable();jQuery(n.ManualTransferButton).disable();jQuery(n.MicrophoneOnButton).disable();jQuery(n.MicrophoneOffButton).disable();jQuery(n.Line1Button).disable();jQuery(n.Line2Button).disable();jQuery(n.EnterConferenceButton).disable();jQuery(n.LeaveConferenceButton).disable();jQuery(n.MarqueeLabel).html("Connection Lost").change();jQuery(n.TimerLabel).html("").change();jQuery(n.NumberInput).val("").change();jQuery(n.SoftPhoneStateLabel).removeClass("device-ready").removeClass("device-warning").removeClass("device-error").removeClass("blink").addClass("device-disabled");jQuery(n.XmppStateLabel).removeClass("device-ready").removeClass("device-warning").removeClass("device-error").removeClass("blink").addClass("device-disabled")}function st(t){t.MarqueeLabel.Disabled?jQuery(n.MarqueeLabel).disable():jQuery(n.MarqueeLabel).enable();t.MarqueeLabel.Hidden?jQuery(n.MarqueeLabel).hide():jQuery(n.MarqueeLabel).show();t.MarqueeLabel.IsTemporary?jQuery(n.MarqueeLabel).addClass("phonebar-state-error-text"):jQuery(n.MarqueeLabel).removeClass("phonebar-state-error-text");jQuery(n.MarqueeLabel).html(t.MarqueeLabel.Text).change();t.TimerLabel.Disabled?jQuery(n.TimerLabel).disable():jQuery(n.TimerLabel).enable();t.TimerLabel.Hidden?jQuery(n.TimerLabel).hide():jQuery(n.TimerLabel).show();jQuery(n.TimerLabel).html(t.TimerLabel.Text).change();t.NumberInput.Disabled?jQuery(n.NumberInput).disable():jQuery(n.NumberInput).enable();t.NumberInput.Hidden?jQuery(n.NumberInput).hide():jQuery(n.NumberInput).show();t.CurrentState===a.NotLoggedIn?(jQuery(n.SoftPhoneStateLabel).removeClass("device-ready").removeClass("device-warning").removeClass("device-error").removeClass("blink").addClass("device-disabled"),jQuery(n.XmppStateLabel).removeClass("device-ready").removeClass("device-warning").removeClass("device-error").removeClass("blink").addClass("device-disabled")):(jQuery(n.SoftPhoneStateLabel).removeClass("device-disabled"),jQuery(n.XmppStateLabel).removeClass("device-disabled"),t.PhoneDevice.IsConfigured?t.PhoneDevice.IsConnected?t.PhoneDevice.IsRegistered?t.PhoneDevice.HasAccessToMediaDevice?(jQuery(n.SoftPhoneStateLabel).attr("title",v[c].SoftPhoneRegisteredStateLabel.replace("{0}",u.config.phoneDevice)),jQuery(n.SoftPhoneStateLabel).addClass("device-ready").removeClass("device-warning").removeClass("device-error").removeClass("blink")):(jQuery(n.SoftPhoneStateLabel).attr("title",v[c].SoftPhoneRegisteredNoMediaStateLabel.replace("{0}",u.config.phoneDevice)),jQuery(n.SoftPhoneStateLabel).addClass("device-ready").addClass("device-warning").removeClass("device-error").addClass("blink")):(jQuery(n.SoftPhoneStateLabel).attr("title",v[c].SoftPhoneNotRegisteredStateLabel.replace("{0}",u.config.phoneDevice)),jQuery(n.SoftPhoneStateLabel).removeClass("device-ready").addClass("device-warning").removeClass("device-error").removeClass("blink")):(jQuery(n.SoftPhoneStateLabel).attr("title",v[c].SoftPhoneNotConnectedStateLabel.replace("{0}",u.config.phoneDevice)),jQuery(n.SoftPhoneStateLabel).removeClass("device-ready").removeClass("device-warning").addClass("device-error").addClass("blink")):jQuery(n.SoftPhoneStateLabel).removeClass("device-ready").removeClass("device-warning").removeClass("device-error").removeClass("blink").addClass("device-disabled"),t.XmppState?(jQuery(n.XmppStateLabel).attr("title",v[c].XmppConnectedStateLabel),jQuery(n.XmppStateLabel).addClass("device-ready").removeClass("device-error").removeClass("blink")):(jQuery(n.XmppStateLabel).attr("title",v[c].XmppNotConnectedStateLabel),jQuery(n.XmppStateLabel).removeClass("device-ready").addClass("device-error").addClass("blink")))}function ht(t,i,r){if(r===!0){st(t);return}t.PhoneToolbar.Hidden?jQuery(n.PhoneToolbar).hide():jQuery(n.PhoneToolbar).show();t.PhoneDialPad.Hidden?jQuery(n.PhoneDialPad).hide():jQuery(n.PhoneDialPad).show();t.LoginButton.Disabled?jQuery(n.LoginButton).disable():jQuery(n.LoginButton).enable();t.LoginButton.Hidden?jQuery(n.LoginButton).hide():jQuery(n.LoginButton).show();t.LoginButton.Blink?jQuery(n.LoginButton).addClass("blink"):jQuery(n.LoginButton).removeClass("blink");t.LoginButton.Highlight?jQuery(n.LoginButton).addClass("highlight"):jQuery(n.LoginButton).removeClass("highlight");t.LoginButton.Selected?jQuery(n.LoginButton).addClass("selected"):jQuery(n.LoginButton).removeClass("selected");t.LoginOrReadyButton.Disabled?jQuery(n.LoginOrReadyButton).disable():jQuery(n.LoginOrReadyButton).enable();t.LoginOrReadyButton.Hidden?jQuery(n.LoginOrReadyButton).hide():jQuery(n.LoginOrReadyButton).show();t.LoginOrReadyButton.Blink?jQuery(n.LoginOrReadyButton).addClass("blink"):jQuery(n.LoginOrReadyButton).removeClass("blink");t.LoginOrReadyButton.Highlight?jQuery(n.LoginOrReadyButton).addClass("highlight"):jQuery(n.LoginOrReadyButton).removeClass("highlight");t.LoginOrReadyButton.Selected?jQuery(n.LoginOrReadyButton).addClass("selected"):jQuery(n.LoginOrReadyButton).removeClass("selected");t.ReadyButton.Disabled?jQuery(n.ReadyButton).disable():jQuery(n.ReadyButton).enable();t.ReadyButton.Hidden?jQuery(n.ReadyButton).hide():jQuery(n.ReadyButton).show();t.ReadyButton.Blink?jQuery(n.ReadyButton).addClass("blink"):jQuery(n.ReadyButton).removeClass("blink");t.ReadyButton.Highlight?jQuery(n.ReadyButton).addClass("highlight"):jQuery(n.ReadyButton).removeClass("highlight");t.ReadyButton.Selected?jQuery(n.ReadyButton).addClass("selected"):jQuery(n.ReadyButton).removeClass("selected");t.PauseButton.Disabled?jQuery(n.PauseButton).disable():jQuery(n.PauseButton).enable();t.PauseButton.Hidden?jQuery(n.PauseButton).hide():jQuery(n.PauseButton).show();t.PauseButton.Blink?jQuery(n.PauseButton).addClass("blink"):jQuery(n.PauseButton).removeClass("blink");t.PauseButton.Highlight?jQuery(n.PauseButton).addClass("highlight"):jQuery(n.PauseButton).removeClass("highlight");t.PauseButton.Selected?jQuery(n.PauseButton).addClass("selected"):jQuery(n.PauseButton).removeClass("selected");t.LogoutButton.Disabled?jQuery(n.LogoutButton).disable():jQuery(n.LogoutButton).enable();t.LogoutButton.Hidden?jQuery(n.LogoutButton).hide():jQuery(n.LogoutButton).show();t.LogoutButton.Blink?jQuery(n.LogoutButton).addClass("blink"):jQuery(n.LogoutButton).removeClass("blink");t.LogoutButton.Highlight?jQuery(n.LogoutButton).addClass("highlight"):jQuery(n.LogoutButton).removeClass("highlight");t.LogoutButton.Selected?jQuery(n.LogoutButton).addClass("selected"):jQuery(n.LogoutButton).removeClass("selected");i&&(t.CallButton.Disabled?jQuery(n.CallButton).disable():jQuery(n.CallButton).enable(),t.CallButton.Hidden?jQuery(n.CallButton).hide():jQuery(n.CallButton).show(),t.CallButton.Blink?jQuery(n.CallButton).addClass("blink"):jQuery(n.CallButton).removeClass("blink"),t.CallButton.Highlight?jQuery(n.CallButton).addClass("highlight"):jQuery(n.CallButton).removeClass("highlight"),t.CallButton.Selected?jQuery(n.CallButton).addClass("selected"):jQuery(n.CallButton).removeClass("selected"));t.AbortCallButton.Disabled?jQuery(n.AbortCallButton).disable():jQuery(n.AbortCallButton).enable();t.AbortCallButton.Hidden?jQuery(n.AbortCallButton).hide():jQuery(n.AbortCallButton).show();t.AbortCallButton.Blink?jQuery(n.AbortCallButton).addClass("blink"):jQuery(n.AbortCallButton).removeClass("blink");t.AbortCallButton.Highlight?jQuery(n.AbortCallButton).addClass("highlight"):jQuery(n.AbortCallButton).removeClass("highlight");t.AbortCallButton.Selected?jQuery(n.AbortCallButton).addClass("selected"):jQuery(n.AbortCallButton).removeClass("selected");t.TransferButton.Disabled?jQuery(n.TransferButton).disable():jQuery(n.TransferButton).enable();t.TransferButton.Hidden?jQuery(n.TransferButton).hide():jQuery(n.TransferButton).show();t.TransferButton.Blink?jQuery(n.TransferButton).addClass("blink"):jQuery(n.TransferButton).removeClass("blink");t.TransferButton.Highlight?jQuery(n.TransferButton).addClass("highlight"):jQuery(n.TransferButton).removeClass("highlight");t.TransferButton.Selected?jQuery(n.TransferButton).addClass("selected"):jQuery(n.TransferButton).removeClass("selected");t.CampaignListButton.Disabled?jQuery(n.CampaignListButton).disable():jQuery(n.CampaignListButton).enable();t.CampaignListButton.Hidden?jQuery(n.CampaignListButton).hide():jQuery(n.CampaignListButton).show();t.CampaignListButton.Blink?jQuery(n.CampaignListButton).addClass("blink"):jQuery(n.CampaignListButton).removeClass("blink");t.CampaignListButton.Highlight?jQuery(n.CampaignListButton).addClass("highlight"):jQuery(n.CampaignListButton).removeClass("highlight");t.CampaignListButton.Selected?jQuery(n.CampaignListButton).addClass("selected"):jQuery(n.CampaignListButton).removeClass("selected");t.StartRecordingButton.Disabled?jQuery(n.StartRecordingButton).disable():jQuery(n.StartRecordingButton).enable();t.StartRecordingButton.Hidden?jQuery(n.StartRecordingButton).hide():jQuery(n.StartRecordingButton).show();t.StartRecordingButton.Blink?jQuery(n.StartRecordingButton).addClass("blink"):jQuery(n.StartRecordingButton).removeClass("blink");t.StartRecordingButton.Highlight?jQuery(n.StartRecordingButton).addClass("highlight"):jQuery(n.StartRecordingButton).removeClass("highlight");t.StartRecordingButton.Selected?jQuery(n.StartRecordingButton).addClass("selected"):jQuery(n.StartRecordingButton).removeClass("selected");t.QueueInfoButton.Disabled?jQuery(n.QueueInfoButton).disable():jQuery(n.QueueInfoButton).enable();t.QueueInfoButton.Hidden?jQuery(n.QueueInfoButton).hide():jQuery(n.QueueInfoButton).show();t.QueueInfoButton.Blink?jQuery(n.QueueInfoButton).addClass("blink"):jQuery(n.QueueInfoButton).removeClass("blink");t.QueueInfoButton.Highlight?jQuery(n.QueueInfoButton).addClass("highlight"):jQuery(n.QueueInfoButton).removeClass("highlight");t.QueueInfoButton.Selected?jQuery(n.QueueInfoButton).addClass("selected"):jQuery(n.QueueInfoButton).removeClass("selected");t.StopRecordingButton.Disabled?jQuery(n.StopRecordingButton).disable():jQuery(n.StopRecordingButton).enable();t.StopRecordingButton.Hidden?jQuery(n.StopRecordingButton).hide():jQuery(n.StopRecordingButton).show();t.StopRecordingButton.Blink?jQuery(n.StopRecordingButton).addClass("blink"):jQuery(n.StopRecordingButton).removeClass("blink");t.StopRecordingButton.Highlight?jQuery(n.StopRecordingButton).addClass("highlight"):jQuery(n.StopRecordingButton).removeClass("highlight");t.StopRecordingButton.Selected?jQuery(n.StopRecordingButton).addClass("selected"):jQuery(n.StopRecordingButton).removeClass("selected");t.MuteRecordingButton.Disabled?jQuery(n.MuteRecordingButton).disable():jQuery(n.MuteRecordingButton).enable();t.MuteRecordingButton.Hidden?jQuery(n.MuteRecordingButton).hide():jQuery(n.MuteRecordingButton).show();t.MuteRecordingButton.Blink?jQuery(n.MuteRecordingButton).addClass("blink"):jQuery(n.MuteRecordingButton).removeClass("blink");t.MuteRecordingButton.Highlight?jQuery(n.MuteRecordingButton).addClass("highlight"):jQuery(n.MuteRecordingButton).removeClass("highlight");t.MuteRecordingButton.Selected?jQuery(n.MuteRecordingButton).addClass("selected"):jQuery(n.MuteRecordingButton).removeClass("selected");t.UnmuteRecordingButton.Disabled?jQuery(n.UnmuteRecordingButton).disable():jQuery(n.UnmuteRecordingButton).enable();t.UnmuteRecordingButton.Hidden?jQuery(n.UnmuteRecordingButton).hide():jQuery(n.UnmuteRecordingButton).show();t.UnmuteRecordingButton.Blink?jQuery(n.UnmuteRecordingButton).addClass("blink"):jQuery(n.UnmuteRecordingButton).removeClass("blink");t.UnmuteRecordingButton.Highlight?jQuery(n.UnmuteRecordingButton).addClass("highlight"):jQuery(n.UnmuteRecordingButton).removeClass("highlight");t.UnmuteRecordingButton.Selected?jQuery(n.UnmuteRecordingButton).addClass("selected"):jQuery(n.UnmuteRecordingButton).removeClass("selected");t.PanicButton.Disabled?jQuery(n.PanicButton).disable():jQuery(n.PanicButton).enable();t.PanicButton.Hidden?jQuery(n.PanicButton).hide():jQuery(n.PanicButton).show();t.PanicButton.Blink?jQuery(n.PanicButton).addClass("blink"):jQuery(n.PanicButton).removeClass("blink");t.PanicButton.Highlight?jQuery(n.PanicButton).addClass("highlight"):jQuery(n.PanicButton).removeClass("highlight");t.PanicButton.Selected?jQuery(n.PanicButton).addClass("selected"):jQuery(n.PanicButton).removeClass("selected");t.HideDialPadButton.Disabled?jQuery(n.HideDialPadButton).disable():jQuery(n.HideDialPadButton).enable();t.HideDialPadButton.Hidden?jQuery(n.HideDialPadButton).hide():jQuery(n.HideDialPadButton).show();t.HideDialPadButton.Blink?jQuery(n.HideDialPadButton).addClass("blink"):jQuery(n.HideDialPadButton).removeClass("blink");t.HideDialPadButton.Highlight?jQuery(n.HideDialPadButton).addClass("highlight"):jQuery(n.HideDialPadButton).removeClass("highlight");t.HideDialPadButton.Selected?jQuery(n.HideDialPadButton).addClass("selected"):jQuery(n.HideDialPadButton).removeClass("selected");t.ShowDialPadButton.Disabled?jQuery(n.ShowDialPadButton).disable():jQuery(n.ShowDialPadButton).enable();t.ShowDialPadButton.Hidden?jQuery(n.ShowDialPadButton).hide():jQuery(n.ShowDialPadButton).show();t.ShowDialPadButton.Blink?jQuery(n.ShowDialPadButton).addClass("blink"):jQuery(n.ShowDialPadButton).removeClass("blink");t.ShowDialPadButton.Highlight?jQuery(n.ShowDialPadButton).addClass("highlight"):jQuery(n.ShowDialPadButton).removeClass("highlight");t.ShowDialPadButton.Selected?jQuery(n.ShowDialPadButton).addClass("selected"):jQuery(n.ShowDialPadButton).removeClass("selected");t.PickupButton.Disabled?jQuery(n.PickupButton).disable():jQuery(n.PickupButton).enable();t.PickupButton.Hidden?jQuery(n.PickupButton).hide():jQuery(n.PickupButton).show();t.PickupButton.Blink?jQuery(n.PickupButton).addClass("blink"):jQuery(n.PickupButton).removeClass("blink");t.PickupButton.Highlight?jQuery(n.PickupButton).addClass("highlight"):jQuery(n.PickupButton).removeClass("highlight");t.PickupButton.Selected?jQuery(n.PickupButton).addClass("selected"):jQuery(n.PickupButton).removeClass("selected");t.HangupButton.Disabled?jQuery(n.HangupButton).disable():jQuery(n.HangupButton).enable();t.HangupButton.Hidden?jQuery(n.HangupButton).hide():jQuery(n.HangupButton).show();t.HangupButton.Blink?jQuery(n.HangupButton).addClass("blink"):jQuery(n.HangupButton).removeClass("blink");t.HangupButton.Highlight?jQuery(n.HangupButton).addClass("highlight"):jQuery(n.HangupButton).removeClass("highlight");t.HangupButton.Selected?jQuery(n.HangupButton).addClass("selected"):jQuery(n.HangupButton).removeClass("selected");t.FlashButton.Disabled?jQuery(n.FlashButton).disable():jQuery(n.FlashButton).enable();t.FlashButton.Hidden?jQuery(n.FlashButton).hide():jQuery(n.FlashButton).show();t.FlashButton.Blink?jQuery(n.FlashButton).addClass("blink"):jQuery(n.FlashButton).removeClass("blink");t.FlashButton.Highlight?jQuery(n.FlashButton).addClass("highlight"):jQuery(n.FlashButton).removeClass("highlight");t.FlashButton.Selected?jQuery(n.FlashButton).addClass("selected"):jQuery(n.FlashButton).removeClass("selected");t.ManualTransferButton.Disabled?jQuery(n.ManualTransferButton).disable():jQuery(n.ManualTransferButton).enable();t.ManualTransferButton.Hidden?jQuery(n.ManualTransferButton).hide():jQuery(n.ManualTransferButton).show();t.ManualTransferButton.Blink?jQuery(n.ManualTransferButton).addClass("blink"):jQuery(n.ManualTransferButton).removeClass("blink");t.ManualTransferButton.Highlight?jQuery(n.ManualTransferButton).addClass("highlight"):jQuery(n.ManualTransferButton).removeClass("highlight");t.ManualTransferButton.Selected?jQuery(n.ManualTransferButton).addClass("selected"):jQuery(n.ManualTransferButton).removeClass("selected");t.MicrophoneOnButton.Disabled?jQuery(n.MicrophoneOnButton).disable():jQuery(n.MicrophoneOnButton).enable();t.MicrophoneOnButton.Hidden?jQuery(n.MicrophoneOnButton).hide():jQuery(n.MicrophoneOnButton).show();t.MicrophoneOnButton.Blink?jQuery(n.MicrophoneOnButton).addClass("blink"):jQuery(n.MicrophoneOnButton).removeClass("blink");t.MicrophoneOnButton.Highlight?jQuery(n.MicrophoneOnButton).addClass("highlight"):jQuery(n.MicrophoneOnButton).removeClass("highlight");t.MicrophoneOnButton.Selected?jQuery(n.MicrophoneOnButton).addClass("selected"):jQuery(n.MicrophoneOnButton).removeClass("selected");t.MicrophoneOffButton.Disabled?jQuery(n.MicrophoneOffButton).disable():jQuery(n.MicrophoneOffButton).enable();t.MicrophoneOffButton.Hidden?jQuery(n.MicrophoneOffButton).hide():jQuery(n.MicrophoneOffButton).show();t.MicrophoneOffButton.Blink?jQuery(n.MicrophoneOffButton).addClass("blink"):jQuery(n.MicrophoneOffButton).removeClass("blink");t.MicrophoneOffButton.Highlight?jQuery(n.MicrophoneOffButton).addClass("highlight"):jQuery(n.MicrophoneOffButton).removeClass("highlight");t.MicrophoneOffButton.Selected?jQuery(n.MicrophoneOffButton).addClass("selected"):jQuery(n.MicrophoneOffButton).removeClass("selected");t.Line1Button.Disabled?jQuery(n.Line1Button).disable():jQuery(n.Line1Button).enable();t.Line1Button.Hidden?jQuery(n.Line1Button).hide():jQuery(n.Line1Button).show();t.Line1Button.Blink?jQuery(n.Line1Button).addClass("blink"):jQuery(n.Line1Button).removeClass("blink");t.Line1Button.Highlight?jQuery(n.Line1Button).addClass("highlight"):jQuery(n.Line1Button).removeClass("highlight");t.Line1Button.Selected?jQuery(n.Line1Button).addClass("selected"):jQuery(n.Line1Button).removeClass("selected");t.Line2Button.Disabled?jQuery(n.Line2Button).disable():jQuery(n.Line2Button).enable();t.Line2Button.Hidden?jQuery(n.Line2Button).hide():jQuery(n.Line2Button).show();t.Line2Button.Blink?jQuery(n.Line2Button).addClass("blink"):jQuery(n.Line2Button).removeClass("blink");t.Line2Button.Highlight?jQuery(n.Line2Button).addClass("highlight"):jQuery(n.Line2Button).removeClass("highlight");t.Line2Button.Selected?jQuery(n.Line2Button).addClass("selected"):jQuery(n.Line2Button).removeClass("selected");t.EnterConferenceButton.Disabled?jQuery(n.EnterConferenceButton).disable():jQuery(n.EnterConferenceButton).enable();t.EnterConferenceButton.Hidden?jQuery(n.EnterConferenceButton).hide():jQuery(n.EnterConferenceButton).show();t.EnterConferenceButton.Blink?jQuery(n.EnterConferenceButton).addClass("blink"):jQuery(n.EnterConferenceButton).removeClass("blink");t.EnterConferenceButton.Highlight?jQuery(n.EnterConferenceButton).addClass("highlight"):jQuery(n.EnterConferenceButton).removeClass("highlight");t.EnterConferenceButton.Selected?jQuery(n.EnterConferenceButton).addClass("selected"):jQuery(n.EnterConferenceButton).removeClass("selected");t.LeaveConferenceButton.Disabled?jQuery(n.LeaveConferenceButton).disable():jQuery(n.LeaveConferenceButton).enable();t.LeaveConferenceButton.Hidden?jQuery(n.LeaveConferenceButton).hide():jQuery(n.LeaveConferenceButton).show();t.LeaveConferenceButton.Blink?jQuery(n.LeaveConferenceButton).addClass("blink"):jQuery(n.LeaveConferenceButton).removeClass("blink");t.LeaveConferenceButton.Highlight?jQuery(n.LeaveConferenceButton).addClass("highlight"):jQuery(n.LeaveConferenceButton).removeClass("highlight");t.LeaveConferenceButton.Selected?jQuery(n.LeaveConferenceButton).addClass("selected"):jQuery(n.LeaveConferenceButton).removeClass("selected");t.DialpadDigit0Button.Disabled?jQuery(n.DialpadDigit0Button).disable():jQuery(n.DialpadDigit0Button).enable();t.DialpadDigit0Button.Hidden?jQuery(n.DialpadDigit0Button).hide():jQuery(n.DialpadDigit0Button).show();t.DialpadDigit0Button.Blink?jQuery(n.DialpadDigit0Button).addClass("blink"):jQuery(n.DialpadDigit0Button).removeClass("blink");t.DialpadDigit0Button.Highlight?jQuery(n.DialpadDigit0Button).addClass("highlight"):jQuery(n.DialpadDigit0Button).removeClass("highlight");t.DialpadDigit0Button.Selected?jQuery(n.DialpadDigit0Button).addClass("selected"):jQuery(n.DialpadDigit0Button).removeClass("selected");t.DialpadDigit1Button.Disabled?jQuery(n.DialpadDigit1Button).disable():jQuery(n.DialpadDigit1Button).enable();t.DialpadDigit1Button.Hidden?jQuery(n.DialpadDigit1Button).hide():jQuery(n.DialpadDigit1Button).show();t.DialpadDigit1Button.Blink?jQuery(n.DialpadDigit1Button).addClass("blink"):jQuery(n.DialpadDigit1Button).removeClass("blink");t.DialpadDigit1Button.Highlight?jQuery(n.DialpadDigit1Button).addClass("highlight"):jQuery(n.DialpadDigit1Button).removeClass("highlight");t.DialpadDigit1Button.Selected?jQuery(n.DialpadDigit1Button).addClass("selected"):jQuery(n.DialpadDigit1Button).removeClass("selected");t.DialpadDigit2Button.Disabled?jQuery(n.DialpadDigit2Button).disable():jQuery(n.DialpadDigit2Button).enable();t.DialpadDigit2Button.Hidden?jQuery(n.DialpadDigit2Button).hide():jQuery(n.DialpadDigit2Button).show();t.DialpadDigit2Button.Blink?jQuery(n.DialpadDigit2Button).addClass("blink"):jQuery(n.DialpadDigit2Button).removeClass("blink");t.DialpadDigit2Button.Highlight?jQuery(n.DialpadDigit2Button).addClass("highlight"):jQuery(n.DialpadDigit2Button).removeClass("highlight");t.DialpadDigit2Button.Selected?jQuery(n.DialpadDigit2Button).addClass("selected"):jQuery(n.DialpadDigit2Button).removeClass("selected");t.DialpadDigit3Button.Disabled?jQuery(n.DialpadDigit3Button).disable():jQuery(n.DialpadDigit3Button).enable();t.DialpadDigit3Button.Hidden?jQuery(n.DialpadDigit3Button).hide():jQuery(n.DialpadDigit3Button).show();t.DialpadDigit3Button.Blink?jQuery(n.DialpadDigit3Button).addClass("blink"):jQuery(n.DialpadDigit3Button).removeClass("blink");t.DialpadDigit3Button.Highlight?jQuery(n.DialpadDigit3Button).addClass("highlight"):jQuery(n.DialpadDigit3Button).removeClass("highlight");t.DialpadDigit3Button.Selected?jQuery(n.DialpadDigit3Button).addClass("selected"):jQuery(n.DialpadDigit3Button).removeClass("selected");t.DialpadDigit4Button.Disabled?jQuery(n.DialpadDigit4Button).disable():jQuery(n.DialpadDigit4Button).enable();t.DialpadDigit4Button.Hidden?jQuery(n.DialpadDigit4Button).hide():jQuery(n.DialpadDigit4Button).show();t.DialpadDigit4Button.Blink?jQuery(n.DialpadDigit4Button).addClass("blink"):jQuery(n.DialpadDigit4Button).removeClass("blink");t.DialpadDigit4Button.Highlight?jQuery(n.DialpadDigit4Button).addClass("highlight"):jQuery(n.DialpadDigit4Button).removeClass("highlight");t.DialpadDigit4Button.Selected?jQuery(n.DialpadDigit4Button).addClass("selected"):jQuery(n.DialpadDigit4Button).removeClass("selected");t.DialpadDigit5Button.Disabled?jQuery(n.DialpadDigit5Button).disable():jQuery(n.DialpadDigit5Button).enable();t.DialpadDigit5Button.Hidden?jQuery(n.DialpadDigit5Button).hide():jQuery(n.DialpadDigit5Button).show();t.DialpadDigit5Button.Blink?jQuery(n.DialpadDigit5Button).addClass("blink"):jQuery(n.DialpadDigit5Button).removeClass("blink");t.DialpadDigit5Button.Highlight?jQuery(n.DialpadDigit5Button).addClass("highlight"):jQuery(n.DialpadDigit5Button).removeClass("highlight");t.DialpadDigit5Button.Selected?jQuery(n.DialpadDigit5Button).addClass("selected"):jQuery(n.DialpadDigit5Button).removeClass("selected");t.DialpadDigit6Button.Disabled?jQuery(n.DialpadDigit6Button).disable():jQuery(n.DialpadDigit6Button).enable();t.DialpadDigit6Button.Hidden?jQuery(n.DialpadDigit6Button).hide():jQuery(n.DialpadDigit6Button).show();t.DialpadDigit6Button.Blink?jQuery(n.DialpadDigit6Button).addClass("blink"):jQuery(n.DialpadDigit6Button).removeClass("blink");t.DialpadDigit6Button.Highlight?jQuery(n.DialpadDigit6Button).addClass("highlight"):jQuery(n.DialpadDigit6Button).removeClass("highlight");t.DialpadDigit6Button.Selected?jQuery(n.DialpadDigit6Button).addClass("selected"):jQuery(n.DialpadDigit6Button).removeClass("selected");t.DialpadDigit7Button.Disabled?jQuery(n.DialpadDigit7Button).disable():jQuery(n.DialpadDigit7Button).enable();t.DialpadDigit7Button.Hidden?jQuery(n.DialpadDigit7Button).hide():jQuery(n.DialpadDigit7Button).show();t.DialpadDigit7Button.Blink?jQuery(n.DialpadDigit7Button).addClass("blink"):jQuery(n.DialpadDigit7Button).removeClass("blink");t.DialpadDigit7Button.Highlight?jQuery(n.DialpadDigit7Button).addClass("highlight"):jQuery(n.DialpadDigit7Button).removeClass("highlight");t.DialpadDigit7Button.Selected?jQuery(n.DialpadDigit7Button).addClass("selected"):jQuery(n.DialpadDigit7Button).removeClass("selected");t.DialpadDigit8Button.Disabled?jQuery(n.DialpadDigit8Button).disable():jQuery(n.DialpadDigit8Button).enable();t.DialpadDigit8Button.Hidden?jQuery(n.DialpadDigit8Button).hide():jQuery(n.DialpadDigit8Button).show();t.DialpadDigit8Button.Blink?jQuery(n.DialpadDigit8Button).addClass("blink"):jQuery(n.DialpadDigit8Button).removeClass("blink");t.DialpadDigit8Button.Highlight?jQuery(n.DialpadDigit8Button).addClass("highlight"):jQuery(n.DialpadDigit8Button).removeClass("highlight");t.DialpadDigit8Button.Selected?jQuery(n.DialpadDigit8Button).addClass("selected"):jQuery(n.DialpadDigit8Button).removeClass("selected");t.DialpadDigit9Button.Disabled?jQuery(n.DialpadDigit9Button).disable():jQuery(n.DialpadDigit9Button).enable();t.DialpadDigit9Button.Hidden?jQuery(n.DialpadDigit9Button).hide():jQuery(n.DialpadDigit9Button).show();t.DialpadDigit9Button.Blink?jQuery(n.DialpadDigit9Button).addClass("blink"):jQuery(n.DialpadDigit9Button).removeClass("blink");t.DialpadDigit9Button.Highlight?jQuery(n.DialpadDigit9Button).addClass("highlight"):jQuery(n.DialpadDigit9Button).removeClass("highlight");t.DialpadDigit9Button.Selected?jQuery(n.DialpadDigit9Button).addClass("selected"):jQuery(n.DialpadDigit9Button).removeClass("selected");t.DialpadHashButton.Disabled?jQuery(n.DialpadHashButton).disable():jQuery(n.DialpadHashButton).enable();t.DialpadHashButton.Hidden?jQuery(n.DialpadHashButton).hide():jQuery(n.DialpadHashButton).show();t.DialpadHashButton.Blink?jQuery(n.DialpadHashButton).addClass("blink"):jQuery(n.DialpadHashButton).removeClass("blink");t.DialpadHashButton.Highlight?jQuery(n.DialpadHashButton).addClass("highlight"):jQuery(n.DialpadHashButton).removeClass("highlight");t.DialpadHashButton.Selected?jQuery(n.DialpadHashButton).addClass("selected"):jQuery(n.DialpadHashButton).removeClass("selected");t.DialpadStarButton.Disabled?jQuery(n.DialpadStarButton).disable():jQuery(n.DialpadStarButton).enable();t.DialpadStarButton.Hidden?jQuery(n.DialpadStarButton).hide():jQuery(n.DialpadStarButton).show();t.DialpadStarButton.Blink?jQuery(n.DialpadStarButton).addClass("blink"):jQuery(n.DialpadStarButton).removeClass("blink");t.DialpadStarButton.Highlight?jQuery(n.DialpadStarButton).addClass("highlight"):jQuery(n.DialpadStarButton).removeClass("highlight");t.DialpadStarButton.Selected?jQuery(n.DialpadStarButton).addClass("selected"):jQuery(n.DialpadStarButton).removeClass("selected");st(t);jQuery(n.SpeakersVUMeter).val(t.SpeakersVUMeter.Value);jQuery(n.MicrophoneVUMeter).val(t.MicrophoneVUMeter.Value)}function rt(){f={};r={login:[],logout:[],pause:[],ready:[],make:[],transfer:[],getAgents:[],getCampaigns:[],getPauseReasons:[],getQueueInfo:[],getOutboundCampaigns:[],getTransferAgents:[],getAssignedCampaigns:[],getTransferCampaigns:[],getCallHistoryLog:[],getSiteListFromProvisioning:[],getModuleConfiguration:[],getAuthorityInfo:[],setConfiguration:[]}}function ct(){if(r.getAgents.length){var n=r.getAgents[0],t=n.campaignName,u=n.mask;window.postMessage({type:"chromebarProxy",params:i.GetAgentListRequest,campaignName:t,mask:u},"*")}}function lt(){r.getPauseReasons.length&&window.postMessage({type:"chromebarProxy",params:i.GetPauseReasonsRequest},"*")}function at(){if(r.getTransferAgents.length){var n=r.getTransferAgents[0],t=n.campaignName;window.postMessage({type:"chromebarProxy",params:i.GetTransferAgentListRequest,campaignName:t},"*")}}function vt(){if(r.getCampaigns.length){var n=r.getCampaigns[0],t=n.mask,u=n.callId,f=n.mediatype;window.postMessage({type:"chromebarProxy",params:i.GetCampaignListRequest,mask:t,callId:u,mediaType:f},"*")}}function yt(){r.getAssignedCampaigns.length&&window.postMessage({type:"chromebarProxy",params:i.GetAssignedCampaignListRequest},"*")}function pt(){r.getOutboundCampaigns.length&&window.postMessage({type:"chromebarProxy",params:i.GetOutboundCampaignListRequest},"*")}function wt(){if(r.getTransferCampaigns.length){var n=r.getTransferCampaigns[0],t=n.callId;window.postMessage({type:"chromebarProxy",params:i.GetTransferCampaignListRequest,callId:t},"*")}}function bt(){r.getCallHistoryLog.length&&window.postMessage({type:"chromebarProxy",params:i.GetCallHistoryLogRequest},"*")}function kt(){if(r.getQueueInfo.length){var n=r.getQueueInfo[0],t=n.campaignName;window.postMessage({type:"chromebarProxy",params:i.GetQueueInfoRequest,campaignName:t},"*")}}function dt(){if(r.getAuthorityInfo.length){var n=r.getAuthorityInfo[0],t=n.userName;window.postMessage({type:"chromebarProxy",params:i.GetAuthorityInfoRequest,userName:t},"*")}}function ut(){if(r.getSiteListFromProvisioning.length){var n=r.getSiteListFromProvisioning[0],t=n.userName,u=n.token;window.postMessage({type:"chromebarProxy",params:i.GetProvisioningSiteListRequest,userName:t,token:u},"*")}}function gt(){if(r.getModuleConfiguration.length){var n=r.getModuleConfiguration[0],t=n.moduleName;window.postMessage({type:"chromebarProxy",params:i.GetModuleConfigurationRequest,moduleName:t},"*")}}var i=Ifm.ChromeBar.Constants.MessageCodes,v=Ifm.ChromeBar.Strings,n=Ifm.ChromeBar.Constants.UIElementClasses,l=Ifm.ChromeBar.Constants.Templates,t,a,p,u,y="[Initialization]",g=0,nt="",f,e,c,tt,ft,w=!1,et,ot,b=null,k=null,r;let d;return r={login:[],logout:[],pause:[],ready:[],make:[],transfer:[],getAgents:[],getCampaigns:[],getPauseReasons:[],getQueueInfo:[],getOutboundCampaigns:[],getTransferAgents:[],getAssignedCampaigns:[],getTransferCampaigns:[],getCallHistoryLog:[],getSiteListFromProvisioning:[],getModuleConfiguration:[],getAuthorityInfo:[],setConfiguration:[]},Ifm.ChromeBar.checkIfRunning=function(n){k==null&&(b=n,w===!1&&(w=!0,window.addEventListener("message",function(n){if(console.log("[ContentScript] [DEBUG] New Message Received",n),!n.isTrusted||n.source!==window){console.log("[ContentScript] [WARN] Invalid Message Received",n);return}n.data.type==="chromebarContentScript"&&it(n)})),window.postMessage({type:"chromebarProxy",params:i.CheckExtensionRequest},"*"),k=setTimeout(function(){b(!1);clearTimeout(k);k=null;b=null},200))},Ifm.PhoneBar.Media.Xmpp.events.initialized=function(){console.log("[ContentScript] [DEBUG] XMPP: initialized event received")},Ifm.PhoneBar.Media.Xmpp.events.reachable=function(){console.log("[ContentScript] [DEBUG] XMPP: reachable event received");window.postMessage({type:"chromebarProxy",params:i.ChatClientConnectedEvent},"*")},Ifm.PhoneBar.Media.Xmpp.events.unreachable=function(){console.log("[ContentScript] [DEBUG] XMPP: unreachable event received");window.postMessage({type:"chromebarProxy",params:i.ChatClientDisconnectedEvent},"*")},Ifm.PhoneBar.Media.Xmpp.events.newcall=function(){console.log("[ContentScript] [DEBUG] XMPP: newcall event received")},Ifm.PhoneBar.Media.Xmpp.events.newmessage=function(){console.log("[ContentScript] [DEBUG] XMPP: newmessage event received")},Ifm.PhoneBar.Media.Xmpp.events.callclosed=function(){console.log("[ContentScript] [DEBUG] XMPP: callclosed event received")},Ifm.PhoneBar.Media.Xmpp.events.filetransfer=function(){console.log("[ContentScript] [DEBUG] XMPP: filetransfer event received")},{agent:{firstName:"",lastName:"",username:"",password:"",extension:"",id:"",getName:function(){return this.firstName+" "+this.lastName}},config:{service:""},options:{autoAnswerPhone:function(n){if(n===undefined)return u.options.autoAnswerPhone;n>=0&&n<=3&&(u.options.autoAnswerPhone=n,t.setConfiguration({options:{autoAnswerPhone:u.options.autoAnswerPhone}}))},autoAnswerRings:function(n){if(n===undefined)return u.options.autoAnswerRings;n>=0&&n<=50&&(u.options.autoAnswerRings=n,t.setConfiguration({options:{autoAnswerRings:u.options.autoAnswerRings}}))},autoConnectToXmpp:function(n){if(n===undefined)return u.options.autoConnectToXmpp;u.options.autoConnectToXmpp=!!n;u.options.autoConnectToXmppServer=!!n;t.setConfiguration({options:{autoConnectToXmpp:u.options.autoConnectToXmpp,autoConnectToXmppServer:u.options.autoConnectToXmppServer}})},callingNumber:function(n){if(n===undefined)return u.options.callingNumber;u.options.callingNumber=n;t.setConfiguration({options:{callingNumber:u.options.callingNumber}})},enableAbortCall:function(n){if(n===undefined)return u.options.enableAbortCall;u.options.enableAbortCall=!!n;t.setConfiguration({options:{enableAbortCall:u.options.enableAbortCall}})},hideClockInPause:function(n){if(n===undefined)return u.options.hideClockInPause;u.options.hideClockInPause=!!n;t.setConfiguration({options:{hideClockInPause:u.options.hideClockInPause}})},hidePausedAgents:function(n){if(n===undefined)return u.options.hidePausedAgents;u.options.hidePausedAgents=!!n;t.setConfiguration({options:{hidePausedAgents:u.options.hidePausedAgents}})},popupIncomingCall:function(n){if(n===undefined)return u.options.popupIncomingCall;Ifm.Type.isNumber(n)&&(u.options.popupIncomingCall=!!n,t.setConfiguration({options:{popupIncomingCall:u.options.popupIncomingCall}}))},rememberCredentials:function(n){if(n===undefined)return u.options.rememberCredentials;if(n===0||n===1||n===2){u.options.rememberCredentials=n;var i={options:{rememberCredentials:u.options.rememberCredentials},parameters:{firstName:u.parameters.firstName,lastName:u.parameters.lastName,username:u.parameters.username,password:u.parameters.password}};n<2&&(this.forgetPassword(),i.parameters.password="");n<1&&(i.parameters.firstName="",i.parameters.lastName="",i.parameters.username="",i.parameters.password="",t.agent.firstName="",t.agent.lastName="",t.agent.username="",t.agent.password="");t.setConfiguration(i)}},showInfoPopupForManualCalls:function(n){if(n===undefined)return u.options.showInfoPopupForManualCalls;u.options.showInfoPopupForManualCalls=!!n;t.setConfiguration({options:{showInfoPopupForManualCalls:u.options.showInfoPopupForManualCalls}})},forgetPassword:function(){t.agent.password=""}},calls:function(n){var t=typeof n=="function"?n:null,i;return arguments.length>0&&t===null?f[n]||null:(i=Object.values(f),t)?i.filter(t):i},chromeBarVersion:function(){return et},clearCallHistoryLog:function(n){window.postMessage({type:"chromebarProxy",params:i.ClearCallHistoryLogRequest,callId:n},"*")},currentState:function(){return y},currentStateReason:function(){return nt},currentStateTime:function(){return g},getAgentList:function(n,t,i){if(arguments.length!==3)throw Ifm.Diagnostics.Errors.argsno("3");if(!Ifm.Type.isFunction(i))throw Ifm.Diagnostics.Errors.func("callback");r.getAgents.push({campaignName:n,mask:t,callback:i});r.getAgents.length===1&&ct()},getAssignedCampaignList:function(n){if(n&&!Ifm.Type.isFunction(n))throw Ifm.Diagnostics.Errors.func("callback");n&&r.getAssignedCampaigns.push(n);r.getAssignedCampaigns.length===1&&yt()},getAudioCall:function(){return t.calls(function(n){return n.mediatype<6})[0]||null},getAuthorityInfo:function(n,t){if(t&&!Ifm.Type.isFunction(t))throw Ifm.Diagnostics.Errors.func("callback");t&&r.getAuthorityInfo.push({userName:n,callback:t});r.getAuthorityInfo.length===1&&dt()},getCallHistoryLog:function(n){if(n&&!Ifm.Type.isFunction(n))throw Ifm.Diagnostics.Errors.func("callback");n&&r.getCallHistoryLog.push(n);r.getCallHistoryLog.length===1&&bt()},getCampaignList:function(n,t,i,u){if(arguments.length!==4)throw Ifm.Diagnostics.Errors.argsno("4");if(!Ifm.Type.isFunction(u))throw Ifm.Diagnostics.Errors.func("callback");r.getCampaigns.push({callId:n,mediatype:t,mask:i,callback:u});r.getCampaigns.length===1&&vt()},getConfiguration:function(){return u},getModuleConfiguration:function(n,t){if(arguments.length!==2)throw Ifm.Diagnostics.Errors.argsno("2");if(!Ifm.Type.isFunction(t))throw Ifm.Diagnostics.Errors.func("callback");r.getModuleConfiguration.push({moduleName:n,callback:t});r.getModuleConfiguration.length===1&&gt()},getOutboundCampaignList:function(n){if(n&&!Ifm.Type.isFunction(n))throw Ifm.Diagnostics.Errors.func("callback");n&&r.getOutboundCampaigns.push(n);r.getOutboundCampaigns.length===1&&pt()},getPauseReasons:function(n){if(n&&!Ifm.Type.isFunction(n))throw Ifm.Diagnostics.Errors.func("callback");n&&r.getPauseReasons.push(n);r.getPauseReasons.length===1&&lt()},getQueueInfo:function(n,t){if(arguments.length!==2)throw Ifm.Diagnostics.Errors.argsno("2");if(!Ifm.Type.isFunction(t))throw Ifm.Diagnostics.Errors.func("callback");r.getQueueInfo.push({campaignName:n,callback:t});r.getQueueInfo.length===1&&kt()},getSiteList:function(n,t,i){if(arguments.length!==3)throw Ifm.Diagnostics.Errors.argsno("3");if(!Ifm.Type.isFunction(i))throw Ifm.Diagnostics.Errors.func("callback");r.getSiteListFromProvisioning.push({userName:n,token:t,callback:i});r.getSiteListFromProvisioning.length===1&&ut()},getSiteListFromProvisioning:function(n,t,i){if(arguments.length!==3)throw Ifm.Diagnostics.Errors.argsno("3");if(!Ifm.Type.isFunction(i))throw Ifm.Diagnostics.Errors.func("callback");r.getSiteListFromProvisioning.push({userName:n,token:t,callback:i});r.getSiteListFromProvisioning.length===1&&ut()},getTransferAgentList:function(n,t){if(arguments.length!==2)throw Ifm.Diagnostics.Errors.argsno("2");if(t&&!Ifm.Type.isFunction(t))throw Ifm.Diagnostics.Errors.func("callback");t&&r.getTransferAgents.push({campaignName:n,callback:t});r.getTransferAgents.length===1&&at()},getTransferCampaignList:function(n,t){if(t&&!Ifm.Type.isFunction(t))throw Ifm.Diagnostics.Errors.func("callback");t&&r.getTransferCampaigns.push({callId:n,callback:t});r.getTransferCampaigns.length===1&&wt()},hideDialPad:function(){jQuery(n.PhoneDialPad+", "+n.HideDialPadButton).disable().hide();jQuery(n.ShowDialPadButton).enable().show();window.postMessage({type:"chromebarProxy",params:i.DialPadStateChangedEvent,hidden:!0},"*")},initialize:function(){t=this;t.scriptControlMode=!1;t.filterNonPhoneCallEvents=!1;t.isSCPRegisteredForCLEvents=!1;t.isPBPRegisteredForCLEvents=!0;t.registeredCampaignList=[];console.log("ChromeBarProxy - Initializing");t.scriptControlMode=!1;t.events=Ifm.ChromeBar.Proxy.events;a=Ifm.ChromeBar.Proxy.States;jQuery('[class^="phonebar-phone"]').hide();jQuery(n.NumberInput).attr("maxlength",255);jQuery(n.PhoneDialPad).hide();rt();w===!1&&(w=!0,window.addEventListener("message",function(n){if(!n.isTrusted||n.source!==window){console.log("[ContentScript] [WARN] Invalid Message Received",n);return}n.data.type==="chromebarContentScript"&&it(n)}));t.sendInitializeRequest()},initializeXmpp:function(n){t.media.xmpp.initialize(t,n||u.xmppconfig,Ifm.ChromeBar.Proxy)},isLoggedIn:function(){return y!==undefined&&y!==a.NotLoggedIn&&y!==a.Connecting&&y!==a.Initialization},language:function(){return c},log:function(n,t){if(arguments.length<3)throw Ifm.Diagnostics.Errors.argsno("3+");var i="",r=t.toLowerCase();r==="info"?r="log":r==="critical"&&(r="error");n&&(i+="["+n+"] ");t&&(i+="["+t+"] ");i+=Array.prototype.splice.call(arguments,2).join(" ");try{console[r](i)}catch(u){console.log(i)}},login:function(n,u,f,e,o){if(arguments.length<3||arguments.length>5)throw Ifm.Diagnostics.Errors.argsno("3 (+2)");if(o&&!Ifm.Type.isFunction(o))throw Ifm.Diagnostics.Errors.func("callback");o&&r.login.push(o);t.agent.firstName=n;t.agent.lastName=u;t.agent.password=f;t.agent.extension=e;window.postMessage({type:"chromebarProxy",params:i.LoginRequest,firstName:n,lastName:u,password:f,extension:e},"*")},loginEx:function(n,u,f,e,o){if(arguments.length<4||arguments.length>5)throw Ifm.Diagnostics.Errors.argsno("4 (+1)");if(o&&!Ifm.Type.isFunction(o))throw Ifm.Diagnostics.Errors.func("callback");o&&r.login.push(o);t.agent.firstName=n;t.agent.lastName=u;t.agent.password=e;t.agent.extension=undefined;window.postMessage({type:"chromebarProxy",params:i.LoginExRequest,firstName:n,lastName:u,oldPassword:f,newPassword:e},"*")},loginWithProvisioning:function(n,u,f,e){if(arguments.length<1||arguments.length>4)throw Ifm.Diagnostics.Errors.argsno("1 (+4)");if(e&&!Ifm.Type.isFunction(e))throw Ifm.Diagnostics.Errors.func("callback");e&&r.login.push(e);t.agent.firstName="\t";t.agent.lastName="\t";t.agent.password=u;t.agent.extension=f;window.postMessage({type:"chromebarProxy",params:i.ProvisioningAndLoginRequest,userName:n,extension:f,token:u},"*")},loginWithProvisioningForSite:function(n,u,f,e,o){if(arguments.length<2||arguments.length>5)throw Ifm.Diagnostics.Errors.argsno("2 (+3)");if(o&&!Ifm.Type.isFunction(o))throw Ifm.Diagnostics.Errors.func("callback");o&&r.login.push(o);t.agent.firstName="\t";t.agent.lastName="\t";t.agent.password=f;t.agent.extension=e;window.postMessage({type:"chromebarProxy",params:i.ProvisioningAndLoginRequest,userName:n,site:u,extension:e,token:f},"*")},loginWithToken:function(n,u,f,e){if(arguments.length<1||arguments.length>4)throw Ifm.Diagnostics.Errors.argsno("1 (+3)");if(e&&!Ifm.Type.isFunction(e))throw Ifm.Diagnostics.Errors.func("callback");e&&r.login.push(e);n&&n.length>0?(t.agent.firstName="\t",t.agent.lastName="\t",t.agent.password=n,t.agent.extension=u,t.agent.userName=f,window.postMessage({type:"chromebarProxy",params:i.LoginWithTokenRequest,userName:f,token:n,extension:t.agent.extension},"*")):window.postMessage({type:"chromebarProxy",params:i.Oauth2LoginRequest,extension:t.agent.extension,userName:f},"*")},logout:function(n){if(arguments.length>1)throw Ifm.Diagnostics.Errors.argsno("0 (+1)");if(n&&!Ifm.Type.isFunction(n))throw Ifm.Diagnostics.Errors.func("callback");n&&r.logout.push(n);window.postMessage({type:"chromebarProxy",params:i.LogoutRequest},"*")},makeCall:function(n,t,u,f){if(arguments.length<2||arguments.length>4)throw Ifm.Diagnostics.Errors.argsno("2 (+2)");if(f&&!Ifm.Type.isFunction(f))throw Ifm.Diagnostics.Errors.func("callback");f&&r.make.push(f);window.postMessage({type:"chromebarProxy",params:i.MakePhonesCallRequest,phoneNumber:n,campaign:t,callingNumber:u},"*")},muteRecording:function(n,r,u,f){if(arguments.length<3||arguments.length>4)throw Ifm.Diagnostics.Errors.argsno("3+1");var e=n?t.calls(n):t.getAudioCall();if(!e||e.mediatype>5)throw Ifm.Diagnostics.Errors.op("this call's mediatype does not support recording");window.postMessage({type:"chromebarProxy",params:i.MuteRecordingRequest,callId:e.callId,muteRxChannel:r,muteTxChannel:u,tag:f},"*")},numberOfLines:function(){return tt},panic:function(){window.postMessage({type:"chromebarProxy",params:"panicEvent"},"*")},pause:function(n,t){if(arguments.length>2)throw Ifm.Diagnostics.Errors.argsno("0 (+2)");if(t&&!Ifm.Type.isFunction(t))throw Ifm.Diagnostics.Errors.func("callback");t&&r.pause.push(t);window.postMessage({type:"chromebarProxy",params:i.PauseRequest,reasonId:n},"*")},phoneBarVersion:function(){return ot},proxyVersion:function(){return Ifm.ChromeBar.Proxy.about},ready:function(n,t){if(arguments.length>2)throw Ifm.Diagnostics.Errors.argsno("0 (+2)");if(t&&!Ifm.Type.isFunction(t))throw Ifm.Diagnostics.Errors.func("callback");t&&r.ready.push(t);window.postMessage({type:"chromebarProxy",params:i.ReadyRequest,callId:n},"*")},sendInitializeRequest:function(){d!==undefined&&console.log("[Proxy] Timeout waiting for RegisterClientPageReply");console.log("[Proxy] Sending InitializeRequest");window.postMessage({type:"chromebarProxy",params:i.InitializeRequest},"*");d=setTimeout(t.sendInitializeRequest,500)},setConfiguration:function(n,t){if(arguments.length<1||arguments.length>2)throw Ifm.Diagnostics.Errors.argsno("1 (+1)");if(t&&!Ifm.Type.isFunction(t))throw Ifm.Diagnostics.Errors.func("callback");t&&r.setConfiguration.push(t);window.postMessage({type:"chromebarProxy",params:i.SetConfigurationRequest,newConfiguration:n},"*")},showAssignedCampaignsList:function(){t.getAssignedCampaignList(function(n){for(var u="",i=0;i<n.campaigns.length;i++)u+=l.CampaignListRow.replace("{name}",n.campaigns[i].name).replace("{boundness}",n.campaigns[i].boundness).replace("{state}",n.campaigns[i].active?v[c].CampaignStateActive:v[c].CampaignStateInactive);var f=l.CampaignListCardEx.replace("{nameth}",v[c].CampaignName).replace("{boundnessth}",v[c].CampaignDirection).replace("{stateth}",v[c].CampaignState).replace("{body}",u),e=Ifm.Dom.Cards.isShown("campaignlist-card"),r=Ifm.Dom.Cards.show(f,"campaignlist-card",!0);e||(r.timer=setInterval(t.showAssignedCampaignsList,5e3),r.onclick=function(){r.close()},r.onclosed=function(){clearInterval(r.timer)})})},showDialPad:function(){jQuery(n.PhoneDialPad+", "+n.HideDialPadButton).enable().show();jQuery(n.ShowDialPadButton).disable().hide();window.postMessage({type:"chromebarProxy",params:i.DialPadStateChangedEvent,hidden:!1},"*")},showLoginDialog:function(n,i){var r;u&&u.config.enableProvisioning?(r=templ.Login3Dialog.replace("{userNameLabel}",v[c].LoginUserName).replace("{userName}",n?p.LastValidUsername||"":""),Ifm.Dom.Cards.showDialog(r,"login2-dialog",e.LoginTitle,[{text:e.ButtonOK,click:function(){var n=usernametxt.value;t.getSiteListFromProvisioning(usernametxt.value,undefined,function(i){var r,u;i!=undefined?(r="",i.forEach(n=>{r+=`<option class="combobox-entry" value="${n}">${n}</option>`}),u=templ.Login4Dialog.replace("{siteNameLabel}",v[c].LoginSiteSelection).replace("{sitesList}",r),Ifm.Dom.Cards.showDialog(u,"login4-dialog",e.LoginTitle,[{text:e.ButtonOK,click:function(){t.loginWithProvisioningForSite(n,sitenametxt.value,"-")}},{text:e.ButtonCancel}])):t.loginWithProvisioningForSite(n,undefined,"-")})}},{text:e.ButtonCancel}])):u&&u.config.oauth2.enableOAuth2?t.loginWithToken(""):(r=l.LoginDialog.replace("{firstNameLabel}",e.LoginFirstName).replace("{lastNameLabel}",e.LoginLastName).replace("{passwordLabel}",e.LoginPassword).replace("{firstName}",n?p.LastValidFirstName||"":"").replace("{lastName}",n?p.LastValidLastName||"":"").replace("{password}",i?p.LastValidPassword||"":""),Ifm.Dom.Cards.showDialog(r,"login-dialog",e.LoginTitle,[{text:e.ButtonChangePassword,cssText:"margin-right:50px;",click:function(){t.showLoginExDialog(n)}},{text:e.ButtonOK,click:function(){t.login(firstnametxt.value,lastnametxt.value,passwordtxt.value)}},{text:e.ButtonCancel}]))},showLoginExDialog:function(n){var i=l.Login2Dialog.replace("{firstNameLabel}",e.LoginFirstName).replace("{lastNameLabel}",e.LoginLastName).replace("{passwordLabel}",e.LoginPassword).replace("{oldPasswordLabel}",e.LoginOldPassword).replace("{newPasswordLabel}",e.LoginNewPassword).replace("{confirmPasswordLabel}",e.LoginConfirmPassword).replace("{firstName}",n?p.LastValidFirstName:"").replace("{lastName}",n?p.LastValidLastName:"").replace("{oldPassword}","").replace("{newPassword}","").replace("{confirmPassword}","");Ifm.Dom.Cards.showDialog(i,"login2-dialog",e.LoginTitle,[{text:e.ButtonOK,click:function(){if(newPasswordtxt.value!==confirmPasswordtxt.value)return confirmPasswordtxt.focus(),t.showMessage(e.PasswordsDontMatch),!1;t.loginEx(firstnametxt.value,lastnametxt.value,oldPasswordtxt.value,newPasswordtxt.value)}},{text:e.ButtonCancel}])},showMakeCallPopup:function(i,r){(i||jQuery(n.NumberInput).val())&&t.getOutboundCampaignList(function(i){var f,u;if(i.campaigns.unshift({name:e.OutboundManualCall}),i.campaigns.length>0){for(f=[],u=0;u<i.campaigns.length;u++)f.push({label:i.campaigns[u].serviceName||i.campaigns[u].name,value:i.campaigns[u].name});(new Ifm.Dom.Menu).choose(f,function(i){i===e.OutboundManualCall?t.media.phone&&t.media.phone.dial(jQuery(n.NumberInput).val()):t.makeCall(jQuery(n.NumberInput).val(),i,r)})}})},showMessage:function(n,t,i){if(jQuery.toast)jQuery.toast({text:n,icon:t,heading:i,allowToastClose:!0,hideAfter:5e3,position:"top-center",loader:!1});else{var r=Ifm.Dom.Band.show(),u='<div class="phonebar-message" style="line-height:'+r.clientHeight+'px;">'+n+"<\/div>";r.innerHTML=u}},showPauseMenu:function(){t.getPauseReasons(function(n){var r,i;if(n.reasons.length===0)t.pause();else{for(n.reasons.unshift({text:e.PauseGenericReason,value:0}),r=[],i=0;i<n.reasons.length;i++)r.push({label:n.reasons[i].text,value:n.reasons[i].id});(new Ifm.Dom.Menu).choose(r,function(n){t.pause(n)})}})},showQueueInfo:function(n){t.getQueueInfo(n,function(n){var r=l.QueueInfoCard.replace("{number}",n.calls).replace("{queuedNumberText}",e.queuedNumberText).replace("{maxTime}",n.maxTime||"--").replace("{queuedMaxTimeText}",e.queuedMaxTimeText).replace("{avgTime}",n.avgTime||"--").replace("{queuedAvgTimeText}",e.queuedAvgTimeText),u=Ifm.Dom.Cards.isShown("queueinfo-card"),i=Ifm.Dom.Cards.show(r,"queueinfo-card",!0);u||(i.className+=" phonebar-queueinfo-card",i.timer=setInterval(t.showQueueInfo,5e3),i.onclick=function(){i.close()},i.onclosed=function(){clearInterval(i.timer)})})},showTransferForm:function(i){var f=l.TransferCallCard.replace("{mandatoryLabel}",e.TransferMandatory),o=Ifm.Dom.Cards.showDialog(f,"transfercall-card",e.TransferTitle,[{text:e.ButtonRefresh,click:function(){var i=jQuery(n.TransferCampaignList)[0],r;return i&&i.selectedIndex>=0&&(r=i[i.selectedIndex].getAttribute("campaignName"),t.getTransferAgentList(r,function(t){for(var u=l.TransferCallAgentListItem.format(e.TransferAnybody),r=0,i;r<t.agents.length,i=t.agents[r];r++)u+=l.TransferCallAgentListItem.format(i.firstName,i.lastName,i.state!==2?"("+e.GenericBusyState+")":"");jQuery(n.TransferAgentList).html(u)})),!1}},{text:e.ButtonTransfer,click:function(){var u=jQuery(n.TransferCampaignList)[0],f="";u&&u.selectedIndex>=0&&(f=u[u.selectedIndex].getAttribute("campaignName"));var r=jQuery(n.TransferAgentList)[0],e="",o="",s=!1;return r&&r.selectedIndex>0&&(e=r[r.selectedIndex].getAttribute("firstName"),o=r[r.selectedIndex].getAttribute("lastName"),s=jQuery(n.TransferMandatoryCheck).prop("checked")),t.transferCall(i,f,e,o,s,1,function(n){n.accepted&&Ifm.Dom.Cards.close("transfercall-card")}),!1}},{text:e.ButtonCancel}]),r,u;jQuery(".phonebar-transfercall-card-content").find(".phonebar-transfer-campaign-list").on("input",function(){var i=jQuery(n.TransferCampaignList)[0],r;i&&i.selectedIndex>=0&&(r=i[i.selectedIndex].getAttribute("campaignName"),t.getTransferAgentList(r,function(t){for(var u=l.TransferCallAgentListItem.format(e.TransferAnybody),r=0,i;r<t.agents.length,i=t.agents[r];r++)u+=l.TransferCallAgentListItem.format(i.firstName,i.lastName,i.state!==2?"("+e.GenericBusyState+")":"");jQuery(n.TransferAgentList).html(u)}))});r=i?t.calls(i):t.getAudioCall();u="";r?(u=r.campaignName,i=r.callId):i=0;t.getTransferCampaignList(i,function(i){for(var h=jQuery(n.TransferCampaignList).val(),f="",o="",c=[],s=0,r=null;s<i.campaigns.length,r=i.campaigns[s];s++)u.startsWith(r.serviceName+"/")?f+=l.TransferCallCampaignListItem.format(r.name,r.campaignName):c[r.serviceName]||(o+=l.TransferCallCampaignListItem.format(r.name,r.serviceName),c[r.serviceName]=!0);f&&(f='<optgroup label="'+e.TransferCampaign+'">'+f+"<\/optgroup>");o&&(o='<optgroup label="'+e.TransferService+'">'+o+"<\/optgroup>");jQuery(n.TransferCampaignList).html(f+o);h&&jQuery(n.TransferCampaignList).val(h);t.getTransferAgentList(u,function(t){for(var u=l.TransferCallAgentListItem.format(e.TransferAnybody),r=0,i;r<t.agents.length,i=t.agents[r];r++)u+=l.TransferCallAgentListItem.format(i.firstName,i.lastName,i.state!==2?"("+e.GenericBusyState+")":"");jQuery(n.TransferAgentList).html(u)})})},startDTMFMasking:function(n,r,u){if(arguments.length!==3)throw Ifm.Diagnostics.Errors.argsno("3");var f=n?t.calls(n):t.getAudioCall();if(!f||f.mediatype>5)throw Ifm.Diagnostics.Errors.op("this call's mediatype does not support DTMFMasking");window.postMessage({type:"chromebarProxy",params:i.StartDTMFMaskingRequest,callId:f.callId,numberOfDigits:r,terminationDigit:u},"*")},startRecording:function(n,r,u){if(arguments.length>3)throw Ifm.Diagnostics.Errors.argsno("0+3");var f=n?t.calls(n):t.getAudioCall();if(!f||f.mediatype>5)throw Ifm.Diagnostics.Errors.op("this call's mediatype does not support recording");window.postMessage({type:"chromebarProxy",params:i.StartRecordingRequest,callId:f.callId,fileName:r,settings:u},"*")},stopDTMFMasking:function(n){if(arguments.length!==1)throw Ifm.Diagnostics.Errors.argsno("1");var r=n?t.calls(n):t.getAudioCall();if(!r||r.mediatype>5)throw Ifm.Diagnostics.Errors.op("this call's mediatype does not support DTMFMasking");window.postMessage({type:"chromebarProxy",params:i.StopDTMFMaskingRequest,callId:r.callId},"*")},stopRecording:function(n){var r=n?t.calls(n):t.getAudioCall();if(!r||r.mediatype>5)throw Ifm.Diagnostics.Errors.op("this call's mediatype does not support recording");window.postMessage({type:"chromebarProxy",params:i.StopRecordingRequest,callId:r.callId},"*")},supportsAbortCall:function(){return u.options.enableAbortCall},supportsConference:function(){return ft},tagRecording:function(n,r){if(arguments.length!==2)throw Ifm.Diagnostics.Errors.argsno("2");var u=n?t.calls(n):t.getAudioCall();if(!u||u.mediatype>5)throw Ifm.Diagnostics.Errors.op("this call's mediatype does not support recording");window.postMessage({type:"chromebarProxy",params:i.TagRecordingRequest,callId:u.callId,tag:r},"*")},transferCall:function(n,u,f,e,o,s,h){if(arguments.length<2||arguments.length>7)throw Ifm.Diagnostics.Errors.argsno("2 (+5)");if(h&&!Ifm.Type.isFunction(h))throw Ifm.Diagnostics.Errors.func("callback");h&&r.transfer.push(h);var c=n?t.calls(n):t.getAudioCall();c&&window.postMessage({type:"chromebarProxy",params:i.TransferCallRequest,callId:c.callId,campaignName:u,agentFirstName:f,agentLastName:e,mandatory:o,mode:s},"*")},updateToken:function(n,r){if(arguments.length<1||arguments.length>2)throw Ifm.Diagnostics.Errors.argsno("1 (+1)");t.agent.password=n;r&&(t.agent.userName=r);window.postMessage({type:"chromebarProxy",params:i.RefreshTokenRequest,token:t.agent.password,username:r},"*")},media:{},abortcall:function(){window.postMessage({type:"chromebarProxy",params:i.AbortCallRequest},"*")},acceptrejectassignment:function(){console.log("WARNING - ChromeBar.Proxy: function 'acceptrejectassignment' not implemented in current version.")},addcalldata:function(n,t,r){window.postMessage({type:"chromebarProxy",params:i.AddCallDataRequest,name:n,value:t,callid:r},"*")},addcampaignlessconnection:function(){t.isSCPRegisteredForCLEvents=!0;t.isPBPRegisteredForCLEvents=!0},addconnection:function(n){t.registeredCampaignList.indexOf(n)<0&&t.registeredCampaignList.push(n)},appendcuesheet:function(n){if(arguments.length!==1)throw Ifm.Diagnostics.Errors.argsno("1");t.tagRecording(undefined,n)},conferencecall:function(n){if(arguments.length!==1)throw Ifm.Diagnostics.Errors.argsno("1");t.media.phone&&(n===1?t.media.phone.enterConference():n===0&&t.media.phone.leaveConference())},connect:function(){t=this;t.initialize=function(){};t.connect=function(){};console.log("ChromeBarProxy - Connecting");t.scriptControlMode=!0;t.events=Ifm.ChromeBar.Proxy.events;a=Ifm.ChromeBar.Proxy.States;t.registeredCampaignList=[];jQuery('[class^="phonebar-phone"]').hide();jQuery(n.NumberInput).attr("maxlength",255);jQuery(n.PhoneDialPad).hide();rt();w===!1&&(w=!0,window.addEventListener("message",function(n){if(!n.isTrusted||n.source!==window){console.log("[ContentScript] [WARN] Invalid Message Received",n);return}n.data.type==="chromebarContentScript"&&it(n)}));window.postMessage({type:"chromebarProxy",params:i.InitializeRequest},"*")},filternonphonecallevents:function(n){t.filterNonPhoneCallEvents=n},disconnect:function(){t.scriptControlMode=!1;window.postMessage({type:"chromebarProxy",params:i.DeregisterRequest},"*");t.events.ondisconnected.raise()},dump:function(){},getagentslist:function(n,i){if(arguments.length<1||arguments.length>2)throw Ifm.Diagnostics.Errors.argsno("1 (+1)");t.getAgentList(i,n,function(n){var r,i,u;if(t.scriptControlMode&&o(!0,!0,"*")){for(r=[],i=0,u=null;i<n.agents.length,u=n.agents[i];i++)r.push({firstname:n.agents[i].firstName,lastname:n.agents[i].lastName,state:n.agents[i].state,time:n.agents[i].time,campaign:n.agents[i].campaignName});t.events.onagentslistreply.raise({agentsnum:r.length,agentslist:r})}})},getcampaignslist:function(n,i,r){if(arguments.length<1||arguments.length>3)throw Ifm.Diagnostics.Errors.argsno("1 (+2)");t.getCampaignList(i,r,n,function(n){var r,i,u;if(t.scriptControlMode&&o(!0,!0,"*")){for(r=[],i=0,u=null;i<n.campaigns.length,u=n.campaigns[i];i++)r.push({name:n.campaigns[i].name,state:n.campaigns[i].status,boundness:n.campaigns[i].boundness,assigned:n.campaigns[i].assigned,transfernotallowed:n.campaigns[i].transfer,flags:n.campaigns[i].flags});t.events.oncampaignslistreply.raise({campaignsnum:r.length,campaignslist:r})}})},getcurrentagentdetails:function(){t.agent&&t.scriptControlMode&&o(!0,!0,"*")&&t.events.onagentdetailsreply.raise({firstname:t.agent.firstName,lastname:t.agent.lastName,extension:t.agent.extension,id:t.agent.id,state:y})},getpausereasonslist:function(){t.getPauseReasons(function(n){var r,i;if(t.scriptControlMode&&o(!0,!0,"*")){for(r=[],i=0;i<n.reasons.length;i++)r.push({description:n.reasons[i].text,code:n.reasons[i].id});t.events.onpausereasonslistreply.raise({pausereasonsnum:n.reasons.length,pausereasonslist:r})}})},getqueueinfo:function(n){t.getQueueInfo(n,function(n){t.scriptControlMode&&o(!0,!0,"*")&&t.events.onqueueinforeply.raise({campaign:n.campaignName,callsnum:n.calls,maxtime:n.maxTime,avgtime:n.avgTime})})},makecall:function(n,i,r){if(arguments.length<2||arguments.length>4)throw Ifm.Diagnostics.Errors.argsno("2 (+2)");t.makeCall(n,i,r)},makedialercall:function(){console.log("WARNING - ChromeBar.Proxy: function 'makedialercall' not implemented in current version.")},makemanualcall:function(n,i){if(arguments.length<2||arguments.length>3)throw Ifm.Diagnostics.Errors.argsno("2 (+1)");t.media.phone&&(t.media.phone.selectLine(n-1),t.media.phone.dial(i))},muteaudiorecording:function(n,i,r,u){if(arguments.length<2||arguments.length>4)throw Ifm.Diagnostics.Errors.argsno("2 (+2)");t.muteRecording(undefined,i,n,r?u:undefined)},playlocalfile:function(){console.log("WARNING - ChromeBar.Proxy: function 'playlocalfile' not implemented in current version.")},removecampaignlessconnection:function(){t.isSCPRegisteredForCLEvents=!1;t.isPBPRegisteredForCLEvents=!1},removeconnection:function(n){t.registeredCampaignList.indexOf(n)>-1&&t.registeredCampaignList.splice(t.registeredCampaignList.indexOf(n),1)},retrievecall:function(){console.log("WARNING - ChromeBar.Proxy: function 'retrievecall' not implemented in current version.")},savecalldata:function(n,t){window.postMessage({type:"chromebarProxy",params:i.SaveCallDataRequest,calldatastr:n,callid:t},"*")},sethookstate:function(n){if(n!==0)t.media.phone&&t.media.phone.drop();else if(n!==1)t.media.phone&&t.media.phone.answer();else throw Ifm.Diagnostics.Errors.func("hookstate");},setmutestate:function(n){n===1||n===!0?window.postMessage({type:"chromebarProxy",params:i.MicrophoneOffRequest},"*"):window.postMessage({type:"chromebarProxy",params:i.MicrophoneOnRequest},"*")},setphonebarbuttonenabled:function(n,t){window.postMessage({type:"chromebarProxy",params:i.EnableChromeBarButtonRequest,buttonIdx:n,enabled:t},"*")},showcalltransferform:function(n){t.showTransferForm(n)},showinformationpopup:function(n,t){window.postMessage({type:"chromebarProxy",params:i.ShowNotificationRequest,title:"",message:n,timeout:t},"*")},startaudiorecording:function(n,i){if(arguments.length<1||arguments.length>2)throw Ifm.Diagnostics.Errors.argsno("1 (+1)");t.startRecording(undefined,n,i)},stopaudiorecording:function(){t.stopRecording()},stopplaylocalfile:function(){console.log("WARNING - ChromeBar.Proxy: function 'stopplaylocalfile' not implemented in current version.")},swapcall:function(){var n=t.getAudioCall();n?window.postMessage({type:"chromebarProxy",params:i.SwapCallRequest,callid:n.callId},"*"):t.events.oncommandexecutedevent.raise({commandcode:i.SwapCallRequest,result:0})},switchactiveline:function(){window.postMessage({type:"chromebarProxy",params:i.SwitchLineRequest},"*")},transfercall:function(n,i,r,u,f){if(arguments.length<1||arguments.length>5)throw Ifm.Diagnostics.Errors.argsno("1 (+4)");t.transferCall(undefined,n,i,r,u,f)}}}()},function(){function n(t){if(!(this instanceof n))throw Ifm.Diagnostics.Errors.ctor();this.phonebar=t;this._isConnected=!1;this._isRegistered=!1;this._lineStates=[];for(var i=0;i<this.numberOfLines;i++)this._lineStates.push(n.States.Idle);this._selectedLineId=0;this._isInConference=!1}var e=namespace("Ifm.ChromeBar.Proxy.Media");n.events=defineEvents("initialized","connected","disconnected","registeredstatechanged","linestatechanged","conferencestatechanged","lineselected","calling","callconnected","calldisconnected","displayname","incomingcall","ringing","mutechanged","vumeter");n.States={Idle:"[Idle]",Incoming:"[Incoming]",Calling:"[Calling]",Talking:"[Talking]"};n.prototype.numberOfLines=1;n.prototype.supportsConference=!1;Object.defineProperties(n.prototype,{isConnected:{get:function(){return this._isConnected}},isInConference:{get:function(){return this._isInConference}},isRegistered:{get:function(){return this._isRegistered}},selectedLineId:{get:function(){return this._selectedLineId}},state:{get:function(){return this._lineStates[this._selectedLineId]}}});n.prototype.initialize=function(){};n.prototype.connect=function(){};n.prototype.disconnect=function(){};n.prototype.answer=function(){this.phonebar.log(t,i,"Answering");this._answer()};n.prototype.canConference=function(){if(!this.supportsConference)return!1;for(var t=0,i=0;t<this.numberOfLines;t++)this._lineStates[t]===n.States.Talking&&i++;return i>1};n.prototype.dial=function(r){if(!r&&r!==0){this.phonebar.log(t,u,"No number to dial");return}if(this.state===n.States.Ringing){this.phonebar.log(t,u,"Can't dial in current state");return}this.phonebar.log(t,i,"Dialing number",r);this.state===n.States.Idle?this._dial(r):this._dtmf(r)};n.prototype.dtmf=function(r){if(!r&&r!==0){this.phonebar.log(t,u,"No dtmf to dial");return}if(this.state===n.States.Idle||this.state===n.States.Ringing){this.phonebar.log(t,u,"Can't dial in current state");return}this.phonebar.log(t,i,"Dialing tones",r);this._dtmf(r)};n.prototype.drop=function(){this.phonebar.log(t,i,"Dropping");this._drop()};n.prototype.enterConference=function(){if(!this.supportsConference){this.phonebar.log(t,u,"Device doesn't support conference");return}this.phonebar.log(t,i,"Entering conference");this._enterConference()};n.prototype.getLineState=function(n){if(!(n>=0&&n<this.numberOfLines)){this.phonebar.log(t,u,"Invalid lineId specified:",n);return}return this._lineStates[n]};n.prototype.leaveConference=function(){if(!this.supportsConference){this.phonebar.log(t,u,"Device doesn't support conference");return}this.phonebar.log(t,i,"Leaving conference");this._leaveConference()};n.prototype.mute=function(){this.phonebar.log(t,i,"Muting microphone");this._mute()};n.prototype.register=function(){var n=this.domain,r=this.phonebar.agent.extension;n&&r||this.phonebar.log(t,u,"Can't register without domain or extension");this.phonebar.log(t,i,"Registering device to",n,r);this._register(n,r)};n.prototype.selectLine=function(n){if(this.numberOfLines<2){this.phonebar.log(t,u,"Device doesn't support multiple lines");return}this.phonebar.log(t,i,"Selecting line",n);this._selectLine(n)};n.prototype.unmute=function(){this.phonebar.log(t,i,"Unmuting microphone");this._unmute()};n.prototype.unregister=function(){this.phonebar.log(t,i,"Unregistering device");this._unregister()};n.prototype._answer=function(){window.postMessage({type:"chromebarProxy",params:r.PickupRequest},"*")};n.prototype._dial=function(n){window.postMessage({type:"chromebarProxy",params:r.DialNumberRequest,number:n},"*")};n.prototype._dtmf=function(n){window.postMessage({type:"chromebarProxy",params:r.SendDtmfRequest,dtmf:n},"*")};n.prototype._drop=function(){window.postMessage({type:"chromebarProxy",params:r.HangupRequest},"*")};n.prototype._enterConference=function(){window.postMessage({type:"chromebarProxy",params:r.EnterConferenceRequest},"*")};n.prototype._leaveConference=function(){window.postMessage({type:"chromebarProxy",params:r.LeaveConferenceRequest},"*")};n.prototype._mute=function(){window.postMessage({type:"chromebarProxy",params:r.MicrophoneOffRequest},"*")};n.prototype._register=function(n,t){window.postMessage({type:"chromebarProxy",params:r.RegisterRequest,domain:n,extension:t},"*")};n.prototype._selectLine=function(n){window.postMessage({type:"chromebarProxy",params:r.SelectLineRequest,lineId:n},"*")};n.prototype._unmute=function(){window.postMessage({type:"chromebarProxy",params:r.MicrophoneOnRequest},"*")};n.prototype._unregister=function(){window.postMessage({type:"chromebarProxy",params:r.UnregisterRequest},"*")};n.prototype._onInitialized=function(){this.phonebar.log(t,i,"Initialized");n.events.initialized.raise(this,{})};n.prototype._onConnected=function(){this.phonebar.log(t,i,"Connected");this._isConnected=!0;n.events.connected.raise(this,{})};n.prototype._onDisconnected=function(r){this.phonebar.log(t,i,"Disconnected");this._isConnected=!1;n.events.disconnected.raise(this,{clean:r})};n.prototype._onRegisteredStateChanged=function(i){this.phonebar.log(t,f,"Device is",i?"":"not","registered");this._isRegistered=i;n.events.registeredstatechanged.raise(this,{isRegistered:i})};n.prototype._onLineStateChanged=function(i,r){this.phonebar.log(t,f,"Line",i+1,"in state",r);this._lineStates[i]=r;n.events.linestatechanged.raise(this,{lineId:i,state:r})};n.prototype._onConferenceStateChanged=function(r){this.phonebar.log(t,i,"Lines are",r?"":"not","in conference");this._isInConference=r;n.events.conferencestatechanged.raise(this,{inConference:r})};n.prototype._onLineSelected=function(r){this.phonebar.log(t,i,"Line",r+1,"selected");this._selectedLineId=r;n.events.lineselected.raise(this,{lineId:r})};n.prototype._onCalling=function(r){this.phonebar.log(t,i,"Calling on line",r+1);n.events.calling.raise(this,{lineId:r})};n.prototype._onCallConnected=function(r){this.phonebar.log(t,i,"Call connected on line",r+1);n.events.callconnected.raise(this,{lineId:r})};n.prototype._onCallDisconnected=function(r,u,f){this.phonebar.log(t,i,"Call disconnected on line",r+1,"; sip code:",u,"sip cause:",f);n.events.calldisconnected.raise(this,{lineId:r,sipCode:u,sipCause:f})};n.prototype._onDisplayName=function(r,u){this.phonebar.log(t,i,"Got display name",u,"for incoming call on line",r+1);n.events.displayname.raise(this,{lineId:r,displayName:u})};n.prototype._onIncomingCall=function(r){this.phonebar.log(t,i,"Incoming call on line",r+1);n.events.incomingcall.raise(this,{lineId:r})};n.prototype._onRinging=function(r,u){this.phonebar.log(t,i,"Line",r+1,"is ringing;",u,"ring(s)");n.events.ringing.raise(this,{lineId:r,rings:u})};n.prototype._onMuteChanged=function(r){this.phonebar.log(t,i,"Microphone is",r?"":"not","muted");n.events.mutechanged.raise(this,{isMuted:r})};n.prototype._onVUMeter=function(t,i){n.events.vumeter.raise(this,{microphone:t,speakers:i})};var t="ChromeBar.Media.Phone",i="Debug",f="Info",u="Warn",r=Ifm.ChromeBar.Constants.MessageCodes;e.Phone=n}();namespace("Ifm.ChromeBar.PhoneBar").Proxy={events:defineEvents("initialized","disconnected","connected","connectionFailure","saveConfigReply","configChangedEvent","buttonStateChangedEvent","booked","assignment","alerting","answered","callfailure","othercall","pausebooked","pause","ready","readyfordetach","readyfortransfer","terminated","recordingstarted","recordingmutechanged","recordingstopped","maskeddigitreceived","maskedpayloadreceived","statechanged","statetimechanged","supervisormessage"),canRun:function(){return Ifm.ChromeBar.Proxy.canRun()},run:function(){this.run=function(){self.log("PhoneBar","Debug","Already running")};this.instance.initialize()},instance:function(){var t=Ifm.ChromeBar.Proxy.instance,n;return Ifm.ChromeBar.Proxy.events.initialized=function(t,i){n&&n.events.initialized.raise(n,i)},Ifm.ChromeBar.Proxy.events.disconnected=function(t,i){n&&n.events.disconnected.raise(n,i)},Ifm.ChromeBar.Proxy.events.connected=function(t,i){n&&n.events.connected.raise(n,i)},Ifm.ChromeBar.Proxy.events.connectionFailure=function(t,i){n&&n.events.connectionFailure.raise(n,i)},Ifm.ChromeBar.Proxy.events.saveConfigReply=function(t,i){n&&n.events.saveConfigReply.raise(n,i)},Ifm.ChromeBar.Proxy.events.configChangedEvent=function(t,i){n&&n.events.configChangedEvent.raise(n,i)},Ifm.ChromeBar.Proxy.events.buttonStateChangedEvent=function(t,i){n&&n.events.buttonStateChangedEvent.raise(n,i)},Ifm.ChromeBar.Proxy.events.booked=function(t,i){n&&n.events.booked.raise(n,i)},Ifm.ChromeBar.Proxy.events.assignment=function(t,i){n&&n.events.assignment.raise(n,i)},Ifm.ChromeBar.Proxy.events.alerting=function(t,i){n&&n.events.alerting.raise(n,i)},Ifm.ChromeBar.Proxy.events.answered=function(t,i){n&&n.events.answered.raise(n,i)},Ifm.ChromeBar.Proxy.events.callfailure=function(t,i){n&&n.events.callfailure.raise(n,i)},Ifm.ChromeBar.Proxy.events.othercall=function(t,i){n&&n.events.othercall.raise(n,i)},Ifm.ChromeBar.Proxy.events.pausebooked=function(t,i){n&&n.events.pausebooked.raise(n,i)},Ifm.ChromeBar.Proxy.events.pause=function(t,i){n&&n.events.pause.raise(n,i)},Ifm.ChromeBar.Proxy.events.ready=function(t,i){n&&n.events.ready.raise(n,i)},Ifm.ChromeBar.Proxy.events.readyfordetach=function(t,i){n&&n.events.readyfordetach.raise(n,i)},Ifm.ChromeBar.Proxy.events.readyfortransfer=function(t,i){n&&n.events.readyfortransfer.raise(n,i)},Ifm.ChromeBar.Proxy.events.terminated=function(t,i){n&&n.events.terminated.raise(n,i)},Ifm.ChromeBar.Proxy.events.recordingstarted=function(t,i){n&&n.events.recordingstarted.raise(n,i)},Ifm.ChromeBar.Proxy.events.recordingmutechanged=function(t,i){n&&n.events.recordingmutechanged.raise(n,i)},Ifm.ChromeBar.Proxy.events.recordingstopped=function(t,i){n&&n.events.recordingstopped.raise(n,i)},Ifm.ChromeBar.Proxy.events.maskeddigitreceived=function(t,i){n&&n.events.maskeddigitreceived.raise(n,i)},Ifm.ChromeBar.Proxy.events.maskedpayloadreceived=function(t,i){n&&n.events.maskedpayloadreceived.raise(n,i)},Ifm.ChromeBar.Proxy.events.statechanged=function(t,i){n&&n.events.statechanged.raise(n,i)},Ifm.ChromeBar.Proxy.events.statetimechanged=function(t,i){n&&n.events.statetimechanged.raise(n,i)},Ifm.ChromeBar.Proxy.events.supervisormessage=function(t,i){n&&n.events.supervisormessage.raise(n,i)},{agent:t.agent,media:t.media,options:t.options,addCampaignLessConnection:function(){return t.addcampaignlessconnection()},addConnection:function(n){return t.addconnection(n)},removeCampaignLessConnection:function(){return t.removecampaignlessconnection()},removeConnection:function(n){return t.removeconnection(n)},abortCall:function(){return t.abortCall()},calls:function(n){return arguments.length===0?t.calls():t.calls(n)},chromeBarVersion:function(){return t.chromeBarVersion()},clearCallHistoryLog:function(n){return t.clearCallHistoryLog(n)},currentState:function(){return t.currentState()},currentStateReason:function(){return t.currentStateReason()},currentStateTime:function(){return t.currentStateTime()},getAgentList:function(n,i,r){return t.getAgentList(n,i,r)},getAssignedCampaignList:function(n){return t.getAssignedCampaignList(n)},getAudioCall:function(){return t.getAudioCall()},getAuthorityInfo:function(n,i){return t.getAuthorityInfo(n,i)},getCallHistoryLog:function(n){return t.getCallHistoryLog(n)},getCampaignList:function(n,i,r,u){return t.getCampaignList(n,i,r,u)},getConfiguration:function(){return t.getConfiguration()},getOutboundCampaignList:function(n){return t.getOutboundCampaignList(n)},getPauseReasons:function(n){return t.getPauseReasons(n)},getQueueInfo:function(n,i){return t.getQueueInfo(n,i)},getSiteListFromProvisioning:function(n,i,r){return t.getSiteListFromProvisioning(n,i,r)},getModuleConfiguration:function(n,i){return t.getModuleConfiguration(n,i)},getTransferAgentList:function(n,i){return t.getTransferAgentList(n,i)},getTransferCampaignList:function(n,i){return t.getTransferCampaignList(n,i)},hideDialPad:function(){return t.hideDialPad()},initialize:function(){return n=this,n.events=Ifm.ChromeBar.PhoneBar.Proxy.events,t.initialize()},initializeXmpp:function(n){return t.initializeXmpp(n)},isLoggedIn:function(){return t.isLoggedIn()},language:function(n){return t.language(n)},log:function(n,i,r){return t.log(n,i,r)},login:function(n,i,r,u,f){return t.login(n,i,r,u,f)},loginEx:function(n,i,r,u,f){return t.loginEx(n,i,r,u,f)},loginWithToken:function(n,i,r,u){return t.loginWithToken(n,i,r,u)},updateToken:function(n,i){return t.updateToken(n,i)},logout:function(n){return t.logout(n)},makeCall:function(n,i,r,u){return t.makeCall(n,i,r,u)},muteRecording:function(n,i,r,u){return t.muteRecording(n,i,r,u)},numberOfLines:function(){return t.numberOfLines()},panic:function(){return t.panic()},pause:function(n,i){return t.pause(n,i)},phoneBarVersion:function(){return t.phoneBarVersion()},loginWithProvisioning:function(n,i,r){return t.loginWithProvisioning(n,i,undefined,r)},loginWithProvisioningEx:function(n,i,r,u){return t.loginWithProvisioning(n,i,r,u)},loginWithProvisioningForSite:function(n,i,r,u){return t.loginWithProvisioningForSite(n,i,r,undefined,u)},loginWithProvisioningForSiteEx:function(n,i,r,u,f){return t.loginWithProvisioningForSite(n,i,r,u,f)},proxyVersion:function(){return t.proxyVersion()},ready:function(n,i){return t.ready(n,i)},setConfiguration:function(n){return t.setConfiguration(n)},showAssignedCampaignsList:function(){return t.showAssignedCampaignsList()},showDialPad:function(){return t.showDialPad()},showLoginDialog:function(n,i){return t.showLoginDialog(n,i)},showLoginExDialog:function(n){return t.showLoginExDialog(n)},showMakeCallPopup:function(n,i){return t.showMakeCallPopup(n,i)},showMessage:function(n,i,r){return t.showMessage(n,i,r)},showPauseMenu:function(){return t.showPauseMenu()},showQueueInfo:function(n){return t.showQueueInfo(n)},showTransferForm:function(n){return t.showTransferForm(n)},startDTMFMasking:function(n,i,r){return t.startDTMFMasking(n,i,r)},stopDTMFMasking:function(n){return t.stopDTMFMasking(n)},startRecording:function(n,i,r){return t.startRecording(n,i,r)},stopRecording:function(n){return t.stopRecording(n)},supportsAbortCall:function(){return t.supportsAbortCall()},supportsConference:function(){return t.supportsConference()},tagRecording:function(n,i){return t.tagRecording(n,i)},transferCall:function(n,i,r,u,f,e,o){return t.transferCall(n,i,r,u,f,e,o)},setChromeBarButtonEnabled:function(n,i){return t.setphonebarbuttonenabled(n,i)}}}()};namespace("Ifm.ChromeBar.ScriptControl").Proxy={events:defineEvents("onconnected","ondisconnected","onabortcallreply","onalertingevent","onansweredevent","onassignmentrequest","onrecordingcompletedevent","onrecordingmutedevent","onrecordingstartedevent","onbookedevent","oncallfailureevent","oncalltransferinitiatedevent","onconnectionremovedevent","ondeviceinfochangedevent","ondisplaynamechangedevent","onphonebarclosedevent","onloginreply","onlogoutreply","onnewcallreply","onothercallevent","onpauseevent","onpausereply","onphonebarconnectionlostevent","onpostcallworkevent","onreadyevent","onreadyfordetachevent","onreadyreply","onreadyfortransferevent","onretrievecallreply","onrejectableassignmentrequest","onterminatedevent","ontransferreply","onsupervisormessageevent","onmaskeddigitreceivedevent","onmaskedpayloadreceivedevent","onqueueinforeply","onagentslistreply","oncampaignslistreply","onpausereasonslistreply","onagentdetailsreply","oncommandexecutedevent"),canRun:function(){return Ifm.ChromeBar.Proxy.canRun()},run:function(){this.run=function(){self.log("PhoneBar","Debug","Already running")};this.instance.initialize()},instance:function(){var t=Ifm.ChromeBar.Proxy.instance,n=this;return Ifm.ChromeBar.Proxy.events.onconnected=function(t){n&&n.events.onconnected.raise(t)},Ifm.ChromeBar.Proxy.events.ondisconnected=function(t){n&&n.events.ondisconnected.raise(t)},Ifm.ChromeBar.Proxy.events.onabortcallreply=function(t){n&&n.events.onabortcallreply.raise(t)},Ifm.ChromeBar.Proxy.events.onalertingevent=function(t){n&&n.events.onalertingevent.raise(t)},Ifm.ChromeBar.Proxy.events.onansweredevent=function(t){n&&n.events.onansweredevent.raise(t)},Ifm.ChromeBar.Proxy.events.onassignmentrequest=function(t){n&&n.events.onassignmentrequest.raise(t)},Ifm.ChromeBar.Proxy.events.onrecordingcompletedevent=function(t){n&&n.events.onrecordingcompletedevent.raise(t)},Ifm.ChromeBar.Proxy.events.onrecordingmutedevent=function(t){n&&n.events.onrecordingmutedevent.raise(t)},Ifm.ChromeBar.Proxy.events.onrecordingstartedevent=function(t){n&&n.events.onrecordingstartedevent.raise(t)},Ifm.ChromeBar.Proxy.events.onbookedevent=function(t){n&&n.events.onbookedevent.raise(t)},Ifm.ChromeBar.Proxy.events.oncallfailureevent=function(t){n&&n.events.oncallfailureevent.raise(t)},Ifm.ChromeBar.Proxy.events.oncalltransferinitiatedevent=function(t){n&&n.events.oncalltransferinitiatedevent.raise(t)},Ifm.ChromeBar.Proxy.events.onconnectionremovedevent=function(t){n&&n.events.onconnectionremovedevent.raise(t)},Ifm.ChromeBar.Proxy.events.ondeviceinfochangedevent=function(t){n&&n.events.ondeviceinfochangedevent.raise(t)},Ifm.ChromeBar.Proxy.events.ondisplaynamechangedevent=function(t){n&&n.events.ondisplaynamechangedevent.raise(t)},Ifm.ChromeBar.Proxy.events.onphonebarclosedevent=function(t){n&&n.events.onphonebarclosedevent.raise(t)},Ifm.ChromeBar.Proxy.events.onloginreply=function(t){n&&n.events.onloginreply.raise(t)},Ifm.ChromeBar.Proxy.events.onlogoutreply=function(t){n&&n.events.onlogoutreply.raise(t)},Ifm.ChromeBar.Proxy.events.onnewcallreply=function(t){n&&n.events.onnewcallreply.raise(t)},Ifm.ChromeBar.Proxy.events.onothercallevent=function(t){n&&n.events.onothercallevent.raise(t)},Ifm.ChromeBar.Proxy.events.onpauseevent=function(t){n&&n.events.onpauseevent.raise(t)},Ifm.ChromeBar.Proxy.events.onpausereply=function(t){n&&n.events.onpausereply.raise(t)},Ifm.ChromeBar.Proxy.events.onphonebarconnectionlostevent=function(t){n&&n.events.onphonebarconnectionlostevent.raise(t)},Ifm.ChromeBar.Proxy.events.onpostcallworkevent=function(t){n&&n.events.onpostcallworkevent.raise(t)},Ifm.ChromeBar.Proxy.events.onreadyevent=function(t){n&&n.events.onreadyevent.raise(t)},Ifm.ChromeBar.Proxy.events.onreadyfordetachevent=function(t){n&&n.events.onreadyfordetachevent.raise(t)},Ifm.ChromeBar.Proxy.events.onreadyreply=function(t){n&&n.events.onreadyreply.raise(t)},Ifm.ChromeBar.Proxy.events.onreadyfortransferevent=function(t){n&&n.events.onreadyfortransferevent.raise(t)},Ifm.ChromeBar.Proxy.events.onretrievecallreply=function(t){n&&n.events.onretrievecallreply.raise(t)},Ifm.ChromeBar.Proxy.events.onrejectableassignmentrequest=function(t){n&&n.events.onrejectableassignmentrequest.raise(t)},Ifm.ChromeBar.Proxy.events.onterminatedevent=function(t){n&&n.events.onterminatedevent.raise(t)},Ifm.ChromeBar.Proxy.events.ontransferreply=function(t){n&&n.events.ontransferreply.raise(t)},Ifm.ChromeBar.Proxy.events.onsupervisormessageevent=function(t){n&&n.events.onsupervisormessageevent.raise(t)},Ifm.ChromeBar.Proxy.events.onmaskeddigitreceivedevent=function(t){n&&n.events.onmaskeddigitreceivedevent.raise(t)},Ifm.ChromeBar.Proxy.events.onmaskedpayloadreceivedevent=function(t){n&&n.events.onmaskedpayloadreceivedevent.raise(t)},Ifm.ChromeBar.Proxy.events.onqueueinforeply=function(t){n&&n.events.onqueueinforeply.raise(t)},Ifm.ChromeBar.Proxy.events.onagentslistreply=function(t){n&&n.events.onagentslistreply.raise(t)},Ifm.ChromeBar.Proxy.events.oncampaignslistreply=function(t){n&&n.events.oncampaignslistreply.raise(t)},Ifm.ChromeBar.Proxy.events.onpausereasonslistreply=function(t){n&&n.events.onpausereasonslistreply.raise(t)},Ifm.ChromeBar.Proxy.events.onagentdetailsreply=function(t){n&&n.events.onagentdetailsreply.raise(t)},Ifm.ChromeBar.Proxy.events.oncommandexecutedevent=function(t){n&&n.events.oncommandexecutedevent.raise(t)},{abortcall:function(){return t.abortcall()},acceptrejectassignment:function(n){return t.acceptrejectassignment(n)},addcalldata:function(n,i,r){return t.addcalldata(n,i,r)},addcampaignlessconnection:function(){return t.addcampaignlessconnection()},addconnection:function(n){return t.addconnection(n)},appendcuesheet:function(n){return t.appendcuesheet(n)},chromebarversion:function(){return t.chromeBarVersion()},clearcallhistorylog:function(n){return t.clearCallHistoryLog(n)},conferencecall:function(n){return t.conferencecall(n)},connect:function(){return n=this,n.events=Ifm.ChromeBar.ScriptControl.Proxy.events,t.connect()},filternonphonecallevents:function(n){return t.filternonphonecallevents(n)},disconnect:function(){return t.disconnect()},dump:function(n){return t.dump(n)},getagentslist:function(n,i){return t.getagentslist(n,i)},getcallhistorylog:function(n){return t.getCallHistoryLog(n)},getcampaignslist:function(n,i,r){return t.getcampaignslist(n,i,r)},getcurrentagentdetails:function(){return t.getcurrentagentdetails()},getpausereasonslist:function(){return t.getpausereasonslist()},getqueueinfo:function(n){return t.getqueueinfo(n)},getsitelistfromprovisioning:function(n,i,r){return t.getSiteListFromProvisioning(n,i,r)},isloggedin:function(){return t.isLoggedIn()},language:function(n){return t.language(n)},login:function(n,i,r,u){return t.login(n,i,r,u)},loginwithtoken:function(n,i,r,u){return t.loginWithToken(n,i,r,u)},loginwithprovisioning:function(n,i,r){return t.loginWithProvisioning(n,i,r)},loginwithprovisioningforsite:function(n,i,r,u){return t.loginWithProvisioningForSite(n,i,r,u)},loginwithprovisioningex:function(n,i,r,u){return t.loginWithProvisioning(n,i,r,u)},loginwithprovisioningforsiteex:function(n,i,r,u,f){return t.loginWithProvisioningForSite(n,i,r,u,f)},updatetoken:function(n,i){return t.updateToken(n,i)},logout:function(){return t.logout()},makecall:function(n,i,r,u){return t.makecall(n,i,r,u)},makedialercall:function(n,i){return t.makedialercall(n,i)},makemanualcall:function(n,i,r){return t.makemanualcall(n,i,r)},muteaudiorecording:function(n,i,r,u){return t.muteaudiorecording(n,i,r,u)},numberoflines:function(){return t.numberOfLines()},pause:function(n){return t.pause(n)},phonebarversion:function(){return t.phoneBarVersion()},playlocalfile:function(n){return t.playlocalfile(n)},proxyversion:function(){return t.proxyVersion()},ready:function(){return t.ready()},removecampaignlessconnection:function(){return t.removecampaignlessconnection()},removeconnection:function(n){return t.removeconnection(n)},retrievecall:function(){return t.retrievecall()},savecalldata:function(n,i){return t.savecalldata(n,i)},sethookstate:function(n){return t.sethookstate(n)},setmutestate:function(n){return t.setmutestate(n)},setphonebarbuttonenabled:function(n,i){return t.setphonebarbuttonenabled(n,i)},showcalltransferform:function(n){return t.showcalltransferform(n)},showinformationpopup:function(n,i){return t.showinformationpopup(n,i)},startdtmfmasking:function(n,i,r){return t.startDTMFMasking(n,i,r)},stopdtmfmasking:function(n){return t.stopDTMFMasking(n)},startaudiorecording:function(n,i){return t.startaudiorecording(n,i)},stopaudiorecording:function(){return t.stopaudiorecording()},stopplaylocalfile:function(){return t.stopplaylocalfile()},supportsabortcall:function(){return t.supportsAbortCall()},supportsconference:function(){return t.supportsConference()},swapcall:function(){return t.swapcall()},switchactiveline:function(){return t.switchactiveline()},transfercall:function(n,i,r,u,f){return t.transfercall(n,i,r,u,f)}}}()};