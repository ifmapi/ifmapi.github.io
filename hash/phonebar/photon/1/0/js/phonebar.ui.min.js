
//============================================================================

// Copyright (c) IFM Infomaster. All rights reserved.

//============================================================================

"use strict";function __errhandler(n,t,i,r,u){if(arguments&&arguments.length){var e=u&&u.message?u.message:n||"Script error",f=t||(u?u.filename:"")||"",o=i||(u?u.lineno:"")||"",s=r||(u?u.colno:"")||"",h=u&&u.stack?u.stack:f?[f,o,s].join(" "):"window.onerror";Ifm.Application.onerror(e,h)}}namespace("Ifm"),function(){var u,n,t;for(Ifm.version+="; Ifm.Dom.js/1.1.0",this.Application={frameworkPath:""},u=document.getElementsByTagName("script"),n=0;n<u.length;n++)if(t=u[n].src.match(/(.*)Ifm\.Dom\.js/),t&&t.length===2){Ifm.Application.frameworkPath=t[1];break}var f=!1,i=[],r=function(){if(!f&&(document.addEventListener||event.type==="load"||document.readyState==="complete")){Ifm.Dom.Strings.replaceAll("%");f=!0;for(var n=i.length;n--;)i[n]();i=[]}};document.addEventListener?(document.addEventListener("DOMContentLoaded",r,!1),window.addEventListener("load",r,!1)):(document.attachEvent("onreadystatechange",r),window.attachEvent("onload",r));this.Application.abort=function(n,t){var r=encodeURIComponent(window.location.href),u=encodeURIComponent(n||""),f=encodeURIComponent(t||""),i=sessionStorage,e="";i?(i.setItem("home",r),i.setItem("error",u),i.setItem("stack",f),i.setItem("info",Ifm.version)):e="?home="+r+"&error="+u+"&stack="+f+"&info="+Ifm.version;window.onerror=null;window.onbeforeunload=null;window.location.assign(this.frameworkPath+"blue.htm"+e)};this.Application.parameters=function(){var n={};return n.count=0,(window.location.search+window.location.hash).replace(/([^?&=]+)=([^&]*)?/g,function(t,i,r){i&&(n[i]=r||"",n.count++)}),n};this.Application.showBand=function(n,t){var i="<div style='margin:16px;'><pre style='font-size:xx-large;'>"+(n||"")+"<\/pre><pre style='font-size:medium;'>"+(t||"")+"<\/pre><\/div>";Ifm.Dom.Band.show(i)};this.Application.ready=function(n){if(!Ifm.Type.isFunction(n))throw new Error("Application.ready() -> Invalid ready handler function");if(f){setTimeout(n);return}i.push(n)};this.Application.quit=function(n,t){if(n&&!Ifm.Type.isFunction(n))throw new Error("Application.quit() -> Invalid quit handler function");if(t&&!Ifm.Type.isFunction(t))throw new Error("Application.quit() -> Invalid cancel handler function");window.onbeforeunload=function(){var i=!1;return setTimeout(function(){setTimeout(function(){i&&t&&t()},100)}),i=n()}};this.Application.onerror=function(n,t){Ifm.Diagnostics.Debug.enabled?Ifm.Diagnostics.Debug.fail(n,t):Ifm.Application.abort(n,t)}}.call(Ifm);namespace("Ifm.Dom"),function(){function n(n){if(!n||!n.URL||n.URL==="about:blank"||n.URL==="edge://newtab/"||n.URL==="chrome://newtab/")return!1;var t=n.readyState;return t==="interactive"||t==="complete"}this.isReady=function(t){return Ifm.Dom.isWindow(t)&&(t=t.document),n(t)};this.isWindow=function(n){return n.constructor.name==="Window"};this.whenReady=function(t,i){if(Ifm.Dom.isWindow(t)&&(t=t.document),n(t))i(t);else{var r=function(){n(t)&&(t.removeEventListener("readystatechange",r),i(t))};t.addEventListener("readystatechange",r)}};this.whenWindowNavigates=function(t,i,r){var u=0,f=setInterval(function(){t.location.href.toLowerCase().indexOf(i.toLowerCase())<0||!n(t.document)||++u<5||(clearInterval(f),Ifm.Dom.whenReady(t,r))},100)};this.Events={addHandler:window.addEventListener?function(n,t,i){n.addEventListener(t,i,!1)}:function(n,t,i){n.attachEvent("on"+t,i)},getEvent:function(n){return n||window.event},getTarget:function(n){var t=n||window.event;return t.target||t.srcElement},preventDefault:function(n){var t=n||window.event;t.preventDefault?t.preventDefault():t.returnValue=!1},removeHandler:window.removeEventListener?function(n,t,i){n.removeEventListener(t,i,!1)}:function(n,t,i){n.detachEvent("on"+t,i)},stopPropagation:function(n){var t=n||window.event;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},stop:function(n){var t=n||window.event;t.preventDefault&&t.preventDefault();t.stopImmediatePropagation&&t.stopImmediatePropagation();t.stopPropagation&&t.stopPropagation();t.stop&&t.stop();t.cancelBubble=!0;t.returnValue=!1}};this.Dialogs={_dialogs:[]};this.Dialogs.create=function(n,t,i){if(!n||!Ifm.Type.isString(n))throw new Error("Dialogs.create() -> Invalid dialog object id: "+n);if(Ifm.Dom.Dialogs._dialogs[n])throw new Error("Dialogs.create() -> Dialog already created:"+n);var r=document.getElementById(n);if(!r)throw new Error("Dialogs.create() -> Dialog definition object not found in DOM: "+n);if(r.parentNode.removeChild(r),t&&!Ifm.Type.isArray(t))throw new Error("Dialogs.create() -> Invalid buttons array:"+t);Ifm.Dom.Dialogs._dialogs[n]={instance:r,buttons:t||null,options:{modal:(i||{}).hasOwnProperty("modal")?i.modal:!0,title:(i||{}).hasOwnProperty("title")?i.title:""},arguments:null,result:undefined}};this.Dialogs.show=function(n,t,i,r){var u,h,e,f,o,s,c;if(!n||!Ifm.Type.isString(n))throw new Error("Dialogs.show() -> Invalid dialog object id: "+n);if(u=Ifm.Dom.Dialogs._dialogs[n],!u)throw new Error("Dialogs.show() -> Dialog not created: "+n);if(i&&!Ifm.Type.isFunction(i))throw new Error("Dialogs.show() -> Invalid handler: beforeShow");if(r&&!Ifm.Type.isFunction(r))throw new Error("Dialogs.show() -> Invalid handler: onHide");if(!u.shown){if(u.shown=!0,u.onhide=r||null,h=u.instance.cloneNode(!0),e=u.buttons,u.options.modal&&Ifm.Dom.Fader.show(),f=document.createElement("div"),f.className="dialog",f.style.zIndex="1100",f.innerHTML='<div class="dialog-title">'+(t||u.options.title||"")+'<\/div><div class="dialog-body"><\/div><div class="dialog-buttons"><\/div>',e&&e.length!==0||(f.innerHTML+='<div class="dialog-close"><button class="dialog-close-button" onclick="Ifm.Dom.Dialogs.hide(&apos;'+n+'&apos;, 0);">r<\/button><\/div>'),document.body.appendChild(f),u.container=f,f.children[1].appendChild(h),e)for(o=0;o<e.length;o++)s=document.createElement("button"),c="Ifm.Dom.Dialogs._dialogs['"+n+"'].result = (function() { "+e[o].click+" })(); Ifm.Dom.Dialogs.hide('"+n+"', "+(o+1)+");",s.onclick=new Function(c),s.innerHTML=e[o].text,s.style.cssText=e[o].cssText,f.children[2].appendChild(s);i&&i();Ifm.Dom.Strings.replaceAll("%%")}};this.Dialogs.hide=function(n,t){var i,r;if(!n||!Ifm.Type.isString(n))throw new Error("Dialogs.hide() -> Invalid dialog object id: "+n);if(i=Ifm.Dom.Dialogs._dialogs[n],!i)throw new Error("Dialogs.hide() -> Dialog not created: "+n);if(i.shown){if(i.onhide)i.onhide(t);i.shown=!1;r=i.container;r.style.opacity="0";setTimeout(function(){document.body.removeChild(r)},200);i.options.modal&&Ifm.Dom.Fader.hide()}};this.Cards=function(){var n={};return{show:function(t,i,r,u,f){i||(i="card"+(+new Date).toString(16));var e;return n[i]?e=n[i].element:(e=document.createElement("div"),n[i]={element:e,fade:!!u},e.close=Ifm.Dom.Cards.close.bind(null,i),e.onclosed=null,u&&Ifm.Dom.Fader.show(),e.style.zIndex="1100",document.body.appendChild(e),e.className="dialog level-"+(f&&/^[12345]$/.test(f)?f:"1"),r||setTimeout(()=>{var n=document.getElementById("ifmjs_sys_fader")||document,t=n.onclick;n.onclick=function(r){n.onclick=t;Ifm.Dom.Events.stop(r);Ifm.Dom.Cards.close(i)};e.onclick=n.onclick},20)),t&&(e.innerHTML=t),e},showDialog:function(n,t,i,r,u={},f){var o=Ifm.Dom.Cards._createDialogBody(n,i),e=Ifm.Dom.Cards.show(o,t,!0,!0);Ifm.Dom.Cards._createDialogButtons(e,e,r);Ifm.Type.isFunction(f)&&f(e,e)},shake:function(t){if(n[t]){var i=n[t].element,f=i.style.left,e=i.style.right,r=i.offsetLeft,u=function(n){var t=10*(n%3-1);i.style.left=r+t+"px";i.style.right=r-t+"px";--n>0?setTimeout(u,20,n):(i.style.left=f,i.style.right=e)};u(16)}},close:function(t){if(n[t]){var i=n[t].element;if(document.body.removeChild(i),n[t].fade&&Ifm.Dom.Fader.hide(),Ifm.Type.isFunction(i.onclosed))i.onclosed(i);return delete n[t],i}},get:function(t){return n[t]||null},getBody:function(t){return n[t]||null},isShown:function(t){return n[t]?!0:!1},_createDialogBody:function(n,t){return`
                    <div class="dialog-title">${t}</div>
                    <div class="dialog-body">${n}</div>
                    <div class="dialog-buttons"></div>
                `},_createDialogButtons:function(n,t,i){var r,u;if(t&&i&&i.length)for(r=0;r<i.length;r++)u=document.createElement("button"),u.innerHTML=i[r].text||"[Button"+(r+1)+"]",u.style.cssText=i[r].cssText,u.onclick=function(i){return function(){Ifm.Type.isFunction(i)&&i(n,t)===!1||n.close()}}(i[r].click),t.lastElementChild.appendChild(u)}}}();this.Band={_bands:[]};this.Band.show=function(n){var t,i,r;return Ifm.Dom.Fader.show(),t=document.createElement("div"),t.className="band",t.style.position="absolute",t.style.top="50%",t.style.marginTop="-80px",t.style.minHeight="160px",t.style.left="0px",t.style.width="100%",t.style.backgroundColor="#0066CC",t.style.color="white",t.style.overflow="hidden",t.style.zIndex="1200",i=document.getElementById("ifmjs_sys_fader")||document,r=i.onclick,i.onclick=function(n){i.onclick=r;Ifm.Dom.Events.stop(n);Ifm.Dom.Band.hide()},t.onclick=i.onclick,t.innerHTML=n,document.body.appendChild(t),Ifm.Dom.Band._bands.push(t),Ifm.Dom.Band._bands.length>1&&(Ifm.Dom.Band._bands[Ifm.Dom.Band._bands.length-2].style.display="none"),t};this.Band.hide=function(){if(Ifm.Dom.Band._bands.length>0){var n=Ifm.Dom.Band._bands.pop(n);document.body.removeChild(n);Ifm.Dom.Fader.hide()}return Ifm.Dom.Band._bands.length>0&&(Ifm.Dom.Band._bands[Ifm.Dom.Band._bands.length-1].style.display=""),n};this.Fader={_faders:0};this.Fader.show=function(){var n,t;return Ifm.Dom.Fader._faders++,Ifm.Dom.Fader._faders===1&&(n=document.getElementById("ifmjs_sys_fader"),n||(n=document.createElement("div"),n.id="ifmjs_sys_fader",n.style.backgroundColor="#003366",n.style.opacity="0.50",n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.width="100%",n.style.height="100%",n.style.zIndex="1000",t=document.getElementById("page-layout"),t&&(t.className+=" fade-effect")),document.body.appendChild(n)),Ifm.Dom.Fader._faders>0};this.Fader.hide=function(){var t,n;return Ifm.Dom.Fader._faders--,Ifm.Dom.Fader._faders===0&&(t=document.getElementById("ifmjs_sys_fader"),t&&(document.body.removeChild(t),n=document.getElementById("page-layout"),n&&(n.className=n.className.replace(" fade-effect","")))),Ifm.Dom.Fader._faders<=0};this.Menu=function(){if(!(this instanceof Ifm.Dom.Menu))throw Ifm.Diagnostics.Errors.ctor();var n="ifmjs_menu";return{constructor:Ifm.Dom.Menu,choose:function(t,i){var f,u,r;if(!Ifm.Type.isArray(t))throw Ifm.Diagnostics.Errors.arg("items");if(!Ifm.Type.isFunction(i))throw Ifm.Diagnostics.Errors.arg("callback");for(f="",u=0;u<t.length,r=t[u];u++)r.visible!==!1&&(f+=r.label!=="-"?'<option value="{0}" {2}>{1}<\/option>'.format(r.value,r.label,r.disabled?"disabled":""):'<option value="" disabled><\/option>');var o='<div class="menu"><select style="width:100%;" size="{0}">{1}<\/select><\/div>'.format(t.length===1?2:t.length,f),s=Ifm.Dom.Cards.show(o,n),e=s.children[0].children[0];e.onclick=function(){i(this.value)};e.onkeydown=function(t){t=Ifm.Dom.Events.getEvent(t);t.which===13&&(Ifm.Dom.Cards.close(n),i(this.value));t.which===27&&Ifm.Dom.Cards.close(n)};e.focus()}}};this.Strings=function(){function n(n,t){if(Ifm.Type.isString(t.nodeValue)&&t.nodeValue.startsWith(n+"(")&&t.nodeValue.endsWith(")"))try{t.nodeValue=Function("return "+t.nodeValue.slice(n.length+1,-1))()}catch(i){}}return{replaceAll:function(t){t||(t="%");Ifm.Dom.Walker.walk(document.body,function(i){if(i.nodeType===1)for(var r=0;r<i.attributes.length;r++)n(t,i.attributes[r]);else i.nodeType===3&&n(t,i)})}}}();this.Walker={};this.Walker.walk=function t(n,i){for(i(n),n=n.firstChild;n;)t(n,i),n=n.nextSibling}}.call(Ifm.Dom);namespace("Ifm.PhoneBar.UI").Templates={CampaignListCard:'<div class="phonebar-campaignlist-card-content"><table class="phonebar-campaignlist-card-table"><tbody>{body}<\/tbody><\/table><\/div>',CampaignListRow:"<tr><td>{name}<\/td><td>{boundness}<\/td><td>{state}<\/td><\/tr>",IncomingCallCard:'<div class="phonebar-incoming-call-card-content"><div class="phonebar-incoming-call-text">{incomingCallText}<\/div><div class="phonebar-incoming-call-number">{incomingCallNumber}<\/div><div class="phonebar-incoming-call-campaign">{campaignName}<\/div><\/div>',LoginDialog:'<fieldset class="phonebar-form"><div><label class="phonebar-form-label" for="firstnametxt">{firstNameLabel}<\/label><input class="phonebar-form-input" type="text" id="firstnametxt" value="{firstName}"><\/div><div><label class="phonebar-form-label" for="lastnametxt">{lastNameLabel}<\/label><input class="phonebar-form-input" type="text" id="lastnametxt" value="{lastName}"><\/div><div><label class="phonebar-form-label" for="passwordtxt">{passwordLabel}<\/label><input class="phonebar-form-input" type="password" id="passwordtxt" value="{password}"><\/div><div><label class="phonebar-form-label" for="extensiontxt">{extensionLabel}<\/label><input class="phonebar-form-input small right-aligned" type="text" id="extensiontxt" value="{extension}"><\/div><\/fieldset>',Login2Dialog:'<fieldset class="phonebar-form"><div><label class="phonebar-form-label" for="firstnametxt">{firstNameLabel}<\/label><input class="phonebar-form-input" type="text" id="firstnametxt" value="{firstName}"><\/div><div><label class="phonebar-form-label" for="lastnametxt">{lastNameLabel}<\/label><input class="phonebar-form-input" type="text" id="lastnametxt" value="{lastName}"><\/div><div><label class="phonebar-form-label" for="oldPasswordtxt">{oldPasswordLabel}<\/label><input class="phonebar-form-input" type="password" id="oldPasswordtxt" value="{oldPassword}"><\/div><div><label class="phonebar-form-label" for="newPasswordtxt">{newPasswordLabel}<\/label><input class="phonebar-form-input" type="password" id="newPasswordtxt" value="{newPassword}"><\/div><div><label class="phonebar-form-label" for="confirmPasswordtxt">{confirmPasswordLabel}<\/label><input class="phonebar-form-input" type="password" id="confirmPasswordtxt" value="{confirmPassword}"><\/div><div><label class="phonebar-form-label" for="extensiontxt">{extensionLabel}<\/label><input class="phonebar-form-input small right-aligned" type="text" id="extensiontxt" value="{extension}"><\/div><\/fieldset>',LoginOAuth2Dialog:'<fieldset class="phonebar-form"><div><label class="phonebar-form-label" for="usernametxt">{usernameLabel}<\/label><input class="phonebar-form-input large" type="text" id="usernametxt" value="{username}"><\/div><div><label class="phonebar-form-label" for="extensiontxt">{extensionLabel}<\/label><input class="phonebar-form-input small right-aligned" type="text" id="extensiontxt" value="{extension}"><\/div><\/fieldset>',MessageCard:'<div class="phonebar-message-{severity}"><i class="material-icons">{icon}<\/i> <span class="phonebar-message-title">{title}<\/span><\/div><div class="phonebar-message-text">{message}<\/div>',QueueInfoCard:'<div class="phonebar-queueinfo-card-content"><div><b>{number}<\/b> {queuedNumberText}<\/div><div><b>{maxTime}<\/b> {queuedMaxTimeText}<\/div><div><b>{avgTime}<\/b> {queuedAvgTimeText}<\/div><\/div>',SupervisorMessageCard:'<div class="phonebar-supervisor-message-{severity}"><i class="material-icons">{icon}<\/i> <span class="phonebar-supervisor-message-title">{title}<\/span><\/div><div class="phonebar-supervisor-message-text">{message}<\/div>',TransferCallCard:'<div class="phonebar-transfercall-card-content"><select class="phonebar-transfer-campaign-list"><\/select><select class="phonebar-transfer-agent-list" size="10"><\/select><label><input type="checkbox" class="phonebar-transfer-mandatory-check" checked>{mandatoryLabel}<\/label><\/div>',TransferCallAgentListItem:'<option firstName="{0}" lastName="{1}" agentState="{2}">{0} {1} {2}<\/option>',TransferCallCampaignListItem:'<option campaignName="{0}">{1}<\/option>'};Ifm.PhoneBar.UI.Commands=function(){function e(){jQuery(t.LoginButton).click(function(){n.login()});jQuery(t.LoginOrReadyButton).click(function(){n.loginOrReady()});jQuery(t.ReadyButton).click(function(){n.ready()});jQuery(t.PauseButton).click(function(){n.pause()});jQuery(t.LogoutButton).click(function(){n.logout()});jQuery(t.AbortCallButton).click(function(){n.abortCall()});jQuery(t.CallButton).click(function(){n.showMakeCallPopup()});jQuery(t.TransferButton).click(function(){n.showTransferForm()});jQuery(t.CampaignListButton).click(function(){Ifm.Dom.Photon.Cards.isShown("campaignlist-card")?Ifm.Dom.Photon.Cards.close("campaignlist-card"):n.showAssignedCampaignList()});jQuery(t.QueueInfoButton).click(function(){Ifm.Dom.Photon.Cards.isShown("queueinfo-card")?Ifm.Dom.Photon.Cards.close("queueinfo-card"):n.showQueueInfo()});jQuery(t.PanicButton).click(function(){n.panic()});jQuery(t.MainMenuButton).click(function(){n.showMenu()});jQuery(t.NumberInput).on("keydown",function(n){return n.which===13?(jQuery(t.CallButton).enabled()&&jQuery(t.CallButton).click(),!1):n.which===27?(jQuery(t.NumberInput).val("").change(),!1):void 0});jQuery(t.StartRecordingButton).click(function(){n.startRecording()});jQuery(t.StopRecordingButton).click(function(){n.stopRecording()});jQuery(t.MuteRecordingButton).click(function(){n.muteRecording()});jQuery(t.UnmuteRecordingButton).click(function(){n.unmuteRecording()});jQuery(t.PhoneDialPad).disable().hide();jQuery(t.HideDialPadButton).disable().hide().click(function(){n.hideDialpad()});jQuery(t.ShowDialPadButton).click(function(){n.showDialpad()});jQuery(t.ToggleDialPadButton).click(function(){n.toggleDialpad()});jQuery(t.PickupButton).click(function(){n.answer()});jQuery(t.HangupButton).click(function(){n.drop()});jQuery(t.ManualTransferButton).click(function(){n.dial("!,"+jQuery(t.NumberInput).val())});jQuery(t.FlashButton).click(function(){n.dial("!")});jQuery(t.Line1Button).click(function(){n.selectLine(0)});jQuery(t.Line2Button).click(function(){n.selectLine(1)});jQuery(t.EnterConferenceButton).click(function(){n.enterConference()});jQuery(t.LeaveConferenceButton).click(function(){n.leaveConference()});jQuery(t.MicrophoneOffButton).click(function(){n.mute()});jQuery(t.MicrophoneOnButton).click(function(){n.unmute()});jQuery(t.DialPadDigit0Button).click(function(){n.dtmf("0")});jQuery(t.DialPadDigit1Button).click(function(){n.dtmf("1")});jQuery(t.DialPadDigit2Button).click(function(){n.dtmf("2")});jQuery(t.DialPadDigit3Button).click(function(){n.dtmf("3")});jQuery(t.DialPadDigit4Button).click(function(){n.dtmf("4")});jQuery(t.DialPadDigit5Button).click(function(){n.dtmf("5")});jQuery(t.DialPadDigit6Button).click(function(){n.dtmf("6")});jQuery(t.DialPadDigit7Button).click(function(){n.dtmf("7")});jQuery(t.DialPadDigit8Button).click(function(){n.dtmf("8")});jQuery(t.DialPadDigit9Button).click(function(){n.dtmf("9")});jQuery(t.DialPadHashButton).click(function(){n.dtmf("#")});jQuery(t.DialPadStarButton).click(function(){n.dtmf("*")})}function o(){Ifm.PhoneBar.events.alerting=function(n,t){var i=n.calls(t.callId),r=i.mediatype;n.options.popupIncomingCalls()&r===r&&s(i.displayNumber,i.campaignName)};Ifm.PhoneBar.events.callfailure=function(t,i){var r=Ifm.PhoneBar.Strings[t.language()];Ifm.Dom.Photon.Cards.close("incoming-call-card");i.cause<255&&n.showMessage(i.description,"warning",r.CallFailure)};Ifm.PhoneBar.events.pausebooked=function(){jQuery(t.PauseButton).addClass("blink")};Ifm.PhoneBar.events.pause=function(){jQuery(t.PauseButton).removeClass("blink")};Ifm.PhoneBar.events.statechanged=function(n,t){var i=Ifm.PhoneBar.States;(t.previousState===i.Alerting||t.previousState===i.OtherCall)&&setTimeout(function(){Ifm.Dom.Photon.Cards.close("incoming-call-card")},3e3)};Ifm.PhoneBar.events.supervisormessage=function(n,t){var r=Ifm.PhoneBar.Strings[n.language()],u=i.SupervisorMessageCard.replace("{severity}",["information","warning","critical"][t.severity]).replace("{icon}",["info","warning","error"][t.severity]).replace("{message}",t.message).replace("{title}",r.SupervisorTitle);Ifm.Dom.Photon.Cards.show(u,undefined,!1,!1,0,r.SupervisorTitle,{width:500,height:250,showInTaskbar:!0})};Ifm.PhoneBar.Media.Xmpp.events.newmessage=function(n,t){var i=n.calls(t.callId);i&&i.mediatype===Ifm.PhoneBar.Mediatypes.StoreAndForward&&(i.handled||n.media.xmpp.handled(t.callId))}}function r(){var n=Ifm.PhoneBar.instance;return n.calls(function(n){return n.mediatype===Ifm.PhoneBar.Mediatypes.Voice})[0]||null}function u(n){var u=Ifm.PhoneBar.instance,f=Ifm.PhoneBar.Strings[u.language()],r=n.querySelector(t.TransferCampaignList),e;r&&r.selectedIndex>=0&&(e=r[r.selectedIndex].getAttribute("campaignName"),u.getTransferAgentList(e,function(r){for(var o=i.TransferCallAgentListItem.format(f.TransferAnybody),e=0,u;e<r.agents.length,u=r.agents[e];e++)o+=i.TransferCallAgentListItem.format(u.firstName,u.lastName,u.state!==2?"("+f.GenericBusyState+")":"");n.querySelector(t.TransferAgentList).innerHTML=o}))}function s(n,t){var u=Ifm.PhoneBar.instance,r=Ifm.PhoneBar.Strings[u.language()],f=i.IncomingCallCard.replace("{incomingCallText}",r.IncomingCallText).replace("{incomingCallNumber}",n||r.UnknownCallingNumber).replace("{campaignName}",t||"");Ifm.Dom.Photon.Cards.show(f,"incoming-call-card",!1,!1,0,r.IncomingCallText,{width:600,height:207})}function h(n,i,u){var o=Ifm.PhoneBar.instance,v=Ifm.PhoneBar.Strings[o.language()],s=n?o.calls(n):r(),e,h;if(s&&s.callId){e=i.querySelector(t.TransferCampaignList);h="";e&&e.selectedIndex>=0&&(h=e[e.selectedIndex].getAttribute("campaignName"));var f=i.querySelector(t.TransferAgentList),c="",l="",a=!1;f&&f.selectedIndex>0&&(c=f[f.selectedIndex].getAttribute("firstName"),l=f[f.selectedIndex].getAttribute("lastName"),a=i.querySelector(t.TransferMandatoryCheck).checked);o.transferCall(s.callId,h,c,l,a,undefined,u)}}var n={};n.login=function(){var r=Ifm.PhoneBar.instance,t=Ifm.PhoneBar.Strings[r.language()],u;if(r.currentState()===Ifm.PhoneBar.States.NotLoggedIn){if(r.config.useProvisioning){n.provisioningAndLogin();return}r.isOAuth2Enabled()?(u=i.LoginOAuth2Dialog.replace("{usernameLabel}",t.LoginUsername).replace("{username}",r.agent.username).replace("{extensionLabel}",t.LoginExtension).replace("{extension}",r.agent.extension),Ifm.Dom.Photon.Cards.showDialog(u,"login-dialog",t.LoginOAuth2Title,[{text:t.ButtonOK,click:function(i,u){if(r.currentState()===Ifm.PhoneBar.States.NotLoggedIn){const e=u.querySelector("#usernametxt"),f=u.querySelector("#extensiontxt");return r.agent.username=e.value,r.agent.extension=f.value,r.agent.save(),r.getToken(function(u){r.loginWithToken(u,f.value,r.agent.username,function(r){if(r.accepted)i.close("login-dialog");else{Ifm.Dom.Photon.Cards.shake("login-dialog");var u;switch(r.failureCause){case 3:u=t.WrongCredentials;break;case 7:u=t.InvalidExtension;break;case 8:u=t.ExtensionInUse;break;case 9:case 10:u=t.TokenBasedLoginError;break;default:u="Login error "+r.failureCause}n.showMessage(u,"warning")}})}),!1}}},{text:t.ButtonCancel}],{width:600,height:248})):(u=i.LoginDialog.replace("{firstNameLabel}",t.LoginFirstName).replace("{lastNameLabel}",t.LoginLastName).replace("{passwordLabel}",t.LoginPassword).replace("{extensionLabel}",t.LoginExtension).replace("{firstName}",r.agent.firstName).replace("{lastName}",r.agent.lastName).replace("{password}",r.agent.password).replace("{extension}",r.agent.extension),Ifm.Dom.Photon.Cards.showDialog(u,"login-dialog",t.LoginTitle,[{text:t.ButtonChangePassword,cssText:"margin-right:50px;",click:function(){n.loginChangePassword()}},{text:t.ButtonOK,click:function(i,u){if(r.currentState()===Ifm.PhoneBar.States.NotLoggedIn){const f=u.querySelector("#firstnametxt"),e=u.querySelector("#lastnametxt"),o=u.querySelector("#passwordtxt"),s=u.querySelector("#extensiontxt");return r.login(f.value,e.value,o.value,s.value,function(r){if(r.accepted)i.close("login-dialog");else if(r.failureCause===1)i.close("login-dialog"),n.showMessage(t.AccountLockedOut,"error");else if(r.failureCause===2)i.close("login-dialog"),n.showMessage(t.PasswordExpired,"warning"),n.loginChangePassword();else{Ifm.Dom.Photon.Cards.shake("login-dialog");var u;switch(r.failureCause){case 0:u=t.UserOrExtensionTaken;break;case 3:u=t.WrongCredentials;break;case 7:u=t.InvalidExtension;break;case 8:u=t.ExtensionInUse;break;default:u="Login error "+r.failureCause}n.showMessage(u,"warning")}}),!1}}},{text:t.ButtonCancel}],{width:600,height:324}))}};n.loginChangePassword=function(){var r=Ifm.PhoneBar.instance,t=Ifm.PhoneBar.Strings[r.language()],u=i.Login2Dialog.replace("{firstNameLabel}",t.LoginFirstName).replace("{lastNameLabel}",t.LoginLastName).replace("{oldPasswordLabel}",t.LoginOldPassword).replace("{newPasswordLabel}",t.LoginNewPassword).replace("{confirmPasswordLabel}",t.LoginConfirmPassword).replace("{extensionLabel}",t.LoginExtension).replace("{firstName}",r.agent.firstName).replace("{lastName}",r.agent.lastName).replace("{oldPassword}","").replace("{newPassword}","").replace("{confirmPassword}","").replace("{extension}",r.agent.extension);Ifm.Dom.Photon.Cards.showDialog(u,"login2-dialog",t.LoginTitle,[{text:t.ButtonOK,click:function(i,u){if(r.currentState()===Ifm.PhoneBar.States.NotLoggedIn){const o=u.querySelector("#firstnametxt"),s=u.querySelector("#lastnametxt"),h=u.querySelector("#oldPasswordtxt"),f=u.querySelector("#newPasswordtxt"),e=u.querySelector("#confirmPasswordtxt"),c=u.querySelector("#extensiontxt");return f.value!==e.value?(e.focus(),n.showMessage(t.PasswordsDontMatch),!1):(r.loginEx(o.value,s.value,h.value,f.value,c.value,function(r){if(r.accepted)i.close("login2-dialog");else if(r.failureCause===1)i.close("login2-dialog"),n.showMessage(t.AccountLockedOut,"error");else if(r.failureCause===4)f.value=e.value="",n.showMessage(t.InvalidNewPassword,"warning");else if(r.failureCause===5)i.close("login2-dialog"),n.login(),n.showMessage(t.CantChangePassword,"information");else{Ifm.Dom.Photon.Cards.shake("login2-dialog");var u=r.failureCause===3?t.WrongCredentials:t.UserOrExtensionTaken;n.showMessage(u,"warning")}}),!1)}}},{text:t.ButtonCancel}],{width:600,height:440})};n.loginOrReady=function(){var t=Ifm.PhoneBar.instance,i=Ifm.PhoneBar.Strings[t.language()];t.isLoggedIn()?n.ready():n.login()};n.logout=function(){var n=Ifm.PhoneBar.instance,t=Ifm.PhoneBar.Strings[n.language()];n.logout()};n.pause=function(){var n=Ifm.PhoneBar.instance,t=Ifm.PhoneBar.Strings[n.language()];n.getPauseReasons(function(i){var u,r;if(i.reasons.length===0)n.pause();else{for(i.reasons.unshift({text:t.PauseGenericReason,value:0}),u=[],r=0;r<i.reasons.length;r++)u.push({label:i.reasons[r].text,value:i.reasons[r].id});Ifm.Dom.Photon.Menu.choose(u,function(t){n.pause(t)})}})};n.ready=function(){var n=Ifm.PhoneBar.instance,i=Ifm.PhoneBar.Strings[n.language()],t=r();t&&t.postcall?n.ready(t.callId):n.ready()};n.panic=function(){var i=Ifm.PhoneBar.instance,r=Ifm.PhoneBar.Strings[i.language()],n;i.panic();n=t.MainToolbar+", "+t.PhoneToolbar;jQuery(n).addClass("phonebar-panic-effect");setTimeout(function(){jQuery(n).removeClass("phonebar-panic-effect")},2e3)};n.showAssignedCampaignList=function(t){var r=Ifm.PhoneBar.instance,u=Ifm.PhoneBar.Strings[r.language()];(!t||Ifm.Dom.Photon.Cards.isShown("campaignlist-card"))&&r.getAssignedCampaignList(function(t){for(var o,f,e="",r=0;r<t.campaigns.length;r++)e+=i.CampaignListRow.replace("{name}",t.campaigns[r].name).replace("{boundness}",t.campaigns[r].boundness).replace("{state}",t.campaigns[r].active?"":"Stop");o=i.CampaignListCard.replace("{body}",e);f=Ifm.Dom.Photon.Cards.show(o,"campaignlist-card",!0,!1,0,u.AssignmentsTitle);setTimeout(n.showAssignedCampaignList,5e3,!0);Ifm.Photon.app.isHosted||(f.onclick=function(){f.close()})})};n.hideDialpad=function(){jQuery(t.PhoneDialPad+", "+t.HideDialPadButton).disable().hide();jQuery(t.ShowDialPadButton).enable().show()};n.showDialpad=function(){jQuery(t.PhoneDialPad+", "+t.HideDialPadButton).enable().show();jQuery(t.ShowDialPadButton).disable().hide()};n.toggleDialpad=function(){console.debug("Not implemented: commands.toggleDialpad()")};n.showQueueInfo=function(t){var u=Ifm.PhoneBar.instance,r=Ifm.PhoneBar.Strings[u.language()];(!t||Ifm.Dom.Photon.Cards.isShown("queueinfo-card"))&&u.getQueueInfo("",function(t){var f=i.QueueInfoCard.replace("{number}",t.calls).replace("{queuedNumberText}",r.queuedNumberText).replace("{maxTime}",t.maxTime||"--").replace("{queuedMaxTimeText}",r.queuedMaxTimeText).replace("{avgTime}",t.avgTime||"--").replace("{queuedAvgTimeText}",r.queuedAvgTimeText),u=Ifm.Dom.Photon.Cards.show(f,"queueinfo-card",!0,!1,0,r.QueueInfoTitle,{left:screen.availWidth-180,top:100,width:130,height:100,toolWindow:!0});u.className+=" phonebar-queueinfo-card";setTimeout(n.showQueueInfo,5e3,!0);Ifm.Photon.app.isHosted||(u.onclick=function(){u.close()})})};n.abortCall=function(){var n=Ifm.PhoneBar.instance;n.currentState()===Ifm.PhoneBar.States.WaitingOutbound&&n.abortCall()};n.showMakeCallPopup=function(){var n=Ifm.PhoneBar.instance,i=Ifm.PhoneBar.Strings[n.language()];if(jQuery(t.NumberInput).val()){if(n.media.phone&&n.media.phone.selectedLineId>0){n.media.phone.dial(jQuery(t.NumberInput).val());return}n.getOutboundCampaignList(function(r){var f,u;if(n.media.phone&&r.campaigns.push({name:i.OutboundManualCall}),r.campaigns.length>0){for(f=[],u=0;u<r.campaigns.length;u++)f.push({label:r.campaigns[u].serviceName||r.campaigns[u].name,value:r.campaigns[u].name});Ifm.Dom.Photon.Menu.choose(f,function(r){r===i.OutboundManualCall?n.media.phone.dial(jQuery(t.NumberInput).val()):n.makeCall(jQuery(t.NumberInput).val(),r,n.options.callingNumber()||n.agent.extension)})}})}};n.showTransferForm=function(n){var o=Ifm.PhoneBar.instance,f=Ifm.PhoneBar.Strings[o.language()],e,s="",c;n?e=o.calls(n):(e=r(),n=e.callId);e?s=e.campaignName:n=0;c=i.TransferCallCard.replace("{mandatoryLabel}",f.TransferMandatory);Ifm.Dom.Photon.Cards.showDialog(c,"transfercall-card",f.TransferTitle,[{text:f.ButtonRefresh,click:function(n,t){return u(t),!1}},{text:f.ButtonTransfer,click:function(t,i){return h(n,i,function(n){n.accepted&&t.close()}),!1}},{text:f.ButtonCancel}],{width:750,height:474},function(r,e){e.querySelector(".phonebar-transfer-campaign-list").addEventListener("input",function(){u(e)});o.getTransferCampaignList(n,function(n){for(var c=e.querySelector(t.TransferCampaignList),a=c.value,o="",h="",v=[],l=0,r=null;l<n.campaigns.length,r=n.campaigns[l];l++)s.startsWith(r.serviceName+"/")?o+=i.TransferCallCampaignListItem.format(r.name,r.campaignName):v[r.serviceName]||(h+=i.TransferCallCampaignListItem.format(r.name,r.serviceName),v[r.serviceName]=!0);o&&(o='<optgroup label="'+f.TransferCampaign+'">'+o+"<\/optgroup>");h&&(h='<optgroup label="'+f.TransferService+'">'+h+"<\/optgroup>");c.innerHTML=o+h;a&&(c.value=a);u(e)})})};n.startRecording=function(){var t=Ifm.PhoneBar.instance,n=r();n&&!n.isRecording&&t.startRecording(n.callId)};n.stopRecording=function(){var t=Ifm.PhoneBar.instance,n=r();n&&n.isRecording&&t.stopRecording(n.callId)};n.muteRecording=function(){var t=Ifm.PhoneBar.instance,n=r();n&&n.isRecording&&t.muteRecording(n.callId,!0,!0)};n.unmuteRecording=function(){var t=Ifm.PhoneBar.instance,n=r();n&&n.isRecording&&t.muteRecording(n.callId,!1,!1)};n.showMessage=function(n,t,i){if(jQuery.toast)jQuery.toast({text:n,icon:t,heading:i,allowToastClose:!0,hideAfter:5e3,position:"top-center",loader:!1});else{var r=Ifm.Dom.Band.show(),u='<div class="phonebar-message" style="line-height:'+r.clientHeight+'px;">'+n+"<\/div>";r.innerHTML=u}};n.answer=function(){var n=Ifm.PhoneBar.instance.media.phone;n.answer()};n.dial=function(n){var i=Ifm.PhoneBar.instance.media.phone,r=n!==undefined&&n!==null?n:jQuery(t.NumberInput).val();i.dial(r)};n.dtmf=function(n){var t=Ifm.PhoneBar.instance.media.phone;t.dtmf(n)};n.enterConference=function(){var n=Ifm.PhoneBar.instance.media.phone;n.enterConference()};n.leaveConference=function(){var n=Ifm.PhoneBar.instance.media.phone;n.leaveConference()};n.drop=function(){var n=Ifm.PhoneBar.instance.media.phone;n.drop()};n.mute=function(){var n=Ifm.PhoneBar.instance.media.phone;n.mute()};n.selectLine=function(n){var t=Ifm.PhoneBar.instance.media.phone;t.selectLine(n)};n.unmute=function(){var n=Ifm.PhoneBar.instance.media.phone;n.unmute()};Ifm.PhoneBar.events.initialized=function(t,i){(f||(e(),o(),f=!0),i.options)&&t.options.loginOnStart()&&setTimeout(function(){if(!t.isRedirectedAfterOAuth2Signin())if(t.isRedirectedAfterOAuth2Signout())n.login();else if(t.options.loginOnStart()===2){var i=t.agent;t.isOAuth2Enabled()&&i.extension?t.getToken(function(r){t.loginWithToken(r,i.extension,i.username,function(t){t.accepted||n.login()})}):t.options.rememberCredentials()===2&&i.firstName&&i.lastName&&i.extension?t.login(i.firstName,i.lastName,i.password,i.extension,function(t){t.accepted||n.login()}):n.login()}else n.login()})};var t=Ifm.PhoneBar.UI.Elements,i=Ifm.PhoneBar.UI.Templates,f=!1;return n}();