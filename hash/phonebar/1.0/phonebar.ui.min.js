
//============================================================================

// Copyright (c) IFM Infomaster. All rights reserved.

//============================================================================

"use strict";function __errhandler(n,t,i,r,u){if(arguments&&arguments.length){var e=u&&u.message?u.message:n||"Script error",f=t||(u?u.filename:"")||"",o=i||(u?u.lineno:"")||"",s=r||(u?u.colno:"")||"",h=u&&u.stack?u.stack:f?[f,o,s].join(" "):"window.onerror";Ifm.Application.onerror(e,h)}}namespace("Ifm"),function(){var u,n,t;for(Ifm.version+="; Ifm.Dom.js/1.0.0",this.Application={frameworkPath:""},u=document.getElementsByTagName("script"),n=0;n<u.length;n++)if(t=u[n].src.match(/(.*)Ifm\.Dom\.js/),t&&t.length===2){Ifm.Application.frameworkPath=t[1];break}var f=!1,i=[],r=function(){if(!f&&(document.addEventListener||event.type==="load"||document.readyState==="complete")){Ifm.Dom.Strings.replaceAll("%");f=!0;for(var n=i.length;n--;)i[n]();i=[]}};document.addEventListener?(document.addEventListener("DOMContentLoaded",r,!1),window.addEventListener("load",r,!1)):(document.attachEvent("onreadystatechange",r),window.attachEvent("onload",r));this.Application.abort=function(n,t){var r=encodeURIComponent(window.location.href),u=encodeURIComponent(n||""),f=encodeURIComponent(t||""),i=sessionStorage,e="";i?(i.setItem("home",r),i.setItem("error",u),i.setItem("stack",f),i.setItem("info",Ifm.version)):e="?home="+r+"&error="+u+"&stack="+f+"&info="+Ifm.version;window.onerror=null;window.onbeforeunload=null;window.location.assign(this.frameworkPath+"blue.htm"+e)};this.Application.parameters=function(){var n={};return n.count=0,(window.location.search+window.location.hash).replace(/([^?&=]+)=([^&]*)?/g,function(t,i,r){i&&(n[i]=r||"",n.count++)}),n};this.Application.showBand=function(n,t){var i="<div style='margin:16px;'><pre style='font-size:xx-large;'>"+(n||"")+"<\/pre><pre style='font-size:medium;'>"+(t||"")+"<\/pre><\/div>";Ifm.Dom.Band.show(i)};this.Application.ready=function(n){if(!Ifm.Type.isFunction(n))throw new Error("Application.ready() -> Invalid ready handler function");if(f){setTimeout(n);return}i.push(n)};this.Application.quit=function(n,t){if(n&&!Ifm.Type.isFunction(n))throw new Error("Application.quit() -> Invalid quit handler function");if(t&&!Ifm.Type.isFunction(t))throw new Error("Application.quit() -> Invalid cancel handler function");window.onbeforeunload=function(){var i=!1;return setTimeout(function(){setTimeout(function(){i&&t&&t()},100)}),i=n()}};this.Application.onerror=function(n,t){Ifm.Diagnostics.Debug.enabled?Ifm.Diagnostics.Debug.fail(n,t):Ifm.Application.abort(n,t)}}.call(Ifm);namespace("Ifm.Dom"),function(){this.Events={addHandler:window.addEventListener?function(n,t,i){n.addEventListener(t,i,!1)}:function(n,t,i){n.attachEvent("on"+t,i)},getEvent:function(n){return n||window.event},getTarget:function(n){var t=n||window.event;return t.target||t.srcElement},preventDefault:function(n){var t=n||window.event;t.preventDefault?t.preventDefault():t.returnValue=!1},removeHandler:window.removeEventListener?function(n,t,i){n.removeEventListener(t,i,!1)}:function(n,t,i){n.detachEvent("on"+t,i)},stopPropagation:function(n){var t=n||window.event;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},stop:function(n){var t=n||window.event;t.preventDefault&&t.preventDefault();t.stopImmediatePropagation&&t.stopImmediatePropagation();t.stopPropagation&&t.stopPropagation();t.stop&&t.stop();t.cancelBubble=!0;t.returnValue=!1}};this.Dialogs={_dialogs:[]};this.Dialogs.create=function(n,t,i){if(!n||!Ifm.Type.isString(n))throw new Error("Dialogs.create() -> Invalid dialog object id: "+n);if(Ifm.Dom.Dialogs._dialogs[n])throw new Error("Dialogs.create() -> Dialog already created:"+n);var r=document.getElementById(n);if(!r)throw new Error("Dialogs.create() -> Dialog definition object not found in DOM: "+n);if(r.parentNode.removeChild(r),t&&!Ifm.Type.isArray(t))throw new Error("Dialogs.create() -> Invalid buttons array:"+t);Ifm.Dom.Dialogs._dialogs[n]={instance:r,buttons:t||null,options:{modal:(i||{}).hasOwnProperty("modal")?i.modal:!0,title:(i||{}).hasOwnProperty("title")?i.title:""},arguments:null,result:undefined}};this.Dialogs.show=function(n,t,i,r){var u,h,e,f,o,s,c;if(!n||!Ifm.Type.isString(n))throw new Error("Dialogs.show() -> Invalid dialog object id: "+n);if(u=Ifm.Dom.Dialogs._dialogs[n],!u)throw new Error("Dialogs.show() -> Dialog not created: "+n);if(i&&!Ifm.Type.isFunction(i))throw new Error("Dialogs.show() -> Invalid handler: beforeShow");if(r&&!Ifm.Type.isFunction(r))throw new Error("Dialogs.show() -> Invalid handler: onHide");if(!u.shown){if(u.shown=!0,u.onhide=r||null,h=u.instance.cloneNode(!0),e=u.buttons,u.options.modal&&Ifm.Dom.Fader.show(),f=document.createElement("div"),f.className="dialog",f.style.zIndex="1100",f.innerHTML='<div class="dialog-title">'+(t||u.options.title||"")+'<\/div><div class="dialog-body"><\/div><div class="dialog-buttons"><\/div>',e&&e.length!==0||(f.innerHTML+='<div class="dialog-close"><button class="dialog-close-button" onclick="Ifm.Dom.Dialogs.hide(&apos;'+n+'&apos;, 0);">r<\/button><\/div>'),document.body.appendChild(f),u.container=f,f.children[1].appendChild(h),e)for(o=0;o<e.length;o++)s=document.createElement("button"),c="Ifm.Dom.Dialogs._dialogs['"+n+"'].result = (function() { "+e[o].click+" })(); Ifm.Dom.Dialogs.hide('"+n+"', "+(o+1)+");",s.onclick=new Function(c),s.innerHTML=e[o].text,s.style.cssText=e[o].cssText,f.children[2].appendChild(s);i&&i();Ifm.Dom.Strings.replaceAll("%%")}};this.Dialogs.hide=function(n,t){var i,r;if(!n||!Ifm.Type.isString(n))throw new Error("Dialogs.hide() -> Invalid dialog object id: "+n);if(i=Ifm.Dom.Dialogs._dialogs[n],!i)throw new Error("Dialogs.hide() -> Dialog not created: "+n);if(i.shown){if(i.onhide)i.onhide(t);i.shown=!1;r=i.container;r.style.opacity="0";setTimeout(function(){document.body.removeChild(r)},200);i.options.modal&&Ifm.Dom.Fader.hide()}};this.Cards=function(){var n={};return{show:function(t,i,r,u,f){var e,o,s;return i||(i="card"+(+new Date).toString(16)),n[i]?e=n[i].element:(e=document.createElement("div"),n[i]={element:e,fade:u?!0:!1},e.close=Ifm.Dom.Cards.close.bind(null,i),e.onclosed=null,u&&Ifm.Dom.Fader.show(),r||(o=document.getElementById("ifmjs_sys_fader")||document,s=o.onclick,o.onclick=function(n){o.onclick=s;Ifm.Dom.Events.stop(n);Ifm.Dom.Cards.close(i)},e.onclick=o.onclick),e.style.zIndex="1100",document.body.appendChild(e),e.className="dialog level-"+(f&&/^[12345]$/.test(f)?f:"1")),t&&(e.innerHTML=t),e},showDialog:function(n,t,i,r){var o='<div class="dialog-title">'+(i||"")+'<\/div><div class="dialog-body">'+(n||"")+'<\/div><div class="dialog-buttons"><\/div>',e=Ifm.Dom.Cards.show(o,t,!0,!0),u,f;if(r&&r.length)for(u=0;u<r.length;u++)f=document.createElement("button"),f.innerHTML=r[u].text||"[Button"+(u+1)+"]",f.style.cssText=r[u].cssText,f.onclick=function(n){return function(){Ifm.Type.isFunction(n)&&n()===!1||e.close()}}(r[u].click),e.lastElementChild.appendChild(f)},shake:function(t){if(n[t]){var i=n[t].element,f=i.style.left,e=i.style.right,r=i.offsetLeft,u=function(n){var t=10*(n%3-1);i.style.left=r+t+"px";i.style.right=r-t+"px";--n>0?setTimeout(u,20,n):(i.style.left=f,i.style.right=e)};u(16)}},close:function(t){if(n[t]){var i=n[t].element;if(document.body.removeChild(i),n[t].fade&&Ifm.Dom.Fader.hide(),Ifm.Type.isFunction(i.onclosed))i.onclosed(i);return delete n[t],i}},isShown:function(t){return n[t]?!0:!1}}}();this.Band={_bands:[]};this.Band.show=function(n){var t,i,r;return Ifm.Dom.Fader.show(),t=document.createElement("div"),t.className="band",t.style.position="absolute",t.style.top="50%",t.style.marginTop="-80px",t.style.minHeight="160px",t.style.left="0px",t.style.width="100%",t.style.backgroundColor="#0066CC",t.style.color="white",t.style.overflow="hidden",t.style.zIndex="1200",i=document.getElementById("ifmjs_sys_fader")||document,r=i.onclick,i.onclick=function(n){i.onclick=r;Ifm.Dom.Events.stop(n);Ifm.Dom.Band.hide()},t.onclick=i.onclick,t.innerHTML=n,document.body.appendChild(t),Ifm.Dom.Band._bands.push(t),Ifm.Dom.Band._bands.length>1&&(Ifm.Dom.Band._bands[Ifm.Dom.Band._bands.length-2].style.display="none"),t};this.Band.hide=function(){if(Ifm.Dom.Band._bands.length>0){var n=Ifm.Dom.Band._bands.pop(n);document.body.removeChild(n);Ifm.Dom.Fader.hide()}return Ifm.Dom.Band._bands.length>0&&(Ifm.Dom.Band._bands[Ifm.Dom.Band._bands.length-1].style.display=""),n};this.Fader={_faders:0};this.Fader.show=function(){var n,t;return Ifm.Dom.Fader._faders++,Ifm.Dom.Fader._faders===1&&(n=document.getElementById("ifmjs_sys_fader"),n||(n=document.createElement("div"),n.id="ifmjs_sys_fader",n.style.backgroundColor="#003366",n.style.opacity="0.50",n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.width="100%",n.style.height="100%",n.style.zIndex="1000",t=document.getElementById("page-layout"),t&&(t.className+=" fade-effect")),document.body.appendChild(n)),Ifm.Dom.Fader._faders>0};this.Fader.hide=function(){var t,n;return Ifm.Dom.Fader._faders--,Ifm.Dom.Fader._faders===0&&(t=document.getElementById("ifmjs_sys_fader"),t&&(document.body.removeChild(t),n=document.getElementById("page-layout"),n&&(n.className=n.className.replace(" fade-effect","")))),Ifm.Dom.Fader._faders<=0};this.Menu=function(){if(!(this instanceof Ifm.Dom.Menu))throw Ifm.Diagnostics.Errors.ctor();var n="ifmjs_menu";return{constructor:Ifm.Dom.Menu,choose:function(t,i){var f,r,u;if(!Ifm.Type.isArray(t))throw Ifm.Diagnostics.Errors.arg("items");if(!Ifm.Type.isFunction(i))throw Ifm.Diagnostics.Errors.arg("callback");for(f="",r=0;r<t.length,u=t[r];r++)f+='<option value="{0}" {2}>{1}<\/option>'.format(u.value,u.label,u.disabled?"disabled":"");var o='<div class="menu"><select style="width:100%;" size="{0}">{1}<\/select><\/div>'.format(t.length===1?2:t.length,f),s=Ifm.Dom.Cards.show(o,n),e=s.children[0].children[0];e.onclick=function(){i(this.value)};e.onkeydown=function(t){t=Ifm.Dom.Events.getEvent(t);t.which===13&&(Ifm.Dom.Cards.close(n),i(this.value));t.which===27&&Ifm.Dom.Cards.close(n)};e.focus()}}};this.Strings=function(){function n(n,t){if(Ifm.Type.isString(t.nodeValue)&&t.nodeValue.startsWith(n+"(")&&t.nodeValue.endsWith(")"))try{t.nodeValue=Function("return "+t.nodeValue.slice(n.length+1,-1))()}catch(i){}}return{replaceAll:function(t){t||(t="%");Ifm.Dom.Walker.walk(document.body,function(i){if(i.nodeType===1)for(var r=0;r<i.attributes.length;r++)n(t,i.attributes[r]);else i.nodeType===3&&n(t,i)})}}}();this.Walker={};this.Walker.walk=function n(t,i){for(i(t),t=t.firstChild;t;)n(t,i),t=t.nextSibling}}.call(Ifm.Dom);namespace("Ifm.PhoneBar.UI").Templates={CampaignListCard:'<div class="phonebar-campaignlist-card-content"><table class="phonebar-campaignlist-card-table"><tbody>{body}<\/tbody><\/table><\/div>',CampaignListRow:"<tr><td>{name}<\/td><td>{boundness}<\/td><td>{state}<\/td><\/tr>",IncomingCallCard:'<div class="phonebar-incoming-call-card-content"><div class="phonebar-incoming-call-text">{incomingCallText}<\/div><div class="phonebar-incoming-call-number">{incomingCallNumber}<\/div><div class="phonebar-incoming-call-campaign">{campaignName}<\/div><\/div>',LoginDialog:'<fieldset><div><label class="phonebar-form-label" for="firstnametxt">{firstNameLabel}<\/label><input class="phonebar-form-input" type="text" id="firstnametxt" value="{firstName}"><\/div><div><label class="phonebar-form-label" for="lastnametxt">{lastNameLabel}<\/label><input class="phonebar-form-input" type="text" id="lastnametxt" value="{lastName}"><\/div><div><label class="phonebar-form-label" for="passwordtxt">{passwordLabel}<\/label><input class="phonebar-form-input" type="password" id="passwordtxt" value="{password}"><\/div><div><label class="phonebar-form-label" for="extensiontxt">{extensionLabel}<\/label><input class="phonebar-form-input" type="text" id="extensiontxt" value="{extension}"><\/div><\/fieldset>',Login2Dialog:'<fieldset><div><label class="phonebar-form-label" for="firstnametxt">{firstNameLabel}<\/label><input class="phonebar-form-input" type="text" id="firstnametxt" value="{firstName}"><\/div><div><label class="phonebar-form-label" for="lastnametxt">{lastNameLabel}<\/label><input class="phonebar-form-input" type="text" id="lastnametxt" value="{lastName}"><\/div><div><label class="phonebar-form-label" for="oldPasswordtxt">{oldPasswordLabel}<\/label><input class="phonebar-form-input" type="password" id="oldPasswordtxt" value="{oldPassword}"><\/div><div><label class="phonebar-form-label" for="newPasswordtxt">{newPasswordLabel}<\/label><input class="phonebar-form-input" type="password" id="newPasswordtxt" value="{newPassword}"><\/div><div><label class="phonebar-form-label" for="confirmPasswordtxt">{confirmPasswordLabel}<\/label><input class="phonebar-form-input" type="password" id="confirmPasswordtxt" value="{confirmPassword}"><\/div><div><label class="phonebar-form-label" for="extensiontxt">{extensionLabel}<\/label><input class="phonebar-form-input" type="text" id="extensiontxt" value="{extension}"><\/div><\/fieldset>',MessageCard:'<div class="phonebar-message-{severity}"><i class="material-icons">{icon}<\/i> <span class="phonebar-message-title">{title}<\/span><\/div><div class="phonebar-message-text">{message}<\/div>',QueueInfoCard:'<div class="phonebar-queueinfo-card-content"><div><b>{number}<\/b> {queuedNumberText}<\/div><div><b>{maxTime}<\/b> {queuedMaxTimeText}<\/div><div><b>{avgTime}<\/b> {queuedAvgTimeText}<\/div><\/div>',SupervisorMessageCard:'<div class="phonebar-supervisor-message-{severity}"><i class="material-icons">{icon}<\/i> <span class="phonebar-supervisor-message-title">{title}<\/span><\/div><div class="phonebar-supervisor-message-text">{message}<\/div>',TransferCallCard:'<div class="phonebar-transfercall-card-content"><select class="phonebar-transfer-campaign-list"><\/select><select class="phonebar-transfer-agent-list" size="10"><\/select><label><input type="checkbox" class="phonebar-transfer-mandatory-check" checked>{mandatoryLabel}<\/label><\/div>',TransferCallAgentListItem:'<option firstName="{0}" lastName="{1}" agentState="{2}">{0} {1} {2}<\/option>',TransferCallCampaignListItem:'<option campaignName="{0}">{1}<\/option>'};Ifm.PhoneBar.UI.Commands=function(){function f(){jQuery(t.LoginButton).click(function(){n.login()});jQuery(t.LoginOrReadyButton).click(function(){n.loginOrReady()});jQuery(t.ReadyButton).click(function(){n.ready()});jQuery(t.PauseButton).click(function(){n.pause()});jQuery(t.LogoutButton).click(function(){n.logout()});jQuery(t.CallButton).click(function(){n.showMakeCallPopup()});jQuery(t.TransferButton).click(function(){n.showTransferForm()});jQuery(t.CampaignListButton).click(function(){Ifm.Dom.Cards.isShown("campaignlist-card")?Ifm.Dom.Cards.close("campaignlist-card"):n.showAssignedCampaignList()});jQuery(t.QueueInfoButton).click(function(){Ifm.Dom.Cards.isShown("queueinfo-card")?Ifm.Dom.Cards.close("queueinfo-card"):n.showQueueInfo()});jQuery(t.PanicButton).click(function(){n.panic()});jQuery(t.NumberInput).on("change input",function(){var r=jQuery(t.NumberInput).val().replace(/([^0-9#*])/g,"");jQuery(t.NumberInput).val(r);var n=Ifm.PhoneBar.States,u=Ifm.PhoneBar.instance,i=u.currentState();i===n.LoggedIn||i===n.Ready||i===n.Paused?(jQuery(t.CallButton).enabled(r.length>0),jQuery(t.ManualTransferButton).disable()):i===n.Talking||i===n.OtherCall?(jQuery(t.CallButton).enabled(r.length>0),jQuery(t.ManualTransferButton).enabled(r.length>0)):jQuery(t.CallButton+", "+t.ManualTransferButton).disable()}).on("keydown",function(i){if(i.which===13){var r=Ifm.PhoneBar.States,f=Ifm.PhoneBar.instance,u=f.currentState();return(u===r.LoggedIn||u===r.Ready||u===r.Paused)&&n.showMakeCallPopup(),!1}if(i.which===27)return jQuery(t.NumberInput).val("").change(),!1});jQuery(t.StartRecordingButton).click(function(){n.startRecording()});jQuery(t.StopRecordingButton).click(function(){n.stopRecording()});jQuery(t.MuteRecordingButton).click(function(){n.muteRecording()});jQuery(t.UnmuteRecordingButton).click(function(){n.unmuteRecording()});jQuery(t.PhoneDialPad).disable().hide();jQuery(t.HideDialPadButton).disable().hide().click(function(){n.hideDialPad()});jQuery(t.ShowDialPadButton).click(function(){n.showDialPad()})}function e(){Ifm.PhoneBar.events.alerting=function(n,t){var i=n.calls(t.callId),r=i.mediatype;n.options.popupIncomingCalls()&r===r&&o(i.callData.get("ExternalParty"),i.campaignName)};Ifm.PhoneBar.events.callfailure=function(t,i){var r=Ifm.PhoneBar.Strings[t.language()];Ifm.Dom.Cards.close("incoming-call-card");n.showMessage(i.description,"warning",r.CallFailure)};Ifm.PhoneBar.events.pausebooked=function(){jQuery(t.PauseButton).addClass("blink")};Ifm.PhoneBar.events.pause=function(){jQuery(t.PauseButton).removeClass("blink")};Ifm.PhoneBar.events.statechanged=function(n,t){var i=Ifm.PhoneBar.States;(t.previousState===i.Alerting||t.previousState===i.OtherCall)&&setTimeout(function(){Ifm.Dom.Cards.close("incoming-call-card")},3e3)};Ifm.PhoneBar.events.supervisormessage=function(n,t){var r=Ifm.PhoneBar.Strings[n.language()],u=i.SupervisorMessageCard.replace("{severity}",["information","warning","critical"][t.severity]).replace("{icon}",["info","warning","error"][t.severity]).replace("{message}",t.message).replace("{title}",r.SupervisorTitle);Ifm.Dom.Cards.show(u)};Ifm.PhoneBar.Media.Xmpp.events.newmessage=function(n,t){var i=n.calls(t.callId);i.mediatype===Ifm.PhoneBar.Mediatypes.StoreAndForward&&(i.handled||n.media.xmpp.handled(t.callId))}}function r(){var n=Ifm.PhoneBar.instance;return n.calls(function(n){return n.mediatype===Ifm.PhoneBar.Mediatypes.Voice})[0]||null}function u(){var r=Ifm.PhoneBar.instance,u=Ifm.PhoneBar.Strings[r.language()],n=jQuery(t.TransferCampaignList)[0],f;n&&n.selectedIndex>=0&&(f=n[n.selectedIndex].getAttribute("campaignName"),r.getTransferAgentList(f,function(n){for(var e=i.TransferCallAgentListItem.format(u.TransferAnybody),f=0,r;f<n.agents.length,r=n.agents[f];f++)e+=i.TransferCallAgentListItem.format(r.firstName,r.lastName,r.state!==2?"("+u.GenericBusyState+")":"");jQuery(t.TransferAgentList).html(e)}))}function o(n,t){var u=Ifm.PhoneBar.instance,r=Ifm.PhoneBar.Strings[u.language()],f=i.IncomingCallCard.replace("{incomingCallText}",r.IncomingCallText).replace("{incomingCallNumber}",n||r.UnknownCallingNumber).replace("{campaignName}",t||"");Ifm.Dom.Cards.show(f,"incoming-call-card")}function s(n){var f=Ifm.PhoneBar.instance,a=Ifm.PhoneBar.Strings[f.language()],s=jQuery(t.TransferButton).data().callId,e=s?f.calls(s):r(),u,o;if(e&&e.callId){u=jQuery(t.TransferCampaignList)[0];o="";u&&u.selectedIndex>=0&&(o=u[u.selectedIndex].getAttribute("campaignName"));var i=jQuery(t.TransferAgentList)[0],h="",c="",l=!1;i&&i.selectedIndex>0&&(h=i[i.selectedIndex].getAttribute("firstName"),c=i[i.selectedIndex].getAttribute("lastName"),l=jQuery(t.TransferMandatoryCheck).prop("checked"));f.transferCall(e.callId,o,h,c,l,undefined,n)}}var n={},t,i;return n.login=function(){var r=Ifm.PhoneBar.instance,t=Ifm.PhoneBar.Strings[r.language()],u=i.LoginDialog.replace("{firstNameLabel}",t.LoginFirstName).replace("{lastNameLabel}",t.LoginLastName).replace("{passwordLabel}",t.LoginPassword).replace("{extensionLabel}",t.LoginExtension).replace("{firstName}",r.agent.firstName).replace("{lastName}",r.agent.lastName).replace("{password}",r.agent.password).replace("{extension}",r.agent.extension);Ifm.Dom.Cards.showDialog(u,"login-dialog",t.LoginTitle,[{text:t.ButtonChangePassword,cssText:"margin-right:50px;",click:function(){n.loginChangePassword()}},{text:t.ButtonOK,click:function(){return r.login(firstnametxt.value,lastnametxt.value,passwordtxt.value,extensiontxt.value,function(i){if(i.accepted)Ifm.Dom.Cards.close("login-dialog");else if(i.failureCause===1)Ifm.Dom.Cards.close("login-dialog"),n.showMessage(t.AccountLockedOut,"error");else if(i.failureCause===2)Ifm.Dom.Cards.close("login-dialog"),n.showMessage(t.PasswordExpired,"warning"),n.loginChangePassword();else{Ifm.Dom.Cards.shake("login-dialog");var r=i.failureCause===3?t.WrongCredentials:t.UserOrExtensionTaken;n.showMessage(r,"warning")}}),!1}},{text:t.ButtonCancel}])},n.loginChangePassword=function(){var r=Ifm.PhoneBar.instance,t=Ifm.PhoneBar.Strings[r.language()],u=i.Login2Dialog.replace("{firstNameLabel}",t.LoginFirstName).replace("{lastNameLabel}",t.LoginLastName).replace("{oldPasswordLabel}",t.LoginOldPassword).replace("{newPasswordLabel}",t.LoginNewPassword).replace("{confirmPasswordLabel}",t.LoginConfirmPassword).replace("{extensionLabel}",t.LoginExtension).replace("{firstName}",r.agent.firstName).replace("{lastName}",r.agent.lastName).replace("{oldPassword}","").replace("{newPassword}","").replace("{confirmPassword}","").replace("{extension}",r.agent.extension);Ifm.Dom.Cards.showDialog(u,"login2-dialog",t.LoginTitle,[{text:t.ButtonOK,click:function(){return newPasswordtxt.value!==confirmPasswordtxt.value?(confirmPasswordtxt.focus(),n.showMessage(t.PasswordsDontMatch),!1):(r.loginEx(firstnametxt.value,lastnametxt.value,oldPasswordtxt.value,newPasswordtxt.value,extensiontxt.value,function(i){if(i.accepted)Ifm.Dom.Cards.close("login2-dialog");else if(i.failureCause===1)Ifm.Dom.Cards.close("login2-dialog"),n.showMessage(t.AccountLockedOut,"error");else if(i.failureCause===4)newPasswordtxt.value=confirmPasswordtxt.value="",n.showMessage(t.InvalidNewPassword,"warning");else if(i.failureCause===5)Ifm.Dom.Cards.close("login2-dialog"),n.login(),n.showMessage(t.CantChangePassword,"information");else{Ifm.Dom.Cards.shake("login2-dialog");var r=i.failureCause===3?t.WrongCredentials:t.UserOrExtensionTaken;n.showMessage(r,"warning")}}),!1)}},{text:t.ButtonCancel}])},n.loginOrReady=function(){var t=Ifm.PhoneBar.instance,i=Ifm.PhoneBar.Strings[t.language()];t.isLoggedIn()?n.ready():n.login()},n.logout=function(){var n=Ifm.PhoneBar.instance,t=Ifm.PhoneBar.Strings[n.language()];n.logout()},n.pause=function(){var n=Ifm.PhoneBar.instance,t=Ifm.PhoneBar.Strings[n.language()];n.getPauseReasons(function(i){var u,r;if(i.reasons.length===0)n.pause();else{for(i.reasons.unshift({text:t.PauseGenericReason,value:0}),u=[],r=0;r<i.reasons.length;r++)u.push({label:i.reasons[r].text,value:i.reasons[r].id});(new Ifm.Dom.Menu).choose(u,function(t){n.pause(t)})}})},n.ready=function(){var n=Ifm.PhoneBar.instance,i=Ifm.PhoneBar.Strings[n.language()],t=r();t&&t.postcall?n.ready(t.callId):n.ready()},n.panic=function(){var i=Ifm.PhoneBar.instance,r=Ifm.PhoneBar.Strings[i.language()],n;i.panic();n=t.MainToolbar+", "+t.PhoneToolbar;jQuery(n).addClass("phonebar-panic-effect");setTimeout(function(){jQuery(n).removeClass("phonebar-panic-effect")},2e3)},n.showAssignedCampaignList=function(){var t=Ifm.PhoneBar.instance,r=Ifm.PhoneBar.Strings[t.language()];t.getAssignedCampaignList(function(t){for(var f="",r=0;r<t.campaigns.length;r++)f+=i.CampaignListRow.replace("{name}",t.campaigns[r].name).replace("{boundness}",t.campaigns[r].boundness).replace("{state}",t.campaigns[r].active?"":"Stop");var e=i.CampaignListCard.replace("{body}",f),o=Ifm.Dom.Cards.isShown("campaignlist-card"),u=Ifm.Dom.Cards.show(e,"campaignlist-card",!0);o||(u.timer=setInterval(n.showAssignedCampaignList,5e3),u.onclick=function(){u.close()},u.onclosed=function(){clearInterval(u.timer)})})},n.hideDialPad=function(){jQuery(t.PhoneDialPad+", "+t.HideDialPadButton).disable().hide();jQuery(t.ShowDialPadButton).enable().show()},n.showDialPad=function(){jQuery(t.PhoneDialPad+", "+t.HideDialPadButton).enable().show();jQuery(t.ShowDialPadButton).disable().hide()},n.showQueueInfo=function(){var r=Ifm.PhoneBar.instance,t=Ifm.PhoneBar.Strings[r.language()];r.getQueueInfo("",function(r){var f=i.QueueInfoCard.replace("{number}",r.calls).replace("{queuedNumberText}",t.queuedNumberText).replace("{maxTime}",r.maxTime||"--").replace("{queuedMaxTimeText}",t.queuedMaxTimeText).replace("{avgTime}",r.avgTime||"--").replace("{queuedAvgTimeText}",t.queuedAvgTimeText),e=Ifm.Dom.Cards.isShown("queueinfo-card"),u=Ifm.Dom.Cards.show(f,"queueinfo-card",!0);e||(u.className+=" phonebar-queueinfo-card",u.timer=setInterval(n.showQueueInfo,5e3),u.onclick=function(){u.close()},u.onclosed=function(){clearInterval(u.timer)})})},n.showMakeCallPopup=function(){var n=Ifm.PhoneBar.instance,i=Ifm.PhoneBar.Strings[n.language()];jQuery(t.NumberInput).val()&&n.getOutboundCampaignList(function(r){var f,u;if(n.media.spc&&r.campaigns.unshift({name:i.OutboundManualCall}),r.campaigns.length>0){for(f=[],u=0;u<r.campaigns.length;u++)f.push({label:r.campaigns[u].serviceName||r.campaigns[u].name,value:r.campaigns[u].name});(new Ifm.Dom.Menu).choose(f,function(r){r===i.OutboundManualCall?n.media.spc.dial(jQuery(t.NumberInput).val()):n.makeCall(jQuery(t.NumberInput).val(),r,n.options.callingNumber()||n.agent.extension)})}})},n.showTransferForm=function(n){var o=Ifm.PhoneBar.instance,f=Ifm.PhoneBar.Strings[o.language()],c=i.TransferCallCard.replace("{mandatoryLabel}",f.TransferMandatory),l=Ifm.Dom.Cards.showDialog(c,"transfercall-card",f.TransferTitle,[{text:f.ButtonRefresh,click:function(){return u(),!1}},{text:f.ButtonTransfer,click:function(){return s(function(n){n.accepted&&Ifm.Dom.Cards.close("transfercall-card")}),!1}},{text:f.ButtonCancel}]),e,h;jQuery(".phonebar-transfercall-card-content").find(".phonebar-transfer-campaign-list").on("input",function(){u()});e=n?o.calls(n):r();h="";e?(h=e.campaignName,n=jQuery(t.TransferButton).data().callId=e.callId):n=0;o.getTransferCampaignList(n,function(n){for(var c=jQuery(t.TransferCampaignList).val(),e="",o="",l=[],s=0,r=null;s<n.campaigns.length,r=n.campaigns[s];s++)h.startsWith(r.serviceName+"/")?e+=i.TransferCallCampaignListItem.format(r.name,r.campaignName):l[r.serviceName]||(o+=i.TransferCallCampaignListItem.format(r.name,r.serviceName),l[r.serviceName]=!0);e&&(e='<optgroup label="'+f.TransferCampaign+'">'+e+"<\/optgroup>");o&&(o='<optgroup label="'+f.TransferService+'">'+o+"<\/optgroup>");jQuery(t.TransferCampaignList).html(e+o);c&&jQuery(t.TransferCampaignList).val(c);u()})},n.startRecording=function(){var t=Ifm.PhoneBar.instance,n=r();n&&!n.isRecording&&t.startRecording(n.callId)},n.stopRecording=function(){var t=Ifm.PhoneBar.instance,n=r();n&&n.isRecording&&t.stopRecording(n.callId)},n.muteRecording=function(){var t=Ifm.PhoneBar.instance,n=r();n&&n.isRecording&&t.muteRecording(n.callId,!0,!0)},n.unmuteRecording=function(){var t=Ifm.PhoneBar.instance,n=r();n&&n.isRecording&&t.muteRecording(n.callId,!1,!1)},n.showMessage=function(n,t,i){if(jQuery.toast)jQuery.toast({text:n,icon:t,heading:i,allowToastClose:!0,hideAfter:5e3,position:"top-center",loader:!1});else{var r=Ifm.Dom.Band.show(),u='<div class="phonebar-message" style="line-height:'+r.clientHeight+'px;">'+n+"<\/div>";r.innerHTML=u}},Ifm.PhoneBar.events.initialized=function(t,i){i.options&&i.options.useDefaultUI&&(f(),e(),t.options.rememberCredentials()===2&&t.options.loginOnStart()===2&&t.agent.firstName&&t.agent.lastName?setTimeout(function(){var i=t.agent;t.login(i.firstName,i.lastName,i.password,i.extension,function(t){t.accepted||n.login()})}):t.options.loginOnStart()&&setTimeout(n.login))},t=Ifm.PhoneBar.UI.Elements,i=Ifm.PhoneBar.UI.Templates,n}();