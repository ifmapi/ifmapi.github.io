
//============================================================================

// Copyright © IFM Infomaster. All rights reserved.

//============================================================================

"use strict";function __errhandler(n,t,i,r,u){if(arguments&&arguments.length){var e=u&&u.message?u.message:n||"Script error",f=t||(u?u.filename:"")||"",o=i||(u?u.lineno:"")||"",s=r||(u?u.colno:"")||"",h=u&&u.stack?u.stack:f?[f,o,s].join(" "):"window.onerror";Ifm.Application.onerror(e,h)}}namespace("Ifm"),function(){var u,n,t;for(Ifm.version+="; Ifm.Dom.js/1.0.0",this.Application={frameworkPath:""},u=document.getElementsByTagName("script"),n=0;n<u.length;n++)if(t=u[n].src.match(/(.*)Ifm\.Dom\.js/),t&&t.length===2){Ifm.Application.frameworkPath=t[1];break}var f=!1,i=[],r=function(){if(!f&&(document.addEventListener||event.type==="load"||document.readyState==="complete")){Ifm.Dom.Strings.replaceAll("%");f=!0;for(var n=i.length;n--;)i[n]();i=[]}};document.addEventListener?(document.addEventListener("DOMContentLoaded",r,!1),window.addEventListener("load",r,!1)):(document.attachEvent("onreadystatechange",r),window.attachEvent("onload",r));this.Application.abort=function(n,t){var r=encodeURIComponent(window.location.href),u=encodeURIComponent(n||""),f=encodeURIComponent(t||""),i=sessionStorage,e="";i?(i.setItem("home",r),i.setItem("error",u),i.setItem("stack",f),i.setItem("info",Ifm.version)):e="?home="+r+"&error="+u+"&stack="+f+"&info="+Ifm.version;window.onerror=null;window.onbeforeunload=null;window.location.assign(this.frameworkPath+"blue.htm"+e)};this.Application.parameters=function(){var n={};return n.count=0,(window.location.search+window.location.hash).replace(/([^?&=]+)=([^&]*)?/g,function(t,i,r){i&&(n[i]=r||"",n.count++)}),n};this.Application.showBand=function(n,t){var i="<div style='margin:16px;'><pre style='font-size:xx-large;'>"+(n||"")+"<\/pre><pre style='font-size:medium;'>"+(t||"")+"<\/pre><\/div>";Ifm.Dom.Band.show(i)};this.Application.ready=function(n){if(!Ifm.Type.isFunction(n))throw new Error("Application.ready() -> Invalid ready handler function");if(f){setTimeout(n);return}i.push(n)};this.Application.quit=function(n,t){if(n&&!Ifm.Type.isFunction(n))throw new Error("Application.quit() -> Invalid quit handler function");if(t&&!Ifm.Type.isFunction(t))throw new Error("Application.quit() -> Invalid cancel handler function");window.onbeforeunload=function(){var i=!1;return setTimeout(function(){setTimeout(function(){i&&t&&t()},100)}),i=n()}};this.Application.onerror=function(n,t){Ifm.Diagnostics.Debug.enabled?Ifm.Diagnostics.Debug.fail(n,t):Ifm.Application.abort(n,t)};this.Cookies={};this.Cookies.get=function(n){try{return document.cookie.replace(new RegExp("(?:(?:^|.*;\\s*)"+n+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1")}catch(t){return""}};this.Cookies.delete=function(n){try{document.cookie=n+"=;expires=Thu, 01-Jan-70 00:00:01 GMT;path=/"}catch(t){}};this.Cookies.set=function(n,t){try{document.cookie=n+"="+t+";expires=Fri, 31 Dec 9999 23:59:59 GMT;path=/"}catch(i){}}}.call(Ifm);namespace("Ifm.Dom"),function(){this.Events={addHandler:window.addEventListener?function(n,t,i){n.addEventListener(t,i,!1)}:function(n,t,i){n.attachEvent("on"+t,i)},getEvent:function(n){return n||window.event},getTarget:function(n){var t=n||window.event;return t.target||t.srcElement},preventDefault:function(n){var t=n||window.event;t.preventDefault?t.preventDefault():t.returnValue=!1},removeHandler:window.removeEventListener?function(n,t,i){n.removeEventListener(t,i,!1)}:function(n,t,i){n.detachEvent("on"+t,i)},stopPropagation:function(n){var t=n||window.event;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},stop:function(n){var t=n||window.event;t.preventDefault&&t.preventDefault();t.stopImmediatePropagation&&t.stopImmediatePropagation();t.stopPropagation&&t.stopPropagation();t.stop&&t.stop();t.cancelBubble=!0;t.returnValue=!1}};this.Dialogs={_dialogs:[]};this.Dialogs.create=function(n,t,i){if(!n||!Ifm.Type.isString(n))throw new Error("Dialogs.create() -> Invalid dialog object id: "+n);if(Ifm.Dom.Dialogs._dialogs[n])throw new Error("Dialogs.create() -> Dialog already created:"+n);var r=document.getElementById(n);if(!r)throw new Error("Dialogs.create() -> Dialog definition object not found in DOM: "+n);if(r.parentNode.removeChild(r),t&&!Ifm.Type.isArray(t))throw new Error("Dialogs.create() -> Invalid buttons array:"+t);Ifm.Dom.Dialogs._dialogs[n]={instance:r,buttons:t||null,options:{modal:(i||{}).hasOwnProperty("modal")?i.modal:!0,title:(i||{}).hasOwnProperty("title")?i.title:""},arguments:null,result:undefined}};this.Dialogs.show=function(n,t,i,r){var u,h,e,f,o,s,c;if(!n||!Ifm.Type.isString(n))throw new Error("Dialogs.show() -> Invalid dialog object id: "+n);if(u=Ifm.Dom.Dialogs._dialogs[n],!u)throw new Error("Dialogs.show() -> Dialog not created: "+n);if(i&&!Ifm.Type.isFunction(i))throw new Error("Dialogs.show() -> Invalid handler: beforeShow");if(r&&!Ifm.Type.isFunction(r))throw new Error("Dialogs.show() -> Invalid handler: onHide");if(!u.shown){if(u.shown=!0,u.onhide=r||null,h=u.instance.cloneNode(!0),e=u.buttons,u.options.modal&&Ifm.Dom.Fader.show(),f=document.createElement("div"),f.className="dialog",f.style.zIndex="1100",f.innerHTML='<div class="dialog-title">'+(t||u.options.title||"")+'<\/div><div class="dialog-body"><\/div><div class="dialog-buttons"><\/div>',e&&e.length!==0||(f.innerHTML+='<div class="dialog-close"><button class="dialog-close-button" onclick="Ifm.Dom.Dialogs.hide(&apos;'+n+'&apos;, 0);">r<\/button><\/div>'),document.body.appendChild(f),u.container=f,f.children[1].appendChild(h),e)for(o=0;o<e.length;o++)s=document.createElement("button"),c="Ifm.Dom.Dialogs._dialogs['"+n+"'].result = (function() { "+e[o].click+" })(); Ifm.Dom.Dialogs.hide('"+n+"', "+(o+1)+");",s.onclick=new Function(c),s.innerHTML=e[o].text,f.children[2].appendChild(s);i&&i();Ifm.Dom.Strings.replaceAll("%%")}};this.Dialogs.hide=function(n,t){var i,r;if(!n||!Ifm.Type.isString(n))throw new Error("Dialogs.hide() -> Invalid dialog object id: "+n);if(i=Ifm.Dom.Dialogs._dialogs[n],!i)throw new Error("Dialogs.hide() -> Dialog not created: "+n);if(i.shown){if(i.onhide)i.onhide(t);i.shown=!1;r=i.container;r.style.opacity="0";setTimeout(function(){document.body.removeChild(r)},200);i.options.modal&&Ifm.Dom.Fader.hide()}};this.Cards=function(){var n={};return{show:function(t,i,r,u,f){var e,o,s;return n[i]?e=n[i].element:(e=document.createElement("div"),n[i]={element:e,fade:u?!0:!1},u&&Ifm.Dom.Fader.show(),r||(o=document.getElementById("ifmjs_sys_fader")||document,s=o.onclick,o.onclick=function(n){o.onclick=s;Ifm.Dom.Events.stop(n);Ifm.Dom.Cards.hide(i)},e.onclick=o.onclick),e.style.zIndex="1100",document.body.appendChild(e),e.className="dialog level-"+(f&&/^[12345]$/.test(f)?f:"1")),t&&(e.innerHTML=t),e},hide:function(t){if(n[t]){var i=n[t].element;return document.body.removeChild(i),n[t].fade&&Ifm.Dom.Fader.hide(),delete n[t],i}},isShown:function(t){return n[t]?!0:!1}}}();this.Band={_bands:[]};this.Band.show=function(n){var t,i,r;return Ifm.Dom.Fader.show(),t=document.createElement("div"),t.className="band",t.style.position="absolute",t.style.top="50%",t.style.marginTop="-80px",t.style.minHeight="160px",t.style.left="0px",t.style.width="100%",t.style.backgroundColor="#0066CC",t.style.color="white",t.style.overflow="hidden",t.style.zIndex="1200",i=document.getElementById("ifmjs_sys_fader")||document,r=i.onclick,i.onclick=function(n){i.onclick=r;Ifm.Dom.Events.stop(n);Ifm.Dom.Band.hide()},t.onclick=i.onclick,t.innerHTML=n,document.body.appendChild(t),Ifm.Dom.Band._bands.push(t),Ifm.Dom.Band._bands.length>1&&(Ifm.Dom.Band._bands[Ifm.Dom.Band._bands.length-2].style.display="none"),t};this.Band.hide=function(){if(Ifm.Dom.Band._bands.length>0){var n=Ifm.Dom.Band._bands.pop(n);document.body.removeChild(n);Ifm.Dom.Fader.hide()}return Ifm.Dom.Band._bands.length>0&&(Ifm.Dom.Band._bands[Ifm.Dom.Band._bands.length-1].style.display=""),n};this.Fader={_faders:0};this.Fader.show=function(){var n,t;return Ifm.Dom.Fader._faders++,Ifm.Dom.Fader._faders===1&&(n=document.getElementById("ifmjs_sys_fader"),n||(n=document.createElement("div"),n.id="ifmjs_sys_fader",n.style.backgroundColor="#003366",n.style.opacity="0.50",n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.width="100%",n.style.height="100%",n.style.zIndex="1000",t=document.getElementById("page-layout"),t&&(t.className+=" fade-effect")),document.body.appendChild(n)),Ifm.Dom.Fader._faders>0};this.Fader.hide=function(){var t,n;return Ifm.Dom.Fader._faders--,Ifm.Dom.Fader._faders===0&&(t=document.getElementById("ifmjs_sys_fader"),t&&(document.body.removeChild(t),n=document.getElementById("page-layout"),n&&(n.className=n.className.replace(" fade-effect","")))),Ifm.Dom.Fader._faders<=0};this.Menu=function(){if(!(this instanceof Ifm.Dom.Menu))throw Ifm.Diagnostics.Errors.ctor();var n="ifmjs_menu";return{constructor:Ifm.Dom.Menu,choose:function(t,i){var f,r,u;if(!Ifm.Type.isArray(t))throw Ifm.Diagnostics.Errors.arg("items");if(!Ifm.Type.isFunction(i))throw Ifm.Diagnostics.Errors.arg("callback");for(f="",r=0;r<t.length,u=t[r];r++)f+='<option value="{0}" {2}>{1}<\/option>'.format(u.value,u.label,u.disabled?"disabled":"");var o='<select style="width:100%;height:100%;overflow:auto;" size="{0}">{1}<\/select>'.format(t.length===1?2:t.length,f),s=Ifm.Dom.Cards.show(o,n),e=s.children[0];e.onclick=function(){i(this.value)};e.onkeydown=function(t){t=Ifm.Dom.Events.getEvent(t);t.which===13&&(Ifm.Dom.Cards.hide(n),i(this.value));t.which===27&&Ifm.Dom.Cards.hide(n)};e.focus()}}};this.Strings=function(){function n(n,t){if(Ifm.Type.isString(t.nodeValue)&&t.nodeValue.startsWith(n+"(")&&t.nodeValue.endsWith(")"))try{t.nodeValue=Function("return "+t.nodeValue.slice(n.length+1,-1))()}catch(i){}}return{replaceAll:function(t){t||(t="%");Ifm.Dom.Walker.walk(document.body,function(i){if(i.nodeType==1)for(var r=0;r<i.attributes.length;r++)n(t,i.attributes[r]);else i.nodeType==3&&n(t,i)})}}}();this.Walker={};this.Walker.walk=function n(t,i){for(i(t),t=t.firstChild;t;)n(t,i),t=t.nextSibling}}.call(Ifm.Dom);namespace("Ifm.PhoneBar.UI",{events:defineEvents("choosecampaign","showloginform","showqueueinfo","showtransferform"),Templates:{CampaignListCard:'<div class="phonebar-campaignlist-card-content">{0}<\/div>',CampaignListBox:'<table class="phonebar-campaignlist-card-table"><thead>{0}<\/thead><tbody>{1}<\/tbody><\/table>',CampaignListRow:"<tr>{0}{1}{2}<\/tr>",CampaignListHead:'<th style="font-weight:bold;">{0}<\/th>',CampaignListCell:"<td>{0}<\/td>",SupervisorMessageCard:'<div class="phonebar-supervisor-message-{0} material-icons">{1}<\/div><div class="phonebar-supervisor-message-text">{2}<\/div>',TransferFormCard:'<div style="padding:8px;">{0}<\/div>',TransferFormBox:'<table style="border:1px solid #ddd;width:100%;height:100%;"><tr>{0}<\/tr><tr>{1}<\/tr><tr>{2}<\/tr><\/table>',TransferFormHead:'<td colspan="2"><select style="width:100%;">{0}<\/select><\/td><td><button class="material-icons"><i class="material-icons">&#xE5D5;<\/i><\/button><\/td>',TransferFormOption:"<option>{0}<\/option>",TransferFormList:'<td colspan="3"><select size="8" style="width:100%;">{0}<\/select><\/td>',TransferFormAgent:'<option firstName="{1}" lastName="{2}" agentState="{3}" agentTime="{4}" campaignName="{5}">{0}<\/option>',TransferFormAction:'<td><input type="checkbox" checked style="text-align:right;">{0}<\/input><\/td><td><button>{1}<\/button><\/td><td><button>{2}<\/button><\/td>'}});namespace("Ifm.PhoneBar");Ifm.PhoneBar.UI.instance=function(){function o(){jQuery(t.LoginButton).click(i.login);jQuery(t.LoginOrReadyButton).click(i.loginOrReady);jQuery(t.ReadyButton).click(i.ready);jQuery(t.PauseButton).click(i.pause);jQuery(t.LogoutButton).click(i.logout);jQuery(t.CallButton).click(i.showMakeCallPopup);jQuery(t.TransferButton).click(i.showTransferForm);jQuery(t.CampaignListButton).click(i.showCampaignList);jQuery(t.QueueInfoButton).click(i.showQueueInfo);jQuery(t.PanicButton).click(i.panic);jQuery(t.NumberInput).on("keydown",function(n){return n.which===13?(i.showMakeCallPopup(),!1):n.which===27?(jQuery(t.NumberInput).val(""),!1):void 0}).on("input",function(){var n=jQuery(t.NumberInput).val().replace(/([^0-9#*])/g,"");jQuery(t.NumberInput).val(n);jQuery(t.CallButton).prop("disabled",n.length===0)})}var r={},e={1:"[Not Available]",2:"[Available]",4:"[Assigned]",8:"[Booked]",16:"[Talking]",32:"[Paused]",64:"[Post-Call]",128:"[Manual Call]"};r.run=function(){n.initialize(custom.config,custom.options);f=Ifm.PhoneBar.Strings[custom.config.language]||Ifm.PhoneBar.Strings.it;o();n.options.loginOnStart()&&setTimeout(i.login)};r.commands={login:function(){u.showloginform.raise(n,n.agent)},loginOrReady:function(){n.isLoggedIn()?i.ready():i.login()},logout:function(){n.logout()},pause:function(){n.getPauseReasons(function(t){var r,i;if(t.reasons.length===0)n.pause();else{for(t.reasons.unshift({text:f.PauseGenericReason,value:0}),r=[],i=0;i<t.reasons.length;i++)r.push({label:t.reasons[i].text,value:t.reasons[i].id});(new Ifm.Dom.Menu).choose(r,function(t){n.pause(t)})}})},ready:function(){var t=n.getActiveCall();t&&t.postcall?n.ready(t.callId):n.ready()},panic:function(){n.panic();jQuery(t.MainToolbar).addClass("phonebar-panic-effect");setTimeout(function(){jQuery(t.MainToolbar).removeClass("phonebar-panic-effect")},2e3)},showCampaignList:function(){n.getCampaignList(0,0,95,function(n){for(var u,t=Ifm.PhoneBar.UI.Templates,f=t.CampaignListRow.format(t.CampaignListHead.format("Nome"),t.CampaignListHead.format("Stato"),t.CampaignListHead.format("Direzione")),r="",i=0;i<n.campaigns.length;i++)r+=t.CampaignListRow.format(t.CampaignListCell.format(n.campaigns[i].name),t.CampaignListCell.format(n.campaigns[i].mask&2?"Attivo":"Inattivo"),t.CampaignListCell.format(n.campaigns[i].mask&8?"Inbound":"Outbound"));u=t.CampaignListCard.format(t.CampaignListBox.format(f,r));Ifm.Dom.Cards.show(u,"phonebar-campaignlist-card")})},showQueueInfo:function(){n.getQueueInfo("",function(t){u.showqueueinfo.raise(n,t)})},showMakeCallPopup:function(){if(jQuery(t.NumberInput).val())n.getCampaignList(0,0,82,function(i){var u,r;if(i.campaigns.length>0){for(u=[],r=0;r<i.campaigns.length;r++)u.push({label:i.campaigns[r].name,value:i.campaigns[r].name});(new Ifm.Dom.Menu).choose(u,function(i){n.makeCall(jQuery(t.NumberInput).val(),i,n.options.callingNumber()||n.agent.extension)})}})},showTransferForm:function(r){var e=function(r){var s=Ifm.PhoneBar.UI.Templates,e,o,f;for(u.showtransferform.raise(n,{}),e=jQuery(t.TransferCampaignList).val(),o="",f=0;f<r.campaigns.length;f++)o+=s.TransferFormOption.format(r.campaigns[f].name);jQuery(t.TransferCampaignList).html(o);e&&jQuery(t.TransferCampaignList).val(e);i.showTransferAgents()},f=n.calls(r)||n.getActiveCall();n.getCampaignList(f&&f.callId||0,f&&f.mediatype||0,378,e)},showTransferAgents:function(){n.getAgentList(jQuery(t.TransferCampaignList).val(),1022,function(n){for(var u=Ifm.PhoneBar.UI.Templates,f=u.TransferFormAgent.format("(Qualsiasi)"),r=0,i;r<n.agents.length,i=n.agents[r];r++)f+=u.TransferFormAgent.format(i.firstName+" "+i.lastName+" "+e[i.state]+" "+i.campaignName,i.firstName,i.lastName,i.state,i.time,i.campaignName);jQuery(t.TransferAgentList).html(f)})},transferCall:function(){var r=n.getActiveCall();if(r&&r.callId){var i=jQuery(t.TransferAgentList)[0],u="",f="",e=!1;i&&i.selectedIndex>0&&(u=i[i.selectedIndex].firstName,f=i[i.selectedIndex].lastName,e=jQuery(t.TransferMandatoryCheck).prop("checked"));n.transferCall(r.callId,jQuery(t.TransferCampaignList).val(),u,f,e)}}};Ifm.PhoneBar.events.supervisormessage=function(n,t){var i=Ifm.PhoneBar.UI.Templates.SupervisorMessageCard,r=i.format(["information","warning","critical"][t.severity],["&#xE88E;","&#xE002;","&#xE000;"][t.severity],t.message);Ifm.Dom.Cards.show(r,"supervisor-message-card")};var n=Ifm.PhoneBar.instance,t=Ifm.PhoneBar.UI.Elements,i=r.commands,u=Ifm.PhoneBar.UI.events,f;return r}();