
//============================================================================

// Copyright (c) IFM Infomaster. All rights reserved.

//============================================================================

"use strict";function defineEvents(){for(var t,i={},n=0;n<arguments.length;n++){if(t=arguments[n],!Ifm.Type.isString(t))throw Ifm.Diagnostics.Errors.arg("name");createEventAccessors(i,t)}return i}function createEventAccessors(n,t){var i=new Ifm.Event;Object.defineProperty(n,t,{get:function(){return i},set:function(n){i.addHandler(n)}})}function namespace(n,t){for(var r,f,i=window,e=n.split("."),u=0;u<e.length;u++)r=e[u],i[r]=i[r]||{},i=i[r];for(f in t)i[f]=t[f];return i}function query(n){var i=n||window.location.search,t={};return i.replace(/[?&#]([^=]+)=([^&]*)?/g,function(n,i,r){return i&&(t[i]=r||""),""}),t}var global=global||window,T0,dT,Ifm;if(Object.defineProperty?Object.defineProperty(global,"T0",{value:+new Date}):T0=+new Date,dT=function(){return new Date-T0},Function.getName=function(n){if(!Ifm.Type.isFunction(n))throw Ifm.Diagnostics.Errors.func("func");var t=/function\s+(\w+)/.exec(n);return t&&t.length===2?t[1]:(t=/(\w+)\s*=\s*function/.exec(n),t&&t.length===2)?t[1]:"anonymous function"},Function.prototype.toShortString=function(){var n=this.toString().replace(/[\r|\n]/g,"").replace(/[\s]+/g," ");return n.substr(0,n.indexOf("{")).trim()},Array.pushArray=function(n,t){if(!Ifm.Type.isArray(n))throw Ifm.Diagnostics.Errors.arg("array1");if(!Ifm.Type.isArray(t))throw Ifm.Diagnostics.Errors.arg("array2");return Array.prototype.push.apply(n,t)},!Array.prototype.find)try{Object.defineProperty(Array.prototype,"find",{enumerable:!1,value:function(n,t){if(!Ifm.Type.isFunction(n))throw Ifm.Diagnostics.Errors.func("func");for(var i=0,r=this.length;i<r;i++)if(i in this&&n.call(t,this[i],i,this))return this[i];return undefined}})}catch(e){}window.ArrayBuffer&&(ArrayBuffer.fromBytes=function(n){for(var i=n.length,r=new ArrayBuffer(i),u=new Uint8Array(r),t=0;t<i;t++)u[t]=n[t];return r},ArrayBuffer.prototype.getBytes=function(){for(var t=new Uint8Array(this),i=[],n=0,r=t.length;n<r;n++)i.push(t[n]);return i});Object.entries||(Object.entries=function(n){var i=[];for(var t in n)n.hasOwnProperty(t)&&i.push([t,n[t]]);return i});Object.keys||(Object.keys=function(n){var t=[];for(var i in n)n.hasOwnProperty(i)&&t.push(i);return t});Object.values||(Object.values=function(n){var t=[];for(var i in n)n.hasOwnProperty(i)&&t.push(n[i]);return t});String.format=function(n){if(!n||!Ifm.Type.isString(n))return n;var t=Array.prototype.slice.call(arguments,1);return n.replace(/{(\d+)}/g,function(n,i){return typeof t[i]!="undefined"?t[i]:""})};String.prototype.format=function(){var n=[this];return Array.prototype.push.apply(n,arguments),String.format.apply(null,n)};String.prototype.startsWith||(String.prototype.startsWith=function(n,t){return t=t||0,this.substr(t,n.length)===n});String.prototype.endsWith||(String.prototype.endsWith=function(n,t){t=t||this.length;var i=Math.max(t-n.length,0);return this.slice(i,t)===n});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")});String.prototype.indexAfter=function(n){var t=this.indexOf(n);return t+(t<0?0:n.length)};String.prototype.lastIndexAfter=function(n){var t=this.lastIndexOf(n);return t+(t<0?0:n.length)};Date.now||(Date.now=function(){return+new Date});Date.prototype.toISOString||function(){function n(n){var t=String(n);return t.length===1&&(t="0"+t),t}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+n(this.getUTCMonth()+1)+"-"+n(this.getUTCDate())+"T"+n(this.getUTCHours())+":"+n(this.getUTCMinutes())+":"+n(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}();Date.prototype.toISOLocaleDateString||(Date.prototype.toISOLocaleDateString=function(){var i=""+this.getFullYear(),n=""+(this.getMonth()+1),t=""+this.getDate();return n.length<2&&(n="0"+n),t.length<2&&(t="0"+t),i+"-"+n+"-"+t});Ifm=namespace("Ifm"),function(){Ifm.version="Ifm.js/1.0.1697";this.Enum={};this.Enum.getName=function(n,t){for(var r,u=Object.getOwnPropertyNames(n),i=0,f=u.length;i<f;i++)if(r=u[i],n[r]===t)return r;return""};this.Enum.getLength=function(n){return Object.getOwnPropertyNames(n).length};this.Type={};this.Type.getTypeName=function(n){var i=Object.prototype.toString.call(n).slice(8,-1),t;return i==="Object"&&(t=n&&n.constructor&&n.constructor.toString().match(/function\s+([^\s]{1,})\s*\(/),t)?t[1]:i};this.Type.isArray=function(n){return Object.prototype.toString.call(n)==="[object Array]"};this.Type.isLikeArray=function(n){return typeof n=="object"&&!Ifm.Type.isString(n)&&typeof n.length=="number"&&!n.propertyIsEnumerable("length")};this.Type.isFunction=function(n){return typeof n=="function"};this.Type.isNumber=function(n){return typeof n=="number"};this.Type.isString=function(n){return typeof n=="string"||n instanceof String};this.Event=function(){if(!(this instanceof Ifm.Event))throw Ifm.Diagnostics.Errors.ctor();var n=[];return{constructor:Ifm.Event,addHandler:function(t,i){Ifm.Type.isFunction(t)&&n.push({f:t,o:i||null})},hasHandlers:function(){return n.length>0},removeAllHandlers:function(){n.length=0},removeHandler:function(t){for(var i=n.length;i--;)n[i].f===t&&n.splice(i,1)},raise:function(){for(var i=n.length,t;i--;)t=n[i],t.f.apply(t.o,arguments)}}}}.call(Ifm);namespace("Ifm.Diagnostics"),function(){this.Debug={};this.Debug.onprint=new Ifm.Event;this.Debug.enabled=!1;this.Debug.popupAssertions=!1;this.Debug.assert=function(n,t){if(Ifm.Diagnostics.Debug.enabled){if(Ifm.Type.isString(n)){try{var i=new Function("return "+n);Ifm.Diagnostics.Debug.assert(i(),n+" "+t)}catch(r){Ifm.Diagnostics.Debug.fail("Invalid assert condition '"+n+"' : "+r.message)}return}n||Ifm.Diagnostics.Debug.fail(t)}};this.Debug.fail=function n(t){if(Ifm.Diagnostics.Debug.enabled){var i=arguments[1],u=arguments[2]||n;if(!i)try{throw new Error("Assertion failed");}catch(r){i=r.stack||"[Callstack not available]"}window.console&&console.error&&console.error(t,i);Ifm.Diagnostics.Debug.popupAssertions&&alert(t+"\n\n----Stack----\n\n"+i)}};this.Debug.clear=function(){if(Ifm.Diagnostics.Debug.enabled){window.console&&console.clear&&console.clear();var n=document.getElementById("consoleview");n&&(n.innerHTML="")}};this.Debug.print=function(n){var t,i;Ifm.Diagnostics.Debug.enabled&&(t=arguments.length>1?Array.prototype.slice.call(arguments).join(" "):n&&n.toString()||null,t!==null)&&(window.console&&console.log&&console.log(t),Ifm.Diagnostics.Debug.onprint.raise(t),i=document.getElementById("consoleview"),i&&(i.innerHTML+=t+"<br>",i.scrollTop=i.scrollHeight))};this.Debug.printf=function(){Ifm.Diagnostics.Debug.enabled&&Ifm.Diagnostics.Debug.print(String.format.apply(null,arguments))};this.Errors=function(){function t(n,t){return new Error(n+(t?": '"+t+"'":""))}var n={};return n.arg=function(n){return t("Invalid function argument",n)},n.argsno=function(n){return t("Invalid number of function arguments",n)},n.ctor=function(n){return t("Invalid constructor call",n)},n.func=function(n){return t("Function argument expected",n)},n.miss=function(n){return t("Missing type or module",n)},n.notimpl=function(n){return t("Feature not implemented",n)},n.notsup=function(n){return t("Feature not supported",n)},n.op=function(n){return t("Invalid operation",n)},n}()}.call(Ifm.Diagnostics);namespace("Ifm");Ifm.Cookies={get:function(n){try{return document.cookie.replace(new RegExp("(?:(?:^|.*;\\s*)"+n+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1")}catch(t){return""}},"delete":function(n){try{document.cookie=n+"=;expires=Thu, 01-Jan-70 00:00:01 GMT;path=/"}catch(t){}},set:function(n,t){try{document.cookie=n+"="+t+";expires=Fri, 31 Dec 9999 23:59:59 GMT;path=/"}catch(i){}}};namespace("Ifm.Messaging"),function(){this.FMessage={HeaderLength:18,LengthPosition:16,ExtLenPosition:12,DataPosition:20,MessageHeaderId:1431655765};this.FMessageReader=function(n){if(!n)throw new Error("FMessageReader() -> Invalid message buffer");if(this._bytes=[],this._readingpos=0,n instanceof ArrayBuffer)this._bytes=n.getBytes();else if(n instanceof Array)this._bytes=n;else throw new Error("FMessageReader() -> Unsupported message data format: "+typeof n);if(this._bytes.length<Ifm.Messaging.FMessage.DataPosition)throw new Error("FMessageReader() -> Invalid message length: "+this._bytes.length);var t=this.nextInt32();if(t!==Ifm.Messaging.FMessage.MessageHeaderId)throw new Error("FMessageReader() -> Invalid FMessage signature: "+t.toString(16));if(this._readingpos=Ifm.Messaging.FMessage.LengthPosition,this.length=this.nextInt16(),this.length===0&&(this._readingpos=Ifm.Messaging.FMessage.ExtLenPosition,this.length=this.nextInt32(),this.length===0))throw new Error("FMessageReader() -> Invalid FMessage length");this._readingpos=Ifm.Messaging.FMessage.HeaderLength;this.code=this.nextInt16()};this.FMessageReader.prototype.remainingBytes=function(){return this.length+Ifm.Messaging.FMessage.HeaderLength-this._readingpos};this.FMessageReader.prototype.nextByte=function(){if(this._readingpos<this._bytes.length)return this._bytes[this._readingpos++];throw new Error("FMessageReader.nextByte() -> No more bytes to read: "+this._readingpos);};this.FMessageReader.prototype.nextBool=function(){return this.nextByte()===0?!1:!0};this.FMessageReader.prototype.nextBool32=function(){return this.nextInt32()===0?!1:!0};this.FMessageReader.prototype.nextInt16=function(){return(this.nextByte()<<8)+this.nextByte()};this.FMessageReader.prototype.nextInt32=function(){return(this.nextInt16()<<16)+this.nextInt16()};this.FMessageReader.prototype.nextInt64=function(){return(this.nextInt32()<<32)+this.nextInt32()};this.FMessageReader.prototype.nextString=function(){for(var i=this.nextInt16(),n=[],t=0;t<i;t++)n.push(this.nextByte());return String.fromCharCode.apply(null,n)};this.FMessageReader.prototype.nextUniString=function(){for(var i=this.nextInt16(),n=[],t=0;t<i;t++)n.push(this.nextByte()),n.push(this.nextByte()<<8);return String.fromCharCode.apply(null,n)};this.FMessageWriter=function(n){this._bytes=[];this._len=0;this.addInt32(Ifm.Messaging.FMessage.MessageHeaderId);this.addInt32(0);this.addInt32(0);this.addInt32(0);this.addInt16(0);this._len=0;this.addInt16(n);this.code=n};this.FMessageWriter.prototype.addByte=function(n){return this._bytes.push(n),this._len++,this};this.FMessageWriter.prototype.addBool=function(n){return this.addByte(n?1:0),this};this.FMessageWriter.prototype.addBool32=function(n){return this.addInt32(n?1:0),this};this.FMessageWriter.prototype.addInt16=function(n){return this.addByte((65280&n)>>8),this.addByte(255&n),this};this.FMessageWriter.prototype.addInt32=function(n){return this.addInt16((4294901760&n)>>16),this.addInt16(65535&n),this};this.FMessageWriter.prototype.addInt64=function(n){return this.addInt32((-4294967296&n)>>32),this.addInt32(4294967295&n),this};this.FMessageWriter.prototype.addString=function(n){var i=n&&n.length||0,t;for(this.addInt16(i),t=0;t<i;t++)this.addByte(n.charCodeAt(t));return this};this.FMessageWriter.prototype.addUniString=function(n){var i=n&&n.length||0,t;for(this.addInt16(i),t=0;t<i;t++)this.addByte(255&n.charCodeAt(t)),this.addByte((65280&n.charCodeAt(t))>>8);return this};this.FMessageWriter.prototype.end=function(){this._bytes[Ifm.Messaging.FMessage.LengthPosition]=(65280&this._len)>>8;this._bytes[Ifm.Messaging.FMessage.LengthPosition+1]=255&this._len};this.FMessageWriter.prototype.toArrayBuffer=function(){return ArrayBuffer.fromBytes(this._bytes)}}.call(Ifm.Messaging);namespace("Ifm.Messaging"),function(n){n.FStringMessage={MessageHeader:"*begin*",MessageTypeDel:"%%%",MessageFieldDel:"###",MessageFooter:"§end§",MinValidLength:16};n.FStringMessageReader=function(n){if(!(this instanceof Ifm.Messaging.FStringMessageReader))throw Ifm.Diagnostics.Errors.ctor("Ifm.Messaging.FStringMessageReader");if(!n)throw Ifm.Diagnostics.Errors.arg("messageBuffer");if(this._message="",this._readingpos=0,Ifm.Type.isString(n))this._message=n;else throw new Error("FStringMessageReader() -> Unsupported message data format: "+typeof n);if(this._message.length<Ifm.Messaging.FStringMessage.MinValidLength)throw new Error("FStringMessageReader() -> Invalid message length: "+this._message.length);if(!this._message.startsWith(Ifm.Messaging.FStringMessage.MessageHeader))throw new Error("FStringMessageReader() -> Invalid FStringMessage signature");var t=this._message.match(/^\*begin\*([A-z0-9]*)%{3}/);if(t&&t.length==2)this.type=t[1];else throw new Error("FStringMessageReader() -> Invalid FStringMessage type format");if(t=this._message.match(/%{3}(.*)[\xA7|$]end[\xA7|$]/),t&&t.length==2)this.data=t[1].split(Ifm.Messaging.FStringMessage.MessageFieldDel);else throw new Error("FStringMessageReader() -> Invalid FStringMessage data format");};n.FStringMessageWriter=function(t){if(!(this instanceof Ifm.Messaging.FStringMessageWriter))throw Ifm.Diagnostics.Errors.ctor("Ifm.Messaging.FStringMessageWriter");if(!Ifm.Type.isString(t))throw Ifm.Diagnostics.Errors.arg("type");this.type=t;this._message=n.FStringMessage.MessageHeader+t+n.FStringMessage.MessageTypeDel};n.FStringMessageWriter.prototype.add=function(n){if(n===undefined||n===null)throw Ifm.Diagnostics.Errors.arg("str");return this._message.endsWith(Ifm.Messaging.FStringMessage.MessageTypeDel)||(this._message+=Ifm.Messaging.FStringMessage.MessageFieldDel),this._message+=n,this};n.FStringMessageWriter.prototype.end=function(){return this._message+=Ifm.Messaging.FStringMessage.MessageFooter,this};n.FStringMessageWriter.prototype.toString=function(){return this._message}}(Ifm.Messaging);namespace("Ifm.Messaging"),function(){this.FMessageBuilder=function(){if(!window.ArrayBuffer)throw new Error("FMessageBuilder() -> ArrayBuffer not supported");this.message=new Ifm.Event;this._buffer=[];this.toString=function(){return"[object FMessageBuilder]"}};this.FMessageBuilder.isSupported=function(){return window.ArrayBuffer?!0:!1};this.FMessageBuilder.prototype.append=function(n){if(n)if(n instanceof ArrayBuffer)Array.pushArray(this._buffer,n.getBytes());else if(n instanceof Array)Array.pushArray(this._buffer,n);else throw new Error("FMessageBuilder.append() -> Unsupported message data format: "+typeof n);else throw new Error("FMessageBuilder.append() -> Invalid message buffer");while(this._buffer.length>Ifm.Messaging.FMessage.HeaderLength){var t=new Ifm.Messaging.FMessageReader(this._buffer);if(Ifm.Messaging.FMessage.HeaderLength+t.length<=this._buffer.length){try{this.message.raise(this,{message:t})}catch(i){console.error(i);Ifm.Diagnostics.Debug.print(this,"Error dispatching or processing message:",i.message);Ifm.Diagnostics.Debug.print(i.stack)}this._buffer.splice(0,Ifm.Messaging.FMessage.HeaderLength+t.length)}}}}.call(Ifm.Messaging);namespace("Ifm.Messaging").FPropertyList=function(n){if(!(this instanceof Ifm.Messaging.FPropertyList))throw Ifm.Diagnostics.Errors.ctor();if(!n||!Ifm.Type.isString(n))throw Ifm.Diagnostics.Errors.arg("pliststr");n=n.trim();for(var t={},i=[],r,u=/{\s*([^\s{]*)\s*=\s*([^}]*)}/g;r=u.exec(n);)t[r[1]]=r[2],i.push(r[1]);this.originalString=n;this.get=function(n){if(!n||!Ifm.Type.isString(n))throw Ifm.Diagnostics.Errors.arg("key");return t[n]};this.keys=function(){var n=[];for(var i in t)n.push(i);return n};this.remove=function(n){if(!n||!Ifm.Type.isString(n))throw Ifm.Diagnostics.Errors.arg("key");if(t.hasOwnProperty(n)){delete t[n];for(var r=i.length;r--;)i[r]===n&&i.splice(r,1)}};this.set=function(n,r){if(!n||!Ifm.Type.isString(n))throw Ifm.Diagnostics.Errors.arg("key");t.hasOwnProperty(n)||i.push(n);t[n]=r};this.toString=function(){for(var r="{",n=0;n<i.length;n++)r+="{"+i[n]+" = "+t[i[n]]+"}";return r+"}"}},function(){function u(n){switch(n){case"403":return": no destination for protocol";case"500":return": client-gateway protocol error";case"502":return": gateway-server protocol error";case"503":return": no destination reachable";default:return""}}var i=namespace("Ifm.Messaging"),t,n;i.FPort=function r(){if(!(this instanceof r))throw Ifm.Diagnostics.Errors.ctor();this.opened=new Ifm.Event;this.closed=new Ifm.Event;this.message=new Ifm.Event};t=Ifm.Messaging.FPort;n=t.prototype;t.isSupported=function(){return global.WebSocket&&global.ArrayBuffer?!0:!1};n.isClosed=function(){return this._websocket&&this._websocket.readyState===WebSocket.CLOSED||!0};n.isOpen=function(){return this._websocket&&this._websocket.readyState===WebSocket.OPEN||!1};n.open=function(n,i){if(!t.isSupported())throw Ifm.Diagnostics.Errors.notsup("FPort");if(this._websocket&&this._websocket.readyState===WebSocket.OPEN)throw new Error("FPort.open() -> Invalid port state");if(!n)throw new Error("FPort.open() -> Invalid address");var r=this,f=new Ifm.Messaging.FMessageBuilder;f.message.addHandler(function(n,t){this.message.raise(r,{reader:t.message})},this);this._closedhere=!1;this._wasconnected=!1;this._gateway=!1;Ifm.Diagnostics.Debug.print("[FPort] connecting to "+n);try{this._websocket=i?new WebSocket(n,i):new WebSocket(n);this._websocket.binaryType="arraybuffer";this._address=n}catch(e){Ifm.Diagnostics.Debug.print("[FPort] connection failed: "+e.message);r.closed.raise(r,{clean:!1,failed:!0,lost:!1,reason:e.message});return}this._websocket.onmessage=function(t){var i,e,o,s;if(Ifm.Type.isString(t.data)){i=t.data.split("|");switch(i[0]){case"#gateway":Ifm.Diagnostics.Debug.print("[FPort] connected through gateway");r._gateway=!0;return;case"#ready":Ifm.Diagnostics.Debug.print("[FPort] ready");r._wasconnected=!0;r.opened.raise(r,{address:n,gateway:r._gateway});return;case"#close":e=i.length>1?i[1]:"0";o=e+u(e);Ifm.Diagnostics.Debug.printf("[FPort] closed ({0})",o);return}try{s=new Ifm.Messaging.FStringMessageReader(t.data)}catch(h){Ifm.Diagnostics.Debug.printf("[FPort] invalid message {0}",t.data);Ifm.Diagnostics.Debug.print(h);return}r.message.raise(r,{reader:s})}else t.data instanceof ArrayBuffer?f.append(t.data):Ifm.Diagnostics.Debug.printf("[FPort] unknown message {0}",t.data)};this._websocket.onclose=function(t){Ifm.Diagnostics.Debug.print("[FPort] closed"+(r._wasconnected?r._closedhere?"":" (connection lost)":" (connection failed)"));r.closed.raise(r,{clean:r._closedhere,failed:!r._wasconnected,lost:r._wasconnected&&!r._closedhere,reason:r._closedhere?"":"Connection to "+n+" "+(r._wasconnected?t.reason?t.reason:"lost":"failed")});delete r._address;delete r._websocket}};n.close=function(){this._websocket&&this._websocket.readyState===WebSocket.OPEN&&(this._closedhere=!0,this._websocket.close())};n.send=function(n){if(n&&this._websocket&&this._websocket.readyState===WebSocket.OPEN)if(n instanceof Ifm.Messaging.FMessageWriter)this._websocket.send(n.toArrayBuffer());else if(n instanceof Ifm.Messaging.FStringMessageWriter)this._websocket.send(n.toString());else throw new Error("Unsupported message format: "+n+" ("+Ifm.Type.getTypeName(n)+")");}}(),function(){var n=namespace("Ifm.Messaging");n.FConnection=function(){if(!(this instanceof Ifm.Messaging.FConnection))throw Ifm.Diagnostics.Errors.ctor();var t=null,i=null;return{constructor:n.FConnection,events:defineEvents("connecting","connected","disconnecting","disconnected","binarymessage","stringmessage"),isSupported:function(){return!!(t&&t.isSupported())},isClosed:function(){return!!(t&&t.isClosed())},isConnected:function(){return!!(t&&t.isOpen())},getAddress:function(){return t&&t._address||""},connect:function(n,r,u){if(this.isConnected())return!0;if(!n||Ifm.Type.isArray(n)&&n.length===0)throw Ifm.Diagnostics.Errors.arg("address");t=new Ifm.Messaging.FPort;t.opened.addHandler(function(){this.events.connected.raise(this);Ifm.Type.isFunction(u)&&u()},this);t.closed.addHandler(function(t,r){if(r.failed&&Ifm.Type.isArray(n)&&n.length>1){this.connect(n.slice().splice(1),u);return}this.events.disconnected.raise(this,i||r);i=null},this);t.message.addHandler(function(n,t){if(t.reader instanceof Ifm.Messaging.FStringMessageReader)this.events.stringmessage.raise(this,t);else if(t.reader instanceof Ifm.Messaging.FMessageReader)this.events.binarymessage.raise(this,t);else{Ifm.Diagnostics.Debug.fail("Invalid messageReader");return}},this);this.events.connecting.raise(this,{address:n});Ifm.Type.isArray(n)?t.open(n[0],r):t.open(n,r)},disconnect:function(n){if(!this.isConnected())return!0;i=n||null;this.events.disconnecting.raise(this);t.close()},send:function(n){if(!n)throw Ifm.Diagnostics.Errors.arg("message");if(!this.isConnected()){console.warn("[Ifm.Messaging.FConnection] Can't send, not connected");return}t.send(n)}}}}();namespace("Ifm").PhoneBar={about:{product:"#phones",title:"#phonebar",version:"1.0.30.1968"},events:defineEvents("initialized","languagechanged","booked","assignment","alerting","answered","callfailure","othercall","pausebooked","pause","ready","readyfordetach","readyfortransfer","terminated","recordingstarted","recordingmutechanged","recordingstopped","statechanged","statetimechanged","supervisormessage"),LoginReplyFailureCauses:{Unspecified:0,AccountLockout:1,ExpiredPassword:2,WrongUsernameOrPassword:3,InvalidNewPassword:4,PasswordChangeNotAllowed:5,WrongState:6,ExtensionTranslationError:128},Mediatypes:{Voice:1,NearRealTime:8,StoreAndForward:16},States:{NotLoggedIn:"[Not Logged In]",Connecting:"[Connecting]",LoggedIn:"[Logged In]",Paused:"[Paused]",Ready:"[Ready]",Alerting:"[Alerting]",Talking:"[Talking]",PostCall:"[Post Call]",OtherCall:"[Other Call]",Assigned:"[Assigned]",WaitingOutbound:"[Waiting Outbound]",WaitingTransfer:"[Waiting Transfer]"},canRun:function(){return!!(global&&global.WebSocket&&global.ArrayBuffer&&global.jQuery)},run:function(n,t){this.run=function(){self.log("PhoneBar","Debug","Already running")};this.instance.initialize(n,t)},instance:function(){function rt(){f={};h={login:[],logout:[],pause:[],ready:[],make:[],transfer:[],getAgentList:[],getCampaignList:[],getPauseReasons:[],getQueueInfo:[]};l=null}function k(){if(Object.values(f).some(function(n){return n.postcall})){c(r.PostCall);u(i.PostCallState);return}if(Object.values(f).some(function(n){return!n.terminated})){c(r.Talking);u(i.TalkingState);return}c(r.Ready);u(i.ReadyState)}function c(i){var s=p,u,e;if(i!==s||i===r.Paused){n.log("PhoneBar","Debug","Changing state, from",s,"to",i);p=i;u=!1;e=!1;switch(i){case r.NotLoggedIn:jQuery([t.PauseButton,t.ReadyButton,t.LogoutButton,t.NumberLabel,t.NumberInput,t.CallButton,t.TransferButton,t.CampaignListButton,t.QueueInfoButton,t.PanicButton,t.StartRecordingButton,t.StopRecordingButton,t.MuteRecordingButton,t.UnmuteRecordingButton].join(", ")).disable();jQuery(t.LoginButton).enable();jQuery(t.LoginOrReadyButton).enable();jQuery(t.NumberInput).val("").change();u=!0;break;case r.Connecting:jQuery([t.LoginButton,t.LoginOrReadyButton].join(", ")).disable();break;case r.LoggedIn:case r.Ready:jQuery([t.PauseButton,t.LogoutButton,t.NumberLabel,t.NumberInput,t.CampaignListButton,t.QueueInfoButton,t.PanicButton].join(", ")).enable();jQuery([t.LoginButton,t.LoginOrReadyButton,t.ReadyButton,t.TransferButton].join(", ")).disable();jQuery(t.NumberInput).val("").change();u=!0;break;case r.Paused:jQuery(t.PauseButton).disable();n.getPauseReasons(function(n){n.reasons.length>0&&jQuery(t.PauseButton).enable()});jQuery([t.ReadyButton,t.LoginOrReadyButton].join(", ")).enable();u=!0;e=!n.options.hideClockInPause();break;case r.Talking:Object.values(f).some(function(n){return n.mediatype===Ifm.PhoneBar.Mediatypes.Voice})&&jQuery(t.TransferButton).enable();y||(u=!0,e=!0);break;case r.PostCall:Object.values(f).find(function(n){return n.mediatype===Ifm.PhoneBar.Mediatypes.Voice})&&jQuery([t.ReadyButton,t.LoginOrReadyButton].join(", ")).enable();break;case r.OtherCall:y||(u=!0,e=!0);break;case r.Assigned:break;case r.Alerting:break;case r.WaitingOutbound:break;case r.WaitingTransfer:break;default:n.log("PhoneBar","Debug","Unexpected state",i);return}o.statechanged.raise(n,{currentState:i,previousState:s});u&&(b=new Date,o.statetimechanged.raise(n,{stateTime:b,startTimer:e}),y&&(y=clearTimeout(y)),e&&(y=setInterval(function(){var n=new Date-b;jQuery(t.StateTimeText).html(w(n,!0))},1e3)),jQuery(t.StateTimeText).html(""))}}function u(n,i){i?(g=!0,jQuery(t.StateText).html(n),jQuery(t.StateText).addClass("phonebar-state-error-text"),setTimeout(function(){jQuery(t.StateText).removeClass("phonebar-state-error-text");g=!1;jQuery(t.StateText).html(tt)},i)):(tt=n,g||jQuery(t.StateText).html(n))}function d(t,i){var r=f[t];r&&r.isRecording?(r.isRecording=!1,v(t),o.recordingstopped.raise(n,{callId:t,result:i||0})):v(0)}function v(n){var i=f[n];i&&i.mediatype!==Ifm.PhoneBar.Mediatypes.Voice||(i&&!i.terminated&&i.isRecording?i&&i.isRecording&&(jQuery(t.StartRecordingButton).disable(),jQuery(t.StartRecordingButton).hide(),jQuery(t.StopRecordingButton).enable(),jQuery(t.StopRecordingButton).show(),i.recordingData.rxChannelMuted||i.recordingData.txChannelMuted?(jQuery(t.MuteRecordingButton).disable(),jQuery(t.MuteRecordingButton).hide(),jQuery(t.UnmuteRecordingButton).enable(),jQuery(t.UnmuteRecordingButton).show()):(jQuery(t.MuteRecordingButton).enable(),jQuery(t.MuteRecordingButton).show(),jQuery(t.UnmuteRecordingButton).disable(),jQuery(t.UnmuteRecordingButton).hide())):(jQuery([t.StartRecordingButton,t.StopRecordingButton,t.MuteRecordingButton,t.UnmuteRecordingButton].join(", ")).disable(),jQuery(t.StopRecordingButton).hide(),jQuery(t.UnmuteRecordingButton).hide(),jQuery(t.StartRecordingButton).show(),jQuery(t.MuteRecordingButton).show()),!i||i.terminated||i.isRecording||jQuery(t.StartRecordingButton).enable())}function w(n,t){var r,u;t&&(n=n/1e3);r=Math.floor(n%60);n=n/60;u=Math.floor(n%60);n=n/60;var f=Math.floor(n%24),e=Math.floor(n/24),i="";return e>0&&(i+=e+" d "),f>0&&(i+=f+" h "),u>0&&(i+=u+" m "),r>0&&(i+=r+" s "),i}function et(){jQuery(t.LoginButton).attr("title",i.TooltipLogin);jQuery(t.LoginOrReadyButton).attr("title",i.TooltipLoginOrReady);jQuery(t.ReadyButton).attr("title",i.TooltipReady);jQuery(t.PauseButton).attr("title",i.TooltipPause);jQuery(t.LogoutButton).attr("title",i.TooltipLogout);jQuery(t.CallButton).attr("title",i.TooltipCall);jQuery(t.TransferButton).attr("title",i.TooltipTransfer);jQuery(t.CampaignListButton).attr("title",i.TooltipCampaignList);jQuery(t.QueueInfoButton).attr("title",i.TooltipQueueInfo);jQuery(t.PanicButton).attr("title",i.TooltipPanic);jQuery(t.NumberLabel+", "+t.NumberInput).attr("title",i.TooltipPhoneNumber);jQuery(t.StartRecordingButton).attr("title",i.TooltipStartRec);jQuery(t.StopRecordingButton).attr("title",i.TooltipStopRec);jQuery(t.MuteRecordingButton).attr("title",i.TooltipMuteRec);jQuery(t.UnmuteRecordingButton).attr("title",i.TooltipUnmuteRec);jQuery(t.HangupButton).attr("title",i.TooltipHangup);jQuery(t.PickupButton).attr("title",i.TooltipPickup);jQuery(t.FlashButton).attr("title",i.TooltipFlash);jQuery(t.ManualTransferButton).attr("title",i.TooltipManualTransfer);jQuery(t.Line1Button).attr("title",i.TooltipLine1);jQuery(t.Line2Button).attr("title",i.TooltipLine2);jQuery(t.EnterConferenceButton).attr("title",i.TooltipEnterConf);jQuery(t.LeaveConferenceButton).attr("title",i.TooltipLeaveConf);jQuery(t.MicrophoneVULabel+", "+t.MicrophoneVUMeter).attr("title",i.TooltipMicVUMeter);jQuery(t.SpeakersVULabel+", "+t.SpeakersVUMeter).attr("title",i.TooltipSpkVUMeter);jQuery(t.MicrophoneOffButton).attr("title",i.TooltipMicOff);jQuery(t.MicrophoneOnButton).attr("title",i.TooltipMicOn)}var n,o,a,r,i,t,p="[Initialization]",tt="",g=!1,b=0,y,it={language:"it"},e=new Ifm.Messaging.FConnection,f,h,l,ut={1:"[No Dial Tone]",2:"[No Ringback]",3:"[Line Busy]",4:"[No Answer]",5:"[Fax Tone]",6:"[Remote Hangup]",7:"[Agent: No Dial Tone]",8:"[Agent: No Ringback]",9:"[Agent: Line Busy]",10:"[Agent: No Answer]",255:"[Unknown]"},ft={1:"CallFailureNoDialTone",2:"CallFailureNoRingback",3:"CallFailureLineBusy",4:"CallFailureNoAnswer",5:"CallFailureFaxTone",6:"CallFailureRemoteHangUp",7:"CallFailureAgentNoDialTone",8:"CallFailureAgentNoRingback",9:"CallFailureAgentBusy",10:"CallFailureAgentNoAnswer",255:"CallFailureUnknown"},nt={RecordingInactive:0,RecordingActive:1,TxChannelMuted:2,RxChannelMuted:4},s={_root:"phonebar!",_agent:"agent!"};return s.agent={firstName:s._root+s._agent+"firstName",lastName:s._root+s._agent+"lastName",password:s._root+s._agent+"password",extension:s._root+s._agent+"extension"},e.events.connecting=function(){c(r.Connecting);u(i.ConnectingState)},e.events.disconnected=function(t,f){n.media.spc&&n.media.spc.disconnect();n.media.xmpp&&n.media.xmpp.disconnect();rt();c(r.NotLoggedIn);f.clean?u(i.NotLoggedInState):f.failed?(n.log("Connection","Warn",f.reason),u(i.ConnectionFailed)):f.lost&&(n.log("Connection","Warn","Connection lost"),u(i.NotLoggedInState+" ("+i.ConnectionLost+")"));v(0)},e.events.binarymessage=function(s,a){var ht=a.reader,y=null,g=Ifm.PhoneBar.Messages,st,tt,b,lt,ot,ct,rt;for(st in g.PhonesToPhoneBarMessages)if(ht.code===g.PhonesToPhoneBarMessages[st]){y=new g[st](ht);y.typecode=ht.code;break}if(y===null){n.log("PhoneBar","Warn","Unknown message received:",ht.code);return}if(y.typecode===g.PhonesToPhoneBarMessages.KeepAliveRequest){e.send(new g.KeepAliveReply);return}b=y.callId;b?n.log("PhoneBar","Debug","Got",st,"message, callId",b):n.log("PhoneBar","Debug","Got",st,"message");switch(y.typecode){case g.PhonesToPhoneBarMessages.AssignmentRequest:var it=new Ifm.Messaging.FPropertyList(y.callDataStr),et=it.get("ExternalParty")||"",at=y.mediatype||it.get("_MediaType_")||Ifm.PhoneBar.Mediatypes.Voice;at===Ifm.PhoneBar.Mediatypes.Voice&&(l?(et.endsWith(l.externalParty)&&(et=l.externalParty,it.set("ExternalParty",et)),l=null):it.set("DDI")||(lt=et.lastIndexOf("+"),lt>0&&(et=et.substring(lt),it.set("ExternalParty",et))));it.save=function(){n.log("PhoneBar","Debug","Sending SetCallResultEvent message");e.send(g.SetCallResultEvent(b,it.toString()))};ot=f[b]={callId:b,callGuid:it.get("GUID").toUpperCase(),mediatype:at,campaignName:y.campaignName,callData:it,otherData:{serviceId:y.serviceId,campaignId:y.campaignId,scriptName:y.scriptName,scriptParameters:y.scriptParameters},isRecording:y.recordingState&nt.RecordingActive?!0:!1,recordingData:{fileName:y.recordingFileName,settings:y.recordingSettings,rxChannelMuted:y.recordingState&nt.RxChannelMuted?!0:!1,txChannelMuted:y.recordingState&nt.TxChannelMuted?!0:!1}};n.log("PhoneBar","Debug","Incoming call on campaign",ot.campaignName,"with calldata",ot.callData);n.log("PhoneBar","Debug","Sending AssignmentReply message");e.send(new g.AssignmentReply(b,1));c(r.Assigned);u(i.AssignedState+" ("+y.campaignName+")");v(b);o.assignment.raise(n,ot);ot.isRecording&&(o.recordingstarted.raise(n,{callId:b,fileName:y.recordingFileName}),o.recordingmutechanged.raise(n,{callId:b,rxChannelMuted:ot.recordingData.rxChannelMuted,txChannelMuted:ot.recordingData.txChannelMuted}));break;case g.PhonesToPhoneBarMessages.LoginReply:y.accepted===0?(u(i.NotLoggedInState),n.log("PhoneBar","Warn","Login request refused, cause",y.failureCause),u(i.RequestRefused,1e3),e.disconnect()):(n.agent.id=y.agentId,c(r.LoggedIn),u(i.LoggedInState),n.media.spc&&n.media.spc.connect(),n.media.xmpp&&n.media.xmpp.connect());tt=h.login.shift();tt&&tt(y);break;case g.PhonesToPhoneBarMessages.LogoutReply:y.accepted===0?(n.log("PhoneBar","Warn","Logout request refused"),u(i.RequestRefused,1e3)):(delete n.agent.id,e.disconnect());tt=h.logout.shift();tt&&tt(y);break;case g.PhonesToPhoneBarMessages.PauseReply:switch(y.accepted){case 0:n.log("PhoneBar","Warn","Pause request refused");u(i.RequestRefused,1e3);break;case 1:c(r.Paused);y.reasonId===0?u(i.PausedState):(n.log("PhoneBar","Debug","Pause reason is",y.reasonText),u(i.PausedState+" ("+y.reasonText+")"));break;case 2:n.log("PhoneBar","Info","Pause booked");u(i.PauseBooked,1e3);o.pausebooked.raise(n,{})}y.accepted===3?(tt=h.getPauseReasons.shift(),tt&&tt({reasons:y.reasons})):(tt=h.pause.shift(),tt&&tt(y));break;case g.PhonesToPhoneBarMessages.ReadyReply:y.accepted===0?(n.log("PhoneBar","Warn","Ready request refused"),u(i.RequestRefused,1e3)):b?(f[b].postcall=!1,f[b].terminated=!0,k(b)):(c(r.Ready),u(i.ReadyState));tt=h.ready.shift();tt&&tt(y);y.accepted===1&&(o.ready.raise(n,{callId:b||null}),b&&delete f[b]);break;case g.PhonesToPhoneBarMessages.NewCallReply:y.accepted===0?(l=null,n.log("PhoneBar","Warn","New call request refused"),u(i.RequestRefused,1e3)):(l.callId=b,n.log("PhoneBar","Info","New call request accepted, callId",b),c(r.WaitingOutbound),u(i.WaitingOutboundState),jQuery(t.NumberInput).val("").change());tt=h.make.shift();tt&&tt(y);break;case g.PhonesToPhoneBarMessages.TransferCallReply:y.accepted===0?(n.log("PhoneBar","Warn","Transfer call request refused"),u(i.RequestRefused,1e3)):(n.log("PhoneBar","Info","Transfer call request accepted, callId",b),f[b].transfer=!0,c(r.WaitingTransfer),u(i.WaitingTransferState),o.readyfortransfer.raise(n,y));tt=h.transfer.shift();tt&&tt(y);break;case g.PhonesToPhoneBarMessages.AgentListReply:tt=h.getAgentList.shift();tt&&tt(y);break;case g.PhonesToPhoneBarMessages.CampaignListReply:tt=h.getCampaignList.shift();tt&&tt(y);break;case g.PhonesToPhoneBarMessages.CampaignQueueInfoReply:for(y.avgTimestamp=y.avgTime,y.avgTime=w(y.avgTime),y.maxTimestamp=y.maxTime,y.maxTime=w(y.maxTime),ct=0;ct<y.campaigns.length;ct++)rt=y.campaigns[ct],rt.avgTimestamp=rt.avgTime,rt.avgTime=w(rt.avgTime),rt.maxTimestamp=rt.maxTime,rt.maxTime=w(rt.maxTime);tt=h.getQueueInfo.shift();tt&&tt(y);break;case g.PhonesToPhoneBarMessages.BookedEvent:u(i.AssignmentBooked);o.booked.raise(n,y);break;case g.PhonesToPhoneBarMessages.AlertingEvent:c(r.Alerting);u(i.AlertingState);o.alerting.raise(n,y);break;case g.PhonesToPhoneBarMessages.AnsweredEvent:c(r.Talking);u(i.TalkingState);o.answered.raise(n,y);break;case g.PhonesToPhoneBarMessages.CallFailureEvent:n.log("PhoneBar","Warn","Call failure: callId",b,"cause",y.cause,ut[y.cause],"ISDN cause",y.protocolTerminationCause,y.protocolTerminationDescription,"detected content cause",y.detectedContentCode,y.detectedContentDescription);y.description=i[ft[y.cause]];k(b);u(i.CallFailure+" ("+y.description+")",3e3);l&&l.callId===b&&(l=null);f[b]&&(f[b].terminated=!0,d(b));jQuery(t.NumberInput).val("").change();o.callfailure.raise(n,y);delete f[b];break;case g.PhonesToPhoneBarMessages.OtherCallEvent:c(r.OtherCall);u(i.OtherCallState);o.othercall.raise(n,y);break;case g.PhonesToPhoneBarMessages.PauseEvent:c(r.Paused);y.reasonId===0?u(i.PausedState):(n.log("PhoneBar","Debug","Pause reason is",y.reasonText),u(i.PausedState+" ("+y.reasonText+")"));o.pause.raise(n,y);break;case g.PhonesToPhoneBarMessages.ReadyEvent:c(r.Ready);u(i.ReadyState);o.ready.raise(n,{callId:null});break;case g.PhonesToPhoneBarMessages.ReadyForDetachEvent:o.readyfordetach.raise(n,y);f[b]&&(f[b].terminated=!0,f[b].transfer&&(d(b),delete f[b]));p!==r.Paused&&k(b);break;case g.PhonesToPhoneBarMessages.ReadyForTransferEvent:c(r.WaitingTransfer);u(i.WaitingTransferState);o.readyfortransfer.raise(n,y);break;case g.PhonesToPhoneBarMessages.SupervisorMessageEvent:o.supervisormessage.raise(n,y);break;case g.PhonesToPhoneBarMessages.TerminatedEvent:f[b].terminated=!0;y.postCallWork===1?(f[b].postcall=!0,c(r.PostCall),u(i.PostCallState)):p!==r.Paused&&k(b);o.terminated.raise(n,y);f[b].postcall||(d(b),delete f[b]);break;case g.PhonesToPhoneBarMessages.AudioRecordingStartedEvent:f[b]&&(f[b].isRecording=!0,f[b].recordingData.fileName=y.fileName,v(b),o.recordingstarted.raise(n,y));break;case g.PhonesToPhoneBarMessages.AudioRecordingCompletedEvent:d(b,y.result);break;case g.PhonesToPhoneBarMessages.AudioRecordingMutedEvent:f[b].recordingData.rxChannelMuted=y.rxChannelMuted;f[b].recordingData.txChannelMuted=y.txChannelMuted;v(b);o.recordingmutechanged.raise(n,y);break;default:n.log("PhoneBar","Debug","Not implemented:",st)}},{calls:function(n){var t=typeof n=="function"?n:null,i;return arguments.length>0&&t===null?f[n]||null:(i=Object.values(f),t)?i.filter(t):i},currentState:function(){return p},currentStateTime:function(){return b},language:function(t){if(arguments.length===0)return it.language;t&&Ifm.PhoneBar.Strings[t]&&(i=Ifm.PhoneBar.Strings[t],it.language=t,et(),n.log("PhoneBar","Debug","Language set to '"+t+"'"),o.languagechanged.raise(n,{language:t}))},isLoggedIn:function(){return n.connection.isConnected()},initialize:function(f,e){if(n=this,a=f,n.initialize=function(){},o=Ifm.PhoneBar.events,r=Ifm.PhoneBar.States,t=Ifm.PhoneBar.UI.Elements,n.language(Ifm.PhoneBar.Strings[f.language]?f.language:"it"),Ifm.Diagnostics.Debug.enabled=custom.config.debug||!0,!Ifm.PhoneBar.canRun())throw new Error(i.NoBrowserSupport);Ifm.version=Ifm.PhoneBar.about.title+"/"+Ifm.PhoneBar.about.version+"; "+Ifm.version;n.log("PhoneBar","Info",Ifm.version);jQuery.fn.extend({enable:function(){return this.each(function(){jQuery(this).prop("disabled",!1);jQuery(this).removeAttr("disabled")})},disable:function(){return this.each(function(){jQuery(this).prop("disabled",!0);jQuery(this).attr("disabled","")})},enabled:function(n){return this.each(function(){n?jQuery(this).enable():jQuery(this).disable()})}});jQuery('[class^="phonebar-phone"]').hide();jQuery(t.NumberInput).attr("maxlength",255);"value"in document.createElement("meter")||jQuery(t.SpeakersVULabel+", "+t.SpeakersVUMeter+", "+t.MicrophoneVULabel+", "+t.MicrophoneVUMeter).remove();Ifm.PhoneBar.Media.Spc.instance&&custom.softphoneconfig&&(n.media.spc=Ifm.PhoneBar.Media.Spc.instance,n.media.spc.initialize(n,custom.softphoneconfig,e));Ifm.PhoneBar.Media.Xmpp.instance&&custom.xmppconfig&&custom.xmppconfig.service&&(n.media.xmpp=Ifm.PhoneBar.Media.Xmpp.instance,n.media.xmpp.initialize(n,custom.xmppconfig));rt();c(r.NotLoggedIn);u(i.NotLoggedInState);v(0);for(var h in e)n.options[h]&&n.options[h](e[h]);n.options.rememberCredentials()&&(n.agent.firstName=Ifm.Cookies.get(s.agent.firstName),n.agent.lastName=Ifm.Cookies.get(s.agent.lastName),n.agent.password=Ifm.Cookies.get(s.agent.password),n.agent.extension=Ifm.Cookies.get(s.agent.extension));o.initialized.raise(n,{config:f,options:e})},login:function(t,i,r,u,f){if(arguments.length<4||arguments.length>5)throw Ifm.Diagnostics.Errors.argsno("4 (+1)");if(f&&!Ifm.Type.isFunction(f))throw Ifm.Diagnostics.Errors.func("callback");if(n.connection.isConnected())throw Ifm.Diagnostics.Errors.op("already logged in");n.agent.firstName=t;n.agent.lastName=i;n.agent.password=r;n.agent.extension=u;n.options.rememberCredentials()&&(Ifm.Cookies.set(s.agent.firstName,t),Ifm.Cookies.set(s.agent.lastName,i),Ifm.Cookies.set(s.agent.extension,u));n.options.rememberCredentials()===2&&Ifm.Cookies.set(s.agent.password,r);var o=a.service,c="ipb",l=0;a.service_rop&&Ifm.Type.isString(u)&&u.startsWith("@")&&(o=a.service_rop,c="ipr",l=2,n.agent.extension=u.slice(1));n.log("PhoneBar","Info","Loggin'in to",o,"as",t,i,"ext.",u);e.connect(o,c,function(){f&&h.login.push(f);n.log("PhoneBar","Debug","Sending LoginRequest message");e.send(new Ifm.PhoneBar.Messages.LoginRequest(t,i,r,u.toString(),l))})},loginEx:function(t,i,r,u,f,o){if(arguments.length<5||arguments.length>6)throw Ifm.Diagnostics.Errors.argsno("5 (+1)");if(o&&!Ifm.Type.isFunction(o))throw Ifm.Diagnostics.Errors.func("callback");if(n.connection.isConnected())throw Ifm.Diagnostics.Errors.op("already logged in");n.agent.firstName=t;n.agent.lastName=i;n.agent.password=u;n.agent.extension=f;n.options.rememberCredentials()&&(Ifm.Cookies.set(s.agent.firstName,t),Ifm.Cookies.set(s.agent.lastName,i),Ifm.Cookies.set(s.agent.extension,f));n.options.rememberCredentials()===2&&Ifm.Cookies.set(s.agent.password,u);var c=a.service,l="ipb",v=0;a.service_rop&&Ifm.Type.isString(f)&&f.startsWith("@")&&(c=a.service_rop,l="ipr",v=2,n.agent.extension=f.slice(1));n.log("PhoneBar","Info","Loggin'in to",a.service,"as",t,i,"ext.",f);e.connect(c,l,function(){o&&h.login.push(o);n.log("PhoneBar","Debug","Sending LoginRequest message");e.send(new Ifm.PhoneBar.Messages.LoginExRequest(t,i,r,u,f.toString(),v))})},logout:function(t){if(arguments.length>1)throw Ifm.Diagnostics.Errors.argsno("0 (+1)");if(t&&!Ifm.Type.isFunction(t))throw Ifm.Diagnostics.Errors.func("callback");t&&h.logout.push(t);n.log("PhoneBar","Debug","Sending LogoutRequest message");e.send(new Ifm.PhoneBar.Messages.LogoutRequest)},pause:function(t,i){if(arguments.length>2)throw Ifm.Diagnostics.Errors.argsno("0 (+2)");if(i&&!Ifm.Type.isFunction(i))throw Ifm.Diagnostics.Errors.func("callback");i&&h.pause.push(i);n.log("PhoneBar","Debug","Sending PauseRequest message");e.send(new Ifm.PhoneBar.Messages.PauseRequest(t))},ready:function(t,i){if(arguments.length>2)throw Ifm.Diagnostics.Errors.argsno("0 (+2)");if(i&&!Ifm.Type.isFunction(i))throw Ifm.Diagnostics.Errors.func("callback");i&&h.ready.push(i);n.log("PhoneBar","Debug","Sending ReadyRequest message");e.send(new Ifm.PhoneBar.Messages.ReadyRequest(t))},makeCall:function(t,i,r,u){if(arguments.length<3||arguments.length>4)throw Ifm.Diagnostics.Errors.argsno("3 (+1)");if(u&&!Ifm.Type.isFunction(u))throw Ifm.Diagnostics.Errors.func("callback");if(l)throw Ifm.Diagnostics.Errors.op("a previous request is pending");u&&h.make.push(u);l={campaignName:i,externalParty:t};n.log("PhoneBar","Debug","Sending NewCallRequest message");e.send(new Ifm.PhoneBar.Messages.NewCallRequest(t,i,r||""))},transferCall:function(t,i,r,u,o,s,c){if(arguments.length<2||arguments.length>7)throw Ifm.Diagnostics.Errors.argsno("2 (+5)");if(c&&!Ifm.Type.isFunction(c))throw Ifm.Diagnostics.Errors.func("callback");(s!==0||s!==2)&&(s=1);c&&h.transfer.push(c);var l=f[t]&&f[t].callData.toString();n.log("PhoneBar","Debug","Sending TransferCallRequest message");e.send(new Ifm.PhoneBar.Messages.TransferCallRequest(t,s,i,l,r,u,o))},getAgentList:function(t,i,r){if(arguments.length!==3)throw Ifm.Diagnostics.Errors.argsno("3");if(!Ifm.Type.isFunction(r))throw Ifm.Diagnostics.Errors.func("callback");h.getAgentList.push(r);n.log("PhoneBar","Debug","Sending AgentListRequest message");e.send(new Ifm.PhoneBar.Messages.AgentListRequest(t,i))},getTransferAgentList:function(t,i){var r=1022;return n.options.hidePausedAgents()&&(r=990),n.getAgentList(t,r,i)},getCampaignList:function(t,i,r,u){if(arguments.length!==4)throw Ifm.Diagnostics.Errors.argsno("4");if(!Ifm.Type.isFunction(u))throw Ifm.Diagnostics.Errors.func("callback");h.getCampaignList.push(u);n.log("PhoneBar","Debug","Sending CampaignListRequest message");e.send(new Ifm.PhoneBar.Messages.CampaignListRequest(r,t,i))},getAssignedCampaignList:function(t){return n.getCampaignList(0,0,95,t)},getOutboundCampaignList:function(t){return n.getCampaignList(0,0,82,t)},getTransferCampaignList:function(t,i){var r=0,u;return t&&n.calls(t)&&(r=n.calls(t).mediatype),u=378,n.getCampaignList(t,r,u,i)},getPauseReasons:function(t){if(arguments.length!==1)throw Ifm.Diagnostics.Errors.argsno("1");if(!Ifm.Type.isFunction(t))throw Ifm.Diagnostics.Errors.func("callback");h.getPauseReasons.push(t);n.log("PhoneBar","Debug","Sending PauseReasonsRequest message");e.send(new Ifm.PhoneBar.Messages.PauseReasonsRequest)},getQueueInfo:function(t,i){if(arguments.length!==2)throw Ifm.Diagnostics.Errors.argsno("2");if(!Ifm.Type.isFunction(i))throw Ifm.Diagnostics.Errors.func("callback");h.getQueueInfo.push(i);n.log("PhoneBar","Debug","Sending CampaignQueueInfoRequest message");e.send(new Ifm.PhoneBar.Messages.CampaignQueueInfoRequest(t))},panic:function(){if(arguments.length!==0)throw Ifm.Diagnostics.Errors.argsno("0");n.log("PhoneBar","Debug","Sending AgentPanicEvent message");e.send(new Ifm.PhoneBar.Messages.AgentPanicEvent)},log:function(n,i){if(arguments.length<3)throw Ifm.Diagnostics.Errors.argsno("3+");var r="",f=new Date,e=f.toLocaleTimeString()+"."+("000"+f.getMilliseconds()).slice(-3),u=i.toLowerCase();u==="info"?u="log":u==="info"&&(u="error");n&&(r+="["+n+"] ");i&&(r+="["+i+"] ");r+=Array.prototype.splice.call(arguments,2).join(" ");try{console[u](r)}catch(o){console.log(r)}r=r.replace(/\</g,"&lt;").replace(/\>/g,"&gt;");jQuery(t.LogText).append("<div class='phonebar-log-text-"+i.toLowerCase()+"'><span class='phonebar-log-text-timestamp'>"+e+" <\/span><span class='phonebar-log-text-line'>"+r+"<\/span><\/div>").parent().scrollTop(jQuery(t.LogText).height())},startRecording:function(i,r,u){var o,f,s;if(arguments.length<1||arguments.length>3)throw Ifm.Diagnostics.Errors.argsno("1+2");if(!i||!n.calls(i))throw Ifm.Diagnostics.Errors.arg("callId");if(o=n.calls(i).mediatype,o!==Ifm.PhoneBar.Mediatypes.Voice)throw Ifm.Diagnostics.Errors.op("this call's mediatype does not support recording");Ifm.Type.isString(r)||(r=a.recordingsPath||"C:\\Recordings\\",r.endsWith("\\")||(r+="\\"),f=n.calls(i).lastRecordingPart=(n.calls(i).lastRecordingPart||0)+1,s=f>1?" ("+f+")":"",r+=(new Date).toISOLocaleDateString()+" "+i+" "+n.agent.getName()+s+".wav");jQuery(t.StartRecordingButton).disable();n.log("PhoneBar","Debug","Sending StartAudioRecordingRequest message for call",i);e.send(new Ifm.PhoneBar.Messages.StartAudioRecordingRequest(i,r,u||0))},stopRecording:function(i){if(arguments.length!==1)throw Ifm.Diagnostics.Errors.argsno("1");if(!i||!n.calls(i))throw Ifm.Diagnostics.Errors.arg("callId");var r=n.calls(i).mediatype;if(r!==Ifm.PhoneBar.Mediatypes.Voice)throw Ifm.Diagnostics.Errors.op("this call's mediatype does not support recording");jQuery(t.StopRecordingButton).disable();n.log("PhoneBar","Debug","Sending StopAudioRecordingRequest message for call",i);e.send(new Ifm.PhoneBar.Messages.StopAudioRecordingRequest(i))},muteRecording:function(t,i,r,u){if(arguments.length<3||arguments.length>4)throw Ifm.Diagnostics.Errors.argsno("3+1");if(!t||!n.calls(t))throw Ifm.Diagnostics.Errors.arg("callId");var f=n.calls(t).mediatype;if(f!==Ifm.PhoneBar.Mediatypes.Voice)throw Ifm.Diagnostics.Errors.op("this call's mediatype does not support recording");n.log("PhoneBar","Debug","Sending SetAudioRecordingMuteRequest message for call",t);e.send(new Ifm.PhoneBar.Messages.SetAudioRecordingMuteRequest(t,r,i,!!u,u||""))},tagRecording:function(t,i){if(arguments.length!==2)throw Ifm.Diagnostics.Errors.argsno("2");if(!t||!n.calls(t))throw Ifm.Diagnostics.Errors.arg("callId");var r=n.calls(t).mediatype;if(r!==Ifm.PhoneBar.Mediatypes.Voice)throw Ifm.Diagnostics.Errors.op("this call's mediatype does not support recording");n.log("PhoneBar","Debug","Sending AppendCueSheetEntryRequest message for call",t);e.send(new Ifm.PhoneBar.Messages.AppendCueSheetEntryRequest(t,i||""))},agent:{firstName:"",lastName:"",password:"",extension:"",getName:function(){return this.firstName+" "+this.lastName}},connection:{events:e.events,isConnected:function(){return e.isConnected()},_getConnection:function(){return e}},media:{},options:function(){var e=1,o=1,h="",c=1,l=1,a=1,v=!1,y=!1,t=!1,r=!1,n=!1,u=!1,f=!1,p=/INPUT|SELECT|TEXTAREA/i;jQuery(document).on("keydown keyup",function(t){if(t.which===8&&!t.ctrlKey&&!t.shiftKey&&!t.altkey&&r){var i=t.target;if(!p.test(i.tagName)||i.disabled||i.readOnly)return!1}return t.which===82&&t.ctrlKey&&n?!1:t.which===116&&(!t.ctrlKey&&u||t.ctrlKey&&n)?!1:void 0});jQuery(document).on("contextmenu",function(){return!f});jQuery(window).on("beforeunload",function(){if(t&&Ifm.PhoneBar.instance.isLoggedIn())return i.UnloadPageConfirm});return{autoAnswerPhone:function(n){if(n===undefined)return e;n>=0&&n<=3&&(e=n)},autoAnswerRings:function(n){if(n===undefined)return o;o=n},hideClockInPause:function(n){if(n===undefined)return v;v=!!n},hidePausedAgents:function(n){if(n===undefined)return y;y=!!n},callingNumber:function(n){if(n===undefined)return h;h=n},rememberCredentials:function(n){if(n===undefined)return c;(n===0||n===1||n===2)&&(c=n);n<2&&this.forgetPassword();n<1&&(Ifm.Cookies.delete(s.agent.firstName),Ifm.Cookies.delete(s.agent.lastName),Ifm.Cookies.delete(s.agent.extension))},loginOnStart:function(n){if(n===undefined)return l;(n===0||n===1||n===2)&&(l=n)},popupIncomingCalls:function(n){if(n===undefined)return a;Ifm.Type.isNumber(n)&&(a=n)},confirmNavigation:function(n){if(n===undefined)return t;t=!!n},preventBackspace:function(n){if(n===undefined)return r;r=!!n},preventHardRefresh:function(t){if(t===undefined)return n;n=!!t},preventRefresh:function(n){if(n===undefined)return u;u=!!n},preventRightClick:function(n){if(n===undefined)return f;f=!!n},forgetPassword:function(){Ifm.Cookies.delete(s.agent.password);Ifm.PhoneBar.instance.agent.password=""}}}()}}()};namespace("Ifm.PhoneBar.UI").Elements={MainToolbar:".phonebar-toolbar",PhoneToolbar:".phonebar-phone-toolbar",PhoneDialPad:".phonebar-phone-dialpad",LogText:".phonebar-log-text",StateText:".phonebar-state-text",StateTimeText:".phonebar-state-time-text",PhoneStateText:".phonebar-phone-state-text",RecordingStateText:".phonebar-recording-state-text",NumberLabel:".phonebar-number-label",NumberInput:".phonebar-number-input",LoginButton:".phonebar-login-button",LoginOrReadyButton:".phonebar-login-ready-button",ReadyButton:".phonebar-ready-button",PauseButton:".phonebar-pause-button",LogoutButton:".phonebar-logout-button",CallButton:".phonebar-call-button",TransferButton:".phonebar-transfer-button",CampaignListButton:".phonebar-campaignlist-button",QueueInfoButton:".phonebar-queueinfo-button",PanicButton:".phonebar-panic-button",StartRecordingButton:".phonebar-start-recording-button",StopRecordingButton:".phonebar-stop-recording-button",MuteRecordingButton:".phonebar-mute-recording-button",UnmuteRecordingButton:".phonebar-unmute-recording-button",HangupButton:".phonebar-phone-hangup-button",PickupButton:".phonebar-phone-pickup-button",FlashButton:".phonebar-phone-flash-button",ManualTransferButton:".phonebar-phone-manual-transfer-button",Line1Button:".phonebar-phone-line1-button",Line2Button:".phonebar-phone-line2-button",EnterConferenceButton:".phonebar-phone-enter-conference-button",LeaveConferenceButton:".phonebar-phone-leave-conference-button",MicrophoneVULabel:".phonebar-phone-microphone-label",MicrophoneVUMeter:".phonebar-phone-microphone-meter",SpeakersVULabel:".phonebar-phone-speakers-label",SpeakersVUMeter:".phonebar-phone-speakers-meter",MicrophoneOffButton:".phonebar-phone-microphone-off-button",MicrophoneOnButton:".phonebar-phone-microphone-on-button",HideDialPadButton:".phonebar-phone-dialpad-hide-button",ShowDialPadButton:".phonebar-phone-dialpad-show-button",DialPadDigit0Button:".phonebar-phone-key-digit0",DialPadDigit1Button:".phonebar-phone-key-digit1",DialPadDigit2Button:".phonebar-phone-key-digit2",DialPadDigit3Button:".phonebar-phone-key-digit3",DialPadDigit4Button:".phonebar-phone-key-digit4",DialPadDigit5Button:".phonebar-phone-key-digit5",DialPadDigit6Button:".phonebar-phone-key-digit6",DialPadDigit7Button:".phonebar-phone-key-digit7",DialPadDigit8Button:".phonebar-phone-key-digit8",DialPadDigit9Button:".phonebar-phone-key-digit9",DialPadHashButton:".phonebar-phone-key-hash",DialPadStarButton:".phonebar-phone-key-star",TransferCampaignList:".phonebar-transfer-campaign-list",TransferAgentList:".phonebar-transfer-agent-list",TransferMandatoryCheck:".phonebar-transfer-mandatory-check"};namespace("Ifm.PhoneBar.Media");namespace("Ifm.PhoneBar.Media.Spc");namespace("Ifm.PhoneBar.Media.Spc.events");namespace("Ifm.PhoneBar.Media.Xmpp");namespace("Ifm.PhoneBar.Media.Xmpp.events"),function(){var n=namespace("Ifm.PhoneBar");n.AgentListCampaigns={AnyCampaign:0,SpecificCampaign:256,OmitSynthetics:512,OmitHumans:1024};n.AgentListStates={NotAvailable:1,Available:2,Assigned:4,Booked:8,Talking:16,Paused:32,Postcall:64,Othercall:128,AnyAvailable:254};n.CampaignInfoFlags={Inactive:1,Active:2,Suspended:4,AnyStatusMask:7,Inbound:8,Outbound:16,AnyBoundness:24,NotAssigned:32,Assigned:64,AnyAssignment:96,PostCallWork:128,HideTransferNotAllowed:256,ExcludeSyntheticCampaigns:512,ExcludeHumanCampaigns:1024};n.LoginReplyFailureCauses={Unspecified:0,AccountLockout:1,ExpiredPassword:2,WrongUsernameOrPassword:3,InvalidNewPassword:4,PasswordChangeNotAllowed:5,WrongState:6,ExtensionTranslationError:128};n.TransferCallModes={Blind:0,Default:1,Consultative:2}}();namespace("Ifm.PhoneBar.Messages"),function(){this.PhonesToPhoneBarMessages={AssignmentRequest:12292,KeepAliveRequest:12543,LoginReply:20480,LogoutReply:20481,ReadyReply:20482,PauseReply:20483,NewCallReply:20485,TransferCallReply:20486,CampaignListReply:20487,AgentListReply:20488,CampaignQueueInfoReply:20489,SetCampaignStatusReply:20490,AbortCallReply:20494,RetrieveCallReply:20495,ReadyEvent:36866,PauseEvent:36867,AlertingEvent:38912,AnsweredEvent:38913,TerminatedEvent:38914,CallFailureEvent:38915,OtherCallEvent:38916,PostCallWorkEvent:38917,SupervisorMessageEvent:38919,ReadyForTransferEvent:38920,ReadyForDetachEvent:38921,BookedEvent:38924,AudioRecordingStartedEvent:38933,AudioRecordingMutedEvent:38934,AudioRecordingCompletedEvent:38935};this.AssignmentRequest=function(n){this.callId=n.nextInt32();this.rejectable=n.nextByte();this.campaignName=n.nextString();this.scriptName=n.nextString();this.scriptParameters=n.nextString();this.callDataStr=n.nextString();this.dummy=n.nextByte();this.cfgVersion=n.nextString();this.serviceId=n.nextString();this.campaignId=n.nextString();this.recordingState=n.remainingBytes()>=1?n.nextByte():0;this.recordingFileName=n.remainingBytes()>=2?n.nextString():"";this.recordingSettings=n.remainingBytes()>=4?n.nextInt32():0;this.mediatype=n.remainingBytes()>=4?n.nextInt32():0};this.KeepAliveRequest=function(){};this.LoginReply=function(n){this.accepted=n.nextByte();n.remainingBytes()&&(this.agentId=n.nextString(),n.nextString(),this.failureCause=n.nextByte())};this.LogoutReply=function(n){this.accepted=n.nextByte()};this.ReadyReply=function(n){this.accepted=n.nextByte();this.callId=n.remainingBytes()>=4?n.nextInt32():null};this.PauseReply=function(n){var i,t,r,u;if(this.accepted=n.nextByte(),this.accepted===1&&n.remainingBytes()?(this.reasonId=n.nextInt32(),this.reasonText=n.nextString()):this.accepted!==3&&(this.reasonId=0,this.reasonText=""),this.accepted===3)for(i=n.nextInt32(),this.reasons=[],t=0;t<i;t++)r=n.nextInt32(),u=n.nextString(),this.reasons.push({id:r,text:u})};this.NewCallReply=function(n){this.callId=n.nextInt32();this.accepted=n.nextByte()};this.TransferCallReply=function(n){this.callId=n.nextInt32();this.accepted=n.nextByte()};this.CampaignListReply=function(n){var o=n.nextInt16(),u,t,f,i,e,r;for(this.campaigns=[],u=0;u<o;u++){if(t=n.nextString(),f=n.nextInt32()&2147483679,f&2147483648)for(i=t.split("\t"),e=1;e<i.length;e++)t=i[e].slice(0,-1),this.campaigns.push({name:i[0]+"/"+t,campaignName:t,serviceName:i[0],_mask:f&~2147483648});else this.campaigns.push({name:t,campaignName:t.split("/")[1],serviceName:t.split("/")[0],_mask:f});r=this.campaigns[u];r.active=r._mask&2?!0:!1;r.boundness=r._mask&8?"Inbound":"Outbound"}this.campaigns.sort(function(n,t){return n.name<t.name?-1:n.name>t.name?1:0})};this.AgentListReply=function(n){var i=n.nextInt16(),t;for(this.agents=[],t=0;t<i;t++)this.agents.push({firstName:n.nextString(),lastName:n.nextString(),campaignName:n.nextString(),state:n.remainingBytes()>=4?n.nextInt32():0,time:n.remainingBytes()>=4?n.nextInt32():0});this.agents.sort(function(n,t){return n.lastName<t.lastName?-1:n.lastName>t.lastName?1:0})};this.CampaignQueueInfoReply=function(n){var f=n.nextInt16(),i;for(this.calls=0,this.avgTime=0,this.maxTime=0,this.campaigns=[],i=0;i<f;i++){var e=n.nextString(),t=n.nextInt32(),r=n.nextInt32(),u=n.nextInt32();this.campaigns.push({name:e,calls:t,avgTime:u,maxTime:r});this.calls+t>0&&(this.avgTime=(this.avgTime*this.calls+u*t)/(this.calls+t));r>this.maxTime&&(this.maxTime=r);this.calls+=t}};this.SetCampaignStatusReply=function(){};this.AbortCallReply=function(){};this.RetrieveCallReply=function(){};this.ReadyEvent=function(){};this.PauseEvent=function(n){n.remainingBytes()?(this.reasonId=n.nextInt32(),this.reasonText=n.nextString()):(this.reasonId=0,this.reasonText="")};this.AlertingEvent=function(n){this.callId=n.nextInt32()};this.AnsweredEvent=function(n){this.callId=n.nextInt32()};this.TerminatedEvent=function(n){this.callId=n.nextInt32();this.postCallWork=n.nextByte()};this.CallFailureEvent=function(n){this.callId=n.nextInt32();this.cause=n.nextByte();this.protocolTerminationCause=n.remainingBytes()>=4?n.nextInt32():0;this.protocolTerminationDescription=n.remainingBytes()>=2?n.nextString():"";this.detectedContentCode=n.remainingBytes()>=4?n.nextInt32():0;this.detectedContentDescription=n.remainingBytes()>=2?n.nextString():""};this.OtherCallEvent=function(){};this.PostCallWorkEvent=function(){};this.SupervisorMessageEvent=function(n){this.severity=n.nextInt16();this.message=n.nextString()};this.ReadyForTransferEvent=function(n){this.callId=n.nextInt32();this.campaignName=n.nextString();this.agentFirstName=n.nextString();this.agentLastName=n.nextString()};this.ReadyForDetachEvent=function(n){this.callId=n.nextInt32()};this.BookedEvent=function(n){this.campaignName=n.nextString();this.mediatype=n.remainingBytes()>=4?n.nextInt32():0};this.AudioRecordingStartedEvent=function(n){this.callId=n.nextInt32();this.fileName=n.nextString()};this.AudioRecordingMutedEvent=function(n){this.callId=n.nextInt32();this.txChannelMuted=n.nextByte()!==0?!0:!1;this.rxChannelMuted=n.nextByte()!==0?!0:!1};this.AudioRecordingCompletedEvent=function(n){this.callId=n.nextInt32();this.result=n.nextInt32()};this.PhoneBarToPhonesMessages={LoginRequest:8192,LogoutRequest:8193,ReadyRequest:8194,PauseRequest:8195,NewCallRequest:8197,TransferCallRequest:8198,CampaignListRequest:8199,AgentListRequest:8200,CampaignQueueInfoRequest:8201,SetCampaignStatusRequest:8202,LoginExRequest:8204,AbortCallRequest:8206,RetrieveCallRequest:8207,AssignmentReply:16388,KeepAliveReply:16639,AgentPanicEvent:32779,SetAgentScriptStateEvent:34826,SetCallResultEvent:34827,AgentNewCallEvent:34829,RemoteOffHookEvent:34830,RemoteOnHookEvent:34831,RemoteRingingEvent:34832,RemoteManualHangUpEvent:34835,DelcoTunnelMessageEvent:34836};this.DelcoTunnelMessages={ConsultationCallControlRequest:9218,StartAudioRecordingRequest:9219,StopAudioRecordingRequest:9220,SetAudioRecordingMuteRequest:9221,AppendCueSheetEntryRequest:9222};this.LoginRequest=function(n,t,i,r,u){var f=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.LoginRequest);return f.addString(n).addString(t).addString(i).addString(r).addByte(u||0).end(),f};this.LogoutRequest=function(){var n=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.LogoutRequest);return n.end(),n};this.ReadyRequest=function(n){var t=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.ReadyRequest);return t.addInt32(n).end(),t};this.PauseRequest=function(n){var t=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.PauseRequest);return n&&t.addByte(1).addInt32(n),t.end(),t};this.PauseReasonsRequest=function(){var n=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.PauseRequest);return n.addByte(3).addInt32(0).end(),n};this.NewCallRequest=function(n,t,i){var r=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.NewCallRequest);return r.addString(n).addString(t).addString(i).end(),r};this.TransferCallRequest=function(n,t,i,r,u,f,e){var o=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.TransferCallRequest);return o.addInt32(n).addInt32(t).addString(i).addString(r).addString(u).addString(f).addByte(e?1:0).end(),o};this.CampaignListRequest=function(n,t,i){var r=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.CampaignListRequest);return r.addInt32(n|2147483648).addInt32(i).addInt32(t).end(),r};this.AgentListRequest=function(n,t){var i=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.AgentListRequest);return i.addString(n).addInt32(t).end(),i};this.CampaignQueueInfoRequest=function(n){var t=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.CampaignQueueInfoRequest);return t.addString(n).addInt32(n?0:2).end(),t};this.SetCampaignStatusRequest=function(){};this.LoginExRequest=function(n,t,i,r,u,f){var e=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.LoginExRequest);return e.addString(n).addString(t).addString(i).addString(r).addString(u).addByte(f||0).end(),e};this.AbortCallRequest=function(n){var t=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.AbortCallRequest);return t.addInt32(n).end(),t};this.RetrieveCallRequest=function(){};this.AssignmentReply=function(n,t){var i=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.AssignmentReply);return i.addInt32(n).addByte(t).end(),i};this.KeepAliveReply=function(){var n=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.KeepAliveReply);return n.end(),n};this.AgentPanicEvent=function(){var n=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.AgentPanicEvent);return n.addByte(1).end(),n};this.SetAgentScriptStateEvent=function(n,t){var i=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.SetAgentScriptStateEvent);return i.addInt32(n).addString((t||0)+255).end(),i};this.SetCallResultEvent=function(n,t){var i=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.SetCallResultEvent);return i.addInt32(n).addString(t).end(),i};this.AgentNewCallEvent=function(){};this.RemoteOffHookEvent=function(){};this.RemoteOnHookEvent=function(){};this.RemoteRingingEvent=function(){};this.RemoteManualHangUpEvent=function(){};this.ConsultationCallControlRequest=function(n,t){var i=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.DelcoTunnelMessageEvent);return i.addInt32(n).addInt32(12).addInt16(Ifm.PhoneBar.Messages.DelcoTunnelMessages.ConsultationCallControlRequest).addByte(1).addByte(1).addInt32(4).addInt32(t).end(),i};this.StartAudioRecordingRequest=function(n,t,i){var r=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.DelcoTunnelMessageEvent);return r.addInt32(n).addInt32(19+t.length*2).addInt16(Ifm.PhoneBar.Messages.DelcoTunnelMessages.StartAudioRecordingRequest).addByte(1).addByte(1).addInt32(2+t.length*2).addUniString(t).addByte(1).addInt32(4).addInt32(i).end(),r};this.StopAudioRecordingRequest=function(n){var t=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.DelcoTunnelMessageEvent);return t.addInt32(n).addInt32(3).addInt16(Ifm.PhoneBar.Messages.DelcoTunnelMessages.StopAudioRecordingRequest).addByte(1).end(),t};this.SetAudioRecordingMuteRequest=function(n,t,i,r,u){var f=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.DelcoTunnelMessageEvent);return f.addInt32(n).addInt32(37+u.length*2).addInt16(Ifm.PhoneBar.Messages.DelcoTunnelMessages.SetAudioRecordingMuteRequest).addByte(1).addByte(1).addInt32(4).addBool32(t).addByte(1).addInt32(4).addBool32(i).addByte(1).addInt32(4).addBool32(r).addByte(1).addInt32(2+u.length*2).addUniString(u).end(),f};this.AppendCueSheetEntryRequest=function(n,t){var i=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.DelcoTunnelMessageEvent);return i.addInt32(n).addInt32(10+t.length*2).addInt16(Ifm.PhoneBar.Messages.DelcoTunnelMessages.AppendCueSheetEntryRequest).addByte(1).addByte(1).addInt32(2+t.length*2).addUniString(t).end(),i}}.call(Ifm.PhoneBar.Messages);namespace("Ifm.PhoneBar.Strings",{en:{UnloadPageConfirm:"If you leave the page, you close any conversation open and you won't be able to receive new calls!",NoBrowserSupport:"Your browser does not have the features needed to run the PhoneBar",Loading:"Loading",AccountLockedOut:"Your logon has been locked out. Contact the administrator.",CantChangePassword:"You're not authorized to change your password",InvalidNewPassword:"The new password doesn't meet security requirements",PasswordExpired:"Your password has expired, change it to log in",PasswordsDontMatch:"The new passwords don't match",UserOrExtensionTaken:"Logon credentials or extension already taken",WrongCredentials:"Invalid logon credentials",NotLoggedInState:"Not available",ConnectingState:"Connecting",LoggedInState:"Available",PausedState:"Paused",ReadyState:"Available",TalkingState:"Talking",PostCallState:"In post-call",OtherCallState:"Manual call",AssignedState:"Assigned",AlertingState:"Incoming call",WaitingOutboundState:"Dialing call",WaitingTransferState:"Waiting for transfer",PhoneNotConnected:"Phone not connected!",PhoneNotRegistered:"Phone not reachable!",ConnectionFailed:"Connection failed",ConnectionLost:"Connection lost",AssignmentBooked:"Booked",PauseBooked:"Pause booked",RequestRefused:"Request refused",CallFailure:"Call failure",GenericBusyState:"Busy",CallFailureNoDialTone:"no dial tone",CallFailureNoRingback:"no ringback",CallFailureLineBusy:"number busy",CallFailureNoAnswer:"no answer",CallFailureFaxTone:"fax",CallFailureRemoteHangUp:"hangup",CallFailureAgentNoDialTone:"no dial tone by the agent",CallFailureAgentNoRingback:"no ringback by the agent",CallFailureAgentBusy:"agent busy",CallFailureAgentNoAnswer:"no answer by the agent",CallFailureUnknown:"unknown cause",OutboundManualCall:"Manual call",PauseGenericReason:"Generic pause",TooltipLogin:"Log in",TooltipLoginOrReady:"Ready",TooltipReady:"Ready",TooltipPause:"Pause",TooltipLogout:"Log out",TooltipCall:"Call",TooltipTransfer:"Transfer window",TooltipQueueInfo:"Display queue info",TooltipCampaignList:"Display assigned campaigns",TooltipPanic:"HELP ME!",TooltipPhoneNumber:"Phone number",TooltipStartRec:"Start recording",TooltipStopRec:"Stop recording",TooltipMuteRec:"Suspend recording",TooltipUnmuteRec:"Resume recording",TooltipHangup:"Hang up",TooltipPickup:"Pick up",TooltipFlash:"Hold and retrieve",TooltipManualTransfer:"Manual transfer",TooltipMicVUMeter:"Microphone",TooltipSpkVUMeter:"Speakers",TooltipMicOff:"Turn microphone OFF",TooltipMicOn:"Turn microphone ON",TooltipLine1:"Line 1",TooltipLine2:"Line 2",TooltipEnterConf:"Join conference",TooltipLeaveConf:"Leave conference",ButtonOK:"OK",ButtonCancel:"Cancel",ButtonChangePassword:"Change Password...",ButtonRefresh:"Refresh",ButtonRetry:"Retry",ButtonTransfer:"Trasferisci",IncomingCallText:"INCOMING CALL!",UnknownCallingNumber:"Unknown Number",queuedAvgTimeText:"avg T",queuedMaxTimeText:"max T",queuedNumberText:"queued",LoginTitle:"Enter your credentials",LoginFirstName:"First name:",LoginLastName:"Last name:",LoginPassword:"Password:",LoginOldPassword:"Current password:",LoginNewPassword:"New password:",LoginConfirmPassword:"Confirm password:",LoginExtension:"Extension:",SupervisorTitle:"Supervisor Message",TransferTitle:"Call transfer",TransferCampaign:"Campaign:",TransferService:"Service:",TransferAnybody:"(Anybody)",TransferMandatory:"Transfer to the selected agent only"}});namespace("Ifm.PhoneBar.Strings",{it:{UnloadPageConfirm:"Se chiudi questa pagina, le conversazioni attive saranno perdute e non potrai ricevere nuove chiamate!",NoBrowserSupport:"Questo browser non ha le funzioni necessarie per la PhoneBar",Loading:"Caricamento",AccountLockedOut:"Il tuo accesso è stato sospeso. Contatta l'amministratore.",CantChangePassword:"Non sei autorizzato a modificare la tua password",InvalidNewPassword:"La nuova password non soddisfa i criteri di sicurezza",PasswordExpired:"La tua password è scaduta, cambiala per accedere",PasswordsDontMatch:"Le nuove password non corrispondono",UserOrExtensionTaken:"Credenziali di accesso o interno già in uso",WrongCredentials:"Credenziali di accesso non valide",NotLoggedInState:"Non disponibile",ConnectingState:"Connessione in corso",LoggedInState:"Disponibile",PausedState:"In pausa",ReadyState:"Disponibile",TalkingState:"In conversazione",PostCallState:"In post-chiamata",OtherCallState:"Chiamata manuale",AssignedState:"In assegnazione",AlertingState:"Chiamata in arrivo",WaitingOutboundState:"In generazione chiamata",WaitingTransferState:"In attesa di trasferimento",PhoneNotConnected:"Telefono non collegato!",PhoneNotRegistered:"Telefono non raggiungibile!",ConnectionFailed:"Connessione fallita",ConnectionLost:"Caduta connessione",AssignmentBooked:"In pre-assegnazione",PauseBooked:"Pausa prenotata",RequestRefused:"Richiesta rifiutata",CallFailure:"Chiamata fallita",GenericBusyState:"Impegnato/a",CallFailureNoDialTone:"nessun tono di chiamata",CallFailureNoRingback:"nessuno squillo",CallFailureLineBusy:"numero occupato",CallFailureNoAnswer:"nessuna risposta",CallFailureFaxTone:"fax",CallFailureRemoteHangUp:"riaggancio",CallFailureAgentNoDialTone:"nessun tono di chiamata sull'operatore",CallFailureAgentNoRingback:"nessuno squillo sull'operatore",CallFailureAgentBusy:"operatore occupato",CallFailureAgentNoAnswer:"nessuna risposta da operatore",CallFailureUnknown:"causa sconosciuta",OutboundManualCall:"Chiamata manuale",PauseGenericReason:"Pausa generica",TooltipLogin:"Accesso",TooltipLoginOrReady:"Disponibile",TooltipReady:"Disponibile",TooltipPause:"Pause",TooltipLogout:"Logout",TooltipCall:"Chiama",TooltipTransfer:"Finestra di trasferimento",TooltipQueueInfo:"Mostra stato code",TooltipCampaignList:"Mostra campagne assegnate",TooltipPanic:"AIUTO!",TooltipPhoneNumber:"Numero di telefono",TooltipStartRec:"Avvia registrazione",TooltipStopRec:"Ferma registrazione",TooltipMuteRec:"Sospendi registrazione",TooltipUnmuteRec:"Riprendi registrazione",TooltipHangup:"Aggancia",TooltipPickup:"Rispondi",TooltipFlash:"In attesa e riprendi",TooltipManualTransfer:"Trasferimento manuale",TooltipMicVUMeter:"Microfono",TooltipSpkVUMeter:"Cuffie",TooltipMicOff:"DISATTIVA microfono",TooltipMicOn:"ATTIVA microfono",TooltipLine1:"Linea 1",TooltipLine2:"Linea 2",TooltipEnterConf:"Avvia conferenza",TooltipLeaveConf:"Chiudi conferenza",ButtonOK:"OK",ButtonCancel:"Annulla",ButtonChangePassword:"Cambia Password...",ButtonRefresh:"Aggiorna",ButtonRetry:"Riprova",ButtonTransfer:"Trasferisci",IncomingCallText:"CHIAMATA IN ARRIVO!",UnknownCallingNumber:"Numero Sconosciuto",queuedAvgTimeText:"T medio",queuedMaxTimeText:"T max",queuedNumberText:"in coda",LoginTitle:"Immetti le tue credenziali",LoginFirstName:"Nome:",LoginLastName:"Cognome:",LoginPassword:"Password:",LoginOldPassword:"Password attuale:",LoginNewPassword:"Nuova password:",LoginConfirmPassword:"Conferma password:",LoginExtension:"Interno:",SupervisorTitle:"Messaggio del Supervisore",TransferTitle:"Trasferimento di chiamata",TransferCampaign:"Campagna:",TransferService:"Servizio:",TransferAnybody:"(Chiunque)",TransferMandatory:"Trasferisci solo all'agente selezionato"}});