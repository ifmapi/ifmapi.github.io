
//============================================================================

// Copyright © IFM Infomaster. All rights reserved.

//============================================================================

"use strict";function defineEvents(){for(var t,i={},n=0;n<arguments.length;n++){if(t=arguments[n],!Ifm.Type.isString(t))throw Ifm.Diagnostics.Errors.arg("name");createEventAccessors(i,t)}return i}function createEventAccessors(n,t){var i=new Ifm.Event;Object.defineProperty(n,t,{get:function(){return i},set:function(n){i.addHandler(n)}})}function namespace(n,t){for(var r,f,i=window,e=n.split("."),u=0;u<e.length;u++)r=e[u],i[r]=i[r]||{},i=i[r];for(f in t)i[f]=t[f];return i}function query(n){var i=n||window.location.search,t={};return i.replace(/[?&#]([^=]+)=([^&]*)?/g,function(n,i,r){return i&&(t[i]=r||""),""}),t}var global=global||window,T0,dT,Ifm;Object.defineProperty?Object.defineProperty(global,"T0",{value:+new Date}):T0=+new Date;dT=function(){return new Date-T0};Function.getName=function(n){if(!Ifm.Type.isFunction(n))throw Ifm.Diagnostics.Errors.func("func");var t=/function\s+(\w+)/.exec(n);return t&&t.length===2?t[1]:(t=/(\w+)\s*=\s*function/.exec(n),t&&t.length===2)?t[1]:"anonymous function"};Function.prototype.toShortString=function(){var n=this.toString().replace(/[\r|\n]/g,"").replace(/[\s]+/g," ");return n.substr(0,n.indexOf("{")).trim()};Array.pushArray=function(n,t){if(!Ifm.Type.isArray(n))throw Ifm.Diagnostics.Errors.arg("array1");if(!Ifm.Type.isArray(t))throw Ifm.Diagnostics.Errors.arg("array2");return Array.prototype.push.apply(n,t)};Array.prototype.find||Object.defineProperty(Array.prototype,"find",{enumerable:!1,value:function(n,t){if(!Ifm.Type.isFunction(n))throw Ifm.Diagnostics.Errors.func("func");for(var i=0,r=this.length;i<r;i++)if(i in this&&n.call(t,this[i],i,this))return this[i];return undefined}});window.ArrayBuffer&&(ArrayBuffer.fromBytes=function(n){for(var i=n.length,r=new ArrayBuffer(i),u=new Uint8Array(r),t=0;t<i;t++)u[t]=n[t];return r},ArrayBuffer.prototype.getBytes=function(){for(var t=new Uint8Array(this),i=[],n=0,r=t.length;n<r;n++)i.push(t[n]);return i});Object.entries||(Object.entries=function(n){var i=[];for(var t in n)n.hasOwnProperty(t)&&i.push([t,n[t]]);return i});Object.keys||(Object.keys=function(n){var t=[];for(var i in n)n.hasOwnProperty(i)&&t.push(i);return t});Object.values||(Object.values=function(n){var t=[];for(var i in n)n.hasOwnProperty(i)&&t.push(n[i]);return t});String.format=function(n){if(!n||!Ifm.Type.isString(n))return n;var t=Array.prototype.slice.call(arguments,1);return n.replace(/{(\d+)}/g,function(n,i){return typeof t[i]!="undefined"?t[i]:""})};String.prototype.format=function(){var n=[this];return Array.prototype.push.apply(n,arguments),String.format.apply(null,n)};String.prototype.startsWith||(String.prototype.startsWith=function(n,t){return t=t||0,this.substr(t,n.length)===n});String.prototype.endsWith||(String.prototype.endsWith=function(n,t){t=t||this.length;var i=Math.max(t-n.length,0);return this.slice(i,t)===n});String.prototype.indexAfter=function(n){var t=this.indexOf(n);return t+(t<0?0:n.length)};String.prototype.lastIndexAfter=function(n){var t=this.lastIndexOf(n);return t+(t<0?0:n.length)};Date.now||(Date.now=function(){return+new Date});Date.prototype.toISOString||function(){function n(n){var t=String(n);return t.length===1&&(t="0"+t),t}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+n(this.getUTCMonth()+1)+"-"+n(this.getUTCDate())+"T"+n(this.getUTCHours())+":"+n(this.getUTCMinutes())+":"+n(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}();Ifm=namespace("Ifm"),function(){Ifm.version="Ifm.js/1.0.0";this.Enum={};this.Enum.getName=function(n,t){for(var r,u=Object.getOwnPropertyNames(n),i=0,f=u.length;i<f;i++)if(r=u[i],n[r]===t)return r;return""};this.Enum.getLength=function(n){return Object.getOwnPropertyNames(n).length};this.Type={};this.Type.getTypeName=function(n){var i=Object.prototype.toString.call(n).slice(8,-1),t;return i==="Object"&&(t=n&&n.constructor&&n.constructor.toString().match(/function\s+([^\s]{1,})\s*\(/),t)?t[1]:i};this.Type.isArray=function(n){return Object.prototype.toString.call(n)==="[object Array]"};this.Type.isLikeArray=function(n){return typeof n=="object"&&!Ifm.Type.isString(n)&&typeof n.length=="number"&&!n.propertyIsEnumerable("length")};this.Type.isFunction=function(n){return typeof n=="function"};this.Type.isNumber=function(n){return typeof n=="number"};this.Type.isString=function(n){return typeof n=="string"||n instanceof String};this.Event=function(){if(!(this instanceof Ifm.Event))throw Ifm.Diagnostics.Errors.ctor();var n=[];return{constructor:Ifm.Event,addHandler:function(t,i){Ifm.Type.isFunction(t)&&n.push({f:t,o:i||null})},hasHandlers:function(){return n.length>0},removeAllHandlers:function(){n.length=0},removeHandler:function(t){for(var i=n.length;i--;)n[i].f===t&&n.splice(i,1)},raise:function(){for(var i=n.length,t;i--;)t=n[i],t.f.apply(t.o,arguments)}}}}.call(Ifm);namespace("Ifm.Diagnostics"),function(){this.Debug={};this.Debug.onprint=new Ifm.Event;this.Debug.enabled=!1;this.Debug.popupAssertions=!1;this.Debug.assert=function(n,t){if(Ifm.Diagnostics.Debug.enabled){if(Ifm.Type.isString(n)){try{var i=new Function("return "+n)();Ifm.Diagnostics.Debug.assert(i,n+" "+t)}catch(r){Ifm.Diagnostics.Debug.fail("Invalid assert condition: '"+n+"'\n"+r.message)}return}n||Ifm.Diagnostics.Debug.fail(t)}};this.Debug.fail=function n(t){if(Ifm.Diagnostics.Debug.enabled){var i=arguments[1],u=arguments[2]||n;if(!i)try{throw new Error("Assertion failed");}catch(r){i=r.stack||"[Callstack not available]"}window.console&&console.error&&console.error(t,i);Ifm.Diagnostics.Debug.popupAssertions&&alert(t+"\n\n----Stack----\n\n"+i)}};this.Debug.clear=function(){if(Ifm.Diagnostics.Debug.enabled){window.console&&console.clear&&console.clear();var n=document.getElementById("consoleview");n&&(n.innerHTML="")}};this.Debug.print=function(n){var t,i;Ifm.Diagnostics.Debug.enabled&&(t=arguments.length>1?Array.prototype.slice.call(arguments).join(" "):n&&n.toString()||null,t!==null)&&(window.console&&console.log&&console.log(t),Ifm.Diagnostics.Debug.onprint.raise(t),i=document.getElementById("consoleview"),i&&(i.innerHTML+=t+"<br>",i.scrollTop=i.scrollHeight))};this.Debug.printf=function(){Ifm.Diagnostics.Debug.enabled&&Ifm.Diagnostics.Debug.print(String.format.apply(null,arguments))};this.Errors=function(){function t(n,t){return new Error(n+(t?": '"+t+"'":""))}var n={};return n.arg=function(n){return t("Invalid function argument",n)},n.argsno=function(n){return t("Invalid number of function arguments",n)},n.ctor=function(n){return t("Invalid constructor call",n)},n.func=function(n){return t("Function argument expected",n)},n.miss=function(n){return t("Missing type or module",n)},n.notimpl=function(n){return t("Feature not implemented",n)},n.notsup=function(n){return t("Feature not supported",n)},n.op=function(n){return t("Invalid operation",n)},n}()}.call(Ifm.Diagnostics);namespace("Ifm");Ifm.Cookies={get:function(n){try{return document.cookie.replace(new RegExp("(?:(?:^|.*;\\s*)"+n+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1")}catch(t){return""}},"delete":function(n){try{document.cookie=n+"=;expires=Thu, 01-Jan-70 00:00:01 GMT;path=/"}catch(t){}},set:function(n,t){try{document.cookie=n+"="+t+";expires=Fri, 31 Dec 9999 23:59:59 GMT;path=/"}catch(i){}}};namespace("Ifm.Messaging"),function(){this.FMessage={HeaderLength:18,LengthPosition:16,ExtLenPosition:12,DataPosition:20,MessageHeaderId:1431655765};this.FMessageReader=function(n){if(!n)throw new Error("FMessageReader() -> Invalid message buffer");if(this._bytes=[],this._readingpos=0,n instanceof ArrayBuffer)this._bytes=n.getBytes();else if(n instanceof Array)this._bytes=n;else throw new Error("FMessageReader() -> Unsupported message data format: "+typeof n);if(this._bytes.length<Ifm.Messaging.FMessage.DataPosition)throw new Error("FMessageReader() -> Invalid message length: "+this._bytes.length);var t=this.nextInt32();if(t!==Ifm.Messaging.FMessage.MessageHeaderId)throw new Error("FMessageReader() -> Invalid FMessage signature: "+t.toString(16));if(this._readingpos=Ifm.Messaging.FMessage.LengthPosition,this.length=this.nextInt16(),this.length===0&&(this._readingpos=Ifm.Messaging.FMessage.ExtLenPosition,this.length=this.nextInt32(),this.length===0))throw new Error("FMessageReader() -> Invalid FMessage length");this._readingpos=Ifm.Messaging.FMessage.HeaderLength;this.code=this.nextInt16()};this.FMessageReader.prototype.remainingBytes=function(){return this._bytes.length-this._readingpos};this.FMessageReader.prototype.nextByte=function(){if(this._readingpos<this._bytes.length)return this._bytes[this._readingpos++];throw new Error("FMessageReader.nextByte() -> No more bytes to read: "+this._readingpos);};this.FMessageReader.prototype.nextBool=function(){return this.nextByte()===0?!1:!0};this.FMessageReader.prototype.nextBool32=function(){return this.nextInt32()===0?!1:!0};this.FMessageReader.prototype.nextInt16=function(){return(this.nextByte()<<8)+this.nextByte()};this.FMessageReader.prototype.nextInt32=function(){return(this.nextInt16()<<16)+this.nextInt16()};this.FMessageReader.prototype.nextInt64=function(){return(this.nextInt32()<<32)+this.nextInt32()};this.FMessageReader.prototype.nextString=function(){for(var i=this.nextInt16(),n=[],t=0;t<i;t++)n.push(this.nextByte());return String.fromCharCode.apply(null,n)};this.FMessageReader.prototype.nextUniString=function(){for(var i=this.nextInt16(),n=[],t=0;t<i;t++)n.push(this.nextByte()),n.push(this.nextByte()<<8);return String.fromCharCode.apply(null,n)};this.FMessageWriter=function(n){this._bytes=[];this._len=0;this.addInt32(Ifm.Messaging.FMessage.MessageHeaderId);this.addInt32(0);this.addInt32(0);this.addInt32(0);this.addInt16(0);this._len=0;this.addInt16(n);this.code=n};this.FMessageWriter.prototype.addByte=function(n){return this._bytes.push(n),this._len++,this};this.FMessageWriter.prototype.addBool=function(n){return this.addByte(n?1:0),this};this.FMessageWriter.prototype.addBool32=function(n){return this.addInt32(n?1:0),this};this.FMessageWriter.prototype.addInt16=function(n){return this.addByte((65280&n)>>8),this.addByte(255&n),this};this.FMessageWriter.prototype.addInt32=function(n){return this.addInt16((4294901760&n)>>16),this.addInt16(65535&n),this};this.FMessageWriter.prototype.addInt64=function(n){return this.addInt32((-4294967296&n)>>32),this.addInt32(4294967295&n),this};this.FMessageWriter.prototype.addString=function(n){var i=n&&n.length||0,t;for(this.addInt16(i),t=0;t<i;t++)this.addByte(n.charCodeAt(t));return this};this.FMessageWriter.prototype.addUniString=function(n){var i=n&&n.length||0,t;for(this.addInt16(i),t=0;t<i;t++)this.addByte(255&n.charCodeAt(t)),this.addByte((65280&n.charCodeAt(t))>>8);return this};this.FMessageWriter.prototype.end=function(){this._bytes[Ifm.Messaging.FMessage.LengthPosition]=(65280&this._len)>>8;this._bytes[Ifm.Messaging.FMessage.LengthPosition+1]=255&this._len};this.FMessageWriter.prototype.toArrayBuffer=function(){return ArrayBuffer.fromBytes(this._bytes)}}.call(Ifm.Messaging);namespace("Ifm.Messaging"),function(n){n.FStringMessage={MessageHeader:"*begin*",MessageTypeDel:"%%%",MessageFieldDel:"###",MessageFooter:"§end§",MinValidLength:16};n.FStringMessageReader=function(n){if(!(this instanceof Ifm.Messaging.FStringMessageReader))throw Ifm.Diagnostics.Errors.ctor("Ifm.Messaging.FStringMessageReader");if(!n)throw Ifm.Diagnostics.Errors.arg("messageBuffer");if(this._message="",this._readingpos=0,Ifm.Type.isString(n))this._message=n;else throw new Error("FStringMessageReader() -> Unsupported message data format: "+typeof n);if(this._message.length<Ifm.Messaging.FStringMessage.MinValidLength)throw new Error("FStringMessageReader() -> Invalid message length: "+this._message.length);if(!this._message.startsWith(Ifm.Messaging.FStringMessage.MessageHeader))throw new Error("FStringMessageReader() -> Invalid FStringMessage signature");var t=this._message.match(/^\*begin\*([A-z]*)%{3}/);if(t&&t.length==2)this.type=t[1];else throw new Error("FStringMessageReader() -> Invalid FStringMessage type format");if(t=this._message.match(/%{3}(.*)[\xA7|$]end[\xA7|$]/),t&&t.length==2)this.data=t[1].split(Ifm.Messaging.FStringMessage.MessageFieldDel);else throw new Error("FStringMessageReader() -> Invalid FStringMessage data format");};n.FStringMessageWriter=function(t){if(!(this instanceof Ifm.Messaging.FStringMessageWriter))throw Ifm.Diagnostics.Errors.ctor("Ifm.Messaging.FStringMessageWriter");if(!Ifm.Type.isString(t))throw Ifm.Diagnostics.Errors.arg("type");this.type=t;this._message=n.FStringMessage.MessageHeader+t+n.FStringMessage.MessageTypeDel};n.FStringMessageWriter.prototype.add=function(n){if(n===undefined||n===null)throw Ifm.Diagnostics.Errors.arg("str");return this._message.endsWith(Ifm.Messaging.FStringMessage.MessageTypeDel)||(this._message+=Ifm.Messaging.FStringMessage.MessageFieldDel),this._message+=n,this};n.FStringMessageWriter.prototype.end=function(){return this._message+=Ifm.Messaging.FStringMessage.MessageFooter,this};n.FStringMessageWriter.prototype.toString=function(){return this._message}}(Ifm.Messaging);namespace("Ifm.Messaging"),function(){this.FMessageBuilder=function(){if(!window.ArrayBuffer)throw new Error("FMessageBuilder() -> ArrayBuffer not supported");this.message=new Ifm.Event;this._buffer=[];this.toString=function(){return"[object FMessageBuilder]"}};this.FMessageBuilder.isSupported=function(){return window.ArrayBuffer?!0:!1};this.FMessageBuilder.prototype.append=function(n){if(n)if(n instanceof ArrayBuffer)Array.pushArray(this._buffer,n.getBytes());else if(n instanceof Array)Array.pushArray(this._buffer,n);else throw new Error("FMessageBuilder.append() -> Unsupported message data format: "+typeof n);else throw new Error("FMessageBuilder.append() -> Invalid message buffer");while(this._buffer.length>Ifm.Messaging.FMessage.HeaderLength){var t=new Ifm.Messaging.FMessageReader(this._buffer);if(Ifm.Messaging.FMessage.HeaderLength+t.length<=this._buffer.length){try{this.message.raise(this,{message:t})}catch(i){console.error(i);Ifm.Diagnostics.Debug.print(this,"Error dispatching or processing message:",i.message);Ifm.Diagnostics.Debug.print(i.stack)}this._buffer.splice(0,Ifm.Messaging.FMessage.HeaderLength+t.length)}}}}.call(Ifm.Messaging);namespace("Ifm.Messaging").FPropertyList=function(n){if(!(this instanceof Ifm.Messaging.FPropertyList))throw Ifm.Diagnostics.Errors.ctor();if(!n||!Ifm.Type.isString(n))throw Ifm.Diagnostics.Errors.arg("pliststr");n=n.trim();for(var t={},i=[],r,u=/{\s*([^\s{]*)\s*=\s*([^}]*)}/g;r=u.exec(n);)t[r[1]]=r[2],i.push(r[1]);this.originalString=n;this.get=function(n){if(!n||!Ifm.Type.isString(n))throw Ifm.Diagnostics.Errors.arg("key");return t[n]};this.keys=function(){var n=[];for(var i in t)n.push(i);return n};this.remove=function(n){if(!n||!Ifm.Type.isString(n))throw Ifm.Diagnostics.Errors.arg("key");if(t.hasOwnProperty(n)){delete t[n];for(var r=i.length;r--;)i[r]===n&&i.splice(r,1)}};this.set=function(n,r){if(!n||!Ifm.Type.isString(n))throw Ifm.Diagnostics.Errors.arg("key");t.hasOwnProperty(n)||i.push(n);t[n]=r};this.toString=function(){for(var r="{",n=0;n<i.length;n++)r+="{"+i[n]+" = "+t[i[n]]+"}";return r+"}"}};namespace("Ifm.Messaging"),function(){this.FPort=function(){if(!(this instanceof Ifm.Messaging.FPort))throw Ifm.Diagnostics.Errors.ctor();this.opened=new Ifm.Event;this.closed=new Ifm.Event;this.message=new Ifm.Event;this.toString=function(){return"[object FPort ("+(this._address||"not open")+")]"}};this.FPort.isSupported=function(){return global.WebSocket&&global.ArrayBuffer?!0:!1};this.FPort.prototype.isOpen=function(){return this._websocket&&this._websocket.readyState===WebSocket.OPEN};this.FPort.prototype.open=function(n){if(!window.WebSocket)throw new Error("FPort() -> WebSocket not supported");if(!window.ArrayBuffer)throw new Error("FPort() -> ArrayBuffer not supported");if(this._websocket&&this._websocket.readyState===WebSocket.OPEN)throw new Error("FPort.open() -> Invalid port state");if(!n)throw new Error("FPort.open() -> Invalid address");var t=this,i=new Ifm.Messaging.FMessageBuilder;i.message.addHandler(function(n,i){this.message.raise(t,{reader:i.message})},this);this._closedhere=!1;this._wasconnected=!1;this._gateway=!1;try{this._websocket=new WebSocket(n);this._websocket.binaryType="arraybuffer";this._address=n}catch(r){Ifm.Diagnostics.Debug.printf("FPort('{0}') connection failed: {1}",n,r.message);t.closed.raise(t,{clean:!1,failed:!0,lost:!1,reason:r.message});return}this._websocket.onmessage=function(r){if(Ifm.Type.isString(r.data)){if(r.data==="#gateway"){Ifm.Diagnostics.Debug.printf("FPort('{0}') connected through gateway",n);t._gateway=!0;return}if(r.data==="#ready"){Ifm.Diagnostics.Debug.printf("FPort('{0}') ready",n);t.opened.raise(t,{address:n,gateway:t._gateway});return}var u;try{u=new Ifm.Messaging.FStringMessageReader(r.data)}catch(f){Ifm.Diagnostics.Debug.printf("FPort('{0}') invalid message {1}",n,r.data);Ifm.Diagnostics.Debug.print(f);return}t.message.raise(t,{reader:u})}else r.data instanceof ArrayBuffer?i.append(r.data):Ifm.Diagnostics.Debug.printf("FPort('{0}') unknown message {1}",n,r.data)};this._websocket.onopen=function(){Ifm.Diagnostics.Debug.printf("FPort('{0}') open",n);t._wasconnected=!0};this._websocket.onclose=function(i){Ifm.Diagnostics.Debug.printf("FPort('{0}') closed {1}",n,t._wasconnected?t._closedhere?"":"- connection lost":"- connection failed");t.closed.raise(t,{clean:t._closedhere,failed:!t._wasconnected,lost:t._wasconnected&&!t._closedhere,reason:t._closedhere?"":"Connection to "+n+" "+(t._wasconnected?i.reason?i.reason:"lost":"failed")});delete t._address;delete t._websocket}};this.FPort.prototype.close=function(){this._websocket&&this._websocket.readyState==WebSocket.OPEN&&(this._closedhere=!0,this._websocket.close())};this.FPort.prototype.send=function(n){if(n&&this._websocket&&this._websocket.readyState==WebSocket.OPEN)if(n instanceof Ifm.Messaging.FMessageWriter)this._websocket.send(n.toArrayBuffer());else if(n instanceof Ifm.Messaging.FStringMessageWriter)this._websocket.send(n.toString());else throw new Error("Unsupported message format: "+n+" ("+Ifm.Type.getTypeName(n)+")");}}.call(Ifm.Messaging),function(){var n=namespace("Ifm.Messaging");n.FConnection=function(){if(!(this instanceof Ifm.Messaging.FConnection))throw Ifm.Diagnostics.Errors.ctor();var t=null;return{constructor:n.FConnection,events:defineEvents("connecting","connected","disconnecting","disconnected","binarymessage","stringmessage"),isSupported:function(){return t&&t.isSupported()?!0:!1},isConnected:function(){return t&&t.isOpen()?!0:!1},connect:function(n,i){if(this.isConnected())return!0;if(!n||Ifm.Type.isArray(n)&&n.length===0)throw Ifm.Diagnostics.Errors.arg("address");t=new Ifm.Messaging.FPort;t.opened.addHandler(function(n,t){t.gateway&&(this.events.connected.raise(this),Ifm.Type.isFunction(i)&&i())},this);t.closed.addHandler(function(t,r){if(r.failed&&Ifm.Type.isArray(n)&&n.length>1){this.connect(n.slice().splice(1),i);return}this.events.disconnected.raise(this,r)},this);t.message.addHandler(function(n,t){if(t.reader instanceof Ifm.Messaging.FStringMessageReader)this.events.stringmessage.raise(this,t);else if(t.reader instanceof Ifm.Messaging.FMessageReader)this.events.binarymessage.raise(this,t);else{Ifm.Diagnostics.Debug.fail("Invalid messageReader");return}},this);this.events.connecting.raise(this,{address:n});Ifm.Type.isArray(n)?t.open(n[0]):t.open(n)},disconnect:function(){if(!this.isConnected())return!0;this.events.disconnecting.raise(this);t.close()},send:function(n){if(!n)throw Ifm.Diagnostics.Errors.arg("message");if(!this.isConnected()){console.warn("[Ifm.Messaging.FConnection] Cannot send, not connected");return}t.send(n)}}}}();namespace("Ifm").PhoneBar={about:{product:"#phones",title:"#phonebar",version:"1.0.0"},events:defineEvents("initialized","booked","assignment","alerting","answered","callfailure","othercall","pause","ready","readyfordetach","readyfortransfer","terminated","audiorecordingstarted","audiorecordingmuted","audiorecordingcompleted","statechanged","statetimechanged","supervisormessage"),LoginReplyFailureCauses:{Unspecified:0,AccountLockout:1,ExpiredPassword:2,WrongUsernameOrPassword:3,InvalidNewPassword:4,PasswordChangeNotAllowed:5,WrongState:6,ExtensionTranslationError:128},Mediatypes:{Voice:1,NearRealTime:8,StoreAndForward:16},RecordingStates:{RecordingInactive:0,RecordingActive:1,TxChannelMuted:2,RxChannelMuted:4},States:{NotLoggedIn:"[Not Logged In]",Connecting:"[Connecting]",LoggedIn:"[Logged In]",Paused:"[Paused]",Ready:"[Ready]",Alerting:"[Alerting]",Talking:"[Talking]",PostCall:"[Post Call]",OtherCall:"[Other Call]",Assigned:"[Assigned]",WaitingOutbound:"[Waiting Outbound]",WaitingTransfer:"[Waiting Transfer]"},canRun:function(){return global&&global.WebSocket&&global.ArrayBuffer&&global.jQuery?!0:!1},instance:function(){function p(){if(Object.values(e).some(function(n){return n.postcall})){c(r.PostCall);u(i.PostCallState);return}if(Object.values(e).some(function(n){return!n.terminated})){c(r.Talking);u(i.TalkingState);return}c(r.Ready);u(i.ReadyState)}function c(i){var o=a,u,f;if(i!==o){n.log("PhoneBar","Debug","Changing state, from",o,"to",i);a=i;u=!1;f=!1;switch(i){case r.NotLoggedIn:jQuery([t.PauseButton,t.ReadyButton,t.LogoutButton,t.NumberLabel,t.NumberInput,t.CallButton,t.TransferButton,t.CampaignListButton,t.QueueInfoButton,t.PanicButton].join(", ")).disable();jQuery(t.LoginButton).enable();jQuery(t.LoginOrReadyButton).enable();jQuery(t.NumberInput).val("");u=!0;break;case r.Connecting:jQuery([t.LoginButton,t.LoginOrReadyButton].join(", ")).disable();break;case r.LoggedIn:case r.Ready:jQuery([t.PauseButton,t.LogoutButton,t.NumberLabel,t.NumberInput,t.CampaignListButton,t.QueueInfoButton,t.PanicButton].join(", ")).enable();jQuery([t.LoginButton,t.LoginOrReadyButton,t.ReadyButton,t.TransferButton].join(", ")).disable();jQuery(t.NumberInput).val("");u=!0;break;case r.Paused:jQuery(t.PauseButton).disable();jQuery([t.ReadyButton,t.LoginOrReadyButton].join(", ")).enable();u=!0;f=!0;break;case r.Talking:Object.values(e).some(function(n){return n.mediatype===Ifm.PhoneBar.Mediatypes.Voice})&&jQuery(t.TransferButton).enable();l||(u=!0,f=!0);break;case r.PostCall:Object.values(e).find(function(n){return n.mediatype===Ifm.PhoneBar.Mediatypes.Voice})&&jQuery([t.ReadyButton,t.LoginOrReadyButton].join(", ")).enable();break;case r.OtherCall:l||(u=!0,f=!0);break;case r.Assigned:break;case r.Alerting:break;case r.WaitingOutbound:break;case r.WaitingTransfer:break;default:n.log("PhoneBar","Debug","Unexpected state",i);return}h.statechanged.raise(n,{currentState:i,previousState:o});u&&(v=new Date,h.statetimechanged.raise(n,{stateTime:v,startTimer:f}),l&&(l=clearTimeout(l)),f&&(l=setInterval(function(){var n=new Date-v;jQuery(t.StateTimeText).html(d(n,!0))},1e3)),jQuery(t.StateTimeText).html(""))}}function u(n,i){jQuery(t.StateText).html(n);i?(jQuery(t.StateText).addClass("phonebar-state-error-text"),setTimeout(function(){jQuery(t.StateText).removeClass("phonebar-state-error-text");jQuery(t.StateText).html(w)},i)):w=n}function d(n,t){var r,u;t&&(n=n/1e3);r=Math.floor(n%60);n=n/60;u=Math.floor(n%60);n=n/60;var f=Math.floor(n%24),e=Math.floor(n/24),i="";return e>0&&(i+=e+" d "),f>0&&(i+=f+" h "),u>0&&(i+=u+" m "),r>0&&(i+=r+" s "),i}function g(){jQuery(t.LoginButton).attr("title",i.TooltipLogin);jQuery(t.LoginOrReadyButton).attr("title",i.TooltipLoginOrReady);jQuery(t.ReadyButton).attr("title",i.TooltipReady);jQuery(t.PauseButton).attr("title",i.TooltipPause);jQuery(t.LogoutButton).attr("title",i.TooltipLogout);jQuery(t.CallButton).attr("title",i.TooltipCall);jQuery(t.TransferButton).attr("title",i.TooltipTransfer);jQuery(t.CampaignListButton).attr("title",i.TooltipCampaignList);jQuery(t.QueueInfoButton).attr("title",i.TooltipQueueInfo);jQuery(t.PanicButton).attr("title",i.TooltipPanic)}var n,h,y,r,i,t,a="[Initialization]",w="",v=0,l,b={language:"it"},f=new Ifm.Messaging.FConnection,e={},s={login:[],logout:[],pause:[],ready:[],make:[],transfer:[],getAgentList:[],getCampaignList:[],getPauseReasons:[],getQueueInfo:[]},k={1:"[No Dial Tone]",2:"[No Ringback]",3:"[Line Busy]",4:"[No Answer]",5:"[Fax Tone]",6:"[Remote Hangup]",7:"[Agent: No Dial Tone]",8:"[Agent: No Ringback]",9:"[Agent: Line Busy]",10:"[Agent: No Answer]",255:"[Unknown]"},o={_root:"phonebar!",_agent:"agent!"};return o.agent={firstName:o._root+o._agent+"firstName",lastName:o._root+o._agent+"lastName",password:o._root+o._agent+"password",extension:o._root+o._agent+"extension"},f.events.connecting=function(){c(r.Connecting);u(i.ConnectingState)},f.events.disconnected=function(t,f){n.media.xmpp&&n.media.xmpp.isConnected()&&n.media.xmpp.disconnect();c(r.NotLoggedIn);f.clean||(f.failed?(n.log("Connection","Warn",f.reason),u(i.ConnectionFailed)):f.lost&&(n.log("Connection","Warn","Connection lost"),u(i.NotLoggedInState+" ("+i.ConnectionLost+")")))},f.events.binarymessage=function(t,o){var g=o.reader,l=null,y=Ifm.PhoneBar.Messages,b,v,w,nt;for(b in y.PhonesToPhoneBarMessages)if(g.code===y.PhonesToPhoneBarMessages[b]){l=new y[b](g);l.typecode=g.code;break}if(l===null){n.log("PhoneBar","Warn","Unknown message received:",g.code);return}if(l.typecode===y.PhonesToPhoneBarMessages.KeepAliveRequest){f.send(new y.KeepAliveReply);return}l.callId?n.log("PhoneBar","Debug","Got",b,"message, callId",l.callId):n.log("PhoneBar","Debug","Got",b,"message");switch(l.typecode){case y.PhonesToPhoneBarMessages.AssignmentRequest:var w=l.callId,d=new Ifm.Messaging.FPropertyList(l.callDataStr),tt=l.mediatype||d.get("_MediaType_")||1;d.save=function(){n.log("PhoneBar","Debug","Sending SetCallResultEvent message");f.send(y.SetCallResultEvent(w,d.toString()))};e[w]={callId:w,callGuid:d.get("GUID").toUpperCase(),mediatype:tt,campaignName:l.campaignName,callData:d,otherData:{serviceId:l.serviceId,campaignId:l.campaignId,recordingState:l.recordingState,recordingFileName:l.recordingFileName,recordingSettings:l.recordingSettings,scriptName:l.scriptName,scriptParameters:l.scriptParameters}};n.log("PhoneBar","Debug","Sending AssignmentReply message");f.send(new y.AssignmentReply(w,1));c(r.Assigned);u(i.AssignedState+" ("+l.campaignName+")");h.assignment.raise(n,e[w]);break;case y.PhonesToPhoneBarMessages.LoginReply:l.accepted===0?(u(i.NotLoggedInState),n.log("PhoneBar","Warn","Login request refused"),u(i.RequestRefused,1e3),f.disconnect()):(n.agent.id=l.agentId,c(r.LoggedIn),u(i.LoggedInState),n.media.xmpp&&n.media.xmpp.connect());v=s.login.shift();v&&v(l);break;case y.PhonesToPhoneBarMessages.LogoutReply:l.accepted===0?(n.log("PhoneBar","Warn","Logout request refused"),u(i.RequestRefused,1e3)):(c(r.NotLoggedIn),u(i.NotLoggedInState),delete n.agent.id,f.disconnect());v=s.logout.shift();v&&v(l);break;case y.PhonesToPhoneBarMessages.PauseReply:switch(l.accepted){case 0:n.log("PhoneBar","Warn","Pause request refused");u(i.RequestRefused,1e3);break;case 1:c(r.Paused);l.reasonId===0?u(i.PausedState):u(i.PausedState+" ("+l.reasonText+")");break;case 2:n.log("PhoneBar","Info","Pause booked");u(i.PauseBooked,1e3)}l.accepted===3?(v=s.getPauseReasons.shift(),v&&v({reasons:l.reasons})):(v=s.pause.shift(),v&&v(l));break;case y.PhonesToPhoneBarMessages.ReadyReply:l.accepted===0?(n.log("PhoneBar","Warn","Ready request refused"),u(i.RequestRefused,1e3)):l.callId?(e[l.callId].postcall=!1,e[l.callId].terminated=!0,p(l.callId)):(c(r.Ready),u(i.ReadyState));v=s.ready.shift();v&&v(l);l.accepted===1&&(h.ready.raise(n,{callId:l.callId||null}),l.callId&&delete e[l.callId]);break;case y.PhonesToPhoneBarMessages.NewCallReply:l.accepted===0?(n.log("PhoneBar","Warn","New call request refused"),u(i.RequestRefused,1e3)):n.log("PhoneBar","Info","New call request accepted, callId "+l.callId);v=s.make.shift();v&&v(l);break;case y.PhonesToPhoneBarMessages.TransferCallReply:l.accepted===0?(n.log("PhoneBar","Warn","Transfer call request refused"),u(i.RequestRefused,1e3)):(n.log("PhoneBar","Info","Transfer call request accepted, callId "+l.callId),h.readyfortransfer.raise(n,l));v=s.transfer.shift();v&&v(l);break;case y.PhonesToPhoneBarMessages.AgentListReply:v=s.getAgentList.shift();v&&v(l);break;case y.PhonesToPhoneBarMessages.CampaignListReply:v=s.getCampaignList.shift();v&&v(l);break;case y.PhonesToPhoneBarMessages.CampaignQueueInfoReply:v=s.getQueueInfo.shift();v&&v(l);break;case y.PhonesToPhoneBarMessages.BookedEvent:u(i.AssignmentBooked);h.booked.raise(n,l);break;case y.PhonesToPhoneBarMessages.AlertingEvent:c(r.Alerting);u(i.AlertingState);h.alerting.raise(n,l);break;case y.PhonesToPhoneBarMessages.AnsweredEvent:c(r.Talking);u(i.TalkingState);h.answered.raise(n,l);break;case y.PhonesToPhoneBarMessages.CallFailureEvent:n.log("PhoneBar","Warn","Call failure: callId",l.callId,"cause",l.cause,k[l.cause],"ISDN code",l.protocolTerminationCause);h.callfailure.raise(n,l);delete e[l.callId];break;case y.PhonesToPhoneBarMessages.OtherCallEvent:c(r.OtherCall);u(i.OtherCallState);h.othercall.raise(n,l);break;case y.PhonesToPhoneBarMessages.PauseEvent:c(r.Paused);l.reasonId===0?u(i.PausedState):u(i.PausedState+" ("+l.reasonText+")");h.pause.raise(n,l);break;case y.PhonesToPhoneBarMessages.ReadyEvent:c(r.Ready);u(i.ReadyState);h.ready.raise(n,{callId:null});break;case y.PhonesToPhoneBarMessages.ReadyForDetachEvent:w=l.callId;h.readyfordetach.raise(n,l);e[w]&&(e[w].terminated=!0,e[w].transfer&&delete e[w]);a!==r.Paused&&p(w);break;case y.PhonesToPhoneBarMessages.ReadyForTransferEvent:h.readyfortransfer.raise(n,l);break;case y.PhonesToPhoneBarMessages.SupervisorMessageEvent:h.supervisormessage.raise(n,l);break;case y.PhonesToPhoneBarMessages.TerminatedEvent:w=l.callId;nt=l.postCallWork===1?!0:!1;e[w].terminated=!0;nt?(e[w].postcall=!0,c(r.PostCall),u(i.PostCallState)):a!==r.Paused&&p(w);h.terminated.raise(n,l);nt||delete e[w];break;default:n.log("PhoneBar","Debug","Not implemented:",b)}},{calls:function(n){var t=typeof n=="function"?n:null,i;return arguments.length>0&&t===null?e[n]||null:(i=Object.values(e),t)?i.filter(t):i},currentState:function(){return a},currentStateTime:function(){return v},language:function(t){if(arguments.length===0)return b.language;t&&Ifm.PhoneBar.Strings[t]&&(i=Ifm.PhoneBar.Strings[t],b.language=t,g(),n.log("PhoneBar","Debug","Language set to",t))},isLoggedIn:function(){return n.connection.isConnected()},initialize:function(f,e){if(n=this,y=f,n.initialize=function(){},h=Ifm.PhoneBar.events,r=Ifm.PhoneBar.States,i=Ifm.PhoneBar.Strings[f.language]||Ifm.PhoneBar.Strings.it,Ifm.Diagnostics.Debug.enabled=custom.config.debug||!0,!Ifm.PhoneBar.canRun())throw new Error(i.NoBrowserSupport);t=Ifm.PhoneBar.UI.Elements;Ifm.version=Ifm.PhoneBar.about.title+"/"+Ifm.PhoneBar.about.version+"; "+Ifm.version;n.log("PhoneBar","Info",Ifm.version);jQuery.fn.extend({enable:function(){return this.each(function(){jQuery(this).prop("disabled",!1);jQuery(this).removeAttr("disabled")})},disable:function(){return this.each(function(){jQuery(this).prop("disabled",!0);jQuery(this).attr("disabled","")})}});jQuery(t.NumberInput).attr("maxlength",255);Ifm.PhoneBar.Media.Xmpp.instance&&custom.xmppconfig&&custom.xmppconfig.service&&(n.media.xmpp=Ifm.PhoneBar.Media.Xmpp.instance,n.media.xmpp.initialize(n,custom.xmppconfig));c(r.NotLoggedIn);u(i.NotLoggedInState);for(var s in e)n.options[s]&&n.options[s](e[s]);n.options.rememberCredentials()&&(n.agent.firstName=Ifm.Cookies.get(o.agent.firstName),n.agent.lastName=Ifm.Cookies.get(o.agent.lastName),n.agent.password=Ifm.Cookies.get(o.agent.password),n.agent.extension=Ifm.Cookies.get(o.agent.extension));h.initialized.raise(n,{config:f,options:e})},login:function(t,i,r,u,e){if(arguments.length<4||arguments.length>5)throw Ifm.Diagnostics.Errors.argsno("4 (+1)");if(e&&!Ifm.Type.isFunction(e))throw Ifm.Diagnostics.Errors.func("callback");if(n.connection.isConnected())throw Ifm.Diagnostics.Errors.op("already logged in");n.agent.firstName=t;n.agent.lastName=i;n.agent.password=r;n.agent.extension=u;n.options.rememberCredentials()&&(Ifm.Cookies.set(o.agent.firstName,t),Ifm.Cookies.set(o.agent.lastName,i),Ifm.Cookies.set(o.agent.extension,u));n.options.rememberCredentials()===2&&Ifm.Cookies.set(o.agent.password,r);n.log("PhoneBar","Info","Loggin'in to",y.service,"as",t,i,"ext.",u);f.connect(y.service,function(){e&&s.login.push(e);n.log("PhoneBar","Debug","Sending LoginRequest message");f.send(new Ifm.PhoneBar.Messages.LoginRequest(n.agent.firstName,n.agent.lastName,n.agent.password,n.agent.extension.toString()))})},logout:function(t){if(arguments.length>1)throw Ifm.Diagnostics.Errors.argsno("0 (+1)");if(t&&!Ifm.Type.isFunction(t))throw Ifm.Diagnostics.Errors.func("callback");t&&s.logout.push(t);n.log("PhoneBar","Debug","Sending LogoutRequest message");f.send(new Ifm.PhoneBar.Messages.LogoutRequest)},pause:function(t,i){if(arguments.length>2)throw Ifm.Diagnostics.Errors.argsno("0 (+2)");if(i&&!Ifm.Type.isFunction(i))throw Ifm.Diagnostics.Errors.func("callback");i&&s.pause.push(i);n.log("PhoneBar","Debug","Sending PauseRequest message");f.send(new Ifm.PhoneBar.Messages.PauseRequest(t))},ready:function(t,i){if(arguments.length>2)throw Ifm.Diagnostics.Errors.argsno("0 (+2)");if(i&&!Ifm.Type.isFunction(i))throw Ifm.Diagnostics.Errors.func("callback");i&&s.ready.push(i);n.log("PhoneBar","Debug","Sending ReadyRequest message");f.send(new Ifm.PhoneBar.Messages.ReadyRequest(t))},makeCall:function(t,i,r,u){if(arguments.length<3||arguments.length>4)throw Ifm.Diagnostics.Errors.argsno("3 (+1)");if(u&&!Ifm.Type.isFunction(u))throw Ifm.Diagnostics.Errors.func("callback");u&&s.make.push(u);n.log("PhoneBar","Debug","Sending NewCallRequest message");f.send(new Ifm.PhoneBar.Messages.NewCallRequest(t,i,r))},transferCall:function(t,i,r,u,o,h,c){if(arguments.length<2||arguments.length>7)throw Ifm.Diagnostics.Errors.argsno("2 (+5)");if(c&&!Ifm.Type.isFunction(c))throw Ifm.Diagnostics.Errors.func("callback");c&&s.transfer.push(c);var l=e[t]&&e[t].callData.toString();n.log("PhoneBar","Debug","Sending TransferCallRequest message");f.send(new Ifm.PhoneBar.Messages.TransferCallRequest(t,h||1,i,l,r,u,o))},getAgentList:function(t,i,r){if(arguments.length!==3)throw Ifm.Diagnostics.Errors.argsno("3");if(!Ifm.Type.isFunction(r))throw Ifm.Diagnostics.Errors.func("callback");s.getAgentList.push(r);n.log("PhoneBar","Debug","Sending AgentListRequest message");f.send(new Ifm.PhoneBar.Messages.AgentListRequest(t,i))},getCampaignList:function(t,i,r,u){if(arguments.length!==4)throw Ifm.Diagnostics.Errors.argsno("4");if(!Ifm.Type.isFunction(u))throw Ifm.Diagnostics.Errors.func("callback");s.getCampaignList.push(u);n.log("PhoneBar","Debug","Sending CampaignListRequest message");f.send(new Ifm.PhoneBar.Messages.CampaignListRequest(r,t,i))},getPauseReasons:function(t){if(arguments.length!==1)throw Ifm.Diagnostics.Errors.argsno("1");if(!Ifm.Type.isFunction(t))throw Ifm.Diagnostics.Errors.func("callback");s.getPauseReasons.push(t);n.log("PhoneBar","Debug","Sending PauseReasonsRequest message");f.send(new Ifm.PhoneBar.Messages.PauseReasonsRequest)},getQueueInfo:function(t,i){if(arguments.length!==2)throw Ifm.Diagnostics.Errors.argsno("2");if(!Ifm.Type.isFunction(i))throw Ifm.Diagnostics.Errors.func("callback");s.getQueueInfo.push(i);n.log("PhoneBar","Debug","Sending CampaignQueueInfoRequest message");f.send(new Ifm.PhoneBar.Messages.CampaignQueueInfoRequest(t))},panic:function(){if(arguments.length!==0)throw Ifm.Diagnostics.Errors.argsno("0");n.log("PhoneBar","Debug","Sending AgentPanicEvent message");f.send(new Ifm.PhoneBar.Messages.AgentPanicEvent)},log:function(n,i){if(arguments.length<3)throw Ifm.Diagnostics.Errors.argsno("3+");var r="",f=new Date,e=f.toLocaleTimeString()+"."+("000"+f.getMilliseconds()).slice(-3),u=i.toLowerCase();u==="info"?u="log":u==="info"&&(u="error");n&&(r+="["+n+"] ");i&&(r+="["+i+"] ");r+=Array.prototype.splice.call(arguments,2).join(" ");try{console[u](r)}catch(o){console.log(r)}jQuery(t.LogText).append("<div class='phonebar-log-text-"+i.toLowerCase()+"'><span class='phonebar-log-text-timestamp'>"+e+" <\/span><span class='phonebar-log-text-line'>"+r+"<\/span><\/div>").parent().scrollTop(jQuery(t.LogText).height())},agent:{firstName:"",lastName:"",password:"",extension:""},connection:{events:f.events,isConnected:function(){return f.isConnected()},_getConnection:function(){return f}},media:{},options:function(){var e="",s=1,h=1,c=1,t=!1,r=!1,n=!1,u=!1,f=!1,l=/INPUT|SELECT|TEXTAREA/i;jQuery(document).on("keydown keyup",function(t){if(t.which===8&&!t.ctrlKey&&!t.shiftKey&&!t.altkey&&r){var i=t.target;if(!l.test(i.tagName)||i.disabled||i.readOnly)return!1}return t.which===82&&t.ctrlKey&&n?!1:t.which===116&&(!t.ctrlKey&&u||t.ctrlKey&&n)?!1:void 0});jQuery(document).on("contextmenu",function(){return f?!1:!0});jQuery(window).on("beforeunload",function(){if(t)return i.UnloadPageConfirm});return{callingNumber:function(n){if(n==undefined)return e;e=n},rememberCredentials:function(n){if(n==undefined)return s;(n===0||n===1||n===2)&&(s=n);n===0&&(Ifm.Cookies.delete(o.agent.firstName),Ifm.Cookies.delete(o.agent.lastName),Ifm.Cookies.delete(o.agent.password),Ifm.Cookies.delete(o.agent.extension))},loginOnStart:function(n){if(n==undefined)return h;(n===0||n===1||n===2)&&(h=n)},popupIncomingCalls:function(n){if(n==undefined)return c;Ifm.Type.isNumber(n)&&(c=n)},confirmNavigation:function(n){if(n==undefined)return t;t=n?!0:!1},preventBackspace:function(n){if(n==undefined)return r;r=n?!0:!1},preventHardRefresh:function(t){if(t==undefined)return n;n=t?!0:!1},preventRefresh:function(n){if(n==undefined)return u;u=n?!0:!1},preventRightClick:function(n){if(n==undefined)return f;f=n?!0:!1}}}()}}()};namespace("Ifm.PhoneBar").UI={Elements:{MainToolbar:".phonebar-toolbar",LogText:".phonebar-log-text",StateText:".phonebar-state-text",StateTimeText:".phonebar-state-time-text",NumberLabel:".phonebar-number-label",NumberInput:".phonebar-number-input",LoginButton:".phonebar-login-button",LoginOrReadyButton:".phonebar-login-ready-button",ReadyButton:".phonebar-ready-button",PauseButton:".phonebar-pause-button",LogoutButton:".phonebar-logout-button",CallButton:".phonebar-call-button",TransferButton:".phonebar-transfer-button",CampaignListButton:".phonebar-campaignlist-button",QueueInfoButton:".phonebar-queueinfo-button",PanicButton:".phonebar-panic-button",TransferCampaignList:".phonebar-transfer-campaign-list",TransferAgentList:".phonebar-transfer-agent-list",TransferMandatoryCheck:".phonebar-transfer-mandatory-check"}};namespace("Ifm.PhoneBar.Media");namespace("Ifm.PhoneBar.Media.Xmpp");namespace("Ifm.PhoneBar.Media.Xmpp.events");namespace("Ifm.PhoneBar.Messages"),function(){this.PhonesToPhoneBarMessages={AssignmentRequest:12292,KeepAliveRequest:12543,LoginReply:20480,LogoutReply:20481,ReadyReply:20482,PauseReply:20483,NewCallReply:20485,TransferCallReply:20486,CampaignListReply:20487,AgentListReply:20488,CampaignQueueInfoReply:20489,SetCampaignStatusReply:20490,AbortCallReply:20494,RetrieveCallReply:20495,ReadyEvent:36866,PauseEvent:36867,AlertingEvent:38912,AnsweredEvent:38913,TerminatedEvent:38914,CallFailureEvent:38915,OtherCallEvent:38916,PostCallWorkEvent:38917,SupervisorMessageEvent:38919,ReadyForTransferEvent:38920,ReadyForDetachEvent:38921,BookedEvent:38924,AudioRecordingStartedEvent:38933,AudioRecordingMutedEvent:38934,AudioRecordingCompletedEvent:38935};this.AssignmentRequest=function(n){this.callId=n.nextInt32();this.rejectable=n.nextByte();this.campaignName=n.nextString();this.scriptName=n.nextString();this.scriptParameters=n.nextString();this.callDataStr=n.nextString();this.dummy=n.nextByte();this.cfgVersion=n.nextString();this.serviceId=n.nextString();this.campaignId=n.nextString();this.recordingState=n.remainingBytes()>=1?n.nextByte():0;this.recordingFileName=n.remainingBytes()>=2?n.nextString():"";this.recordingSettings=n.remainingBytes()>=4?n.nextInt32():0;this.mediatype=n.remainingBytes()>=4?n.nextInt32():0};this.KeepAliveRequest=function(){};this.LoginReply=function(n){this.accepted=n.nextByte();n.remainingBytes()&&(this.agentId=n.nextString(),n.nextString(),this.failureCause=n.nextByte())};this.LogoutReply=function(n){this.accepted=n.nextByte()};this.ReadyReply=function(n){this.accepted=n.nextByte();this.callId=n.remainingBytes()>=4?n.nextInt32():null};this.PauseReply=function(n){var i,t,r,u;if(this.accepted=n.nextByte(),this.accepted===1&&n.remainingBytes()?(this.reasonId=n.nextInt32(),this.reasonText=n.nextString()):this.accepted!==3&&(this.reasonId=0,this.reasonText=""),this.accepted===3)for(i=n.nextInt32(),this.reasons=[],t=0;t<i;t++)r=n.nextInt32(),u=n.nextString(),this.reasons.push({id:r,text:u})};this.NewCallReply=function(n){this.callId=n.nextInt32();this.accepted=n.nextByte()};this.TransferCallReply=function(n){this.callId=n.nextInt32();this.accepted=n.nextByte()};this.CampaignListReply=function(n){var e=n.nextInt16(),f,t,r,i,u;for(this.campaigns=[],f=0;f<e;f++)if(t=n.nextString(),r=n.nextInt32()&2147483679,r&2147483648)for(i=t.split("\t"),u=1;u<i.length;u++)t=i[u].slice(0,-1),this.campaigns.push({name:i[0]+"/"+t,campaignName:t,serviceName:i[0],mask:r&~2147483648});else this.campaigns.push({name:t,campaignName:t.split("/")[1],serviceName:t.split("/")[0],mask:r})};this.AgentListReply=function(n){var i=n.nextInt16(),t;for(this.agents=[],t=0;t<i;t++)this.agents.push({firstName:n.nextString(),lastName:n.nextString(),campaignName:n.nextString(),state:n.remainingBytes()>=4?n.nextInt32():0,time:n.remainingBytes()>=4?n.nextInt32():0})};this.CampaignQueueInfoReply=function(n){var f=n.nextInt16(),i;for(this.calls=0,this.avgTime=0,this.maxTime=0,this.campaigns=[],i=0;i<f;i++){var e=n.nextString(),t=n.nextInt32(),u=n.nextInt32(),r=n.nextInt32();this.campaigns.push({name:e,calls:t,avgTime:u,maxTime:r});this.calls+t>0&&(this.avgTime=(this.avgTime*this.calls+u*t)/(this.calls+t));r>this.maxTime&&(this.maxTime=r);this.calls+=t}};this.SetCampaignStatusReply=function(){};this.AbortCallReply=function(){};this.RetrieveCallReply=function(){};this.ReadyEvent=function(){};this.PauseEvent=function(n){n.remainingBytes()?(this.reasonId=n.nextInt32(),this.reasonText=n.nextString()):(this.reasonId=0,this.reasonText="")};this.AlertingEvent=function(n){this.callId=n.nextInt32()};this.AnsweredEvent=function(n){this.callId=n.nextInt32()};this.TerminatedEvent=function(n){this.callId=n.nextInt32();this.postCallWork=n.nextByte()};this.CallFailureEvent=function(n){this.callId=n.nextInt32();this.cause=n.nextByte();this.protocolTerminationCause=n.remainingBytes()>=4?n.nextInt32():0};this.OtherCallEvent=function(){};this.PostCallWorkEvent=function(){};this.SupervisorMessageEvent=function(n){this.severity=n.nextInt16();this.message=n.nextString()};this.ReadyForTransferEvent=function(n){this.callId=n.nextInt32();this.campaignName=n.nextString();this.agentFirstName=n.nextString();this.agentLastName=n.nextString()};this.ReadyForDetachEvent=function(n){this.callId=n.nextInt32()};this.BookedEvent=function(n){this.campaignName=n.nextString();this.mediatype=n.remainingBytes()>=4?n.nextInt32():0};this.AudioRecordingStartedEvent=function(n){this.callId=n.nextInt32();this.fileName=n.nextString()};this.AudioRecordingMutedEvent=function(n){this.callId=n.nextInt32();this.txChannelMuted=n.nextByte();this.rxChannelMuted=n.nextByte()};this.AudioRecordingCompletedEvent=function(n){this.callId=n.nextInt32();this.result=n.nextInt32()};this.PhoneBarToPhonesMessages={LoginRequest:8192,LogoutRequest:8193,ReadyRequest:8194,PauseRequest:8195,NewCallRequest:8197,TransferCallRequest:8198,CampaignListRequest:8199,AgentListRequest:8200,CampaignQueueInfoRequest:8201,SetCampaignStatusRequest:8202,LoginExRequest:8204,AbortCallRequest:8206,RetrieveCallRequest:8207,AssignmentReply:16388,KeepAliveReply:16639,AgentPanicEvent:32779,SetAgentScriptStateEvent:34826,SetCallResultEvent:34827,AgentNewCallEvent:34829,RemoteOffHookEvent:34830,RemoteOnHookEvent:34831,RemoteRingingEvent:34832,RemoteManualHangUpEvent:34835,DelcoTunnelMessageEvent:34836};this.DelcoTunnelMessages={ConsultationCallControlRequest:9218,StartAudioRecordingRequest:9219,StopAudioRecordingRequest:9220,SetAudioRecordingMuteRequest:9221,AppendCueSheetEntryRequest:9222};this.LoginRequest=function(n,t,i,r){var u=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.LoginRequest);return u.addString(n).addString(t).addString(i).addString(r).end(),u};this.LogoutRequest=function(){var n=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.LogoutRequest);return n.end(),n};this.ReadyRequest=function(n){var t=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.ReadyRequest);return t.addInt32(n).end(),t};this.PauseRequest=function(n){var t=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.PauseRequest);return n&&t.addByte(1).addInt32(n),t.end(),t};this.PauseReasonsRequest=function(){var n=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.PauseRequest);return n.addByte(3).addInt32(0).end(),n};this.NewCallRequest=function(n,t,i){var r=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.NewCallRequest);return r.addString(n).addString(t).addString(i).end(),r};this.TransferCallRequest=function(n,t,i,r,u,f,e){var o=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.TransferCallRequest);return o.addInt32(n).addInt32(t).addString(i).addString(r).addString(u).addString(f).addByte(e?1:0).end(),o};this.CampaignListRequest=function(n,t,i){var r=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.CampaignListRequest);return r.addInt32(n|2147483648).addInt32(i).addInt32(t).end(),r};this.AgentListRequest=function(n,t){var i=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.AgentListRequest);return i.addString(n).addInt32(t).end(),i};this.CampaignQueueInfoRequest=function(n){var t=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.CampaignQueueInfoRequest);return t.addString(n).addInt32(n?0:2).end(),t};this.SetCampaignStatusRequest=function(){};this.LoginExRequest=function(){};this.AbortCallRequest=function(){};this.RetrieveCallRequest=function(){};this.AssignmentReply=function(n,t){var i=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.AssignmentReply);return i.addInt32(n).addByte(t).end(),i};this.KeepAliveReply=function(){var n=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.KeepAliveReply);return n.end(),n};this.AgentPanicEvent=function(){var n=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.AgentPanicEvent);return n.addByte(1).end(),n};this.SetAgentScriptStateEvent=function(){};this.SetCallResultEvent=function(n,t){var i=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.SetCallResultEvent);return i.addInt32(n).addString(t).end(),i};this.AgentNewCallEvent=function(){};this.RemoteOffHookEvent=function(){};this.RemoteOnHookEvent=function(){};this.RemoteRingingEvent=function(){};this.RemoteManualHangUpEvent=function(){};this.ConsultationCallControlRequest=function(n,t){var i=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.DelcoTunnelMessageEvent);return i.addInt32(n).addInt32(12).addInt16(Ifm.PhoneBar.Messages.DelcoTunnelMessages.ConsultationCallControlRequest).addByte(1).addByte(1).addInt32(4).addInt32(t).end(),i};this.StartAudioRecordingRequest=function(n,t,i){var r=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.DelcoTunnelMessageEvent);return r.addInt32(n).addInt32(19+t.length*2).addInt16(Ifm.PhoneBar.Messages.DelcoTunnelMessages.StartAudioRecordingRequest).addByte(1).addByte(1).addInt32(2+t.length*2).addUniString(t).addByte(1).addInt32(4).addInt32(i).end(),r};this.StopAudioRecordingRequest=function(n){var t=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.DelcoTunnelMessageEvent);return t.addInt32(n).addInt32(3).addInt16(Ifm.PhoneBar.Messages.DelcoTunnelMessages.StopAudioRecordingRequest).addByte(1).end(),t};this.SetAudioRecordingMuteRequest=function(n,t,i,r,u){var f=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.DelcoTunnelMessageEvent);return f.addInt32(n).addInt32(37+u.length*2).addInt16(Ifm.PhoneBar.Messages.DelcoTunnelMessages.SetAudioRecordingMuteStateRequest).addByte(1).addByte(1).addInt32(4).addBool32(t).addByte(1).addInt32(4).addInt32(i).addByte(1).addInt32(4).addInt32(r).addByte(1).addInt32(2+u.length*2).addUniString(u).end(),f};this.AppendCueSheetEntryRequest=function(n,t){var i=new Ifm.Messaging.FMessageWriter(Ifm.PhoneBar.Messages.PhoneBarToPhonesMessages.DelcoTunnelMessageEvent);return i.addInt32(n).addInt32(10+t.length*2).addInt16(Ifm.PhoneBar.Messages.DelcoTunnelMessages.AppendCueSheetEntryRequest).addByte(1).addByte(1).addInt32(2+t.length*2).addUniString(t).end(),i}}.call(Ifm.PhoneBar.Messages);namespace("Ifm.PhoneBar.Strings",{en:{UnloadPageConfirm:"If you leave the page, you close any conversation open and you won't be able to receive new calls!",NoBrowserSupport:"Your browser does not have the features needed to run the PhoneBar",Loading:"Loading",NotLoggedInState:"Not available",ConnectingState:"Connecting",LoggedInState:"Available",PausedState:"Paused",ReadyState:"Available",TalkingState:"Talking",PostCallState:"In post-call",OtherCallState:"Manual call",AssignedState:"Assigned",WaitingOutboundState:"Waiting outbound call",AlertingState:"Incoming call",WaitingTransferState:"Waiting for transfer",ConnectionFailed:"Connection failed",ConnectionLost:"Connection lost",AssignmentBooked:"Booked",PauseBooked:"Pause booked",RequestRefused:"Request refused",PauseGenericReason:"Generic pause",TooltipLogin:"Log in",TooltipLoginOrReady:"Log in or ready",TooltipReady:"Ready",TooltipPause:"Pause",TooltipLogout:"Log out",TooltipCall:"Call",TooltipTransfer:"Transfer window",TooltipQueueInfo:"Display queue info",TooltipCampaignList:"Display assigned campaigns",TooltipPanic:"HELP ME!",ButtonOK:"OK",ButtonCancel:"Cancel",ButtonRefresh:"Refresh",ButtonRetry:"Retry",ButtonTransfer:"Trasferisci",IncomingCallText:"INCOMING CALL!",LoginTitle:"Enter your credentials",LoginFirstName:"First name:",LoginLastName:"Last name:",LoginPassword:"Password:",LoginExtension:"Extension:",TransferTitle:"Call transfer",TransferCampaign:"Campaign:",TransferService:"Service:",TransferAnybody:"(Anybody)",TransferMandatory:"Transfer to the selected agent only"}});namespace("Ifm.PhoneBar.Strings",{it:{UnloadPageConfirm:"Se chiudi questa pagina, le conversazioni attive saranno perdute e non potrai ricevere nuove chiamate!",NoBrowserSupport:"Questo browser non ha le funzioni necessarie per la PhoneBar",Loading:"Caricamento",NotLoggedInState:"Non disponibile",ConnectingState:"Connessione in corso",LoggedInState:"Disponibile",PausedState:"In pausa",ReadyState:"Disponibile",TalkingState:"In conversazione",PostCallState:"In post-chiamata",OtherCallState:"Chiamata manuale",AssignedState:"In assegnazione",WaitingOutboundState:"In generazione chiamata",AlertingState:"Chiamata in arrivo",WaitingTransferState:"In attesa di trasferimento",ConnectionFailed:"Connessione fallita",ConnectionLost:"Caduta connessione",AssignmentBooked:"In pre-assegnazione",PauseBooked:"Pausa prenotata",RequestRefused:"Richiesta rifiutata",PauseGenericReason:"Pausa generica",TooltipLogin:"Login",TooltipLoginOrReady:"Login o disponibile",TooltipReady:"Ritorna disponibile",TooltipPause:"Pause",TooltipLogout:"Logout",TooltipCall:"Chiama",TooltipTransfer:"Finestra di trasferimento",TooltipQueueInfo:"Mostra stato code",TooltipCampaignList:"Mostra campagne assegnate",TooltipPanic:"AIUTO!",ButtonOK:"OK",ButtonCancel:"Annulla",ButtonRefresh:"Aggiorna",ButtonRetry:"Riprova",ButtonTransfer:"Trasferisci",IncomingCallText:"CHIAMATA IN ARRIVO!",LoginTitle:"Immetti le tue credenziali",LoginFirstName:"Nome:",LoginLastName:"Cognome:",LoginPassword:"Password:",LoginExtension:"Interno:",TransferTitle:"Trasferimento di chiamata",TransferCampaign:"Campaigna:",TransferService:"Servizio:",TransferAnybody:"(Chiunque)",TransferMandatory:"Trasferisci solo all'agente selezionato"}});